var leVars={};var mQuery=jQuery.noConflict(true);window.jQuery=mQuery;window.$=mQuery;if(!String.prototype.startsWith){String.prototype.startsWith=function(searchString,position){position=position||0;return this.substr(position,searchString.length)===searchString;};}
leVars.activeRequests=0;mQuery.ajaxSetup({beforeSend:function(request,settings){if(settings.showLoadingBar){Le.startPageLoadingBar();}
if(typeof IdleTimer!='undefined'){var userLastActive=IdleTimer.getLastActive();var queryGlue=(settings.url.indexOf("?")==-1)?'?':'&';settings.url=settings.url+queryGlue+'leUserLastActive='+userLastActive;}
if(mQuery('#leLastNotificationId').length){var queryGlue=(settings.url.indexOf("?")==-1)?'?':'&';settings.url=settings.url+queryGlue+'leLastNotificationId='+mQuery('#leLastNotificationId').val();}
if(settings.type=='POST'){request.setRequestHeader('X-CSRF-Token',leAjaxCsrf);}
return true;},cache:false});mQuery(document).ajaxComplete(function(event,xhr,settings){Le.stopPageLoadingBar();xhr.always(function(response){if(response.flashes){var alerthtml=response.flashes;var alerthtmlel=mQuery(alerthtml);var alertmessage=mQuery(alerthtmlel).find('span').html();var alertType=alerthtmlel.attr('data-alert-type');if(typeof alertmessage!='undefined'){alertmessage=alertmessage.trim();}else{alertmessage='';}
if(alertmessage!=''){if(!alertmessage.includes("delete")&&!alertmessage.includes("do not have access")){if(alertType=="sweetalert"){Le.successModel('Done!',alertmessage,'success');}else{Le.setFlashes(response.flashes);}}}}else if(response.redirect){window.location=response.redirect;}});});mQuery(document).ajaxStop(function(event){leVars.activeRequests=0;Le.stopPageLoadingBar();});mQuery(document).ready(function(){if(typeof leContent!=='undefined'){mQuery("html").Core({console:false});}
if(typeof IdleTimer!='undefined'){IdleTimer.init({idleTimeout:60000,awayTimeout:900000,statusChangeUrl:leAjaxUrl+'?action=updateUserStatus'});}
mQuery(document).on('keydown',function(e){if(e.which===8&&!mQuery(e.target).is("input:not([readonly]):not([type=radio]):not([type=checkbox]), textarea, [contentEditable], [contentEditable=true]")){e.preventDefault();}});});leVars.manualStateChange=true;if(typeof History!='undefined'){History.Adapter.bind(window,'statechange',function(){if(leVars.manualStateChange==true){window.location.reload();}
leVars.manualStateChange=true;});}
leVars.iconClasses={};leVars.routeInProgress='';leVars.moderatedIntervals={};leVars.intervalsInProgress={};var Le={loadedContent:{},keyboardShortcutHtml:{},addKeyboardShortcut:function(sequence,description,func,section){Mousetrap.bind(sequence,func);var sectionName=section||'global';if(!Le.keyboardShortcutHtml.hasOwnProperty(sectionName)){Le.keyboardShortcutHtml[sectionName]={};}
Le.keyboardShortcutHtml[sectionName][sequence]='<div class="col-xs-6"><mark>'+sequence+'</mark>: '+description+'</div>';},bindGlobalKeyboardShortcuts:function(){Le.addKeyboardShortcut('shift+d','Load the Dashboard',function(e){mQuery('#le_dashboard_index').click();});Le.addKeyboardShortcut('shift+c','Load Contacts',function(e){mQuery('#le_contact_index').click();});Le.addKeyboardShortcut('shift+right','Activate Right Menu',function(e){mQuery(".navbar-right a[data-toggle='sidebar']").click();});Le.addKeyboardShortcut('shift+n','Show Notifications',function(e){mQuery('.dropdown-notification').click();});Le.addKeyboardShortcut('shift+s','Global Search',function(e){mQuery('#globalSearchContainer .search-button').click();});Le.addKeyboardShortcut('mod+z','Undo change',function(e){if(mQuery('.btn-undo').length){mQuery('.btn-undo').click();}});Le.addKeyboardShortcut('mod+shift+z','Redo change',function(e){if(mQuery('.btn-redo').length){mQuery('.btn-redo').click();}});Mousetrap.bind('?',function(e){var modalWindow=mQuery('#leSharedModal');modalWindow.find('.modal-title').html('Keyboard Shortcuts');modalWindow.find('.modal-body').html(function(){var modalHtml='';var sections=Object.keys(Le.keyboardShortcutHtml);sections.forEach(function(section){var sectionTitle=(section+'').replace(/^([a-z\u00E0-\u00FC])|\s+([a-z\u00E0-\u00FC])/g,function($1){return $1.toUpperCase();});modalHtml+='<h4>'+sectionTitle+'</h4><br />';modalHtml+='<div class="row">';var sequences=Object.keys(Le.keyboardShortcutHtml[section]);sequences.forEach(function(sequence){modalHtml+=Le.keyboardShortcutHtml[section][sequence];});modalHtml+='</div><hr />';});return modalHtml;});modalWindow.find('.modal-footer').html('<p>Press <mark>shift+?</mark> at any time to view this help modal.');modalWindow.modal();});},translate:function(id,params){if(!leLang.hasOwnProperty(id)){return id;}
var translated=leLang[id];if(params){for(var key in params){if(!params.hasOwnProperty(key))continue;var regEx=new RegExp('%'+key+'%','g');translated=translated.replace(regEx,params[key])}}
return translated;},setupBrowserNotifier:function(){notify.requestPermission();notify.config({autoClose:10000});Le.browserNotifier={isSupported:notify.isSupported,permissionLevel:notify.permissionLevel()};Le.browserNotifier.isSupported=notify.isSupported;Le.browserNotifier.permissionLevel=notify.permissionLevel();Le.browserNotifier.createNotification=function(title,options){return notify.createNotification(title,options);}},stopPageLoadingBar:function(){if(leVars.activeRequests<1){leVars.activeRequests=0;}else{leVars.activeRequests--;}
if(leVars.loadingBarTimeout){clearTimeout(leVars.loadingBarTimeout);}
if(leVars.activeRequests==0){mQuery('.loading-bar').removeClass('active');}},startPageLoadingBar:function(){mQuery('.loading-bar').addClass('active');leVars.activeRequests++;},startCanvasLoadingBar:function(){mQuery('.canvas-loading-bar').addClass('active');},startModalLoadingBar:function(modalTarget){mQuery(modalTarget+' .modal-loading-bar').addClass('active');},stopCanvasLoadingBar:function(){mQuery('.canvas-loading-bar').removeClass('active');},stopModalLoadingBar:function(modalTarget){mQuery(modalTarget+' .modal-loading-bar').removeClass('active');},activateButtonLoadingIndicator:function(button){button.prop('disabled',true);if(!button.find('.fa-spinner.fa-spin').length){button.append(mQuery('<i class="fa fa-fw fa-spinner fa-spin"></i>'));}},removeButtonLoadingIndicator:function(button){button.prop('disabled',false);button.find('.fa-spinner').remove();},activateLabelLoadingIndicator:function(el){var labelSpinner=mQuery("label[for='"+el+"']");Le.labelSpinner=mQuery('<i class="fa fa-fw fa-spinner fa-spin"></i>');labelSpinner.append(Le.labelSpinner);},removeLabelLoadingIndicator:function(){mQuery(Le.labelSpinner).remove();},loadNewWindow:function(options){if(options.windowUrl){Le.startModalLoadingBar();setTimeout(function(){var opener=window.open(options.windowUrl,'mauticpopup','height=600,width=1100');if(!opener||opener.closed||typeof opener.closed=='undefined'){alert(leLang.popupBlockerMessage);}else{opener.onload=function(){Le.stopModalLoadingBar();Le.stopIconSpinPostEvent();};}},100);}},loadScript:function(url,onLoadCallback,alreadyLoadedCallback){if(typeof Le.headLoadedAssets=='undefined'){Le.headLoadedAssets={};}else if(typeof Le.headLoadedAssets[url]!='undefined'){if(alreadyLoadedCallback&&typeof Le[alreadyLoadedCallback]=='function'){Le[alreadyLoadedCallback]();}
return;}
Le.headLoadedAssets[url]=1;mQuery.getScript(url,function(data,textStatus,jqxhr){if(textStatus=='success'){if(onLoadCallback&&typeof Le[onLoadCallback]=='function'){Le[onLoadCallback]();}else if(typeof Le[leContent+"OnLoad"]=='function'){if(typeof Le.loadedContent[leContent]=='undefined'){Le.loadedContent[leContent]=true;Le[leContent+"OnLoad"]('#app-content',{});}}}});},loadStylesheet:function(url){if(typeof Le.headLoadedAssets=='undefined'){Le.headLoadedAssets={};}else if(typeof Le.headLoadedAssets[url]!='undefined'){return;}
Le.headLoadedAssets[url]=1;var link=document.createElement("link");link.type="text/css";link.rel="stylesheet";link.href=url;mQuery('head').append(link);},startIconSpinOnEvent:function(target){if(leVars.ignoreIconSpin){leVars.ignoreIconSpin=false;return;}
if(typeof target=='object'&&typeof(target.target)!=='undefined'){target=target.target;}
if(mQuery(target).length){var hasBtn=mQuery(target).hasClass('btn');var hasIcon=mQuery(target).hasClass('fa');var dontspin=mQuery(target).hasClass('btn-nospin');var i=(hasBtn&&mQuery(target).find('i.fa').length)?mQuery(target).find('i.fa'):target;if(!dontspin&&((hasBtn&&mQuery(target).find('i.fa').length)||hasIcon)){var el=(hasIcon)?target:mQuery(target).find('i.fa').first();var identifierClass=(new Date).getTime();leVars.iconClasses[identifierClass]=mQuery(el).attr('class');var specialClasses=['fa-fw','fa-lg','fa-2x','fa-3x','fa-4x','fa-5x','fa-li','text-white','text-muted'];var appendClasses="";for(var i=0;i<specialClasses.length;i++){if(mQuery(el).hasClass(specialClasses[i])){appendClasses+=" "+specialClasses[i];}}
mQuery(el).removeClass();mQuery(el).addClass('fa fa-spinner fa-spin '+identifierClass+appendClasses);}}},stopIconSpinPostEvent:function(specificId){if(typeof specificId!='undefined'&&specificId in leVars.iconClasses){mQuery('.'+specificId).removeClass('fa fa-spinner fa-spin '+specificId).addClass(leVars.iconClasses[specificId]);delete leVars.iconClasses[specificId];}else{mQuery.each(leVars.iconClasses,function(index,value){mQuery('.'+index).removeClass('fa fa-spinner fa-spin '+index).addClass(value);});leVars.iconClasses={};}},redirectWithBackdrop:function(url){Le.activateBackdrop();setTimeout(function(){window.location=url;},50);},activateBackdrop:function(hideWait){if(!mQuery('#mautic-backdrop').length){var container=mQuery('<div />',{id:'mautic-backdrop'});mQuery('<div />',{'class':'modal-backdrop fade in'}).appendTo(container);if(typeof hideWait=='undefined'){mQuery('<div />',{"class":'mautic-pleasewait'}).html(leLang.pleaseWait).appendTo(container);}
container.appendTo('body');}},deactivateBackgroup:function(){if(mQuery('#mautic-backdrop').length){mQuery('#mautic-backdrop').remove();}
if(mQuery('.modal-backdrop').length){mQuery('.modal-backdrop').remove();}},executeAction:function(action,callback){if(typeof Le.activeActions=='undefined'){Le.activeActions={};}else if(typeof Le.activeActions[action]!='undefined'){return;}
Le.activeActions[action]=true;Le.dismissConfirmation();if(action.indexOf('batchExport')>=0){Le.initiateFileDownload(action);return;}
mQuery.ajax({showLoadingBar:true,url:action,type:"POST",dataType:"json",success:function(response){Le.processPageContent(response);if(typeof callback=='function'){callback(response);}},error:function(request,textStatus,errorThrown){Le.processAjaxError(request,textStatus,errorThrown);},complete:function(){delete Le.activeActions[action]}});},processAjaxError:function(request,textStatus,errorThrown,mainContent){if(textStatus=='abort'){Le.stopPageLoadingBar();Le.stopCanvasLoadingBar();Le.stopIconSpinPostEvent();return;}
var inDevMode=typeof leEnv!=='undefined'&&leEnv=='dev';if(inDevMode){console.log(request);}
if(typeof request.responseJSON!=='undefined'){response=request.responseJSON;}else{var errorStart=request.responseText.indexOf('{"newContent');var jsonString=request.responseText.slice(errorStart);if(jsonString){try{var response=mQuery.parseJSON(jsonString);if(inDevMode){console.log(response);}}catch(err){if(inDevMode){console.log(err);}}}else{response={};}}
if(response){if(response.newContent&&mainContent){mQuery('#app-content .content-body').html(response.newContent);if(response.route&&response.route.indexOf("ajax")==-1){leVars.manualStateChange=false;if(response.route.indexOf("validate")==-1){History.pushState(null,productBrandName,response.route);}}}else if(response.newContent&&mQuery('.modal.in').length){mQuery('.modal.in .modal-body-content').html(response.newContent);mQuery('.modal.in .modal-body-content').removeClass('hide');if(mQuery('.modal.in  .loading-placeholder').length){mQuery('.modal.in  .loading-placeholder').addClass('hide');}}else if(inDevMode){console.log(response);if(response.errors&&response.errors[0]&&response.errors[0].message){alert(response.errors[0].message);}}}
Le.stopPageLoadingBar();Le.stopCanvasLoadingBar();Le.stopIconSpinPostEvent();},setModeratedInterval:function(key,callback,timeout,params){if(typeof leVars.intervalsInProgress[key]!='undefined'){clearTimeout(leVars.moderatedIntervals[key]);}else{leVars.intervalsInProgress[key]=true;if(typeof params=='undefined'){params=[];}
if(typeof callback=='function'){callback(params);}else{window["Le"][callback].apply('window',params);}}
leVars.moderatedIntervals[key]=setTimeout(function(){Le.setModeratedInterval(key,callback,timeout,params)},timeout);},moderatedIntervalCallbackIsComplete:function(key){delete leVars.intervalsInProgress[key];},clearModeratedInterval:function(key){Le.moderatedIntervalCallbackIsComplete(key);clearTimeout(leVars.moderatedIntervals[key]);delete leVars.moderatedIntervals[key];},setFlashes:function(flashes){mQuery('#flashes').append(flashes);mQuery('#flashes .alert-new').each(function(){var me=this;window.setTimeout(function(){mQuery(me).fadeTo(500,0).slideUp(500,function(){mQuery(this).remove();});},6000);mQuery(this).removeClass('alert-new');});},setBrowserNotifications:function(notifications){mQuery.each(notifications,function(key,notification){Le.browserNotifier.createNotification(notification.title,{body:notification.message,icon:notification.icon});});},setNotifications:function(notifications){if(notifications.lastId){mQuery('#leLastNotificationId').val(notifications.lastId);}
if(mQuery('#notifications .le-update')){mQuery('#notifications .le-update').remove();}
if(notifications.hasNewNotifications){if(mQuery('#newNotificationIndicator').hasClass('hide')){mQuery('#newNotificationIndicator').removeClass('hide');}}
if(notifications.content){mQuery('#notifications').prepend(notifications.content);if(!mQuery('#notificationLEbot').hasClass('hide')){mQuery('#notificationLEbot').addClass('hide');}}
if(notifications.sound){mQuery('.playSound').remove();mQuery.playSound(notifications.sound);}},showNotifications:function(){mQuery("#notificationsDropdown").unbind('hide.bs.dropdown');mQuery('#notificationsDropdown').on('hidden.bs.dropdown',function(){if(!mQuery('#newNotificationIndicator').hasClass('hide')){mQuery('#notifications .is-unread').remove();mQuery('#newNotificationIndicator').addClass('hide');}});},clearNotification:function(id){if(id){mQuery("#notification"+id).fadeTo("fast",0.01).slideUp("fast",function(){mQuery(this).find("*[data-toggle='tooltip']").tooltip('destroy');mQuery(this).remove();if(!mQuery('#notifications .notification').length){if(mQuery('#notificationLEbot').hasClass('hide')){mQuery('#notificationLEbot').removeClass('hide');}}});}else{mQuery("#notifications .notification").fadeOut(300,function(){mQuery(this).remove();if(mQuery('#notificationLEbot').hasClass('hide')){mQuery('#notificationLEbot').removeClass('hide');}});}
mQuery.ajax({url:leAjaxUrl,type:"GET",data:"action=clearNotification&id="+id});},ajaxActionRequest:function(action,data,successClosure,showLoadingBar,queue){if(typeof Le.ajaxActionXhrQueue=='undefined'){Le.ajaxActionXhrQueue={};}
if(typeof Le.ajaxActionXhr=='undefined'){Le.ajaxActionXhr={};}else if(typeof Le.ajaxActionXhr[action]!='undefined'){if(queue){if(typeof Le.ajaxActionXhrQueue[action]=='undefined'){Le.ajaxActionXhrQueue[action]=[];}
Le.ajaxActionXhrQueue[action].push({action:action,data:data,successClosure:successClosure,showLoadingBar:showLoadingBar});return;}else{Le.removeLabelLoadingIndicator();Le.ajaxActionXhr[action].abort();}}
if(typeof showLoadingBar=='undefined'){showLoadingBar=false;}
Le.ajaxActionXhr[action]=mQuery.ajax({url:leAjaxUrl+'?action='+action,type:'POST',data:data,showLoadingBar:showLoadingBar,success:function(response){if(typeof successClosure=='function'){successClosure(response);}},error:function(request,textStatus,errorThrown){Le.processAjaxError(request,textStatus,errorThrown,true);},complete:function(){delete Le.ajaxActionXhr[action];if(typeof Le.ajaxActionXhrQueue[action]!=='undefined'&&Le.ajaxActionXhrQueue[action].length){var next=Le.ajaxActionXhrQueue[action].shift();Le.ajaxActionRequest(next.action,next.data,next.successClosure,next.showLoadingBar,false);}}});},isLocalStorageSupported:function(){try{localStorage.setItem('Le.test','mautic');localStorage.removeItem('Le.test');return true;}catch(e){return false;}},removeActionButtons:function(){mQuery('html').click(function(){mQuery('.md-fab-animated').removeClass('md-fab-animated md-fab-active');mQuery('.md-fab-primary').css("width",'28px');mQuery('.md-fab-toolbar-actions').css("display","none");});mQuery('.md-fab-primary').click(function(event){event.stopPropagation();});},closeLicenseButton:function(){var x=document.getElementById("licenseclosediv");if(x.style.display==="none"){x.style.display="block";}else{x.style.display="none";mQuery('#licenseclosediv').addClass('hide');}},closeSMSNotification:function(){var x=document.getElementById("licenseclosediv");if(x.style.display==="none"){x.style.display="block";}else{mQuery('.sms-notifiation').addClass('hide');}}};;Le.loadContent=function(route,link,method,target,showPageLoading,callback,data){if(typeof Le.loadContentXhr=='undefined'){Le.loadContentXhr={};}else if(typeof Le.loadContentXhr[target]!='undefined'){Le.loadContentXhr[target].abort();}
Le.showPageLoading=(typeof showPageLoading=='undefined'||showPageLoading)?true:false;Le.loadContentXhr[target]=mQuery.ajax({showLoadingBar:showPageLoading,url:route,type:method,dataType:"json",data:data,success:function(response){if(response){response.stopPageLoading=showPageLoading;if(response.callback){window["Le"][response.callback].apply('window',[response]);return;}
if(response.redirect){Le.redirectWithBackdrop(response.redirect);}else if(target||response.target){if(target)response.target=target;Le.processPageContent(response);}else{leVars.liveCache=new Array();leVars.lastSearchStr='';if(typeof response.route==='undefined'){response.route=route;}
if(typeof response.activeLink==='undefined'&&link){response.activeLink=link;}
Le.processPageContent(response);}
Le.stopIconSpinPostEvent();}
leVars.routeInProgress='';},error:function(request,textStatus,errorThrown){Le.processAjaxError(request,textStatus,errorThrown,true);leVars.routeInProgress='';Le.stopIconSpinPostEvent();Le.stopPageLoadingBar();},complete:function(){if(typeof callback!=='undefined'){if(typeof callback=='function'){callback();}else{window["Le"][callback].apply('window',[]);}}
Le.generatePageTitle(route);delete Le.loadContentXhr[target];}});return false;};Le.generatePageTitle=function(route){if(-1!==route.indexOf('timeline')){return}else if(-1!==route.indexOf('view')){var currentModule=route.split('/')[3];var titleWithHTML=mQuery('.page-header h3').find('span.span-block');var currentModuleItem='';if(1<titleWithHTML.length){currentModuleItem=titleWithHTML.eq(0).text()+' - '+titleWithHTML.eq(1).text();}else{currentModuleItem=mQuery('.page-header h3').text();}
currentModuleItem=mQuery('<div>'+currentModuleItem+'</div>').text();mQuery('title').html(currentModuleItem+' | '+productBrandName);}else{mQuery('title').html(mQuery('.page-header h3').html()+' | '+productBrandName);}};Le.processPageContent=function(response){if(response){Le.deactivateBackgroup();if(response.errors&&'dev'==leEnv){alert(response.errors[0].message);console.log(response.errors);}
if(!response.target){response.target='#app-content';}
Le.onPageUnload(response.target,response);if(response.newContent){if(response.replaceContent&&response.replaceContent=='true'){mQuery(response.target).replaceWith(response.newContent);}else{mQuery(response.target).html(response.newContent);}}
if(response.notifications){Le.setNotifications(response.notifications);}
if(response.browserNotifications){Le.setBrowserNotifications(response.browserNotifications);}
if(response.route){leVars.manualStateChange=false;History.pushState(null,productBrandName,response.route);Le.generatePageTitle(response.route);}
if(response.target=='#app-content'){if(response.leContent){leContent=response.leContent;}
if(response.activeLink){var link=response.activeLink;if(link!==undefined&&link.charAt(0)!='#'){link="#"+link;}
var parent=mQuery(link).parent();mQuery(".nav-sidebar").find(".active").removeClass("active");parent.addClass("active");var openParent=parent.closest('li.open');mQuery(".nav-sidebar").find(".open").each(function(){if(!openParent.hasClass('open')||(openParent.hasClass('open')&&openParent[0]!==mQuery(this)[0])){mQuery(this).removeClass('open');mQuery(this).find("ul").removeClass("in");}});}
mQuery('body').animate({scrollTop:0},0);}else{var overflow=mQuery(response.target).css('overflow');var overflowY=mQuery(response.target).css('overflowY');if(overflow=='auto'||overflow=='scroll'||overflowY=='auto'||overflowY=='scroll'){mQuery(response.target).animate({scrollTop:0},0);}}
if(response.overlayEnabled){mQuery(response.overlayTarget+' .content-overlay').remove();}
Le.onPageLoad(response.target,response);}};Le.onPageLoad=function(container,response,inModal){Le.initDateRangePicker(container+' #daterange_date_from',container+' #daterange_date_to');Le.makeLinksAlive(mQuery(container+" a[data-toggle='ajax']"));mQuery(container+" form[data-toggle='ajax']").each(function(index){Le.ajaxifyForm(mQuery(this).attr('name'));});Le.makeModalsAlive(mQuery(container+" *[data-toggle='ajaxmodal']"))
Le.activateModalEmbeddedForms(container);mQuery(container+" *[data-toggle='livesearch']").each(function(index){Le.activateLiveSearch(mQuery(this),"lastSearchStr","liveCache");});mQuery(container+" *[data-toggle='listfilter']").each(function(index){Le.activateListFilterSelect(mQuery(this));});var pageTooltips=mQuery(container+" *[data-toggle='tooltip']");pageTooltips.tooltip({html:true,container:'body'});pageTooltips.each(function(i){var thisTooltip=mQuery(pageTooltips.get(i));var elementParent=thisTooltip.parent();if(elementParent.get(0).tagName==='LABEL'){elementParent.append('<i class="fa fa-question-circle"></i>');elementParent.hover(function(){thisTooltip.tooltip('show')},function(){thisTooltip.tooltip('hide');});}});mQuery(container+" *[data-toggle='sortablelist']").each(function(index){Le.activateSortable(this);});mQuery(container+" div.sortable-panels").each(function(){Le.activateSortablePanels(this);});mQuery(container+" a[data-toggle='download']").off('click.download');mQuery(container+" a[data-toggle='download']").on('click.download',function(event){event.preventDefault();Le.initiateFileDownload(mQuery(this).attr('href'));});Le.makeConfirmationsAlive(mQuery(container+" a[data-toggle='confirmation']"));mQuery(container+" *[data-toggle='datetime']").each(function(){Le.activateDateTimeInputs(this,'datetime');});mQuery(container+" *[data-toggle='date']").each(function(){Le.activateDateTimeInputs(this,'date');});mQuery(container+" *[data-toggle='time']").each(function(){Le.activateDateTimeInputs(this,'time');});mQuery(container+" *[data-onload-callback]").each(function(){var callback=function(el){if(typeof window["Le"][mQuery(el).attr('data-onload-callback')]=='function'){window["Le"][mQuery(el).attr('data-onload-callback')].apply('window',[el]);}}
mQuery(document).ready(callback(this));});mQuery(container+" input[data-toggle='color']").each(function(){Le.activateColorPicker(this);});mQuery(container+" select").not('.multiselect, .not-chosen').each(function(){Le.activateChosenSelect(this);});mQuery(container+" select.multiselect").each(function(){Le.activateMultiSelect(this);});mQuery(container+" *[data-toggle='field-lookup']").each(function(index){var target=mQuery(this).attr('data-target');var options=mQuery(this).attr('data-options');var field=mQuery(this).attr('id');var action=mQuery(this).attr('data-action');Le.activateFieldTypeahead(field,target,options,action);});mQuery(container+" .table-responsive").on('shown.bs.dropdown',function(e){var table=mQuery(this),menu=mQuery(e.target).find(".dropdown-menu"),tableOffsetHeight=table.offset().top+table.height(),menuOffsetHeight=menu.offset().top+menu.outerHeight(true);if(menuOffsetHeight>tableOffsetHeight)
table.css("padding-bottom",menuOffsetHeight-tableOffsetHeight+16)});mQuery(container+" .table-responsive").on("hide.bs.dropdown",function(){mQuery(this).css("padding-bottom",0);})
mQuery(container+" .nav-tabs[data-toggle='tab-hash']").each(function(){var hash=document.location.hash;var prefix='tab-';if(hash){var hashPieces=hash.split('?');hash=hashPieces[0].replace("#","#"+prefix);var activeTab=mQuery(this).find('a[href='+hash+']').first();if(mQuery(activeTab).length){mQuery('.nav-tabs li').removeClass('active');mQuery('.tab-pane').removeClass('in active');mQuery(activeTab).parent().addClass('active');mQuery(hash).addClass('in active');}}
mQuery(this).find('a').on('shown.bs.tab',function(e){window.location.hash=e.target.hash.replace("#"+prefix,"#");});});mQuery(container+" .nav-overflow-tabs ul").each(function(){Le.activateOverflowTabs(this);});mQuery(container+" .nav.sortable").each(function(){Le.activateSortableTabs(this);});Le.activateTabDeleteButtons(container);mQuery(container+' .btn:not(.btn-nospin)').on('click.spinningicons',function(event){Le.startIconSpinOnEvent(event);});mQuery(container+' input[class=list-checkbox]').on('change',function(){var disabled=Le.batchActionPrecheck(container)?false:true;var color=(disabled)?'btn-default':'btn-info';var button=container+' th.col-actions .input-group-btn button';mQuery(button).prop('disabled',disabled);mQuery(button).removeClass('btn-default btn-info').addClass(color);});mQuery(container+" .bottom-form-buttons").each(function(){if(inModal||mQuery(this).closest('.modal').length){var modal=(inModal)?container:mQuery(this).closest('.modal');if(mQuery(modal).find('.modal-form-buttons').length){mQuery(modal).find('.bottom-form-buttons').addClass('hide');var buttons=mQuery(modal).find('.bottom-form-buttons').html();mQuery(modal).find('.modal-form-buttons').html('');mQuery(buttons).filter("button").each(function(i,v){var id=mQuery(this).attr('id');var button=mQuery("<button type='button' />").addClass(mQuery(this).attr('class')).addClass('btn-copy').html(mQuery(this).html()).appendTo(mQuery(modal).find('.modal-form-buttons')).on('click.ajaxform',function(event){if(mQuery(this).hasClass('disabled')){return false;}
if(!mQuery(this).hasClass('btn-dnd')){mQuery(this).parent().find('button').prop('disabled',true);}
event.preventDefault();if(!mQuery(this).hasClass('btn-nospin')){Le.startIconSpinOnEvent(event);}
mQuery('#'+id).click();});});}}else{mQuery('.toolbar-action-buttons').addClass('hide');if(mQuery('.toolbar-form-buttons').hasClass('hide')){mQuery(container+' .bottom-form-buttons').addClass('hide');var buttons=mQuery(container+" .bottom-form-buttons").html();mQuery(container+' .toolbar-form-buttons .toolbar-standard').html('');mQuery(container+' .toolbar-form-buttons .toolbar-dropdown .drop-menu').html('');var lastIndex=mQuery(buttons).filter("button").length-1;mQuery(buttons).filter("button").each(function(i,v){var id=mQuery(this).attr('id');var buttonClick=function(event){event.preventDefault();Le.startIconSpinOnEvent(event);mQuery('#'+id).click();};mQuery("<button type='button' />").addClass(mQuery(this).attr('class')).addClass('btn-copy').attr('id',mQuery(this).attr('id')+'_toolbar').html(mQuery(this).html()).on('click.ajaxform',buttonClick).appendTo('.toolbar-form-buttons .toolbar-standard');if(i===lastIndex){mQuery(".toolbar-form-buttons .toolbar-dropdown .btn-main").off('.ajaxform').attr('id',mQuery(this).attr('id')+'_toolbar_mobile').html(mQuery(this).html()).on('click.ajaxform',buttonClick);}else{mQuery("<a />").attr('id',mQuery(this).attr('id')+'_toolbar_mobile').html(mQuery(this).html()).on('click.ajaxform',buttonClick).appendTo(mQuery('<li />').prependTo('.toolbar-form-buttons .toolbar-dropdown .dropdown-menu'))}});if(!location.href.match(/(form|page|drip|broadcast)/i)){mQuery('.toolbar-form-buttons').removeClass('hide');}}}});Le.activateGlobalFroalaOptions();if(mQuery(container+' textarea.editor').length){mQuery(container+' textarea.editor').each(function(){var textarea=mQuery(this);if(textarea.hasClass('editor-builder-tokens')){textarea.on('froalaEditor.initialized',function(e,editor){Le.initAtWho(editor.$el,textarea.attr('data-token-callback'),editor);});textarea.on('froalaEditor.focus',function(e,editor){Le.initAtWho(editor.$el,textarea.attr('data-token-callback'),editor);});}
textarea.on('froalaEditor.blur',function(e,editor){editor.popups.hideAll();});var maxButtons=['undo','redo','|','bold','italic','underline','paragraphFormat','fontFamily','fontSize','color','align','formatOL','formatUL','quote','clearFormatting','insertLink','insertImage','insertGatedVideo','insertTable','fullscreen','html','token'];var minButtons=['undo','redo','|','bold','italic','underline'];if(textarea.hasClass('editor-email')){maxButtons=mQuery.grep(maxButtons,function(value){return value!='insertGatedVideo';});maxButtons.push('dynamicContent');}
if(textarea.hasClass('editor-dynamic-content')){minButtons=['undo','redo','|','bold','italic','underline','paragraphFormat','fontFamily','fontSize','color','align','formatOL','formatUL','quote','clearFormatting','insertLink','insertImage','insertGatedVideo','insertTable','html','fullscreen'];}
if(textarea.hasClass('editor-basic')){minButtons=['undo','redo','|','bold','italic','underline','paragraphFormat','fontFamily','fontSize','color','align','formatOL','formatUL','quote','clearFormatting','insertLink','insertImage','insertTable','html','fullscreen'];}
if(textarea.hasClass('editor-advanced')||textarea.hasClass('editor-basic-fullpage')){var options={toolbarButtons:maxButtons,toolbarButtonsMD:maxButtons,heightMin:300};if(textarea.hasClass('editor-basic-fullpage')){options.fullPage=true;options.htmlAllowedTags=['.*'];options.htmlAllowedAttrs=['.*'];options.htmlRemoveTags=[];options.lineBreakerTags=[];}
textarea.on('froalaEditor.focus',function(e,editor){Le.showChangeThemeWarning=true;});textarea.froalaEditor(mQuery.extend({},Le.basicFroalaOptions,options));}else{textarea.froalaEditor(mQuery.extend({},Le.basicFroalaOptions,{toolbarButtons:minButtons,toolbarButtonsMD:minButtons,toolbarButtonsSM:minButtons,toolbarButtonsXS:minButtons,heightMin:100}));}});}
if(mQuery(container+' .shuffle-grid').length){var grid=mQuery(container+" .shuffle-grid");setTimeout(function(){grid.shuffle({itemSelector:".shuffle",sizer:false});mQuery("html").on("fa.sidebar.minimize",function(){grid.shuffle("update");}).on("fa.sidebar.maximize",function(){grid.shuffle("update");});if(grid.parents('.tab-pane').length){var tabId=grid.parents('.tab-pane').first().attr('id');var tab=mQuery('a[href="#'+tabId+'"]').on('shown.bs.tab',function(){grid.shuffle("update");});}},1000);}
if(mQuery(container+' .dropdown-menu-form').length){mQuery(container+' .dropdown-menu-form').on('click',function(e){e.stopPropagation();});}
if(response&&response.updateSelect&&typeof response.id!=='undefined'){Le.updateEntitySelect(response);}
var contentSpecific=false;if(response&&response.leContent){contentSpecific=response.leContent;}else if(container=='body'){contentSpecific=leContent;}
if(response&&response.sidebar){var sidebarContent=mQuery('.app-sidebar.sidebar-left');var newSidebar=mQuery(response.sidebar);var nav=sidebarContent.find('li');if(nav.length){var openNavIndex;nav.each(function(i,el){var $el=mQuery(el);if($el.hasClass('open')){openNavIndex=i;}});var openNav=mQuery(newSidebar.find('li')[openNavIndex]);openNav.addClass('open');openNav.find('ul').removeClass('collapse');}
sidebarContent.html(newSidebar);}
if(container=='#app-content'||container=='body'){Le.bindGlobalKeyboardShortcuts();mQuery(".sidebar-left a[data-toggle='ajax']").on('click.ajax',function(event){mQuery("html").removeClass('sidebar-open-ltr');mQuery('.nav-sidebar li.nav-group').removeClass('hover');});mQuery('.sidebar-right a[data-toggle="ajax"]').on('click.ajax',function(event){mQuery("html").removeClass('sidebar-open-rtl');});}
if(contentSpecific&&typeof Le[contentSpecific+"OnLoad"]=='function'){if(inModal||typeof Le.loadedContent[contentSpecific]=='undefined'){var date=new Date();var days=365;date.setTime(+date+(days*86400000));var customerUrl=window.location.href;window.document.cookie="le_customer_url="+customerUrl+";expires="+date.toGMTString()+";domain=."+productBrandName+".com; path=/";Le.loadedContent[contentSpecific]=true;Le[contentSpecific+"OnLoad"](container,response);}}
if(!inModal&&container=='body'){mQuery('#notificationsDropdown').on('click',function(e){if(mQuery(e.target).hasClass('do-not-close')){e.stopPropagation();}});if(mQuery('#globalSearchContainer').length){mQuery('#globalSearchContainer .search-button').click(function(){mQuery('#globalSearchContainer').addClass('active');if(mQuery('#globalSearchInput').val()){mQuery('#globalSearchDropdown').addClass('open');}
setTimeout(function(){mQuery('#globalSearchInput').focus();},100);});Le.enableGlobalSearchListener();mQuery("#globalSearchInput").on('change keyup paste',function(){if(mQuery(this).val()){mQuery('#globalSearchDropdown').addClass('open');Le.enableGlobalSearchListener();}else{mQuery('#globalSearchDropdown').removeClass('open');}});Le.activateLiveSearch("#globalSearchInput","lastGlobalSearchStr","globalLivecache");}}
Le.renderCharts(container);Le.renderMaps(container);Le.stopIconSpinPostEvent();if((response&&typeof response.stopPageLoading!='undefined'&&response.stopPageLoading)||container=='#app-content'||container=='.page-list'){Le.stopPageLoadingBar();}
if(contentSpecific!="invalidDomain"){mQuery('.license-notifiation').addClass('hide');Le.loadLicenseUsageInfo();}
Le.configureFullScreenSettings();Le.checkImportHistory();};Le.enableGlobalSearchListener=function(){mQuery('body').on('click.globalsearch',function(event){var target=event.target;if(!mQuery(target).parents('#globalSearchContainer').length&&!mQuery(target).parents('#globalSearchDropdown').length){Le.closeGlobalSearchResults();}});}
Le.makeConfirmationsAlive=function(jQueryObject){jQueryObject.off('click.confirmation');jQueryObject.on('click.confirmation',function(event){event.preventDefault();leVars.ignoreIconSpin=true;return Le.showConfirmation(this);});};Le.makeModalsAlive=function(jQueryObject){jQueryObject.off('click.ajaxmodal');jQueryObject.on('click.ajaxmodal',function(event){event.preventDefault();Le.ajaxifyModal(this,event);});};Le.makeLinksAlive=function(jQueryObject){jQueryObject.off('click.ajax');jQueryObject.on('click.ajax',function(event){event.preventDefault();return Le.ajaxifyLink(this,event);});};Le.onPageUnload=function(container,response){if(typeof container!='undefined'){mQuery(container+" *[data-toggle='tooltip']").tooltip('destroy');if(typeof leVars.modalsReset=='undefined'){leVars.modalsReset={};}
mQuery(container+' textarea.editor').each(function(){mQuery('textarea.editor').froalaEditor('destroy');});mQuery('html').off('fa.sidebar.minimize').off('fa.sidebar.maximize');mQuery(container+" input[data-toggle='color']").each(function(){mQuery(this).minicolors('destroy');});}
var contentSpecific=false;if(container=='#app-content'){Mousetrap.reset();contentSpecific=leContent;if(typeof Le.chartObjects!=='undefined'){mQuery.each(Le.chartObjects,function(i,chart){chart.destroy();});Le.chartObjects=[];}
if(typeof Le.mapObjects!=='undefined'){mQuery.each(Le.mapObjects,function(i,map){Le.destroyMap(map);});Le.mapObjects=[];}
if(typeof Le.builderTokens!=='undefined'){Le.builderTokens={};}}else if(response&&response.leContent){contentSpecific=response.leContent;}
if(contentSpecific){if(typeof Le[contentSpecific+"OnUnload"]=='function'){Le[contentSpecific+"OnUnload"](container,response);}
if(typeof Le.loadedContent[contentSpecific]!=='undefined'){delete Le.loadedContent[contentSpecific];}}};Le.ajaxifyLink=function(el,event){if(mQuery(el).hasClass('disabled')){return false;}
var route=mQuery(el).attr('href');if(route.indexOf('javascript')>=0||leVars.routeInProgress===route){return false;}
if(route.indexOf('batchExport')>=0){Le.initiateFileDownload(route);return true;}
if(event.ctrlKey||event.metaKey){route=route.split("?")[0];window.open(route,'_blank');return;}
if(mQuery(".form-exit-unlock-id").length){if(mQuery(el).attr('data-ignore-formexit')!='true'){var unlockParameter=(mQuery('.form-exit-unlock-parameter').length)?mQuery('.form-exit-unlock-parameter').val():'';Le.unlockEntity(mQuery('.form-exit-unlock-model').val(),mQuery('.form-exit-unlock-id').val(),unlockParameter);}}
var link=mQuery(el).attr('data-menu-link');if(link!==undefined&&link.charAt(0)!='#'){link="#"+link;}
var method=mQuery(el).attr('data-method');if(!method){method='GET'}
leVars.routeInProgress=route;var target=mQuery(el).attr('data-target');if(!target){target=null;}
var showLoadingBar=(mQuery(el).attr('data-hide-loadingbar'))?false:true;if(mQuery('#globalSearchContainer').length&&mQuery('#globalSearchContainer').hasClass('active')){Le.closeGlobalSearchResults();}
Le.loadContent(route,link,method,target,showLoadingBar);};Le.activateChosenSelect=function(el,ignoreGlobal,jQueryVariant){var mQuery=(typeof jQueryVariant!='undefined')?jQueryVariant:window.mQuery;if(mQuery(el).parents('.no-chosen').length&&!ignoreGlobal){return;}
var noResultsText=mQuery(el).data('no-results-text');if(!noResultsText){noResultsText=leLang['chosenNoResults'];}
var isLookup=mQuery(el).attr('data-chosen-lookup');if(isLookup){if(mQuery(el).attr('data-new-route')){mQuery(el).on('change',function(){var url=mQuery(el).attr('data-new-route');if(mQuery(el).val()=='new'&&(mQuery(el).attr('data-popup')=="true"||mQuery(el).closest('.modal').length>0)){var queryGlue=url.indexOf('?')>=0?'&':'?';mQuery(el).find('option[value="new"]').prop('selected',false);mQuery(el).trigger('chosen:updated');Le.loadNewWindow({"windowUrl":url+queryGlue+"contentOnly=1&updateSelect="+mQuery(el).attr('id')});}else{Le.loadAjaxModalBySelectValue(this,'new',url,mQuery(el).attr('data-header'));}});}
var multiPlaceholder=leLang['le.core.lookup.search_options'],singlePlaceholder=leLang['le.core.lookup.search_options'];}else{var multiPlaceholder=leLang['chosenChooseMore'],singlePlaceholder=leLang['chosenChooseOne'];}
if(typeof mQuery(el).data('chosen-placeholder')!=='undefined'){multiPlaceholder=singlePlaceholder=mQuery(el).data('chosen-placeholder');}
mQuery(el).chosen({placeholder_text_multiple:multiPlaceholder,placeholder_text_single:singlePlaceholder,no_results_text:noResultsText,width:"100%",allow_single_deselect:true,include_group_label_in_selected:true,search_contains:true});if(isLookup){var searchTerm=mQuery(el).attr('data-model');if(searchTerm){mQuery(el).ajaxChosen({type:'GET',url:leAjaxUrl+'?action='+mQuery(el).attr('data-chosen-lookup'),dataType:'json',afterTypeDelay:2,minTermLength:2,jsonTermKey:searchTerm,keepTypingMsg:"Keep typing...",lookingForMsg:"Looking for"});}}};Le.activateFieldTypeahead=function(field,target,options,action){if(options&&typeof options==='String'){var keys=values=[];options=options.split('||');if(options.length==2){keys=options[1].split('|');values=options[0].split('|');}else{values=options[0].split('|');}
var fieldTypeahead=Le.activateTypeahead('#'+field,{dataOptions:values,dataOptionKeys:keys,minLength:0});}else{var fieldTypeahead=Le.activateTypeahead('#'+field,{prefetch:true,remote:true,action:action+"&field="+target});}
var callback=function(event,datum){if(mQuery("#"+field).length&&datum["value"]){mQuery("#"+field).val(datum["value"]);var lookupCallback=mQuery('#'+field).data("lookup-callback");if(lookupCallback&&typeof Le[lookupCallback]=='function'){Le[lookupCallback](field,datum);}}};mQuery(fieldTypeahead).on('typeahead:selected',callback).on('typeahead:autocompleted',callback);};Le.activateMultiSelect=function(el){var moveOption=function(v,prev){var theOption=mQuery(el).find('option[value="'+v+'"]').first();var lastSelected=mQuery(el).find('option:not(:disabled)').filter(function(){return mQuery(this).prop('selected');}).last();if(typeof prev!=='undefined'){if(prev){var prevOption=mQuery(el).find('option[value="'+prev+'"]').first();theOption.insertAfter(prevOption);return;}}else if(lastSelected.length){theOption.insertAfter(lastSelected);return;}
theOption.prependTo(el);};mQuery(el).multiSelect({afterInit:function(container){var funcName=mQuery(el).data('afterInit');if(funcName){Le[funcName]('init',container);}
var selectThat=this,$selectableSearch=this.$selectableUl.prev(),$selectionSearch=this.$selectionUl.prev(),selectableSearchString='#'+this.$container.attr('id')+' .ms-elem-selectable:not(.ms-selected)',selectionSearchString='#'+this.$container.attr('id')+' .ms-elem-selection.ms-selected';this.qs1=$selectableSearch.quicksearch(selectableSearchString).on('keydown',function(e){if(e.which===40){selectThat.$selectableUl.focus();return false;}});this.qs2=$selectionSearch.quicksearch(selectionSearchString).on('keydown',function(e){if(e.which==40){selectThat.$selectionUl.focus();return false;}});var selectOrder=mQuery(el).data('order');if(selectOrder&&selectOrder.length>1){this.deselect_all();mQuery.each(selectOrder,function(k,v){selectThat.select(v);});}
var isSortable=mQuery(el).data('sortable');if(isSortable){mQuery(el).parent('.choice-wrapper').find('.ms-selection').first().sortable({items:'.ms-elem-selection',helper:function(e,ui){ui.width(mQuery(el).width());return ui;},axis:'y',scroll:false,update:function(event,ui){var prev=ui.item.prev();var prevValue=(prev.length)?prev.data('ms-value'):'';moveOption(ui.item.data('ms-value'),prevValue);}});}},afterSelect:function(value){var funcName=mQuery(el).data('afterSelect');if(funcName){Le[funcName]('select',value);}
this.qs1.cache();this.qs2.cache();moveOption(value);},afterDeselect:function(value){var funcName=mQuery(el).data('afterDeselect');if(funcName){Le[funcName]('deselect',value);}
this.qs1.cache();this.qs2.cache();},selectableHeader:"<input type='text' class='ms-search form-control' autocomplete='off'>",selectionHeader:"<input type='text' class='ms-search form-control' autocomplete='off'>",keepOrder:true});};Le.activateModalEmbeddedForms=function(container){mQuery(container+" *[data-embedded-form='cancel']").off('click.embeddedform');mQuery(container+" *[data-embedded-form='cancel']").on('click.embeddedform',function(event){event.preventDefault();var modal=mQuery(this).closest('.modal');mQuery(modal).modal('hide');if(mQuery(this).attr('data-embedded-form-clear')==='true'){Le.resetForm(modal);}
if(typeof mQuery(this).attr('data-embedded-form-callback')!='undefined'){if(typeof window["Le"][mQuery(this).attr('data-embedded-form-callback')]=='function'){window["Le"][mQuery(this).attr('data-embedded-form-callback')].apply('window',[this,modal]);}}});mQuery(container+" *[data-embedded-form='add']").each(function(){var submitButton=this;var modal=mQuery(this).closest('.modal');if(typeof mQuery(modal).data('bs.modal')!=='undefined'&&typeof mQuery(modal).data('bs.modal').options!=='undefined'){mQuery(modal).data('bs.modal').options.keyboard=false;mQuery(modal).data('bs.modal').options.backdrop='static';}else{mQuery(modal).attr('data-keyboard',false);mQuery(modal).attr('data-backdrop','static');}
mQuery(modal).on('show.bs.modal',function(){mQuery(this).on("keydown.embeddedForm",":input:not(textarea)",function(event){if(event.keyCode==13){event.preventDefault();if(event.metaKey||event.ctrlKey){mQuery(submitButton).click();}}});});mQuery(modal).on('hidden.bs.modal',function(){mQuery(this).off("keydown.embeddedForm",":input:not(textarea)");});});mQuery(container+" *[data-embedded-form='add']").off('click.embeddedform');mQuery(container+" *[data-embedded-form='add']").on('click.embeddedform',function(event){event.preventDefault();var modal=mQuery(this).closest('.modal');mQuery(modal).modal('hide');if(typeof mQuery(this).attr('data-embedded-form-callback')!='undefined'){if(typeof window["Le"][mQuery(this).attr('data-embedded-form-callback')]=='function'){window["Le"][mQuery(this).attr('data-embedded-form-callback')].apply('window',[this,modal]);}}});};Le.activateDateTimeInputs=function(el,type){if(typeof type=='undefined'){type='datetime';}
var format=mQuery(el).data('format');if(type=='datetime'){mQuery(el).datetimepicker({format:(format)?format:'Y-m-d H:i:s',lazyInit:true,validateOnBlur:false,allowBlank:true,scrollMonth:false,scrollInput:false});}else if(type=='date'){mQuery(el).datetimepicker({timepicker:false,format:(format)?format:'Y-m-d',lazyInit:true,validateOnBlur:false,allowBlank:true,scrollMonth:false,scrollInput:false,closeOnDateSelect:true});}else if(type=='time'){var defaultTime=false;if(el.id=='dripemailform_scheduleDate'){var scheduleDate=mQuery(el).val();defaultTime="11:00";if(scheduleDate==""){defaultTime=false;}}
mQuery(el).timepicker({showMeridian:false,minuteStep:15,defaultTime:defaultTime});}
mQuery(el).addClass('calendar-activated');};Le.activateSearchAutocomplete=function(elId,modelName){if(mQuery('#'+elId).length){var livesearch=(mQuery('#'+elId).attr("data-toggle=['livesearch']"))?true:false;var typeaheadObject=Le.activateTypeahead('#'+elId,{prefetch:true,remote:false,limit:0,action:'commandList&model='+modelName,multiple:true});mQuery(typeaheadObject).on('typeahead:selected',function(event,datum){if(livesearch){leVars.lastSearchStr='';mQuery('#'+elId).keyup();}}).on('typeahead:autocompleted',function(event,datum){if(livesearch){leVars.lastSearchStr='';mQuery('#'+elId).keyup();}});}};Le.activateLiveSearch=function(el,searchStrVar,liveCacheVar){if(!mQuery(el).length){return;}
var btn="button[data-livesearch-parent='"+mQuery(el).attr('id')+"']";mQuery(el).on('focus',function(){Le.currentSearchString=mQuery(this).val().trim();});mQuery(el).on('change keyup paste',{},function(event){var searchStr=mQuery(el).val().trim();var spaceKeyPressed=(event.which==32||event.keyCode==32);var enterKeyPressed=(event.which==13||event.keyCode==13);var deleteKeyPressed=(event.which==8||event.keyCode==8);if(!enterKeyPressed&&Le.currentSearchString&&Le.currentSearchString==searchStr){return;}
var target=mQuery(el).attr('data-target');var diff=searchStr.length-leVars[searchStrVar].length;if(diff<0){diff=parseInt(diff)*-1;}
var overlayEnabled=mQuery(el).attr('data-overlay');if(!overlayEnabled||overlayEnabled=='false'){overlayEnabled=false;}else{overlayEnabled=true;}
var overlayTarget=mQuery(el).attr('data-overlay-target');if(!overlayTarget)overlayTarget=target;if(overlayEnabled){mQuery(el).off('blur.livesearchOverlay');mQuery(el).on('blur.livesearchOverlay',function(){mQuery(overlayTarget+' .content-overlay').remove();});}
if(!deleteKeyPressed&&overlayEnabled){var overlay=mQuery('<div />',{"class":"content-overlay"}).html(mQuery(el).attr('data-overlay-text'));if(mQuery(el).attr('data-overlay-background')){overlay.css('background',mQuery(el).attr('data-overlay-background'));}
if(mQuery(el).attr('data-overlay-color')){overlay.css('color',mQuery(el).attr('data-overlay-color'));}}
if((!searchStr&&leVars[searchStrVar].length)||diff>=3||spaceKeyPressed||enterKeyPressed){leVars[searchStrVar]=searchStr;event.data.livesearch=true;Le.filterList(event,mQuery(el).attr('id'),mQuery(el).attr('data-action'),target,liveCacheVar,overlayEnabled,overlayTarget);}else if(overlayEnabled){if(!mQuery(overlayTarget+' .content-overlay').length){mQuery(overlayTarget).prepend(overlay);}}});if(mQuery(btn).length){mQuery(btn).on('click',{'parent':mQuery(el).attr('id')},function(event){var searchStr=mQuery(el).val().trim();leVars[searchStrVar]=searchStr;Le.filterButtonClicked=true;Le.filterList(event,event.data.parent,mQuery('#'+event.data.parent).attr('data-action'),mQuery('#'+event.data.parent).attr('data-target'),'liveCache',mQuery(this).attr('data-livesearch-action'));});if(mQuery(el).val()){mQuery(btn).attr('data-livesearch-action','clear');mQuery(btn+' i').removeClass('fa-search').addClass('fa-eraser');}else{mQuery(btn).attr('data-livesearch-action','search');mQuery(btn+' i').removeClass('fa-eraser').addClass('fa-search');}}};Le.activateListFilterSelect=function(el){var filterName=mQuery(el).attr('name');var isMultiple=mQuery(el).attr('multiple')?true:false;var prefixExceptions=mQuery(el).data('prefix-exceptions');if(isMultiple&&prefixExceptions){if(typeof Le.listFilterValues=='undefined'){Le.listFilterValues={};}
Le.listFilterValues[filterName]=mQuery(el).val();}
mQuery(el).on('change',function(){var filterVal=mQuery(this).val();if(filterVal==null){filterVal=[];}
if(prefixExceptions){var limited=prefixExceptions.split(',');if(filterVal.length>1){for(var i=0;i<filterVal.length;i++){if(mQuery.inArray(filterVal[i],Le.listFilterValues[filterName])==-1){var newOption=mQuery(this).find('option[value="'+filterVal[i]+'"]');var prefix=mQuery(newOption).parent().data('prefix');if(mQuery.inArray(prefix,limited)!=-1){mQuery(newOption).siblings().prop('selected',false);filterVal=mQuery(this).val();mQuery(this).trigger('chosen:updated');}}}}
Le.listFilterValues[filterName]=filterVal;}
var tmpl=mQuery(this).data('tmpl');if(!tmpl){tmpl='list';}
var filters=(isMultiple)?JSON.stringify(filterVal):filterVal;var request=window.location.pathname+'?tmpl='+tmpl+'&'+filterName+'='+filters;Le.loadContent(request,'','POST',mQuery(this).data('target'));});};Le.activateColorPicker=function(el,options){var pickerOptions=mQuery(el).data('color-options');if(!pickerOptions){pickerOptions={theme:'bootstrap',change:function(hex,opacity){mQuery(el).trigger('change.minicolors',hex);}};}
if(typeof options=='object'){pickerOptions=mQuery.extend(pickerOptions,options);}
mQuery(el).minicolors(pickerOptions);};Le.activateTypeahead=function(el,options){if(typeof options=='undefined'||!mQuery(el).length){return;}
if(typeof options.remote=='undefined'){options.remote=(options.action)?true:false;}
if(typeof options.prefetch=='undefined'){options.prefetch=false;}
if(typeof options.limit=='undefined'){options.limit=5;}
if(!options.displayKey){options.displayKey='value';}
if(typeof options.multiple=='undefined'){options.multiple=false;}
if(typeof options.minLength=='undefined'){options.minLength=2;}
if(options.prefetch||options.remote){if(typeof options.action=='undefined'){return;}
var sourceOptions={datumTokenizer:Bloodhound.tokenizers.obj.whitespace(options.displayKey),queryTokenizer:Bloodhound.tokenizers.whitespace,dupDetector:function(remoteMatch,localMatch){return(remoteMatch[options.displayKey]==localMatch[options.displayKey]);},ttl:15000,limit:options.limit};var filterClosure=function(list){if(typeof list.ignore_wdt!='undefined'){delete list.ignore_wdt;}
if(typeof list.success!='undefined'){delete list.success;}
if(typeof list=='object'){if(typeof list[0]!='undefined'){list=mQuery.map(list,function(el){return el;});}else{list=[];}}
return list;};if(options.remote){sourceOptions.remote={url:leAjaxUrl+"?action="+options.action+"&filter=%QUERY",filter:filterClosure};}
if(options.prefetch){sourceOptions.prefetch={url:leAjaxUrl+"?action="+options.action,filter:filterClosure};}
var theBloodhound=new Bloodhound(sourceOptions);theBloodhound.initialize();}else{var substringMatcher=function(strs,strKeys){return function findMatches(q,cb){var matches,substrRegex;matches=[];substrRegex=new RegExp(q,'i');mQuery.each(strs,function(i,str){if(typeof str=='object'){str=str[options.displayKey];}
if(substrRegex.test(str)){var match={};match[options.displayKey]=str;if(strKeys.length&&typeof strKeys[i]!='undefined'){match['id']=strKeys[i];}
matches.push(match);}});cb(matches);};};var lookupOptions=(options.dataOptions)?options.dataOptions:mQuery(el).data('options');var lookupKeys=(options.dataOptionKeys)?options.dataOptionKeys:[];if(!lookupOptions){return;}}
var theName=el.replace(/[^a-z0-9\s]/gi,'').replace(/[-\s]/g,'_');var theTypeahead=mQuery(el).typeahead({hint:true,highlight:true,minLength:options.minLength,multiple:options.multiple},{name:theName,displayKey:options.displayKey,source:(typeof theBloodhound!='undefined')?theBloodhound.ttAdapter():substringMatcher(lookupOptions,lookupKeys)}).on('keypress',function(event){if((event.keyCode||event.which)==13){mQuery(el).typeahead('close');}}).on('focus',function(){if(mQuery(el).typeahead('val')===''&&!options.minLength){mQuery(el).data('ttTypeahead').input.trigger('queryChanged','');}});return theTypeahead;};Le.activateSortable=function(el){var prefix=mQuery(el).attr('data-prefix');if(mQuery('#'+prefix+'_additem').length){mQuery('#'+prefix+'_additem').click(function(){var count=mQuery('#'+prefix+'_itemcount').val();var prototype=mQuery('#'+prefix+'_additem').attr('data-prototype');prototype=prototype.replace(/__name__/g,count);mQuery(prototype).appendTo(mQuery('#'+prefix+'_list div.list-sortable'));mQuery('#'+prefix+'_list_'+count).focus();count++;mQuery('#'+prefix+'_itemcount').val(count);return false;});}
mQuery('#'+prefix+'_list div.list-sortable').sortable({items:'div.sortable',handle:'span.postaddon',axis:'y',containment:'#'+prefix+'_list',stop:function(i){var order=0;mQuery('#'+prefix+'_list div.list-sortable div.input-group input').each(function(){var name=mQuery(this).attr('name');if(mQuery(this).hasClass('sortable-label')){name=name.replace(/(\[list\]\[[0-9]+\]\[label\])$/g,'')+'[list]['+order+'][label]';}else if(mQuery(this).hasClass('sortable-value')){name=name.replace(/(\[list\]\[[0-9]+\]\[value\])$/g,'')+'[list]['+order+'][value]';order++;}else{name=name.replace(/(\[list\]\[[0-9]+\])$/g,'')+'[list]['+order+']';order++;}
mQuery(this).attr('name',name);});}});};Le.closeGlobalSearchResults=function(){mQuery('#globalSearchContainer').removeClass('active');mQuery('#globalSearchDropdown').removeClass('open');mQuery('body').off('click.globalsearch');};Le.initiateFileDownload=function(link){var iframe=mQuery("<iframe/>").attr({src:link,style:"visibility:hidden;display:none"}).appendTo(mQuery('body'));};Le.showActionButtons=function(id){setTimeout(function(){mQuery('#mainClass-'+id).addClass('md-fab-animated md-fab-active');mQuery('.toolbar-actions-'+id).css("display","block");var actioButtons=document.getElementsByClassName("md-fab-toolbar-actions")[0].getElementsByTagName("a").length;if(actioButtons>4){mQuery('#mainClass-'+id).css("width",'145px');}else if(actioButtons>3){mQuery('#mainClass-'+id).css("width",'115px');}else{mQuery('#mainClass-'+id).css("width",'89px');}},750);};Le.hideFlashMessage=function(){mQuery(function(){mQuery('#flashes').delay(6000).fadeIn('normal',function(){var value=mQuery('.alert-growl  span').html();if(value.includes("verification link")){mQuery('#flashes button').delay(200000).click();}else{mQuery('#flashes button').delay(5000).click();}});});};Le.exitFullscreen=function(){if(document.exitFullscreen){document.exitFullscreen();}else if(document.mozCancelFullScreen){document.mozCancelFullScreen();}else if(document.webkitExitFullscreen){document.webkitExitFullscreen();}};Le.launchFullscreen=function(element){if(element.requestFullscreen){element.requestFullscreen();}else if(element.mozRequestFullScreen){element.mozRequestFullScreen();}else if(element.webkitRequestFullscreen){element.webkitRequestFullscreen();}else if(element.msRequestFullscreen){element.msRequestFullscreen();}};Le.toggle_fullscreen=function(){var fullscreenEnabled=document.fullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled;if(fullscreenEnabled){if(!document.fullscreenElement&&!document.mozFullScreenElement&&!document.webkitFullscreenElement&&!document.msFullscreenElement){Le.launchFullscreen(document.documentElement);}else{Le.exitFullscreen();}}};Le.configureFullScreenSettings=function(){mQuery("#btn-fullscreen").off().on('click',function(){Le.toggle_fullscreen();});};Le.errorOnLoad=function(container,response){mQuery('html').removeClass('sidebar-minimized');mQuery('#app-content').removeClass('container');};Le.downloadIpLookupDataStore=function(){var ipService=mQuery('#config_coreconfig_ip_lookup_service').val();var ipAuth=mQuery('#config_coreconfig_ip_lookup_auth').val();mQuery('#iplookup_fetch_button_container .fa-spinner').removeClass('hide');Le.ajaxActionRequest('downloadIpLookupDataStore',{service:ipService,auth:ipAuth},function(response){mQuery('#iplookup_fetch_button_container .fa-spinner').addClass('hide');if(response.message){mQuery('#iplookup_fetch_button_container').parent().removeClass('has-error').addClass('has-success');mQuery('#iplookup_fetch_button_container').next('.help-block').html(response.message);}else if(response.error){mQuery('#iplookup_fetch_button_container').parent().removeClass('has-success').addClass('has-error');mQuery('#iplookup_fetch_button_container').next('.help-block').html(response.error);}});};Le.getIpLookupFormConfig=function(){var ipService=mQuery('#config_coreconfig_ip_lookup_service').val();Le.activateLabelLoadingIndicator('config_coreconfig_ip_lookup_service');Le.ajaxActionRequest('getIpLookupForm',{service:ipService},function(response){Le.removeLabelLoadingIndicator();mQuery('#ip_lookup_config_container').html(response.html);mQuery('#ip_lookup_attribution').html(response.attribution);});};;Le.processUpdate=function(container,step,state){var baseUrl=leBasePath+'/';switch(step){case 1:mQuery.ajax({showLoadingBar:true,url:leAjaxUrl+'?action=core:updateSetUpdateLayout',dataType:'json',success:function(response){if(response.success){mQuery('div[id='+container+']').html(response.content);Le.processUpdate(container,step+1,state);}else if(response.redirect){window.location=response.redirect;}},error:function(request,textStatus,errorThrown){Le.processAjaxError(request,textStatus,errorThrown);}});break;case 2:mQuery.ajax({showLoadingBar:true,url:leAjaxUrl+'?action=core:updateDownloadPackage',dataType:'json',success:function(response){if(response.redirect){window.location=response.redirect;}else{mQuery('td[id=update-step-downloading-status]').html('<span class="hidden-xs">'+response.stepStatus+'</span>');if(response.success){mQuery('td[id=update-step-downloading-status]').append(mQuery('<i></i>').addClass('pull-right fa fa-check text-success'));mQuery('#updateTable tbody').append('<tr><td>'+response.nextStep+'</td><td id="update-step-extracting-status"><span class="hidden-xs">'+response.nextStepStatus+'</span><i class="pull-right fa fa-spinner fa-spin"></i></td></tr>');Le.processUpdate(container,step+1,state);}else{mQuery('td[id=update-step-downloading-status]').append(mQuery('<i></i>').addClass('pull-right fa fa-warning text-danger'));mQuery('div[id=main-update-panel]').removeClass('panel-default').addClass('panel-danger');mQuery('div#main-update-panel div.panel-body').prepend('<div class="alert alert-danger">'+response.message+'</div>');}}},error:function(request,textStatus,errorThrown){Le.processAjaxError(request,textStatus,errorThrown);}});break;case 3:mQuery.ajax({showLoadingBar:true,url:leAjaxUrl+'?action=core:updateExtractPackage',dataType:'json',success:function(response){if(response.redirect){window.location=response.redirect;}else{mQuery('td[id=update-step-extracting-status]').html('<span class="hidden-xs">'+response.stepStatus+'</span>');if(response.success){mQuery('td[id=update-step-extracting-status]').append(mQuery('<i></i>').addClass('pull-right fa fa-check text-success'));mQuery('#updateTable tbody').append('<tr><td>'+response.nextStep+'</td><td id="update-step-moving-status"><span class="hidden-xs">'+response.nextStepStatus+'</span><i class="pull-right fa fa-spinner fa-spin"></i></td></tr>');Le.processUpdate(container,step+1,state);}else{mQuery('td[id=update-step-extracting-status]').append(mQuery('<i></i>').addClass('pull-right fa fa-warning text-danger'));mQuery('div[id=main-update-panel]').removeClass('panel-default').addClass('panel-danger');mQuery('div#main-update-panel div.panel-body').prepend('<div class="alert alert-danger">'+response.message+'</div>');}}},error:function(request,textStatus,errorThrown){Le.processAjaxError(request,textStatus,errorThrown);}});break;case 4:mQuery.ajax({showLoadingBar:true,url:baseUrl+'upgrade/upgrade.php?task=moveBundles&updateState='+state,dataType:'json',success:function(response){if(response.redirect){window.location=response.redirect;}else{mQuery('td[id=update-step-moving-status]').html('<span class="hidden-xs">'+response.stepStatus+'</span>');if(response.error){mQuery('td[id=update-step-moving-status]').append(mQuery('<i></i>').addClass('pull-right fa fa-warning text-danger'));mQuery('div[id=main-update-panel]').removeClass('panel-default').addClass('panel-danger');mQuery('div#main-update-panel div.panel-body').prepend('<div class="alert alert-danger">'+response.message+'</div>');}else if(response.complete){mQuery('td[id=update-step-moving-status]').append(mQuery('<i></i>').addClass('pull-right fa fa-spinner fa-spin'));Le.processUpdate(container,step+1,response.updateState);}else{mQuery('td[id=update-step-moving-status]').append(mQuery('<i></i>').addClass('pull-right fa fa-spinner fa-spin'));Le.processUpdate(container,step,response.updateState);}}},error:function(request,textStatus,errorThrown){Le.processAjaxError(request,textStatus,errorThrown);}});break;case 5:mQuery.ajax({showLoadingBar:true,url:baseUrl+'upgrade/upgrade.php?task=moveCore&updateState='+state,dataType:'json',success:function(response){if(response.redirect){window.location=response.redirect;}else{mQuery('td[id=update-step-moving-status]').html('<span class="hidden-xs">'+response.stepStatus+'</span>');if(response.error){mQuery('td[id=update-step-moving-status]').append(mQuery('<i></i>').addClass('pull-right fa fa-warning text-danger'));mQuery('div[id=main-update-panel]').removeClass('panel-default').addClass('panel-danger');mQuery('div#main-update-panel div.panel-body').prepend('<div class="alert alert-danger">'+response.message+'</div>');}else if(response.complete){mQuery('td[id=update-step-moving-status]').append(mQuery('<i></i>').addClass('pull-right fa fa-spinner fa-spin'));Le.processUpdate(container,step+1,response.updateState);}else{mQuery('td[id=update-step-moving-status]').append(mQuery('<i></i>').addClass('pull-right fa fa-spinner fa-spin'));Le.processUpdate(container,step,response.updateState);}}},error:function(request,textStatus,errorThrown){Le.processAjaxError(request,textStatus,errorThrown);}});break;case 6:mQuery.ajax({showLoadingBar:true,url:baseUrl+'upgrade/upgrade.php?task=moveVendors&updateState='+state,dataType:'json',success:function(response){if(response.redirect){window.location=response.redirect;}else{mQuery('td[id=update-step-moving-status]').html('<span class="hidden-xs">'+response.stepStatus+'</span>');if(response.error){mQuery('td[id=update-step-moving-status]').append(mQuery('<i></i>').addClass('pull-right fa fa-warning text-danger'));mQuery('div[id=main-update-panel]').removeClass('panel-default').addClass('panel-danger');mQuery('div#main-update-panel div.panel-body').prepend('<div class="alert alert-danger">'+response.message+'</div>');}else if(response.complete){mQuery('td[id=update-step-moving-status]').append(mQuery('<i></i>').addClass('pull-right fa fa-check text-success'));mQuery('#updateTable tbody').append('<tr><td>'+response.nextStep+'</td><td id="update-step-cache-status"><span class="hidden-xs">'+response.nextStepStatus+'</span><i class="pull-right fa fa-spinner fa-spin"></i></td></tr>');Le.processUpdate(container,step+1,response.updateState);}else{mQuery('td[id=update-step-moving-status]').append(mQuery('<i></i>').addClass('pull-right fa fa-spinner fa-spin'));Le.processUpdate(container,step,response.updateState);}}},error:function(request,textStatus,errorThrown){Le.processAjaxError(request,textStatus,errorThrown);}});break;case 7:mQuery.ajax({showLoadingBar:true,url:baseUrl+'upgrade/upgrade.php?task=clearCache&updateState='+state,dataType:'json',success:function(response){if(response.redirect){window.location=response.redirect;}else{mQuery('td[id=update-step-cache-status]').html('<span class="hidden-xs">'+response.stepStatus+'</span>');if(response.error){mQuery('td[id=update-step-cache-status]').append(mQuery('<i></i>').addClass('pull-right fa fa-warning text-danger'));mQuery('div[id=main-update-panel]').removeClass('panel-default').addClass('panel-danger');mQuery('div#main-update-panel div.panel-body').prepend('<div class="alert alert-danger">'+response.message+'</div>');}else if(response.complete){mQuery('td[id=update-step-cache-status]').append(mQuery('<i></i>').addClass('pull-right fa fa-check text-success'));mQuery('#updateTable tbody').append('<tr><td>'+response.nextStep+'</td><td id="update-step-database-status"><span class="hidden-xs">'+response.nextStepStatus+'</span><i class="pull-right fa fa-spinner fa-spin"></i></td></tr>');Le.processUpdate(container,step+1,response.updateState);}else{mQuery('td[id=update-step-cache-status]').append(mQuery('<i></i>').addClass('pull-right fa fa-spinner fa-spin'));Le.processUpdate(container,step,response.updateState);}}},error:function(request,textStatus,errorThrown){Le.processAjaxError(request,textStatus,errorThrown);}});break;case 8:mQuery.ajax({showLoadingBar:true,url:leAjaxUrl+'?action=core:updateDatabaseMigration&finalize=1',dataType:'json',success:function(response){if(response.redirect){window.location=response.redirect;}else{mQuery('td[id=update-step-database-status]').html('<span class="hidden-xs">'+response.stepStatus+'</span>');if(response.success){mQuery('td[id=update-step-database-status]').append(mQuery('<i></i>').addClass('pull-right fa fa-check text-success'));mQuery('#updateTable tbody').append('<tr><td>'+response.nextStep+'</td><td id="update-step-finalization-status"><span class="hidden-xs">'+response.nextStepStatus+'</span><i class="pull-right fa fa-spinner fa-spin"></i></td></tr>');Le.processUpdate(container,step+1,state);}else{mQuery('td[id=update-step-database-status]').append(mQuery('<i></i>').addClass('pull-right fa fa-warning text-danger'));mQuery('div[id=main-update-panel]').removeClass('panel-default').addClass('panel-danger');mQuery('div#main-update-panel div.panel-body').prepend('<div class="alert alert-danger">'+response.message+'</div>');}}},error:function(request,textStatus,errorThrown){window.location=leBaseUrl+'/app/update/schema?update=1';}});break;case 9:mQuery.ajax({showLoadingBar:true,url:leAjaxUrl+'?action=core:updateFinalization',dataType:'json',success:function(response){if(response.redirect){window.location=response.redirect;}else{if(response.success){mQuery('div[id='+container+']').html('<div class="alert alert-le">'+response.message+'</div>');if(response.postmessage){mQuery('<div>'+response.postmessage+'</div>').insertAfter('div[id='+container+'] .alert');}}else{mQuery('td[id=update-step-finalization-status]').html('<span class="hidden-xs">'+response.stepStatus+'</span>');mQuery('td[id=update-step-finalization-status]').append(mQuery('<i></i>').addClass('pull-right fa fa-warning text-danger'));mQuery('div[id=main-update-panel]').removeClass('panel-default').addClass('panel-danger');mQuery('div#main-update-panel div.panel-body').prepend('<div class="alert alert-danger">'+response.message+'</div>');}}},error:function(request,textStatus,errorThrown){Le.processAjaxError(request,textStatus,errorThrown);}});break;}
Le.stopPageLoadingBar();};;Le.getUrlParameter=function(name){name=name.replace(/[\[]/,'\\[').replace(/[\]]/,'\\]');var regex=new RegExp('[\\?&]'+name+'=([^&#]*)');var results=regex.exec(location.search);return results===null?'':decodeURIComponent(results[1].replace(/\+/g,' '));};Le.launchBuilder=function(formName,actionName){var builder=mQuery('.builder');Le.codeMode=builder.hasClass('code-mode');Le.showChangeThemeWarning=true;mQuery('body').css('overflow-y','hidden');builder.addClass('builder-active').removeClass('hide');if(typeof actionName=='undefined'){actionName=formName;}
var builderCss={margin:"0",padding:"0",border:"none",width:"100%",height:"100%"};var themeHtml=mQuery('textarea.builder-html').val();if(Le.codeMode){var rawTokens=mQuery.map(Le.builderTokens,function(element,index){return index}).sort();Le.builderCodeMirror=CodeMirror(document.getElementById('customHtmlContainer'),{value:themeHtml,lineNumbers:true,mode:'htmlmixed',extraKeys:{"Ctrl-Space":"autocomplete"},lineWrapping:true,hintOptions:{hint:function(editor){var cursor=editor.getCursor();var currentLine=editor.getLine(cursor.line);var start=cursor.ch;var end=start;while(end<currentLine.length&&/[\w|}$]+/.test(currentLine.charAt(end)))++end;while(start&&/[\w|{$]+/.test(currentLine.charAt(start-1)))--start;var curWord=start!=end&&currentLine.slice(start,end);var regex=new RegExp('^'+curWord,'i');var result={list:(!curWord?rawTokens:mQuery(rawTokens).filter(function(idx){return(rawTokens[idx].indexOf(curWord)!==-1);})),from:CodeMirror.Pos(cursor.line,start),to:CodeMirror.Pos(cursor.line,end)};return result;}}});Le.keepPreviewAlive('builder-template-content');}else{var isPrefCenterEnabled=eval(parent.mQuery('input[name="page[isPreferenceCenter]"]:checked').val());var slots=['segmentlist','categorylist','preferredchannel','channelfrequency','saveprefsbutton'];mQuery.each(slots,function(i,s){if(isPrefCenterEnabled){mQuery('[data-slot-type='+s+']').show();}else{mQuery('[data-slot-type='+s+']').hide();}});}
var builderPanel=mQuery('.builder-panel');var builderContent=mQuery('.builder-content');var btnCloseBuilder=mQuery('.btn-close-builder');var applyBtn=mQuery('.btn-apply-builder');var panelHeight=(builderContent.css('right')=='0px')?builderPanel.height():0;var panelWidth=(builderContent.css('right')=='0px')?0:builderPanel.width();var spinnerLeft=(mQuery(window).width()-panelWidth-60)/2;var spinnerTop=(mQuery(window).height()-panelHeight-60)/2;var form=mQuery('form[name='+formName+']');applyBtn.off('click').on('click',function(e){Le.activateButtonLoadingIndicator(applyBtn);Le.sendBuilderContentToTextarea(function(){document.getElementById('builder-template-content').contentWindow.Le.destroySlots();mQuery('#slot-form-container, #section-form-container').html('');Le.inBuilderSubmissionOn(form);var bgApplyBtn=mQuery('.btn-apply');if(0===bgApplyBtn.length&&("1"===Le.getUrlParameter('contentOnly')||Le.isInBuilder)){var frm=mQuery('.btn-save').closest('form');Le.inBuilderSubmissionOn(frm);frm.submit();Le.inBuilderSubmissionOff();}else{bgApplyBtn.trigger('click');}
Le.inBuilderSubmissionOff();},true);});builderPanel.on('scroll',function(e){if(mQuery.find('.fr-popup:visible').length){if(!Le.isInViewport(builderPanel.find('.fr-view:visible'))){builderPanel.find('.fr-view:visible').blur();builderPanel.find('input:focus').blur();}}else{builderPanel.find('input:focus').blur();}});var overlay=mQuery('<div id="builder-overlay" class="modal-backdrop fade in"><div style="position: absolute; top:'+spinnerTop+'px; left:'+spinnerLeft+'px" class="builder-spinner"><i class="fa fa-spinner fa-spin fa-5x"></i></div></div>').css(builderCss).appendTo('.builder-content');btnCloseBuilder.prop('disabled',true);applyBtn.prop('disabled',true);var assets=Le.htmlspecialchars_decode(mQuery('[data-builder-assets]').html());themeHtml=themeHtml.replace('</head>',assets+'</head>');Le.initBuilderIframe(themeHtml,btnCloseBuilder,applyBtn);};Le.isInViewport=function(el){var elementTop=mQuery(el).offset().top;var elementBottom=elementTop+mQuery(el).outerHeight();var viewportTop=mQuery(window).scrollTop();var viewportBottom=viewportTop+mQuery(window).height();return elementBottom>viewportTop&&elementTop<viewportBottom;};Le.inBuilderSubmissionOn=function(form){var inBuilder=mQuery('<input type="hidden" name="inBuilder" value="1" />');form.append(inBuilder);}
Le.inBuilderSubmissionOff=function(form){Le.isInBuilder=false;mQuery('input[name="inBuilder"]').remove();}
Le.processBuilderErrors=function(response){if(response.validationError){mQuery('.btn-apply-builder').attr('disabled',true);Le.closeCampaignBuilder();}};Le.formatCode=function(){Le.builderCodeMirror.autoFormatRange({line:0,ch:0},{line:Le.builderCodeMirror.lineCount()});}
Le.openMediaManager=function(){Le.openServerBrowser(leBasePath+'/'+leAssetPrefix+'app/bundles/CoreBundle/Assets/js/libraries/ckeditor/filemanager/index.html?type=Images',screen.width*0.7,screen.height*0.7);}
Le.setFileUrl=function(url,width,height,alt){Le.insertTextAtCMCursor(url);}
Le.insertTextAtCMCursor=function(text){var doc=Le.builderCodeMirror.getDoc();var cursor=doc.getCursor();doc.replaceRange(text,cursor);}
Le.openServerBrowser=function(url,width,height){var iLeft=(screen.width-width)/2;var iTop=(screen.height-height)/2;var sOptions="toolbar=no,status=no,resizable=yes,dependent=yes";sOptions+=",width="+width;sOptions+=",height="+height;sOptions+=",left="+iLeft;sOptions+=",top="+iTop;var oWindow=window.open(url,"BrowseWindow",sOptions);}
Le.keepPreviewAlive=function(iframeId,slot){var codeChanged=false;Le.builderCodeMirror.on('change',function(cm,change){codeChanged=true;});window.setInterval(function(){if(codeChanged){var value=(Le.builderCodeMirror)?Le.builderCodeMirror.getValue():'';Le.livePreviewInterval=Le.updateIframeContent(iframeId,value,slot);codeChanged=false;}},2000);};Le.killLivePreview=function(){window.clearInterval(Le.livePreviewInterval);};Le.destroyCodeMirror=function(){delete Le.builderCodeMirror;mQuery('#customHtmlContainer').empty();};Le.buildBuilderIframe=function(themeHtml,id,onLoadCallback){if(mQuery('iframe#'+id).length){var builder=mQuery('iframe#'+id);}else{var builder=mQuery("<iframe />",{css:{margin:"0",padding:"0",border:"none",width:"100%",height:"100%"},id:id}).appendTo('.builder-content');}
builder.off('load').on('load',function(){if(typeof onLoadCallback==='function'){onLoadCallback();}});Le.updateIframeContent(id,themeHtml);};Le.htmlspecialchars_decode=function(encodedHtml){encodedHtml=encodedHtml.replace(/&quot;/g,'"');encodedHtml=encodedHtml.replace(/&#039;/g,"'");encodedHtml=encodedHtml.replace(/&amp;/g,'&');encodedHtml=encodedHtml.replace(/&lt;/g,'<');encodedHtml=encodedHtml.replace(/&gt;/g,'>');return encodedHtml;};Le.initSelectTheme=function(themeField){var customHtml=mQuery('textarea.builder-html');var isNew=Le.isNewEntity('#page_sessionId, #emailform_sessionId');Le.showChangeThemeWarning=true;Le.builderTheme=themeField.val();if(isNew){Le.showChangeThemeWarning=false;if(!customHtml.length||!customHtml.val().length){Le.setThemeHtml(Le.builderTheme);}}
if(customHtml.length){mQuery('[data-theme]').click(function(e){e.preventDefault();var currentLink=mQuery(this);var theme=currentLink.attr('data-theme');var isCodeMode=(theme==='le_code_mode');Le.builderTheme=theme;if(Le.showChangeThemeWarning&&customHtml.val().length){if(!isCodeMode){if(confirm(Le.translate('le.core.builder.theme_change_warning'))){customHtml.val('');Le.showChangeThemeWarning=false;}else{return;}}else{if(confirm(Le.translate('Le.core.builder.code_mode_warning'))){}else{return;}}}
themeField.val(theme);if(isCodeMode){mQuery('.builder').addClass('code-mode');mQuery('.builder .code-editor').removeClass('hide');mQuery('.builder .code-mode-toolbar').removeClass('hide');mQuery('.builder .builder-toolbar').addClass('hide');}else{mQuery('.builder').removeClass('code-mode');mQuery('.builder .code-editor').addClass('hide');mQuery('.builder .code-mode-toolbar').addClass('hide');mQuery('.builder .builder-toolbar').removeClass('hide');Le.setThemeHtml(theme);}
mQuery('.theme-list .panel').removeClass('theme-selected');currentLink.closest('.panel').addClass('theme-selected');mQuery('.theme-list .select-theme-selected').addClass('hide');mQuery('.theme-list .select-theme-link').removeClass('hide');currentLink.closest('.panel').find('.select-theme-selected').removeClass('hide');currentLink.addClass('hide');});}};Le.initSelectBeeTemplate=function(themeField,formname){var templateJSON=mQuery('textarea.bee-editor-json');var isNew=Le.isNewEntity('#page_sessionId, #emailform_sessionId');Le.showChangeThemeWarning=true;Le.beeTemplate=themeField.val();var templateJSON=mQuery('textarea.bee-editor-json');var templateHTML=mQuery('textarea.builder-html');var url=window.location.href;if((url.indexOf('emails/new')!=-1||url.indexOf('broadcast/new')!=-1||url.indexOf('pages/new')!=-1||(typeof templateHTML.val()==='undefined'||!templateHTML.val().length))){if((mQuery('#email-content-preview').hasClass('hide'))){Le.beeTemplate="";}}
if(!templateJSON.length||!templateJSON.val().length){if(!templateHTML.length||!templateHTML.val().length){Le.setBeeTemplateJSON(Le.beeTemplate);}}
if(isNew){Le.showChangeThemeWarning=false;if(!mQuery('.sidebar-content').is(':visible')&&formname=='email'){Le.selectEmailEditor("basic");}}else{if(formname=='email'){if(!templateJSON.length||!templateJSON.val().length){}else{}}}
if(formname=='page'){var templateJSON=mQuery('textarea.bee-editor-json');if(!templateJSON.length||!templateJSON.val().length){Le.setBeeTemplateJSON(Le.beeTemplate);}}
if(templateJSON.length){mQuery('[data-beetemplate]').click(function(e){e.preventDefault();var currentLink=mQuery(this);var theme=currentLink.attr('data-beetemplate');Le.beeTemplate=theme;if(Le.showChangeThemeWarning&&templateJSON.val().length){if(confirm(Le.translate('le.core.builder.theme_change_warning'))){templateJSON.val('');Le.showChangeThemeWarning=false;}else{return;}}
themeField.val(theme);mQuery('.theme-list .panel').removeClass('theme-selected');currentLink.closest('.panel').addClass('theme-selected');mQuery('.theme-list .select-theme-selected').addClass('hide');mQuery('.theme-list .select-theme-link').removeClass('hide');currentLink.closest('.panel').find('.select-theme-selected').removeClass('hide');currentLink.addClass('hide');});}};Le.updateIframeContent=function(iframeId,content,slot){content=content.replace(/^\s*[\r\n]/gm,'');if(iframeId){var iframe=document.getElementById(iframeId);var doc=iframe.contentDocument||iframe.contentWindow.document;doc.open();doc.write(content);doc.close();if('HTML'===doc.all[0].tagName){mQuery(doc.all[0]).removeClass();}}else if(slot){slot.html(content);}};Le.setThemeHtml=function(theme){mQuery.get(mQuery('#builder_url').val()+'?template='+theme,function(themeHtml){var textarea=mQuery('textarea.builder-html');textarea.val(themeHtml);});};Le.setBeeTemplateJSON=function(template){if(template!=""){Le.setBeeTemplateHTML(template);mQuery.get(mQuery('#builder_url').val()+'?beetemplate='+template,function(templatejson){var textarea=mQuery('textarea.bee-editor-json');textarea.val(templatejson);});}};Le.setBeeTemplateHTML=function(template){mQuery.get(mQuery('#builder_url').val()+'?beehtmltemplate='+template,function(templatehtml){var textarea=mQuery('textarea.builder-html');textarea.val(templatehtml);});};Le.closeBuilder=function(model){var panelHeight=(mQuery('.builder-content').css('right')=='0px')?mQuery('.builder-panel').height():0,panelWidth=(mQuery('.builder-content').css('right')=='0px')?0:mQuery('.builder-panel').width(),spinnerLeft=(mQuery(window).width()-panelWidth-60)/2,spinnerTop=(mQuery(window).height()-panelHeight-60)/2,closeBtn=mQuery('.btn-close-builder'),overlay=mQuery('#builder-overlay'),builder=mQuery('.builder');mQuery('.builder-spinner').css({left:spinnerLeft,top:spinnerTop});overlay.removeClass('hide');closeBtn.prop('disabled',true);mQuery('#builder-errors').hide('fast').text('');try{Le.sendBuilderContentToTextarea(function(){if(Le.codeMode){Le.killLivePreview();Le.destroyCodeMirror();delete Le.codeMode;}else{document.getElementById('builder-template-content').contentWindow.Le.destroySlots();mQuery('#slot-form-container, #section-form-container').html('');}
overlay.remove();builder.removeClass('builder-active').addClass('hide');closeBtn.prop('disabled',false);mQuery('body').css('overflow-y','');builder.addClass('hide');Le.stopIconSpinPostEvent();mQuery('#builder-template-content').remove();},false);}catch(error){console.error(error);}};Le.sendBuilderContentToTextarea=function(callback,keepBuilderContent){var customHtml;try{if(Le.codeMode){customHtml=Le.builderCodeMirror.getValue();customHtml=Le.convertDynamicContentSlotsToTokens(customHtml);mQuery('.builder-html').val(customHtml);callback();}else{var builderHtml=mQuery('iframe#builder-template-content').contents();if(keepBuilderContent){Le.cloneHtmlContent(builderHtml,function(themeHtml){Le.sanitizeHtmlAndStoreToTextarea(themeHtml);callback();});}else{Le.sanitizeHtmlAndStoreToTextarea(builderHtml);callback();}}}catch(error){console.error(error);}}
Le.sanitizeHtmlAndStoreToTextarea=function(html){var cleanHtml=Le.sanitizeHtmlBeforeSave(html);mQuery('.builder-html').val(Le.domToString(cleanHtml));};Le.domToString=function(dom){if(typeof dom==='string'){return dom;}
var xs=new XMLSerializer();return xs.serializeToString(dom.get(0));};Le.sanitizeHtmlBeforeSave=function(htmlContent){htmlContent.find('[data-source="le"]').remove();htmlContent.find('.atwho-container').remove();htmlContent.find('.fr-image-overlay, .fr-quick-insert, .fr-tooltip, .fr-toolbar, .fr-popup, .fr-image-resizer').remove();htmlContent.find('[data-slot-focus], [data-section-focus]').remove();var customHtml=Le.domToString(htmlContent);return Le.convertDynamicContentSlotsToTokens(customHtml);};Le.cloneHtmlContent=function(content,callback){var id='iframe-helper';var iframeHelper=mQuery('<iframe id="'+id+'" />');Le.buildBuilderIframe(Le.domToString(content),id,function(){callback(mQuery('iframe#'+id).contents());iframeHelper.remove();});}
Le.destroySlots=function(){if(typeof Le.builderSlots!=='undefined'&&Le.builderSlots.length){mQuery.each(Le.builderSlots,function(i,slotParams){mQuery(slotParams.slot).trigger('slot:destroy',slotParams);});delete Le.builderSlots;}
Le.builderContents.find('[data-slot-container]').sortable().sortable('destroy');Le.builderContents.find('*[class=""]').removeAttr('class');Le.builderContents=Le.clearFroalaStyles(Le.builderContents);Le.builderContents.find('*[style="z-index: 2501;"]').removeAttr('style');Le.builderContents.find('.fr-toolbar, .fr-line-breaker').remove();var htmlTags=document.getElementsByTagName('html');htmlTags[0].removeAttribute('class');};Le.clearFroalaStyles=function(content){mQuery.each(content.find('td, th, table, [fr-original-class], [fr-original-style]'),function(){var el=mQuery(this);if(el.attr('fr-original-class')){el.attr('class',el.attr('fr-original-class'));el.removeAttr('fr-original-class');}
if(el.attr('fr-original-style')){el.attr('style',el.attr('fr-original-style'));el.removeAttr('fr-original-style');}
if(el.css('border')==='1px solid rgb(221, 221, 221)'){el.css('border','');}});content.find('link[href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css"]').remove();content.find('strong[contenteditable="false"]').removeAttr('style');content.find('[data-atwho-at-query]').removeAttr('data-atwho-at-query');return content;}
Le.toggleBuilderButton=function(hide){if(mQuery('.toolbar-form-buttons .toolbar-standard .btn-builder')){if(hide){mQuery('.toolbar-form-buttons .toolbar-standard .btn-builder').addClass('hide btn-standard-toolbar').appendTo('.toolbar-form-buttons')
mQuery('.toolbar-form-buttons .toolbar-dropdown i.fa-cube').parent().addClass('hide');}else{if(!mQuery('.btn-standard-toolbar.btn-builder').length){mQuery('.toolbar-form-buttons .toolbar-standard .btn-builder').addClass('btn-standard-toolbar')}else{mQuery('.toolbar-form-buttons .btn-standard-toolbar.btn-builder').prependTo('.toolbar-form-buttons .toolbar-standard').removeClass('hide');mQuery('.toolbar-form-buttons .toolbar-dropdown i.fa-cube').parent().removeClass('hide');}}}};Le.initSectionListeners=function(){Le.activateGlobalFroalaOptions();Le.selectedSlot=null;Le.builderContents.on('section:init',function(event,section,isNew){section=mQuery(section);if(isNew){Le.initSlots(section.find('[data-slot-container]'));}
section.on('click',function(e){var clickedSection=mQuery(this);var previouslyFocused=Le.builderContents.find('[data-section-focus]');var sectionWrapper=mQuery(this);var section=sectionWrapper.find('[data-section]');var focusParts={'top':{},'right':{},'bottom':{},'left':{},'clone':{classes:'fa fa-copy',onClick:function(){var cloneBtn=mQuery(this);var clonedElem=cloneBtn.closest('[data-section-wrapper]');clonedElem.clone().insertAfter(clonedElem);Le.initSlotListeners();Le.initSections();Le.initSlots();}},'handle':{classes:'fa fa-arrows-v'},'delete':{classes:'fa fa-remove',onClick:function(){if(confirm(parent.Le.translate('Le.core.builder.section_delete_warning'))){var deleteBtn=mQuery(this);var focusSeciton=deleteBtn.closest('[data-section-wrapper]').remove();}}}};var sectionForm=mQuery(parent.mQuery('script[data-section-form]').html());var sectionFormContainer=parent.mQuery('#section-form-container');if(previouslyFocused.length){previouslyFocused.remove();sectionFormContainer.find('input[data-toggle="color"]').each(function(){mQuery(this).minicolors('destroy');});}
Le.builderContents.find('[data-slot-focus]').each(function(){if(!mQuery(e.target).attr('data-slot-focus')&&!mQuery(e.target).closest('data-slot').length&&!mQuery(e.target).closest('[data-slot-container]').length){mQuery(this).remove();}});mQuery.each(focusParts,function(key,config){var focusPart=mQuery('<div/>').attr('data-section-focus',key).addClass(config.classes);if(config.onClick){focusPart.on('click',config.onClick);}
sectionWrapper.append(focusPart);});sectionFormContainer.html(sectionForm);if(section.length&&section.css('background-color')!=='rgba(0, 0, 0, 0)'){sectionForm.find('#builder_section_content-background-color').val(Le.rgb2hex(section.css('backgroundColor')));}
if(sectionWrapper.css('background-color')!=='rgba(0, 0, 0, 0)'){sectionForm.find('#builder_section_wrapper-background-color').val(Le.rgb2hex(sectionWrapper.css('backgroundColor')));}
sectionFormContainer.find('input[data-toggle="color"]').each(function(){parent.Le.activateColorPicker(this);});sectionForm.on('keyup paste change touchmove',function(e){var field=mQuery(e.target);if(section.length&&field.attr('id')==='builder_section_content-background-color'){Le.sectionBackgroundChanged(section,field.val());}else if(field.attr('id')==='builder_section_wrapper-background-color'){Le.sectionBackgroundChanged(sectionWrapper,field.val());}});parent.mQuery('#section-form-container').on('change.minicolors',function(e,hex){var field=mQuery(e.target);var focusedSectionWrapper=mQuery('[data-section-focus]').parent();var focusedSection=focusedSectionWrapper.find('[data-section]');if(focusedSection.length&&field.attr('id')==='builder_section_content-background-color'){Le.sectionBackgroundChanged(focusedSection,field.val());}else if(field.attr('id')==='builder_section_wrapper-background-color'){Le.sectionBackgroundChanged(focusedSectionWrapper,field.val());}});});});}
Le.initSections=function(){Le.initSectionListeners();var sectionWrappers=Le.builderContents.find('[data-section-wrapper]');var bodyOverflow={};Le.sortActive=false;mQuery('body').sortable({helper:function(e,ui){bodyOverflow.overflowX=mQuery('body').css('overflow-x');bodyOverflow.overflowY=mQuery('body').css('overflow-y');mQuery('body').css({overflowX:'visible',overflowY:'visible'});return ui;},axis:'y',items:'[data-section-wrapper]',handle:'[data-section-focus="handle"]',placeholder:'slot-placeholder',connectWith:'body',start:function(event,ui){Le.sortActive=true;ui.placeholder.height(ui.helper.outerHeight());},stop:function(event,ui){if(ui.item.hasClass('section-type-handle')){mQuery('body',parent.document).css(bodyOverflow);var newSection=mQuery('<div/>').attr('data-section-wrapper',ui.item.attr('data-section-type')).html(ui.item.find('script').html());ui.item.replaceWith(newSection);Le.builderContents.trigger('section:init',[newSection,true]);}else{mQuery('body').css(bodyOverflow);}
Le.sortActive=false;},});var iframe=mQuery('#builder-template-content',parent.document).contents();mQuery('#section-type-container .section-type-handle',parent.document).draggable({iframeFix:true,connectToSortable:'body',revert:'invalid',iframeOffset:iframe.offset(),helper:function(e,ui){bodyOverflow.overflowX=mQuery('body',parent.document).css('overflow-x');bodyOverflow.overflowY=mQuery('body',parent.document).css('overflow-y');mQuery('body',parent.document).css({overflowX:'hidden',overflowY:'hidden'});var helper=mQuery(this).clone().css('height',mQuery(this).height()).css('width',mQuery(this).width());return helper;},zIndex:8000,cursorAt:{top:15,left:15},start:function(event,ui){mQuery('#builder-template-content',parent.document).css('overflow','hidden');mQuery('#builder-template-content',parent.document).attr('scrolling','no');},stop:function(event,ui){mQuery('body',parent.document).css(bodyOverflow);mQuery('#builder-template-content',parent.document).css('overflow','visible');mQuery('#builder-template-content',parent.document).attr('scrolling','yes');}}).disableSelection();sectionWrappers.each(function(){mQuery(this).trigger('section:init',this);});};Le.sectionBackgroundChanged=function(element,color){if(color.length){color='#'+color;}else{color='transparent';}
element.css('background-color',color).attr('bgcolor',color);mQuery(element).find('[data-slot-focus]').each(function(){var focusedSlot=mQuery(this).closest('[data-slot]');if(focusedSlot.attr('data-slot')=='text'){Le.setTextSlotEditorStyle(parent.mQuery('#slot_text_content'),focusedSlot);}});};Le.rgb2hex=function(orig){var rgb=orig.replace(/\s/g,'').match(/^rgba?\((\d+),(\d+),(\d+)/i);return(rgb&&rgb.length===4)?"#"+
("0"+parseInt(rgb[1],10).toString(16)).slice(-2)+
("0"+parseInt(rgb[2],10).toString(16)).slice(-2)+
("0"+parseInt(rgb[3],10).toString(16)).slice(-2):orig;};Le.initSlots=function(slotContainers){if(!slotContainers){slotContainers=Le.builderContents.find('[data-slot-container]');}
Le.builderContents.find('a').on('click',function(e){e.preventDefault();});var bodyOverflow={};Le.sortActive=false;Le.parentDocument=parent.document;slotContainers.sortable({helper:function(e,ui){bodyOverflow.overflowX=mQuery('body').css('overflow-x');bodyOverflow.overflowY=mQuery('body').css('overflow-y');mQuery('body').css({overflowX:'visible',overflowY:'visible'});return ui;},items:'[data-slot]',handle:'[data-slot-toolbar]',placeholder:'slot-placeholder',connectWith:'[data-slot-container]',start:function(event,ui){Le.sortActive=true;ui.placeholder.height(ui.helper.outerHeight());Le.builderContents.find('[data-slot-focus]').each(function(){var focusedSlot=mQuery(this).closest('[data-slot]');if(focusedSlot.attr('data-slot')==='image'){focusedSlot.find('img').each(function(){mQuery(this).froalaEditor('popups.hideAll');});Le.builderContents.find('.fr-image-resizer.fr-active').removeClass('fr-active');}});Le.builderContents.find('[data-slot-focus]').remove();},stop:function(event,ui){if(ui.item.hasClass('slot-type-handle')){mQuery('body',parent.document).css(bodyOverflow);var newSlot=mQuery('<div/>').attr('data-slot',ui.item.attr('data-slot-type')).html(ui.item.find('script').html())
ui.item.replaceWith(newSlot);Le.builderContents.trigger('slot:init',newSlot);}else{mQuery('body').css(bodyOverflow);}
Le.sortActive=false;}});var iframe=mQuery('#builder-template-content',parent.document).contents();mQuery('#slot-type-container .slot-type-handle',parent.document).draggable({iframeFix:true,connectToSortable:'[data-slot-container]',revert:'invalid',iframeOffset:iframe.offset(),helper:function(e,ui){bodyOverflow.overflowX=mQuery('body',Le.parentDocument).css('overflow-x');bodyOverflow.overflowY=mQuery('body',Le.parentDocument).css('overflow-y');mQuery('body',Le.parentDocument).css({overflowX:'hidden',overflowY:'hidden'});return mQuery(this).clone().css('height',mQuery(this).height()).css('width',mQuery(this).width());},zIndex:8000,cursorAt:{top:15,left:15},start:function(event,ui){mQuery('#builder-template-content',Le.parentDocument).css('overflow','hidden');mQuery('#builder-template-content',Le.parentDocument).attr('scrolling','no');if(slotContainers.data('sortable'))slotContainers.sortable('option','scroll',false);},stop:function(event,ui){mQuery('body',Le.parentDocument).css(bodyOverflow);mQuery('#builder-template-content',Le.parentDocument).css('overflow','visible');mQuery('#builder-template-content',Le.parentDocument).attr('scrolling','yes');if(slotContainers.data('sortable'))slotContainers.sortable('option','scroll',true);parent.mQuery('.ui-draggable-dragging').remove();}}).disableSelection();iframe.on('scroll',function(){mQuery('#slot-type-container .slot-type-handle',Le.parentDocument).draggable("option","cursorAt",{top:-1*iframe.scrollTop()+15});});slotContainers.find('[data-slot]').each(function(){mQuery(this).trigger('slot:init',this);});};Le.getSlotToolbar=function(type){Le.builderContents.find('[data-slot-toolbar]').remove();var slotToolbar=mQuery('<div/>').attr('data-slot-toolbar',true);var deleteLink=Le.getSlotDeleteLink();var cloneLink=Le.getSlotCloneLink();if(typeof type!=='undefined'){mQuery('<span style="color:#fff;margin-left:10px;font-family:sans-serif;font-size:smaller">'+type.toUpperCase()+'</span>').appendTo(slotToolbar);}
deleteLink.appendTo(slotToolbar);cloneLink.appendTo(slotToolbar);return slotToolbar;};Le.getSlotDeleteLink=function(){if(typeof Le.deleteLink=='undefined'){Le.deleteLink=mQuery('<a><i class="fa fa-lg fa-times"></i></a>').attr('data-slot-action','delete').attr('alt','delete').addClass('btn btn-delete btn-default');}
return Le.deleteLink;};Le.getSlotCloneLink=function(){if(typeof Le.cloneLink=='undefined'){Le.cloneLink=mQuery('<a><i class="fa fa-lg fa-copy"></i></a>').attr('data-slot-action','clone').attr('alt','clone').addClass('btn btn-clone btn-clone');}
return Le.cloneLink;};Le.getSlotFocus=function(){Le.builderContents.find('[data-slot-focus]').remove();return mQuery('<div/>').attr('data-slot-focus',true);};Le.cloneFocusForm=function(decId,removeFroala){Le.reattachDEC();var focusForm=parent.mQuery('#emailform_dynamicContent_'+decId);Le.activeDECParent=focusForm.parent();focusForm.removeClass('fade');focusForm.find('.tab-pane:first').find('.remove-item').hide();focusForm.find('.addNewDynamicContentFilter').hide();var element=focusForm.detach();Le.activeDEC=element;return element;};Le.initEmailDynamicContentSlotEdit=function(clickedSlot){var decId=clickedSlot.attr('data-param-dec-id');var focusForm;if(decId||decId===0){focusForm=Le.cloneFocusForm(decId);}
var focusFormHeader=parent.mQuery('#customize-slot-panel').find('.panel-heading h4');var newDynConButton=mQuery('<button/>').css('float','right').addClass('btn btn-success btn-xs');newDynConButton.text('Add Variant');newDynConButton.on('click',function(e){e.stopPropagation();Le.createNewDynamicContentFilter('#dynamicContentFilterTabs_'+decId,parent.mQuery);var focusForm=Le.cloneFocusForm(decId,false);focusForm.insertAfter(parent.mQuery('#slot_dynamiccontent > div.has-error'));});focusFormHeader.append(newDynConButton);return focusForm;};Le.removeAddVariantButton=function(){parent.mQuery('#customize-slot-panel').find('.panel-heading button').remove();Le.reattachDEC();};Le.reattachDEC=function(){if(typeof Le.activeDEC!=='undefined'){var element=Le.activeDEC.detach();Le.activeDECParent.append(element);}};Le.isSlotInitiated=function(slot){if(typeof Le.builderSlots==='undefined'||Le.builderSlots.length===0)return false;return typeof Le.builderSlots.find(function(params){return slot.is(params.slot);})!=='undefined';};Le.initSlotListeners=function(){Le.activateGlobalFroalaOptions();Le.builderSlots=[];Le.selectedSlot=null;Le.builderContents.on('slot:selected',function(event,slot){slot=mQuery(slot);Le.builderContents.find('[data-slot-focus]').remove();mQuery(slot).append(Le.getSlotFocus());});Le.builderContents.on('slot:init',function(event,slot){slot=mQuery(slot);var type=slot.attr('data-slot');if(Le.isSlotInitiated(slot))return;var slotToolbar=Le.getSlotToolbar(type);var deleteLink=Le.getSlotDeleteLink();var cloneLink=Le.getSlotCloneLink();var focus=Le.getSlotFocus();slot.hover(function(e){e.stopPropagation();slotToolbar=Le.getSlotToolbar(type);focus=Le.getSlotFocus();if(Le.sortActive){return;}
slot.append(focus);deleteLink.click(function(e){if(type=='dynamicContent'){var dynConId=slot.attr('data-param-dec-id');dynConId='#emailform_dynamicContent_'+dynConId;var dynConTarget=parent.mQuery(dynConId);dynConTarget.find(dynConId+'_tokenName').val('');}
slot.trigger('slot:destroy',{slot:slot,type:type});mQuery.each(Le.builderSlots,function(i,slotParams){if(slotParams.slot.is(slot)){Le.builderSlots.splice(i,1);return false;}});slot.remove();focus.remove();});cloneLink.click(function(e){slot.clone().insertAfter(slot);Le.initSlots(slot.closest('[data-slot-container="1"]'));});if(slot.offset().top<25){slotToolbar.css('top','0');}else{slotToolbar.css('top','-24px');}
slot.append(slotToolbar);},function(){if(Le.sortActive){return;}
slotToolbar.remove();focus.remove();});slot.on('click',function(e){e.stopPropagation();Le.deleteCodeModeSlot();Le.removeAddVariantButton();var clickedSlot=mQuery(this);clickedSlot.trigger('slot:selected',clickedSlot);var minicolors=parent.mQuery('#slot-form-container .minicolors');if(minicolors.length){parent.mQuery('#slot-form-container input[data-toggle="color"]').each(function(){mQuery(this).minicolors('destroy');});parent.mQuery('#slot-form-container').off('change.minicolors');}
if(parent.mQuery('#slot-form-container').find('textarea.editor')){parent.mQuery('#slot-form-container').find('textarea.editor').each(function(){parent.mQuery(this).froalaEditor('popups.hideAll');});}
var focusType=clickedSlot.attr('data-slot');var focusForm=mQuery(parent.mQuery('script[data-slot-type-form="'+focusType+'"]').html());var slotFormContainer=parent.mQuery('#slot-form-container');if(focusType=='dynamicContent'){var nff=Le.initEmailDynamicContentSlotEdit(clickedSlot);nff.insertAfter(focusForm.find('#slot_dynamiccontent > div.has-error'));}
slotFormContainer.html(focusForm);parent.mQuery.each(clickedSlot.get(0).attributes,function(i,attr){var regex=/data-param-(.*)/;var match=regex.exec(attr.name);if(match!==null){focusForm.find('input[type="text"][data-slot-param="'+match[1]+'"]').val(attr.value);var selectField=focusForm.find('select[data-slot-param="'+match[1]+'"]');if(selectField.length){selectField.val(attr.value)}
var urlField=focusForm.find('input[type="url"][data-slot-param="'+match[1]+'"]');if(urlField.length){urlField.val(attr.value);}
var numberField=focusForm.find('input[type="number"][data-slot-param="'+match[1]+'"]');if(numberField.length){numberField.val(attr.value);}
var radioField=focusForm.find('input[type="radio"][data-slot-param="'+match[1]+'"][value="'+attr.value+'"]');if(radioField.length){radioField.parent('.btn').addClass('active');radioField.attr('checked',true);}}});focusForm.on('keyup change',function(e){var field=mQuery(e.target);if(field.attr('data-slot-param')){clickedSlot.attr('data-param-'+field.attr('data-slot-param'),field.val());}
clickedSlot.trigger('slot:change',{slot:clickedSlot,field:field,type:focusType});});focusForm.find('.btn').on('click',function(e){var field=mQuery(this).find('input:radio');if(field.length){clickedSlot.attr('data-param-'+field.attr('data-slot-param'),field.val());clickedSlot.trigger('slot:change',{slot:clickedSlot,field:field,type:focusType});}});focusForm.find('input[data-toggle="color"]').each(function(){parent.Le.activateColorPicker(this,{change:function(){var field=mQuery(this);clickedSlot.attr('data-param-'+field.attr('data-slot-param'),field.val());clickedSlot.trigger('slot:change',{slot:clickedSlot,field:field,type:focusType});}});});$codeModeSlotTypes=['codemode'];for(var i=0;i<$codeModeSlotTypes.length;i++){if($codeModeSlotTypes[i]===type){Le.codeMode=true;var element=focusForm.find('#slot_'+$codeModeSlotTypes[i]+'_content')[0];if(element){Le.builderCodeMirror=CodeMirror.fromTextArea(element,{lineNumbers:true,mode:'htmlmixed',extraKeys:{"Ctrl-Space":"autocomplete"},lineWrapping:true,});Le.builderCodeMirror.getDoc().setValue(slot.find('#codemodeHtmlContainer,.codemodeHtmlContainer').html());Le.keepPreviewAlive(null,slot.find('#codemodeHtmlContainer,.codemodeHtmlContainer'));}
break;}}
focusForm.find('textarea.editor').each(function(){var theEditor=this;var slotHtml=parent.mQuery('<div/>').html(clickedSlot.html());slotHtml.find('[data-slot-focus]').remove();slotHtml.find('[data-slot-toolbar]').remove();var buttons=['undo','redo','|','bold','italic','underline','paragraphFormat','fontFamily','fontSize','color','align','formatOL','formatUL','quote','clearFormatting','token','insertLink','insertImage','insertGatedVideo','insertTable','html','fullscreen'];var builderEl=parent.mQuery('.builder');if(builderEl.length&&builderEl.hasClass('email-builder')){buttons=parent.mQuery.grep(buttons,function(value){return value!='insertGatedVideo';});}
var froalaOptions={toolbarButtons:buttons,toolbarButtonsMD:buttons,toolbarButtonsSM:buttons,toolbarButtonsXS:buttons,toolbarSticky:false,linkList:[],imageEditButtons:['imageReplace','imageAlign','imageRemove','imageAlt','imageSize','|','imageLink','linkOpen','linkEdit','linkRemove']};if(focusType!=='dynamicContent'){parent.mQuery(this).on('froalaEditor.initialized',function(e,editor){parent.Le.initAtWho(editor.$el,parent.Le.getBuilderTokensMethod(),editor);Le.setTextSlotEditorStyle(editor.$el,clickedSlot);});}
parent.mQuery(this).on('froalaEditor.contentChanged',function(e,editor){var slotHtml=mQuery('<div/>').append(editor.html.get());if(!(focusType=='dynamicContent'&&mQuery(this).attr('id').match(/filters/))){clickedSlot.html(slotHtml.html());}});if(!(focusType=='dynamicContent'&&mQuery(this).attr('id').match(/filters/))){parent.mQuery(this).val(slotHtml.html());}
parent.mQuery(this).froalaEditor(parent.mQuery.extend({},Le.basicFroalaOptions,froalaOptions));});});if(type==='image'||type==='imagecaption'||type==='imagecard'){var image=slot.find('img');image.removeAttr('data-froala.editor');image.on('froalaEditor.click',function(e,editor){slot.closest('[data-slot]').trigger('click');});var froalaOptions=mQuery.extend({},Le.basicFroalaOptions,{linkList:[],imageEditButtons:['imageReplace','imageAlign','imageAlt','imageSize','|','imageLink','linkOpen','linkEdit','linkRemove'],useClasses:false});image.froalaEditor(froalaOptions);}else if(type==='button'){slot.find('a').click(function(e){e.preventDefault();});}else if(type==='dynamicContent'){if(slot.html().match(/__dynamicContent__/)){var decs=mQuery('[data-slot="dynamicContent"]');var ids=mQuery.map(decs,function(e){return mQuery(e).attr('data-param-dec-id');})
var maxId=Math.max.apply(Math,ids);if(isNaN(maxId)||Number.NEGATIVE_INFINITY==maxId)maxId=0;slot.attr('data-param-dec-id',maxId+1);slot.html('Dynamic Content');Le.createNewDynamicContentItem(parent.mQuery);}}
Le.builderSlots.push({slot:slot,type:type});});Le.getPredefinedLinks=function(callback){var linkList=[];Le.getTokens(Le.getBuilderTokensMethod(),function(tokens){if(tokens.length){mQuery.each(tokens,function(token,label){if(token.startsWith('{pagelink=')||token.startsWith('{filelink=')||token.startsWith('{webview_url')||token.startsWith('{unsubscribe_url')){linkList.push({text:label,href:token});}});}
return callback(linkList);});};Le.builderContents.on('slot:change',function(event,params){var fieldParam=params.field.attr('data-slot-param');var type=params.type;if(type!=="dynamicContent"){Le.removeAddVariantButton();}
Le.clearSlotFormError(fieldParam);if(fieldParam==='width'||fieldParam==='padding-left'||fieldParam==='padding-right'||fieldParam==='padding-top'||fieldParam==='padding-bottom'){params.slot.css(fieldParam,params.field.val()+'px');}else if('label-text'===fieldParam){params.slot.find('label.control-label').text(params.field.val());}else if('label-text1'===fieldParam){params.slot.find('label.label1').text(params.field.val());}else if('label-text2'===fieldParam){params.slot.find('label.label2').text(params.field.val());}else if('label-text3'===fieldParam){params.slot.find('label.label3').text(params.field.val());}else if('label-text4'===fieldParam){params.slot.find('label.label4').text(params.field.val());}else if('glink'===fieldParam||'flink'===fieldParam||'tlink'===fieldParam){params.slot.find('#'+fieldParam).attr('href',params.field.val());}else if(fieldParam==='href'){params.slot.find('a').eq(0).attr('href',params.field.val());}else if(fieldParam==='link-text'){params.slot.find('a').eq(0).text(params.field.val());}else if(fieldParam==='float'){var values=['left','center','right'];params.slot.find('a').parent().attr('align',values[params.field.val()]);}else if(fieldParam==='caption'){params.slot.find('figcaption').text(params.field.val());}else if(fieldParam==='cardcaption'){params.slot.find('td.imagecard-caption').text(params.field.val());}else if(fieldParam==='text-align'){var values=['left','center','right'];if(type==='imagecard'){params.slot.find('.imagecard-caption').css(fieldParam,values[params.field.val()]);}else if(type==='imagecaption'){params.slot.find('figcaption').css(fieldParam,values[params.field.val()]);}}else if(fieldParam==='align'){Le.builderContents.find('[data-slot-focus]').each(function(){var focusedSlot=mQuery(this).closest('[data-slot]');if(focusedSlot.attr('data-slot')=='image'){focusedSlot.find('img').each(function(){mQuery(this).froalaEditor('popups.hideAll');});Le.builderContents.find('.fr-image-resizer.fr-active').removeClass('fr-active');}});var values=['left','center','right'];if('socialfollow'===type){params.slot.find('div.socialfollow').css('text-align',values[params.field.val()]);}else if('imagecaption'===type){params.slot.find('figure').css('text-align',values[params.field.val()]);}else if('imagecard'===type){params.slot.find('td.imagecard-image').css('text-align',values[params.field.val()]);}else{params.slot.find('img').closest('div').css('text-align',values[params.field.val()]);}}else if(fieldParam==='border-radius'){params.slot.find('a.button').css(fieldParam,params.field.val()+'px');}else if(fieldParam==='button-size'){var bg_clr=params.slot.attr('data-param-background-color');var values=[{borderWidth:'10px 20px',padding:'0',fontSize:'14px',borderColor:bg_clr,borderStyle:'solid'},{borderWidth:'20px 23px',padding:'0',fontSize:'20px',borderColor:bg_clr,borderStyle:'solid'},{borderWidth:'25px 40px',padding:'0',fontSize:'30px',borderColor:bg_clr,borderStyle:'solid'}];params.slot.find('a.button').css(values[params.field.val()]);}else if(fieldParam==='caption-color'){params.slot.find('.imagecard-caption').css('background-color','#'+params.field.val());}else if(fieldParam==='background-color'||fieldParam==='color'){var matches=params.field.val().match(/^#?([0-9a-f]{6}|[0-9a-f]{3})$/);if(matches!==null){var color=matches[1];if(fieldParam==='background-color'){if('imagecard'===type){params.slot.find('.imagecard').css(fieldParam,'#'+color);}else{params.slot.find('a.button').css(fieldParam,'#'+color);params.slot.find('a.button').attr('background','#'+color);params.slot.find('a.button').css('border-color','#'+color);}}else if(fieldParam==='color'){if('imagecard'===type){params.slot.find('.imagecard-caption').css(fieldParam,'#'+color);}else if('imagecaption'===type){params.slot.find('figcaption').css(fieldParam,'#'+color);}else{params.slot.find('a.button').css(fieldParam,'#'+color);}}}}else if(/gatedvideo/.test(fieldParam)){var toInsert=fieldParam.split('-')[1];var insertVal=params.field.val();if(toInsert==='url'){var videoProvider=Le.getVideoProvider(insertVal);if(videoProvider==null){Le.slotFormError(fieldParam,'Please enter a valid YouTube, Vimeo, or MP4 url.');}else{params.slot.find('source').attr('src',insertVal).attr('type',videoProvider);}}else if(toInsert==='gatetime'){params.slot.find('video').attr('data-gate-time',insertVal);}else if(toInsert==='formid'){params.slot.find('video').attr('data-form-id',insertVal);}else if(toInsert==='height'){params.slot.find('video').attr('height',insertVal);}else if(toInsert==='width'){params.slot.find('video').attr('width',insertVal);}}else if(fieldParam==='separator-color'){params.slot.find('hr').css('border-color','#'+params.field.val());}else if(fieldParam==='separator-thickness'){var sep_color=params.slot.attr('data-param-separator-color');params.slot.find('hr').css('border',params.field.val()+'px solid #'+sep_color);}
if(params.type=='text'){}});Le.builderContents.on('slot:destroy',function(event,params){Le.reattachDEC();if(params.type==='text'){if(parent.mQuery('#slot_text_content').length){parent.mQuery('#slot_text_content').froalaEditor('destroy');parent.mQuery('#slot_text_content').find('.atwho-inserted').atwho('destroy');}}else if(params.type==='image'){Le.deleteCodeModeSlot();var image=params.slot.find('img');if(typeof image!=='undefined'&&image.hasClass('fr-view')){image.froalaEditor('destroy');image.removeAttr('data-froala.editor');image.removeClass('fr-view');}}else if(params.type==='dynamicContent'){Le.removeAddVariantButton();var dynConId=params.slot.attr('data-param-dec-id');dynConId='#emailform_dynamicContent_'+dynConId;if(Le.activeDEC&&Le.activeDEC.attr('id')===dynConId.substr(1)){delete Le.activeDEC;delete Le.activeDECParent;}
var dynConTarget=parent.mQuery(dynConId);var dynConName=dynConTarget.find(dynConId+'_tokenName').val();if(dynConName===''){dynConTarget.find('a.remove-item:first').click();parent.mQuery('.dynamicContentFilterContainer').find('a[href='+dynConId+']').parent().remove();params.slot.remove();}}
Le.builderContents.find('.sf-toolbar').remove();});};Le.deleteCodeModeSlot=function(){Le.killLivePreview();Le.destroyCodeMirror();delete Le.codeMode;};Le.clearSlotFormError=function(field){var customizeSlotField=parent.mQuery('#customize-form-container').find('[data-slot-param="'+field+'"]');if(customizeSlotField.length){customizeSlotField.attr('style','');customizeSlotField.next('[data-error]').remove();}};Le.slotFormError=function(field,message){var customizeSlotField=parent.mQuery('#customize-form-container').find('[data-slot-param="'+field+'"]');if(customizeSlotField.length){customizeSlotField.css('border-color','red');if(message.length){var messageContainer=mQuery('<p/>').text(message).attr('data-error','true').css({color:'red',padding:'5px 0'});messageContainer.insertAfter(customizeSlotField);}}};Le.getVideoProvider=function(url){var providers=[{test_regex:/^.*((youtu.be)|(youtube.com))\/((v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))?\??v?=?([^#\&\?]*).*/,provider:'video/youtube'},{test_regex:/^.*(vimeo\.com\/)((channels\/[A-z]+\/)|(groups\/[A-z]+\/videos\/))?([0-9]+)/,provider:'video/vimeo'},{test_regex:/mp4/,provider:'video/mp4'}];for(var i=0;i<providers.length;i++){var vp=providers[i];if(vp.test_regex.test(url)){return vp.provider;}}
return null;};Le.setTextSlotEditorStyle=function(editorEl,slot)
{var wrapper=parent.mQuery(editorEl).closest('.form-group').find('.fr-wrapper .fr-element').first();if(typeof wrapper=='undefined'){return;}
if(typeof slot.attr('style')!=='undefined'){wrapper.attr('style',slot.attr('style'));}
mQuery.each(['background-color','color','font-family','font-size','line-height','text-align'],function(key,style){var overrideStyle=Le.getSlotStyle(slot,style,false);if(overrideStyle){wrapper.css(style,overrideStyle);}});};Le.getSlotStyle=function(slot,styleName,fallback){if('background-color'==styleName){var temp=mQuery('<div style="background:none;display:none;"/>').appendTo('body');var transparent=temp.css(styleName);temp.remove();}
var findStyle=function(slot){function test(elem){if('background-color'==styleName){if(typeof elem.attr('bgcolor')!=='undefined'){return elem.attr('bgcolor');}
if(elem.css(styleName)==transparent){return!elem.is('body')?test(elem.parent()):fallback||transparent;}else{return elem.css(styleName);}}else if(typeof elem.css(styleName)!=='undefined'){return elem.css(styleName);}else{return!elem.is('body')?test(elem.parent()):fallback;}}
return test(slot);};return findStyle(slot);};Le.getBuilderTokensMethod=function(){var method='page:getBuilderTokens';if(parent.mQuery('.builder').hasClass('email-builder')){method='email:getBuilderTokens';}
return method;};Le.prepareBuilderIframe=function(themeHtml,btnCloseBuilder,applyBtn){var decTokenRegex=/(?:{)dynamiccontent="(.*?)(?:")}/g;var match=decTokenRegex.exec(themeHtml);while(match!==null){var dynConToken=match[0];var dynConName=match[1];if(!Le.builderTokens.hasOwnProperty(dynConToken)){Le.builderTokens[dynConToken]=dynConName;}
match=decTokenRegex.exec(themeHtml);}
themeHtml=Le.prepareDynamicContentBlocksForBuilder(themeHtml);var isPrefCenterEnabled=eval(parent.mQuery('input[name="page[isPreferenceCenter]"]:checked').val());if(!isPrefCenterEnabled){var slots=['segmentlist','categorylist','preferredchannel','channelfrequency','saveprefsbutton'];mQuery.each(slots,function(i,s){themeHtml=themeHtml.replace('{'+s+'}','');});var parser=new DOMParser();var el=parser.parseFromString(themeHtml,"text/html");var $b=mQuery(el);mQuery.each(slots,function(i,s){$b.find('[data-slot='+s+']').remove();});themeHtml=Le.domToString($b);}
Le.buildBuilderIframe(themeHtml,'builder-template-content',function(){mQuery('#builder-overlay').addClass('hide');btnCloseBuilder.prop('disabled',false);applyBtn.prop('disabled',false);});};Le.initBuilderIframe=function(themeHtml,btnCloseBuilder,applyBtn){if(Le.builderTokensRequestInProgress){var intervalID=setInterval(function(){if(!Le.builderTokensRequestInProgress){clearInterval(intervalID);Le.prepareBuilderIframe(themeHtml,btnCloseBuilder,applyBtn);}},500);}else{Le.prepareBuilderIframe(themeHtml,btnCloseBuilder,applyBtn);}};Le.prepareDynamicContentBlocksForBuilder=function(builderHtml){for(var token in Le.builderTokens){if(Le.builderTokens.hasOwnProperty(token)&&/\{dynamic/.test(token)){var defaultContent=Le.convertDynamicContentTokenToSlot(token);builderHtml=builderHtml.replace(token,defaultContent);}}
return builderHtml;};Le.convertDynamicContentTokenToSlot=function(token){var dynConData=Le.getDynamicContentDataForToken(token);if(dynConData){return'<div data-slot="dynamicContent" contenteditable="false" data-param-dec-id="'+dynConData.id+'">'+dynConData.content+'</div>';}
return token;};Le.getDynamicContentDataForToken=function(token){var dynConName=/\{dynamiccontent="(.*)"\}/.exec(token)[1];var dynConTabs=parent.mQuery('#dynamicContentTabs');var dynConTarget=dynConTabs.find('a:contains("'+dynConName+'")').attr('href');var dynConContainer=parent.mQuery(dynConTarget);if(dynConContainer.html()){var dynConContent=dynConContainer.find(dynConTarget+'_content');if(dynConContent.hasClass('editor')){dynConContent=dynConContent.froalaEditor('html.get');}else{dynConContent=dynConContent.html();}
return{id:parseInt(dynConTarget.replace(/[^0-9]/g,'')),content:dynConContent};}
return null;};Le.convertDynamicContentSlotsToTokens=function(builderHtml){var dynConSlots=mQuery(builderHtml).find('[data-slot="dynamicContent"]');if(dynConSlots.length){dynConSlots.each(function(i){var $this=mQuery(this);var dynConNum=$this.attr('data-param-dec-id');var dynConId='#emailform_dynamicContent_'+dynConNum;var dynConTarget=mQuery(dynConId);var dynConName=dynConTarget.find(dynConId+'_tokenName').val();var dynConToken='{dynamiccontent="'+dynConName+'"}';if(!Le.builderTokens.hasOwnProperty(dynConToken)){Le.builderTokens[dynConToken]=dynConName;}
var parser=new DOMParser();var el=parser.parseFromString(builderHtml,"text/html");var $b=mQuery(el);$b.find('div[data-param-dec-id='+dynConNum+']').replaceWith(dynConToken);builderHtml=Le.domToString($b);if($this.parent().hasClass('atwho-inserted')){var toReplace=$this.parent('.atwho-inserted').get(0).outerHTML;builderHtml=builderHtml.replace(toReplace,dynConToken);}});}
return builderHtml;};Le.getPredefinedLinks=function(callback){var linkList=[];Le.getTokens(Le.getBuilderTokensMethod(),function(tokens){if(tokens.length){mQuery.each(tokens,function(token,label){if(token.startsWith('{pagelink=')||token.startsWith('{filelink=')||token.startsWith('{webview_url')||token.startsWith('{unsubscribe_url')){linkList.push({text:label,href:token});}});}
return callback(linkList);});};mQuery(function(){if(parent&&parent.mQuery&&parent.mQuery('#builder-template-content').length){Le.builderContents=mQuery('body');if(!parent.Le.codeMode){Le.initSlotListeners();Le.initSections();Le.initSlots();}}});;Le.getAbTestWinnerForm=function(bundle,formName,abKey){if(abKey&&mQuery(abKey).val()&&mQuery(abKey).closest('.form-group').hasClass('has-error')){mQuery(abKey).closest('.form-group').removeClass('has-error');if(mQuery(abKey).next().hasClass('help-block')){mQuery(abKey).next().remove();}}
Le.activateLabelLoadingIndicator(formName+'_variantSettings_winnerCriteria');var id=mQuery('#'+formName+'_sessionId').val();var query="action="+bundle+":getAbTestForm&abKey="+mQuery(abKey).val()+"&id="+id;mQuery.ajax({url:leAjaxUrl,type:"POST",data:query,dataType:"json",success:function(response){if(typeof response.html!='undefined'){if(mQuery('#'+formName+'_variantSettings_properties').length){mQuery('#'+formName+'_variantSettings_properties').replaceWith(response.html);}else{mQuery('#'+formName+'_variantSettings').append(response.html);}
if(response.html!=''){Le.onPageLoad('#'+formName+'_variantSettings_properties',response);}}},error:function(request,textStatus,errorThrown){Le.processAjaxError(request,textStatus,errorThrown);},complete:function(){Le.removeLabelLoadingIndicator();}});};;mQuery(document).on({"chosen:hiding_dropdown":function(){mQuery('#app-wrapper').css('overflow','hidden');},"chosen:showing_dropdown":function(){mQuery('#app-wrapper').css('overflow','visible');}});Le.renameFormElements=function(container,oldIdPrefix,oldNamePrefix,newIdPrefix,newNamePrefix){mQuery('*[id^="'+oldIdPrefix+'"]',container).each(function(){var id=mQuery(this).attr('id');id=id.replace(oldIdPrefix,newIdPrefix);mQuery(this).attr('id',id);var name=mQuery(this).attr('name');if(name){name=name.replace(oldNamePrefix,newNamePrefix);mQuery(this).attr('name',name);}});mQuery('label[for^="'+oldIdPrefix+'"]',container).each(function(){var id=mQuery(this).attr('for');id=id.replace(oldIdPrefix,newIdPrefix);mQuery(this).attr('for',id);});};Le.ajaxifyForm=function(formName){Le.initializeFormFieldVisibilitySwitcher(formName);var form='form[name="'+formName+'"]';mQuery(form+' input, '+form+' select').off('keydown.ajaxform');mQuery(form+' input, '+form+' select').on('keydown.ajaxform',function(e){if(e.keyCode==13&&(e.metaKey||e.ctrlKey)){if(leVars.formSubmitInProgress){return false;}
var saveButton=mQuery(form).find('button.btn-save');var applyButton=mQuery(form).find('button.btn-apply');var modalParent=mQuery(form).closest('.modal');var inMain=mQuery(modalParent).length>0?false:true;if(mQuery(saveButton).length){if(inMain){if(mQuery(form).find('button.btn-save.btn-copy').length){mQuery(mQuery(form).find('button.btn-save.btn-copy')).trigger('click');return;}}else{if(mQuery(modalParent).find('button.btn-save.btn-copy').length){mQuery(mQuery(modalParent).find('button.btn-save.btn-copy')).trigger('click');return;}}
mQuery(saveButton).trigger('click');}else if(mQuery(applyButton).length){if(inMain){if(mQuery(form).find('button.btn-apply.btn-copy').length){mQuery(mQuery(form).find('button.btn-apply.btn-copy')).trigger('click');return;}}else{if(mQuery(modalParent).find('button.btn-apply.btn-copy').length){mQuery(mQuery(modalParent).find('button.btn-apply.btn-copy')).trigger('click');return;}}
mQuery(applyButton).trigger('click');}}else if(e.keyCode==13&&mQuery(e.target).is(':input')){var inputs=mQuery(this).parents('form').eq(0).find(':input');if(inputs[inputs.index(this)+1]!=null){inputs[inputs.index(this)+1].focus();}
e.preventDefault();return false;}});mQuery(form+' :submit').each(function(){mQuery(this).off('click.ajaxform');mQuery(this).on('click.ajaxform',function(){if(mQuery(this).attr('name')&&!mQuery('input[name="'+mQuery(this).attr('name')+'"]').length){mQuery('input.button-clicked').remove();mQuery('form[name="'+formName+'"]').append(mQuery('<input type="hidden" class="button-clicked">').attr({name:mQuery(this).attr('name'),value:mQuery(this).attr('value')}));}});});mQuery(form).off('submit.ajaxform');mQuery(form).on('submit.ajaxform',(function(e){e.preventDefault();var form=mQuery(this);if(leVars.formSubmitInProgress){return false;}else{var callbackAsync=form.data('submit-callback-async');if(callbackAsync&&typeof Le[callbackAsync]=='function'){Le[callbackAsync].apply(this,[form,function(){Le.postMauticForm(form);}]);}else{var callback=form.data('submit-callback');if(callback&&typeof Le[callback]=='function'){if(!Le[callback]()){return false;}}
Le.postMauticForm(form);}}
return false;}));};Le.postMauticForm=function(form){leVars.formSubmitInProgress=true;Le.postForm(form,function(response){if(response.inMain){Le.processPageContent(response);}else{Le.processModalContent(response,'#'+response.modalId);}});};Le.resetForm=function(form){mQuery(':input',form).not(':button, :submit, :reset, :hidden').val('').removeAttr('checked').prop('checked',false).removeAttr('selected').prop('selected',false);mQuery(form).find('select:not(.not-chosen):not(.multiselect)').each(function(){mQuery(this).find('option:selected').prop('selected',false)
mQuery(this).trigger('chosen:updated');});};Le.postForm=function(form,callback){var form=mQuery(form);var modalParent=form.closest('.modal');var inMain=mQuery(modalParent).length>0?false:true;var action=form.attr('action');if(!inMain){var modalTarget='#'+mQuery(modalParent).attr('id');Le.startModalLoadingBar(modalTarget);}
var showLoading=(!inMain||form.attr('data-hide-loadingbar'))?false:true;form.ajaxSubmit({showLoadingBar:showLoading,success:function(data){if(!inMain){Le.stopModalLoadingBar(modalTarget);}
if(data.redirect){Le.redirectWithBackdrop(data.redirect);}else{leVars.formSubmitInProgress=false;if(!inMain){var modalId=mQuery(modalParent).attr('id');}
if(data.sessionExpired){if(!inMain){mQuery('#'+modalId).modal('hide');mQuery('.modal-backdrop').remove();}
Le.processPageContent(data);}else if(callback){data.inMain=inMain;if(!inMain){data.modalId=modalId;}
if(typeof callback=='function'){callback(data);}else if(typeof Le[callback]=='function'){Le[callback](data);}}}},error:function(request,textStatus,errorThrown){leVars.formSubmitInProgress=false;Le.processAjaxError(request,textStatus,errorThrown,inMain);}});};Le.initializeFormFieldVisibilitySwitcher=function(formName)
{Le.switchFormFieldVisibilty(formName);mQuery('form[name="'+formName+'"]').change(function(){Le.switchFormFieldVisibilty(formName);});};Le.switchFormFieldVisibilty=function(formName){var form=mQuery('form[name="'+formName+'"]');var fields={};var fieldsPriority={};var getFieldParts=function(fieldName){var returnObject={"name":fieldName,"attribute":''};if(fieldName.search(':')!==-1){var returnArray=fieldName.split(':');returnObject.name=returnArray[0];returnObject.attribute=returnArray[1];}
return returnObject;};var checkValueCondition=function(sourceFieldVal,condition){var visible=true;if(typeof condition=='object'){visible=mQuery.inArray(sourceFieldVal,condition)!==-1;}else if(condition=='empty'||(condition=='notEmpty')){var isEmpty=(sourceFieldVal==''||sourceFieldVal==null||sourceFieldVal=='undefined');visible=(condition=='empty')?isEmpty:!isEmpty;}else if(condition!==sourceFieldVal){visible=false;}
return visible;};var checkFieldCondition=function(fieldId,attribute,condition){var visible=true;if(attribute){if(typeof mQuery('#'+fieldId).attr(attribute)!=='undefined'){var field='#'+fieldId;}else if(mQuery('#'+fieldId).is('select')){var field=mQuery('#'+fieldId+' option[value="'+mQuery('#'+fieldId).val()+'"]');}else{return visible;}
var attributeValue=(typeof mQuery(field).attr(attribute)!=='undefined')?mQuery(field).attr(attribute):null;return checkValueCondition(attributeValue,condition);}else if(mQuery('#'+fieldId).is(':checkbox')||mQuery('#'+fieldId).is(':radio')){return(condition=='checked'&&mQuery('#'+fieldId).is(':checked'))||(condition==''&&!mQuery('#'+fieldId).is(':checked'));}
return checkValueCondition(mQuery('#'+fieldId).val(),condition);}
form.find('[data-show-on]').each(function(index,el){var field=mQuery(el);var showOn=jQuery.parseJSON(field.attr('data-show-on'));mQuery.each(showOn,function(fieldId,condition){var fieldParts=getFieldParts(fieldId);if(typeof fields[field.attr('id')]==='undefined'||!fields[field.attr('id')]){fields[field.attr('id')]=checkFieldCondition(fieldParts.name,fieldParts.attribute,condition);}});});form.find('[data-hide-on]').each(function(index,el){var field=mQuery(el);var hideOn=jQuery.parseJSON(field.attr('data-hide-on'));if(typeof hideOn.display_priority!=='undefined'){fieldsPriority[field.attr('id')]='hide';delete hideOn.display_priority;}
mQuery.each(hideOn,function(fieldId,condition){var fieldParts=getFieldParts(fieldId);if(typeof fields[field.attr('id')]==='undefined'||fields[field.attr('id')]){fields[field.attr('id')]=!checkFieldCondition(fieldParts.name,fieldParts.attribute,condition);}});});mQuery.each(fields,function(fieldId,show){var fieldContainer=mQuery('#'+fieldId).closest('[class*="col-"]');;if(show){fieldContainer.fadeIn();}else{fieldContainer.fadeOut();}});};Le.updateEntitySelect=function(response){var mQueryParent=(window.opener)?window.opener.mQuery:mQuery;if(response.id){var newOption=mQuery('<option />').val(response.id);newOption.html(response.name);var el='#'+response.updateSelect;var sortOptions=function(options){return options.sort(function(a,b){var alc=a.text.toLowerCase(),blc=b.text.toLowerCase();return alc>blc?1:alc<blc?-1:0;});}
var emptyOption=false,createNewOption=false;if(mQueryParent(el).prop('disabled')){mQueryParent(el).prop('disabled',false);var emptyOption=mQuery('<option value="">'+leLang.chosenChooseOne+'</option>');}else{if(mQueryParent(el+' option[value=""]').length){emptyOption=mQueryParent(el+' option[value=""]').clone();mQueryParent(el+' option[value=""]').remove();}
if(mQueryParent(el+' option[value="new"]').length){createNewOption=mQueryParent(el+' option[value="new"]').clone();mQueryParent(el+' option[value="new"]').remove();}}
if(response.group){var optgroup=el+' optgroup[label="'+response.group+'"]';if(mQueryParent(optgroup).length){var firstOptionGroups=mQueryParent(optgroup);var isUpdateOption=false;firstOptionGroups.each(function(){var firstOptions=mQuery(this).children();for(var i=0;i<firstOptions.length;i++){if(firstOptions[i].value===response.id.toString()){firstOptions[i].text=response.name;isUpdateOption=true;break;}}});if(!isUpdateOption){mQueryParent(optgroup).append(newOption);}}else{var newOptgroup=mQuery('<optgroup label= />');newOption.appendTo(newOptgroup);mQueryParent(newOptgroup).appendTo(mQueryParent(el));}
var optionGroups=sortOptions(mQueryParent(el+' optgroup'));optionGroups.each(function(){var options=sortOptions(mQuery(this).children());mQuery(this).html(options);});var appendOptions=optionGroups;}else{newOption.appendTo(mQueryParent(el));var appendOptions=sortOptions(mQueryParent(el).children());}
mQueryParent(el).html(appendOptions);if(createNewOption){mQueryParent(el).prepend(createNewOption);}
if(emptyOption){mQueryParent(el).prepend(emptyOption);}
newOption.prop('selected',true);mQueryParent(el).trigger("chosen:updated");}
if(window.opener){window.close();}else{mQueryParent('#leSharedModal').modal('hide');}};Le.toggleYesNoButtonClass=function(changedId){changedId='#'+changedId;var isYesButton=mQuery(changedId).parent().hasClass('btn-yes');var isExtraButton=mQuery(changedId).parent().hasClass('btn-extra');if(isExtraButton){mQuery(changedId).parents('.btn-group').find('.btn').removeClass('btn-success btn-danger').addClass('btn-default');}else{var otherButton=isYesButton?'.btn-no':'.btn-yes';var otherLabel=mQuery(changedId).parent().parent().find(otherButton);if(mQuery(changedId).prop('checked')){var thisRemove='btn-default',otherAdd='btn-default';if(isYesButton){var thisAdd='btn-success',otherRemove='btn-danger';}else{var thisAdd='btn-danger',otherRemove='btn-success';}}else{var thisAdd='btn-default';if(isYesButton){var thisAdd='btn-success',otherRemove='btn-danger';}else{var thisAdd='btn-danger',otherRemove='btn-success';}}
if(changedId=="#leadlistoptin_listtype_0"&&thisAdd=="btn-danger"){thisAdd="btn-success";}else if(changedId=="#leadlistoptin_listtype_1"&&otherRemove=="btn-danger"){otherRemove="btn-success";}
mQuery(changedId).parent().removeClass(thisRemove).addClass(thisAdd);mQuery(otherLabel).removeClass(otherRemove).addClass(otherAdd);}
return true;};Le.removeFormListOption=function(el){var sortableDiv=mQuery(el).parents('div.sortable');var inputCount=mQuery(sortableDiv).parents('div.form-group').find('input.sortable-itemcount');var count=mQuery(inputCount).val();count--;mQuery(inputCount).val(count);mQuery(sortableDiv).remove();};Le.createOption=function(value,label){return mQuery('<option/>').attr('value',value).text(label);}
Le.updateFieldOperatorValue=function(field,action,valueOnChange,valueOnChangeArguments){var fieldId=mQuery(field).attr('id');Le.activateLabelLoadingIndicator(fieldId);if(fieldId.indexOf('_operator')!==-1){var fieldType='operator';}else if(fieldId.indexOf('_field')!==-1){var fieldType='field';}else{return;}
var fieldPrefix=fieldId.slice(0,-1*fieldType.length);var fieldAlias=mQuery('#'+fieldPrefix+'field').val();var fieldOperator=mQuery('#'+fieldPrefix+'operator').val();Le.ajaxActionRequest(action,{'alias':fieldAlias,'operator':fieldOperator,'changed':fieldType},function(response){if(typeof response.options!='undefined'){var valueField=mQuery('#'+fieldPrefix+'value');var valueFieldAttrs={'class':valueField.attr('class'),'id':valueField.attr('id'),'name':valueField.attr('name'),'autocomplete':valueField.attr('autocomplete'),'value':valueField.val()};if(mQuery('#'+fieldPrefix+'value_chosen').length){valueFieldAttrs['value']='';valueField.chosen('destroy');}
if(!mQuery.isEmptyObject(response.options)&&response.fieldType!=='number'){var newValueField=mQuery('<select/>').attr('class',valueFieldAttrs['class']).attr('id',valueFieldAttrs['id']).attr('name',valueFieldAttrs['name']).attr('autocomplete',valueFieldAttrs['autocomplete']).attr('value',valueFieldAttrs['value']);mQuery.each(response.options,function(value,optgroup){if(typeof optgroup==='object'){var optgroupEl=mQuery('<optgroup/>').attr('label',value);mQuery.each(optgroup,function(optVal,label){var option=Le.createOption(optVal,label);if(response.optionsAttr&&response.optionsAttr[optVal]){mQuery.each(response.optionsAttr[optVal],function(optAttr,optVal){option.attr(optAttr,optVal);});}
optgroupEl.append(option)});newValueField.append(optgroupEl);}else{var option=Le.createOption(value,optgroup);if(response.optionsAttr&&response.optionsAttr[value]){mQuery.each(response.optionsAttr[value],function(optAttr,optVal){option.attr(optAttr,optVal);});}
newValueField.append(option);}});newValueField.val(valueFieldAttrs['value']);valueField.replaceWith(newValueField);Le.activateChosenSelect(newValueField);}else{var newValueField=mQuery('<input/>').attr('type','text').attr('class',valueFieldAttrs['class']).attr('id',valueFieldAttrs['id']).attr('name',valueFieldAttrs['name']).attr('autocomplete',valueFieldAttrs['autocomplete']).attr('value',valueFieldAttrs['value']);if(response.disabled){newValueField.attr('value','');newValueField.prop('disabled',true);}
valueField.replaceWith(newValueField);if(response.fieldType=='date'||response.fieldType=='datetime'){Le.activateDateTimeInputs(newValueField,response.fieldType);}}
if(valueOnChange&&typeof valueOnChange=='function'){mQuery('#'+fieldPrefix+'value').on('change',function(){if(typeof valueOnChangeArguments!='object'){valueOnChangeArguments=[];}
valueOnChangeArguments.unshift(mQuery('#'+fieldPrefix+'value'));valueOnChange.apply(null,valueOnChangeArguments);});}
if(!mQuery.isEmptyObject(response.operators)){var operatorField=mQuery('#'+fieldPrefix+'operator');if(mQuery('#'+fieldPrefix+'operator_chosen').length){operatorField.chosen('destroy');}
var operatorFieldAttrs={'class':operatorField.attr('class'),'id':operatorField.attr('id'),'name':operatorField.attr('name'),'autocomplete':operatorField.attr('autocomplete'),'value':operatorField.val()};var newOperatorField=mQuery('<select/>').attr('class',operatorFieldAttrs['class']).attr('id',operatorFieldAttrs['id']).attr('name',operatorFieldAttrs['name']).attr('autocomplete',operatorFieldAttrs['autocomplete']).attr('value',operatorFieldAttrs['value']).attr('onchange','Le.updateLeadFieldValues(this)');mQuery.each(response.operators,function(optionKey,optionVal){newOperatorField.append(Le.createOption(optionKey,optionVal));});newOperatorField.val(operatorField.val());operatorField.replaceWith(newOperatorField);Le.activateChosenSelect(newOperatorField);}}
Le.removeLabelLoadingIndicator();});};;if(typeof Chart!='undefined'){Chart.defaults.global.elements.line.borderWidth=1;Chart.defaults.global.elements.point.radius=2;Chart.defaults.global.legend.labels.boxWidth=12;Chart.defaults.global.maintainAspectRatio=false;}
Le.renderCharts=function(scope){var charts=[];if(!Le.chartObjects)Le.chartObjects=[];if(mQuery.type(scope)==='string'){charts=mQuery(scope).find('canvas.chart');}else if(scope){charts=scope.find('canvas.chart');}else{charts=mQuery('canvas.chart');}
if(charts.length){charts.each(function(index,canvas){canvas=mQuery(canvas);if(!canvas.hasClass('chart-rendered')){if(canvas.hasClass('line-chart')){Le.renderLineChart(canvas)}else if(canvas.hasClass('pie-chart')){Le.renderPieChart(canvas)}else if(canvas.hasClass('bar-chart')){Le.renderBarChart(canvas)}else if(canvas.hasClass('liefechart-bar-chart')){Le.renderLifechartBarChart(canvas)}else if(canvas.hasClass('simple-bar-chart')){Le.renderSimpleBarChart(canvas)}else if(canvas.hasClass('horizontal-bar-chart')){Le.renderHorizontalBarChart(canvas)}}
canvas.addClass('chart-rendered');});}};Le.renderLineChart=function(canvas){var data=mQuery.parseJSON(canvas.text());if(!data.labels.length||!data.datasets.length)return;var chart=new Chart(canvas,{type:'line',data:data,options:{lineTension:0.2,borderWidth:1,scales:{xAxes:[{ticks:{beginAtZero:true},gridLines:{drawOnChartArea:false}}],yAxes:[{ticks:{beginAtZero:true},gridLines:{drawOnChartArea:false}}]}}});Le.chartObjects.push(chart);};Le.renderPieChart=function(canvas){var data=mQuery.parseJSON(canvas.text());var options={borderWidth:1};var disableLegend=canvas.attr('data-disable-legend');if(typeof disableLegend!=='undefined'&&disableLegend!==false){options.legend={display:false}}
var chart=new Chart(canvas,{type:'pie',data:data,options:options});Le.chartObjects.push(chart);};Le.renderBarChart=function(canvas){var data=mQuery.parseJSON(canvas.text());var chart=new Chart(canvas,{type:'bar',data:data,options:{scales:{xAxes:[{barPercentage:0.9,}]}}});Le.chartObjects.push(chart);};Le.renderLifechartBarChart=function(canvas){var canvasWidth=mQuery(canvas).parent().width();var barWidth=(canvasWidth<300)?5:25;var data=mQuery.parseJSON(canvas.text());var chart=new Chart(canvas,{type:'bar',data:data,options:{scales:{xAxes:[{barThickness:barWidth,}]}}});Le.chartObjects.push(chart);};Le.renderSimpleBarChart=function(canvas){var data=mQuery.parseJSON(canvas.text());var chart=new Chart(canvas,{type:'bar',data:data,options:{scales:{xAxes:[{stacked:false,ticks:{fontSize:9},gridLines:{display:false},}],yAxes:[{display:false,stacked:false,ticks:{beginAtZero:true,display:false},gridLines:{display:false}}],display:false},legend:{display:false}}});Le.chartObjects.push(chart);};Le.renderHorizontalBarChart=function(canvas){var data=mQuery.parseJSON(canvas.text());var chart=new Chart(canvas,{type:'horizontalBar',data:data,options:{scales:{xAxes:[{display:true,stacked:false,gridLines:{display:false},ticks:{beginAtZero:true,display:true,fontSize:8,stepSize:5}}],yAxes:[{stacked:false,ticks:{beginAtZero:true,display:true,fontSize:9},gridLines:{display:false},barPercentage:0.5,categorySpacing:1}],display:false},legend:{display:false},tooltips:{mode:'single',bodyFontSize:9,bodySpacing:0,callbacks:{title:function(tooltipItems,data){return'';},label:function(tooltipItem,data){return tooltipItem.xLabel+': '+tooltipItem.yLabel;}}}}});Le.chartObjects.push(chart);};Le.renderMaps=function(scope){var maps=[];if(mQuery.type(scope)==='string'){maps=mQuery(scope).find('.vector-map');}else if(scope){maps=scope.find('.vector-map');}else{maps=mQuery('.vector-map');}
if(maps.length){maps.each(function(index,element){Le.renderMap(mQuery(element));});}};Le.renderMap=function(wrapper){if(wrapper.is(':visible')){if(!Le.mapObjects)Le.mapObjects=[];var data=wrapper.data('map-data');if(typeof data==='undefined'||!data.length){try{data=mQuery.parseJSON(wrapper.text());wrapper.data('map-data',data);}catch(error){return;}}
var firstKey=Object.keys(data)[0];if(firstKey=="0"){var markersData=data,regionsData={};}else{var markersData={},regionsData=data;}
wrapper.text('');wrapper.vectorMap({backgroundColor:'transparent',zoomOnScroll:false,markers:markersData,markerStyle:{initial:{fill:'#40C7B5'},selected:{fill:'#40C7B5'}},regionStyle:{initial:{"fill":'#dce0e5',"fill-opacity":1,"stroke":'none',"stroke-width":0,"stroke-opacity":1},hover:{"fill-opacity":0.7,"cursor":'pointer'}},map:'world_mill_en',series:{regions:[{values:regionsData,scale:['#dce0e5','#40C7B5'],normalizeFunction:'polynomial'}]},onRegionTipShow:function(event,label,index){if(data[index]>0){label.html('<b>'+label.html()+'</b></br>'+
data[index]+' Leads');}}});wrapper.addClass('map-rendered');Le.mapObjects.push(wrapper);return wrapper;}};Le.destroyMap=function(wrapper){if(wrapper.hasClass('map-rendered')){var map=wrapper.vectorMap('get','mapObject');map.removeAllMarkers();map.remove();wrapper.empty();wrapper.removeClass('map-rendered');}};Le.initDateRangePicker=function(fromId,toId){var dateFrom=mQuery(fromId);var dateTo=mQuery(toId);if(dateFrom.length&&dateTo.length){dateFrom.datetimepicker({format:'M j, Y',onShow:function(ct){this.setOptions({maxDate:dateTo.val()?new Date(dateTo.val()):false});},timepicker:false,scrollMonth:false,scrollInput:false});dateTo.datetimepicker({format:'M j, Y',onShow:function(ct){this.setOptions({maxDate:new Date(),minDate:dateFrom.val()?new Date(dateFrom.val()):false});},timepicker:false,scrollMonth:false,scrollInput:false});}};Le.getChartData=function(element,action,query,callback){var element=mQuery(element);var wrapper=element.closest('ul');var button=mQuery('#time-scopes .button-label');wrapper.find('a').removeClass('bg-primary');element.addClass('bg-primary');button.text(element.text());query=query+'&action='+action;mQuery.ajax({showLoadingBar:true,url:leAjaxUrl,type:'POST',data:query,dataType:"json",success:function(response){if(response.success){Le.stopPageLoadingBar();if(typeof callback=='function'){callback(response);}else if(typeof window["Le"][callback]!=='undefined'){window["Le"][callback].apply('window',[response]);}}},error:function(request,textStatus,errorThrown){Le.processAjaxError(request,textStatus,errorThrown);}});};Le.emulateNoDataForPieChart=function(data){var dataEmpty=true;mQuery.each(data,function(i,part){if(part.value){dataEmpty=false;}});if(dataEmpty){data=[{value:1,color:"#efeeec",highlight:"#EBEBEB",label:"No data"}];}
return data;};;Le.activateSortablePanels=function(container){mQuery(container).find('.available-panel-selector').each(function(){var sortablesContainer=mQuery(this).closest('.sortable-panels');var selector=this;var prefix=mQuery(selector).data('prototype-prefix');mQuery(selector).on('change',function(){var selected=mQuery(this).val();selected=selected.replace('.','-');var prototype='#'+prefix+selected;console.log(prototype);if(mQuery(prototype).length){console.log('exists');Le.appendSortablePanel(sortablesContainer,prototype);}
mQuery(selector).val('');mQuery(selector).trigger('chosen:updated');});var bodyOverflow={};mQuery(sortablesContainer).sortable({items:'.panel',handle:'.sortable-panel-wrapper',cancel:'',helper:function(e,ui){ui.children().each(function(){if(!mQuery(this).hasClass('modal')){mQuery(this).width(mQuery(this).width());}});bodyOverflow.overflowX=mQuery('body').css('overflow-x');bodyOverflow.overflowY=mQuery('body').css('overflow-y');mQuery('body').css({overflowX:'visible',overflowY:'visible'});return ui;},scroll:true,axis:'y',containment:'#'+mQuery(sortablesContainer).attr('id')+' .drop-here',stop:function(e,ui){mQuery('body').css(bodyOverflow);mQuery(ui.item).attr('style','');}});});var sortable=mQuery(container).hasClass('sortable-panels')?container:mQuery(container).find('.sortable-panels');mQuery(sortable).find('.sortable-panel-wrapper').each(function(){Le.activateSortablePanel(mQuery(this).closest('.panel'));});};Le.activateSortablePanel=function(panel){mQuery(panel).find('.sortable-panel-buttons').each(function(){mQuery(this).find('.btn-delete').on('click',function(){Le.deleteSortablePanel(mQuery(this).closest('.panel'));});mQuery(this).find('.btn-edit').on('click',function(){Le.showModal('#'+mQuery(panel).find('.modal').attr('id'));});});mQuery(panel).find('select').not('.multiselect, .not-chosen').each(function(){Le.activateChosenSelect(this,true);});mQuery(panel).on('dblclick.sortablepanels',function(event){event.preventDefault();mQuery(this).find('.btn-edit').first().click();});if(mQuery(panel).hasClass('sortable-has-error')){var originalClass=mQuery(panel).find('.btn-edit i.fa').attr('class');mQuery(panel).find('.btn-edit i.fa').attr('data-original-icon',originalClass);mQuery(panel).find('.btn-edit i.fa').attr('class','fa fa-warning text-warning');}};Le.appendSortablePanel=function(sortablesContainer,modal){var newIdPrefix=mQuery(sortablesContainer).find('.available-panel-selector').attr('data-prototype-id-prefix');var newNamePrefix=mQuery(sortablesContainer).find('.available-panel-selector').attr('data-prototype-name-prefix');var oldIdPrefix=mQuery(modal).attr('data-id-prefix');var oldNamePrefix=mQuery(modal).attr('data-name-prefix');var index=parseInt(mQuery(sortablesContainer).attr('data-index'));var panelId=index+1;mQuery(sortablesContainer).attr('data-index',panelId);var panelName=mQuery(modal).attr('data-name');oldIdPrefix=oldIdPrefix+panelName;oldNamePrefix=oldNamePrefix+'['+panelName+']';newIdPrefix=newIdPrefix+index;newNamePrefix=newNamePrefix+'['+index+']';var newPanel=mQuery(sortablesContainer).find('.panel-prototype .panel').clone();var selectedPanel=mQuery(sortablesContainer).find('.available-panel-selector').children('option:selected');var placeholders=selectedPanel.attr('data-placeholders');if(placeholders){placeholders=mQuery.parseJSON(placeholders);var newPanelContent=mQuery(newPanel).html();mQuery.each(placeholders,function(key,val){newPanelContent=newPanelContent.replace(key,val);});newPanel.html(newPanelContent);}
mQuery(newPanel).addClass('new-panel');mQuery(newPanel).attr('data-default-label',selectedPanel.attr('data-default-label'));mQuery(sortablesContainer).find('.drop-here').append(newPanel);var newModal=mQuery(modal).clone();mQuery(newModal).removeClass('in').css('display','none');mQuery(newModal).attr('id',mQuery(newModal).attr('id').replace(oldIdPrefix,newIdPrefix));mQuery(newModal).find('button[data-embedded-form="cancel"]').removeAttr('data-embedded-form-clear');mQuery(newModal).find('button[data-embedded-form-callback="cancelSortablePanel"]').removeAttr('data-embedded-form-callback');mQuery(newModal).modal('hide');newPanel.append(newModal);Le.renameFormElements(newModal,oldIdPrefix,oldNamePrefix,newIdPrefix,newNamePrefix)
Le.activateModalEmbeddedForms('#'+mQuery(newModal).attr('id'));Le.showModal(newModal);mQuery(newModal).find('select').not('.multiselect, .not-chosen').each(function(){Le.activateChosenSelect(this);});};Le.updateSortablePanel=function(modalBtn,modal){var panel=mQuery(modal).closest('.panel');var label='';var hasNameField=false;if(mQuery(modalBtn).attr('data-panel-label')){label=mQuery(modalBtn).attr('data-panel-label');}else if(mQuery(modal).attr('data-panel-label')){label=mQuery(modal).attr('data-panel-label');}else if(mQuery(modal).find("input[name$='[name]']").length){label=mQuery(modal).find("input[name$='[name]']").val();hasNameField=true;}
if(!label.length){label=mQuery(panel).attr('data-default-label');if(hasNameField){mQuery(modal).find("input[name$='[name]']").val(label);}}
mQuery(panel).find('.sortable-panel-label').html(label);var footer='';if(mQuery(modalBtn).attr('data-panel-footer')){var footer=mQuery(modalBtn).attr('data-panel-footer');}else if(mQuery(modal).attr('data-panel-footer')){var footer=mQuery(modal).attr('data-panel-footer');}
mQuery(panel).find('.sortable-panel.footer').html(footer);if(mQuery(panel).hasClass('sortable-has-error')){mQuery(panel).removeClass('sortable-has-error');var editBtn=mQuery(panel).find('.btn-edit i');if(editBtn.length){editBtn.attr('class',editBtn.attr('data-original-icon'));}}
Le.activateSortablePanel(panel);mQuery(panel).removeClass('new-panel');mQuery(panel).find('.modal .btn-add').addClass('hide');mQuery(panel).find('.modal .btn-update').removeClass('hide');Le.toggleSortablePanelAddMessage(mQuery(panel).closest('.sortable-panels'));};Le.deleteSortablePanel=function(panel){var panelContainer=mQuery(panel).closest('.sortable-panels');mQuery(panel).remove();Le.toggleSortablePanelAddMessage(panelContainer);};Le.cancelSortablePanel=function(modalBtn,modal){setTimeout(function(){mQuery(modal).closest('.panel').remove();},500);}
Le.toggleSortablePanelAddMessage=function(panelContainer){var panelsLeft=mQuery(panelContainer).find('.sortable-panel-wrapper').length;mQuery(panelContainer).find('.sortable-panel-placeholder').each(function(){if(panelsLeft<=1){mQuery(this).removeClass('hide');}else{mQuery(this).addClass('hide');}});};;Le.modalContentXhr={};Le.activeModal='';Le.backgroundedModal='';Le.ajaxifyModal=function(el,event){if(mQuery(el).hasClass('disabled')){return false;}
var target=mQuery(el).attr('data-target');var route=(mQuery(el).attr('data-href'))?mQuery(el).attr('data-href'):mQuery(el).attr('href');if(route.indexOf('javascript')>=0){return false;}
mQuery('body').addClass('noscroll');var method=mQuery(el).attr('data-method');if(!method){method='GET'}
var header=mQuery(el).attr('data-header');var footer=mQuery(el).attr('data-footer');var preventDismissal=mQuery(el).attr('data-prevent-dismiss');if(preventDismissal){mQuery(el).removeAttr('data-prevent-dismiss');}
Le.loadAjaxModal(target,route,method,header,footer,preventDismissal);};Le.loadAjaxModal=function(target,route,method,header,footer,preventDismissal){if(mQuery(target+' .loading-placeholder').length){mQuery(target+' .loading-placeholder').removeClass('hide');mQuery(target+' .modal-body-content').addClass('hide');if(mQuery(target+' .modal-loading-bar').length){mQuery(target+' .modal-loading-bar').addClass('active');}}
if(footer=='false'){mQuery(target+" .modal-footer").addClass('hide');}
mQuery(target).on('show.bs.modal',function(){if(header){mQuery(target+" .modal-title").html(header);}
if(footer&&footer!='false'){mQuery(target+" .modal-footer").html(header);}});mQuery(target).on('hidden.bs.modal',function(){if(typeof Le.modalContentXhr[target]!='undefined'){Le.modalContentXhr[target].abort();delete Le.modalContentXhr[target];}
mQuery('body').removeClass('noscroll');var response={};if(Le.modalMauticContent){response.leContent=Le.modalMauticContent;delete Le.modalMauticContent;}
Le.onPageUnload(target,response);Le.resetModal(target);});if(typeof mQuery(target).data('bs.modal')!=='undefined'&&typeof mQuery(target).data('bs.modal').options!=='undefined'){if(preventDismissal){mQuery(target).data('bs.modal').options.keyboard=false;mQuery(target).data('bs.modal').options.backdrop='static';}else{mQuery(target).data('bs.modal').options.keyboard=true;mQuery(target).data('bs.modal').options.backdrop=true;}}else{if(preventDismissal){mQuery(target).modal({backdrop:'static',keyboard:false});}else{mQuery(target).modal({backdrop:true,keyboard:true});}}
Le.showModal(target);if(typeof Le.modalContentXhr=='undefined'){Le.modalContentXhr={};}else if(typeof Le.modalContentXhr[target]!='undefined'){Le.modalContentXhr[target].abort();}
Le.modalContentXhr[target]=mQuery.ajax({url:route,type:method,dataType:"json",success:function(response){if(response){Le.processModalContent(response,target);}
Le.stopIconSpinPostEvent();},error:function(request,textStatus,errorThrown){Le.processAjaxError(request,textStatus,errorThrown);Le.stopIconSpinPostEvent();},complete:function(){Le.stopModalLoadingBar(target);delete Le.modalContentXhr[target];}});};Le.updateAjaxModal=function(target,route,method){if(mQuery(target+' .loading-placeholder').length){mQuery(target+' .loading-placeholder').removeClass('hide');mQuery(target+' .modal-body-content').html("");if(mQuery(target+' .modal-loading-bar').length){mQuery(target+' .modal-loading-bar').addClass('active');}}
Le.modalContentXhr[target]=mQuery.ajax({url:route,type:method,dataType:"json",success:function(response){if(response.newContent){if(mQuery(target+' .loading-placeholder').length){mQuery(target+' .loading-placeholder').addClass('hide');mQuery(target+' .modal-body-content').html(response.newContent);mQuery(target+' .modal-body-content').removeClass('hide');}else{mQuery(target+' .modal-body').html(response.newContent);}
Le.onPageLoad(target,response,true);}
Le.stopIconSpinPostEvent();},error:function(request,textStatus,errorThrown){Le.processAjaxError(request,textStatus,errorThrown);Le.stopIconSpinPostEvent();},complete:function(){Le.stopModalLoadingBar(target);delete Le.modalContentXhr[target];}});};Le.resetModal=function(target){if(mQuery(target).hasClass('in')){return;}
mQuery(target+" .modal-title").html('');mQuery(target+" .modal-body-content").html('');if(mQuery(target+" loading-placeholder").length){mQuery(target+" loading-placeholder").removeClass('hide');}
if(mQuery(target+" .modal-footer").length){var hasFooterButtons=mQuery(target+" .modal-footer .modal-form-buttons").length;mQuery(target+" .modal-footer").html('');if(hasFooterButtons){mQuery('<div class="modal-form-buttons" />').appendTo(target+" .modal-footer");}
mQuery(target+" .modal-footer").removeClass('hide');}};Le.processModalContent=function(response,target){Le.stopIconSpinPostEvent();if(response.error){if(response.errors){alert(response.errors[0].message);}else if(response.error.message){alert(response.error.message);}else{alert(response.error);}
return;}
if(response.sessionExpired||(response.closeModal&&response.newContent&&!response.updateModalContent)){mQuery(target).modal('hide');mQuery('body').removeClass('modal-open');mQuery('.modal-backdrop').remove();Le.processPageContent(response);}else{if(response.notifications){Le.setNotifications(response.notifications);}
if(response.browserNotifications){Le.setBrowserNotifications(response.browserNotifications);}
if(response.callback){window["Le"][response.callback].apply('window',[response]);return;}
if(response.target){mQuery(response.target).html(response.newContent);Le.onPageLoad(response.target,response,true);}else if(response.newContent){if(mQuery(target+' .loading-placeholder').length){mQuery(target+' .loading-placeholder').addClass('hide');mQuery(target+' .modal-body-content').html(response.newContent);mQuery(target+' .modal-body-content').removeClass('hide');}else{mQuery(target+' .modal-body').html(response.newContent);}}
Le.onPageLoad(target,response,true);Le.modalMauticContent=false;if(response.closeModal){mQuery('body').removeClass('noscroll');mQuery(target).modal('hide');if(!response.updateModalContent){Le.onPageUnload(target,response);}}else{Le.modalMauticContent=response.leContent?response.leContent:false;}}};Le.showConfirmation=function(el){var precheck=mQuery(el).data('precheck');if(precheck){if(typeof precheck=='function'){if(!precheck()){return;}}else if(typeof Le[precheck]=='function'){if(!Le[precheck]()){return;}}}
var message=mQuery(el).data('message');var confirmText=mQuery(el).data('confirm-text');var confirmAction=mQuery(el).attr('href');var confirmCallback=mQuery(el).data('confirm-callback');var cancelText=mQuery(el).data('cancel-text');var cancelCallback=mQuery(el).data('cancel-callback');var buttonText='Yes, delete it';if(typeof confirmText!=="undefined"&&confirmText=="Activate"){buttonText='Yes, '+confirmText+' it';}
var canceltxt='No, cancel';var type='warning';if(confirmAction.indexOf('/batchExport')!=-1){buttonText='Yes';canceltxt='No';type='';}
swal({title:'Are you sure?',text:message,type:type,showCancelButton:true,confirmButtonText:buttonText,cancelButtonText:canceltxt,confirmButtonClass:'btn btn-success',cancelButtonClass:'btn btn-danger m-l-10',buttonsStyling:false}).then(function(response){if(response.value){if(typeof Le[confirmCallback]==="function"){if(confirmCallback=='executeAction'){window["Le"][confirmCallback].apply('window',[confirmAction,Le.responseCallBack]);}else{window["Le"][confirmCallback].apply('window',[confirmAction,el,Le.responseCallBack]);}}}else if(response.dismiss==='cancel'){if(cancelCallback&&typeof Le[cancelCallback]==="function"){window["Le"][cancelCallback].apply('window',[]);}}},function(dismiss){})};Le.successModel=function(title,msg,type){swal(title,msg,type);};Le.dismissConfirmation=function(){if(mQuery('.confirmation-modal').length){mQuery('.confirmation-modal').modal('hide');}};Le.responseCallBack=function(response){try{if(response.flashes){var alerthtml=response.flashes;var alerthtmlel=mQuery(alerthtml);var alerttype=alerthtmlel.attr('data-alert-type');var alertmessage=mQuery(alerthtmlel).find('span').html();if(typeof alertmessage!='undefined'){alertmessage=alertmessage.trim();}else{alertmessage='';}
if(alertmessage!=''){if(alerttype!='error'){alerttype='success';alerttitle='Deleted!';}else{alerttitle='Sorry!';}
swal(alerttitle,alertmessage,alerttype);}}}catch(err){}};Le.closeModalAndRedirect=function(el,url){Le.startModalLoadingBar(el);Le.loadContent(url);mQuery('body').removeClass('noscroll');};Le.RedirectToGivenURL=function(url){window.location.href=url;};Le.loadAjaxModalBySelectValue=function(el,value,route,header){var selectVal=mQuery(el).val();var hasValue=(selectVal==value);if(!hasValue&&mQuery.isArray(selectVal)){hasValue=(mQuery.inArray(value,selectVal)!==-1);}
if(hasValue){route=route+(route.indexOf('?')>-1?'&':'?')+'modal=1&contentOnly=1&updateSelect='+mQuery(el).attr('id');mQuery(el).find('option[value="'+value+'"]').prop('selected',false);mQuery(el).trigger("chosen:updated");Le.loadAjaxModal('#leSharedModal',route,'get',header);}};Le.showModal=function(target){if(mQuery('.modal.in').length){if(mQuery(target).closest('.modal').length){mQuery('<div />').attr('data-modal-placeholder',target).insertAfter(mQuery(target));mQuery(target).attr('data-modal-moved',1);mQuery(target).appendTo('body');}
var activeModal=mQuery('.modal.in .modal-dialog:not(:has(.aside))').parents('.modal').last(),targetModal=mQuery(target);if(activeModal.length&&activeModal.attr('id')!==targetModal.attr('id')){targetModal.attr('data-previous-modal','#'+activeModal.attr('id'));activeModal.find('.modal-dialog').addClass('aside');var stackedDialogCount=mQuery('.modal.in .modal-dialog.aside').length;if(stackedDialogCount<=5){activeModal.find('.modal-dialog').addClass('aside-'+stackedDialogCount);}
mQuery(target).on('hide.bs.modal',function(){var modal=mQuery(this);var previous=modal.attr('data-previous-modal');if(previous){mQuery(previous).find('.modal-dialog').removeClass('aside');mQuery(modal).attr('data-previous-modal',undefined);}
if(mQuery(modal).attr('data-modal-moved')){mQuery('[data-modal-placeholder').replaceWith(mQuery(modal));mQuery(modal).attr('data-modal-moved',undefined);}});}}
mQuery(target).modal('show');};;leVars.liveCache=new Array();leVars.lastSearchStr="";leVars.globalLivecache=new Array();leVars.lastGlobalSearchStr="";Le.isNewEntity=function(idInputSelector){id=mQuery(idInputSelector);if(id.length){return id.val().match("^new_");}
return null;};Le.getEntityId=function(){return(mQuery('input#entityId').length)?mQuery('input#entityId').val():0;};Le.reorderTableData=function(name,orderby,tmpl,target,baseUrl){if(typeof baseUrl=='undefined'){baseUrl=window.location.pathname;}
if(baseUrl.indexOf('tmpl')==-1){baseUrl=baseUrl+"?tmpl="+tmpl}
var route=baseUrl+"&name="+name+"&orderby="+encodeURIComponent(orderby);Le.loadContent(route,'','POST',target);};Le.filterTableData=function(name,filterby,filterValue,tmpl,target,baseUrl){if(typeof baseUrl=='undefined'){baseUrl=window.location.pathname;}
if(baseUrl.indexOf('tmpl')==-1){baseUrl=baseUrl+"?tmpl="+tmpl}
var route=baseUrl+"&name="+name+"&filterby="+encodeURIComponent(filterby)+"&value="+encodeURIComponent(filterValue)
Le.loadContent(route,'','POST',target);};Le.limitTableData=function(name,limit,tmpl,target,baseUrl){if(typeof baseUrl=='undefined'){baseUrl=window.location.pathname;}
if(baseUrl.indexOf('tmpl')==-1){baseUrl=baseUrl+"?tmpl="+tmpl}
var route=baseUrl+"&name="+name+"&limit="+limit;Le.loadContent(route,'','POST',target);};Le.pageTableData=function(name,page,tmpl,target,baseUrl){if(typeof baseUrl=='undefined'){baseUrl=window.location.pathname;}
if(baseUrl.indexOf('tmpl')==-1){baseUrl=baseUrl+"?tmpl="+tmpl}
var route=baseUrl+"&name="+name+"&pageId="+page;Le.loadContent(route,'','POST',target);}
Le.filterList=function(e,elId,route,target,liveCacheVar,action,overlayEnabled,overlayTarget){if(typeof liveCacheVar=='undefined'){liveCacheVar="liveCache";}
var el=mQuery('#'+elId);if(el.length&&(e.data.livesearch||mQuery(e.target).prop('tagName')=='BUTTON'||mQuery(e.target).parent().prop('tagName')=='BUTTON')){var value=el.val().trim();if(!value){action='clear';}else if(action=='clear'){el.val('');el.typeahead('val','');value='';}
if(false&&value&&value in leVars[liveCacheVar]){var response={"newContent":leVars[liveCacheVar][value]};response.target=target;response.overlayEnabled=overlayEnabled;response.overlayTarget=overlayTarget;Le.processPageContent(response);}else{var searchName=el.attr('name');if(searchName=='undefined'){searchName='search';}
if(searchName=='search'&&value.includes(' ')){if(!value.startsWith('"')){value='"'+value;}
if(!value.endsWith('"')){value=value+'"';}}
if(typeof Le.liveSearchXhr!=='undefined'){L['liveSearchXhr'].abort();}
var btn="button[data-livesearch-parent='"+elId+"']";if(mQuery(btn).length&&!mQuery(btn).hasClass('btn-nospin')&&!Le.filterButtonClicked){Le.startIconSpinOnEvent(btn);}
var tmpl=mQuery('#'+elId).data('tmpl');if(!tmpl){tmpl='list';}
var tmplParam=(route.indexOf('tmpl')==-1)?'&tmpl='+tmpl:'';var checkInModalTarget=(overlayTarget)?overlayTarget:target;var modalParent=mQuery(checkInModalTarget).closest('.modal');var inModal=mQuery(modalParent).length>0;if(inModal){var modalTarget='#'+mQuery(modalParent).attr('id');Le.startModalLoadingBar(modalTarget);}
var showLoading=(inModal)?false:true;Le.liveSearchXhr=mQuery.ajax({showLoadingBar:showLoading,url:route,type:"GET",data:searchName+"="+encodeURIComponent(value)+tmplParam,dataType:"json",success:function(response){if(response.redirect){window.location=response.redirect;}else{if(response.newContent){leVars[liveCacheVar][value]=response.newContent;}
response.target=target;response.overlayEnabled=overlayEnabled;response.overlayTarget=overlayTarget;if(mQuery(btn).length){if(action=='clear'){mQuery(btn).attr('data-livesearch-action','search');mQuery(btn).children('i').first().removeClass('fa-eraser').addClass('fa-search');}else{mQuery(btn).attr('data-livesearch-action','clear');mQuery(btn).children('i').first().removeClass('fa-search').addClass('fa-eraser');}}
if(inModal){Le.processModalContent(response);Le.stopModalLoadingBar(modalTarget);}else{Le.processPageContent(response);Le.stopPageLoadingBar();}}},error:function(request,textStatus,errorThrown){Le.processAjaxError(request,textStatus,errorThrown);if(mQuery(btn).length){if(action=='clear'){mQuery(btn).attr('data-livesearch-action','search');mQuery(btn).children('i').first().removeClass('fa-eraser').addClass('fa-search');}else{mQuery(btn).attr('data-livesearch-action','clear');mQuery(btn).children('i').first().removeClass('fa-search').addClass('fa-eraser');}}},complete:function(){delete Le.liveSearchXhr;delete Le.filterButtonClicked;}});}}};Le.setSearchFilter=function(el,searchId,string){if(typeof searchId=='undefined')
searchId='#list-search';else
searchId='#'+searchId;if(string||string===''){var current=string;}else{var filter=mQuery(el).val();var current=mQuery('#list-search').typeahead('val')+" "+filter;}
mQuery(searchId).typeahead('val',current);var e=mQuery.Event("keypress",{which:13});e.data={};e.data.livesearch=true;Le.filterList(e,'list-search',mQuery(searchId).attr('data-action'),mQuery(searchId).attr('data-target'),'liveCache');};Le.unlockEntity=function(model,id,parameter){mQuery.ajax({url:leAjaxUrl,type:"POST",data:"action=unlockEntity&model="+model+"&id="+id+"&parameter="+parameter,dataType:"json"});};Le.togglePublishStatus=function(event,el,model,id,extra,backdrop){event.preventDefault();var wasPublished=mQuery(el).hasClass('fa-toggle-on');mQuery(el).removeClass('fa-toggle-on fa-toggle-off').addClass('fa-spin fa-spinner');mQuery(el).tooltip('destroy');leVars.liveCache=new Array();if(backdrop){Le.activateBackdrop();}
if(extra){extra='&'+extra;}
mQuery(el).tooltip('destroy');mQuery.ajax({url:leAjaxUrl,type:"POST",data:"action=togglePublishStatus&model="+model+'&id='+id+extra,dataType:"json",success:function(response){if(!response.success){var addClass=(wasPublished)?'fa-toggle-on':'fa-toggle-off';mQuery(el).removeClass('fa-spin fa-spinner').addClass(addClass);var alertmsg="publish";if(wasPublished){alertmsg="un publish";}
alert("You don't have rights to "+alertmsg+" it");}else if(response.reload){Le.redirectWithBackdrop(window.location);}else if(response.statusHtml){mQuery(el).replaceWith(response.statusHtml);mQuery(el).tooltip({html:true,container:'body'});}else if(response.senderprofile=="1"&&response.success){var addClass='fa-toggle-off';mQuery(el).removeClass('fa-spin fa-spinner').addClass(addClass);}},error:function(request,textStatus,errorThrown){var addClass=(wasPublished)?'fa-toggle-on':'fa-toggle-off';mQuery(el).removeClass('fa-spin fa-spinner').addClass(addClass);Le.processAjaxError(request,textStatus,errorThrown);}});};Le.executeBatchAction=function(action,el,callback){if(typeof Le.activeActions=='undefined'){Le.activeActions={};}else if(typeof Le.activeActions[action]!='undefined'){return;}
var items=Le.getCheckedListIds(el,true);var queryGlue=action.indexOf('?')>=0?'&':'?';var action=action+queryGlue+'ids='+items;Le.executeAction(action,callback);};Le.batchActionPrecheck=function(container){if(typeof container=='undefined'){container='';}
return mQuery(container+' input[class=list-checkbox]:checked').length;};Le.getCheckedListIds=function(el,stringify){var checkboxes='input[class=list-checkbox]:checked';if(typeof el!='undefined'&&el){var target=mQuery(el).data('target');if(target){checkboxes=target+' '+checkboxes;}}
var items=mQuery(checkboxes).map(function(){return mQuery(this).val();}).get();if(stringify){items=JSON.stringify(items);}
return items;};;Le.builderTokens={};Le.dynamicContentTokens={};Le.builderTokensRequestInProgress=false;Le.activateGlobalFroalaOptions=function(){Le.basicFroalaOptions={enter:mQuery.FroalaEditor.ENTER_BR,imageUploadURL:leBaseUrl+'a/file/upload',imageManagerLoadURL:leBaseUrl+'a/file/list',imageManagerDeleteURL:leBaseUrl+'a/file/delete',imageDefaultWidth:0,pastePlain:true,htmlAllowedTags:['a','abbr','address','area','article','aside','audio','b','base','bdi','bdo','blockquote','br','button','canvas','caption','cite','code','col','colgroup','datalist','dd','del','details','dfn','dialog','div','dl','dt','em','embed','fieldset','figcaption','figure','footer','form','h1','h2','h3','h4','h5','h6','header','hgroup','hr','i','iframe','img','input','ins','kbd','keygen','label','legend','li','link','main','map','mark','menu','menuitem','meter','nav','noscript','object','ol','optgroup','option','output','p','param','pre','progress','queue','rp','rt','ruby','s','samp','script','style','section','select','small','source','span','strike','strong','sub','summary','sup','table','tbody','td','textarea','tfoot','th','thead','time','title','tr','track','u','ul','var','video','wbr','center'],htmlAllowedAttrs:['data-atwho-at-query','data-section','data-section-wrapper','accept','accept-charset','accesskey','action','align','allowfullscreen','alt','async','autocomplete','autofocus','autoplay','autosave','background','bgcolor','border','charset','cellpadding','cellspacing','checked','cite','class','color','cols','colspan','content','contenteditable','contextmenu','controls','coords','data','data-.*','datetime','default','defer','dir','dirname','disabled','download','draggable','dropzone','enctype','for','form','formaction','frameborder','headers','height','hidden','high','href','hreflang','http-equiv','icon','id','ismap','itemprop','keytype','kind','label','lang','language','list','loop','low','max','maxlength','media','method','min','mozallowfullscreen','multiple','name','novalidate','open','optimum','pattern','ping','placeholder','poster','preload','pubdate','radiogroup','readonly','rel','required','reversed','rows','rowspan','sandbox','scope','scoped','scrolling','seamless','selected','shape','size','sizes','span','src','srcdoc','srclang','srcset','start','step','summary','spellcheck','style','tabindex','target','title','type','translate','usemap','value','valign','webkitallowfullscreen','width','wrap']};Le.basicFroalaOptions.iframeStyle=mQuery.FroalaEditor.DEFAULTS.iframeStyle+'body .fr-gatedvideo{user-select:none;-o-user-select:none;-moz-user-select:none;-khtml-user-select:none;-webkit-user-select:none;-ms-user-select:none;position:relative;display:table;min-height:140px}body .fr-gatedvideo::after{content:"";position:absolute;background-repeat:no-repeat;background-position:50% 40%;height:100%;width:100%;top:0;left:0;display:block;clear:both;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHIAAAByCAMAAAC4A3VPAAAA/1BMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD64ociAAAAVHRSTlMAAQIDBAUGCAkKCw0PEBEUFxsfICUmKistLjE1Njo8QExNVl9iY2RmZ2hpa2xtb3Bxc3R8gIWGkZedoquwt8XP0dXX2drc4OLm6Ont7/Hz9ff5+/3esbxfAAACIklEQVRo3u3aW1fTQBSG4a9BKIUKVCi0IqCIp3pAjYpQaEGQYlWk5fv/v8WLrkKbJjNNsmeu9nuXrFnruclhJXsATdM0TdNSVihVqrV6itZXl2ZyeLM7Rz1mqN1YyQaWwltmrrUxDfHgUSUYOdztM1fNBav4rE/+fjI8mjtm3q5rFnFvsK46OFo4p0BPpxHZBADMd0jX5ovhor8AEJxSqLpdJAHgQErkddI19JJjZI1yNePFVxwjC5eCJDesIoEtSZGtGPE1I2RLlOTks+9NZAUWZUU2bCKxLUy2I2JjYgVCYZIzFpE4kSaXLCLRkSZXR8S3cQtwI02uW0RCWhx5zr6jb/I9fZNJojvyA32T+/RNGkRHpEl0QxpFJ+RHeiYff6Jv8oLeSSqppJJKKqmkkkoqqWTe9rveyfrDrncSFtPJl5fZdPN9aTQdfUWbTFf/Cgymsz8i5a53Mtl0+HcryZQn7+dQCSb+SJNVWEycSZMVWEwcSpMlWMy7gZtUvQIsJtaEyaPIBGHSRNCTJXdgM4GvouLtLGwmsCxKhjEzr4gJ4Lug2C/FTfbKvyJk8Z8cuRs/vxwzAWBTTDxOmguPmqaBRurO5zCFOTjxRUTsmHYz3JkX5sFNqk7njfsKhubn4YnN3NfQQWDZPVG+Iskf9zduMd+9cmnbrgGgGP5sPx8bby5/y/zsa20VMm74Cdb2Ds/SvbNvOifh9iI0TdM0TZPtP32lY4xP2bT1AAAAAElFTkSuQmCC)}body .fr-gatedvideo video{background-color:rgba(67,83,147,.5)}body .fr-gatedvideo.fr-active > *{z-index:2;position:relative}body .fr-gatedvideo > *{-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;max-width:100%;border:none}body .fr-box .fr-gatedvideo-resizer{position:absolute;border:solid 1px #1e88e5;display:none;user-select:none;-o-user-select:none;-moz-user-select:none;-khtml-user-select:none;-webkit-user-select:none;-ms-user-select:none}body .fr-box .fr-gatedvideo-resizer.fr-active{display:block}body .fr-box .fr-gatedvideo-resizer .fr-handler{display:block;position:absolute;background:#1e88e5;border:solid 1px #fff;z-index:4;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}body .fr-box .fr-gatedvideo-resizer .fr-handler.fr-hnw{cursor:nw-resize}body .fr-box .fr-gatedvideo-resizer .fr-handler.fr-hne{cursor:ne-resize}body .fr-box .fr-gatedvideo-resizer .fr-handler.fr-hsw{cursor:sw-resize}body .fr-box .fr-gatedvideo-resizer .fr-handler.fr-hse{cursor:se-resize}body .fr-box .fr-gatedvideo-resizer .fr-handler{width:12px;height:12px}body .fr-box .fr-gatedvideo-resizer .fr-handler.fr-hnw{left:-6px;top:-6px}body .fr-box .fr-gatedvideo-resizer .fr-handler.fr-hne{right:-6px;top:-6px}body .fr-box .fr-gatedvideo-resizer .fr-handler.fr-hsw{left:-6px;bottom:-6px}body .fr-box .fr-gatedvideo-resizer .fr-handler.fr-hse{right:-6px;bottom:-6px}@media (min-width: 1200px){body .fr-box .fr-gatedvideo-resizer .fr-handler{width:10px;height:10px}body .fr-box .fr-gatedvideo-resizer .fr-handler.fr-hnw{left:-5px;top:-5px}body .fr-box .fr-gatedvideo-resizer .fr-handler.fr-hne{right:-5px;top:-5px}body .fr-box .fr-gatedvideo-resizer .fr-handler.fr-hsw{left:-5px;bottom:-5px}body .fr-box .fr-gatedvideo-resizer .fr-handler.fr-hse{right:-5px;bottom:-5px}}body .fr-gatedvideo-size-layer .fr-gatedvideo-group .fr-input-line{display:inline-block}body .fr-gatedvideo-size-layer .fr-gatedvideo-group .fr-input-line + .fr-input-line{margin-left:10px}body .fr-gatedvideo-overlay{position:fixed;top:0;left:0;bottom:0;right:0;z-index:9999;display:none}';mQuery.FroalaEditor.DEFAULTS.key='MCHCPd1XQVZFSHSd1C==';};Le.initAtWho=function(element,method,froala){if(Le.builderTokensRequestInProgress){var intervalID=setInterval(function(){if(!Le.builderTokensRequestInProgress){clearInterval(intervalID);Le.configureAtWho(element,method,froala);}},500);}else{Le.configureAtWho(element,method,froala);}};Le.configureAtWho=function(element,method,froala){Le.getTokens(method,function(tokens){mQuery.each(tokens,function(k,v){if(k.match(/leadfield=status/i)||k.match(/leadfield=created_source/i)){delete tokens[k];}
if((k.match(/list_unsubscribe_link/i))||(k.match(/confirmation_link/i))){delete tokens[k];}
if(k.match(/filelink=/i)&&v.match(/a:/)){delete tokens[k];var nv=v.replace('a:','');k='<a title=\'File Link\' href=\''+k+'\'>'+nv+'</a>';tokens[k]=nv;}else if(k.match(/pagelink=/i)&&v.match(/a:/)){delete tokens[k];nv=v.replace('a:','');k='<a title=\'Page Link\' href=\''+k+'\'>'+nv+'</a>';tokens[k]=nv;}else if(k.match(/dwc=/i)){var tn=k.substr(5,k.length-6);tokens[k]=v+' ('+tn+')';}else if(k.match(/leadfield=company/i)&&!v.match(/company/i)){tokens[k]='Company '+v;}});element.atwho('destroy');Le.configureDynamicContentAtWhoTokens();mQuery.extend(tokens,Le.dynamicContentTokens);element.atwho({at:'{',displayTpl:'<li>${name} <small>${id}</small></li>',insertTpl:"${id}",editableAtwhoQueryAttrs:{"data-fr-verified":true},data:mQuery.map(tokens,function(value,i){return{'id':i,'name':value};}),acceptSpaceBar:true});if(froala){froala.events.on('keydown',function(e){if((e.which==mQuery.FroalaEditor.KEYCODE.TAB||e.which==mQuery.FroalaEditor.KEYCODE.ENTER||e.which==mQuery.FroalaEditor.KEYCODE.SPACE)&&froala.$el.atwho('isSelecting')){return false;}},true);}});};Le.getTokens=function(method,callback){if(!mQuery.isEmptyObject(Le.builderTokens)){return callback(Le.builderTokens);}
Le.builderTokensRequestInProgress=true;mQuery.ajax({url:leAjaxUrl,data:'action='+method,success:function(response){if(typeof response.tokens==='object'){Le.builderTokens=response.tokens;callback(response.tokens);}},error:function(request,textStatus,errorThrown){Le.processAjaxError(request,textStatus,errorThrown);},complete:function(){Le.builderTokensRequestInProgress=false;}});};Le.configureDynamicContentAtWhoTokens=function(){Le.dynamicContentTokens={};var dynamicContentTabs=mQuery('#dynamicContentTabs');if(dynamicContentTabs.length===0&&window.parent){dynamicContentTabs=mQuery(window.parent.document.getElementById('dynamicContentTabs'));}
if(dynamicContentTabs.length){dynamicContentTabs.find('a[data-toggle="tab"]').each(function(){var tokenText=mQuery(this).text();var prototype='{dynamiccontent="__tokenName__"}';var newOption=prototype.replace(/__tokenName__/g,tokenText);Le.dynamicContentTokens[newOption]=tokenText;});}};;Le.overflowNavOptions={"parent":".nav-overflow-tabs","more":Le.translate('le.core.tabs.more')};Le.toggleTabPublished=function(el){if(mQuery(el).val()==="1"&&mQuery(el).prop('checked')){Le.publishTab(el);}else{Le.unpublishTab(el);}}
Le.publishTab=function(tab){mQuery('a[href="#'+Le.getTabId(tab)+'"]').find('.fa').removeClass('text-muted').addClass('text-success');};Le.unpublishTab=function(tab){mQuery('a[href="#'+Le.getTabId(tab)+'"]').find('.fa').removeClass('text-success').addClass('text-muted');};Le.getTabId=function(tab){if(!mQuery(tab).hasClass('tab-pane')){tab=mQuery(tab).closest('.tab-pane');}
return mQuery(tab).attr('id');};Le.activateOverflowTabs=function(tabs,options){if(!options){options={};}
var localOptions=Le.overflowNavOptions;mQuery.extend(localOptions,options);mQuery(tabs).overflowNavs(localOptions);var resizeMe=function(tabs,options){mQuery(window).on('resize',{tabs:tabs,options:options},function(event){mQuery(event.data.tabs).overflowNavs(event.data.options);});};resizeMe(tabs,localOptions);};Le.activateSortableTabs=function(tabs){mQuery(tabs).sortable({container:'ul.nav',axis:mQuery(tabs).hasClass('tabs-right')||mQuery(tabs).hasClass('tabs-left')?'y':'x',stop:function(e,ui){var action=mQuery(tabs).attr('data-sort-action');mQuery.ajax({type:"POST",url:action,data:mQuery(tabs).sortable("serialize",{attribute:'data-tab-id'})});}});};Le.activateTabDeleteButtons=function(container){mQuery(container+" .nav.nav-deletable>li a").each(function(){Le.activateTabDeleteButton(this);});};Le.activateTabDeleteButton=function(tab){var btn=mQuery('<span class="btn btn-danger btn-xs btn-delete pull-right hide"><i class="fa fa-times"></i></span>').on('click',function(){return Le.deleteTab(btn)}).appendTo(tab);mQuery(tab).hover(function(){mQuery(btn).removeClass('hide');},function(){mQuery(btn).addClass('hide');});};Le.deleteTab=function(deleteBtn){var tab=mQuery(deleteBtn).closest('li');var tabContent=mQuery(deleteBtn).closest('a').attr('href');var parent=mQuery(tab).closest('ul');var wasActive=(mQuery(tab.hasClass('active')));var action=mQuery(parent).attr('data-delete-action');if(action){var success=false;mQuery.ajax({url:action,type:'POST',dataType:"json",data:{tab:tabContent},success:function(response){if(response&&response.success){mQuery(tab).remove();mQuery(tabContent).remove();if(wasActive){mQuery(parent).find('li:first a').click();}
if(!mQuery(parent).find('li').length){mQuery('.tab-content .placeholder').removeClass('hide');}}else{Le.stopIconSpinPostEvent();}}});}else{mQuery(tab).remove();mQuery(tabContent).remove();if(wasActive){mQuery(parent).find('li:first a').click();}
if(!mQuery(parent).find('li').length){mQuery('.tab-content .placeholder').removeClass('hide');}}
return false;};;Le.contentVersions={};Le.versionNamespace='';Le.currentContentVersion=-1;Le.prepareVersioning=function(undoCallback,redoCallback,namespace){if(!Le.isLocalStorageSupported()){mQuery('.btn-undo').prop('disabled',true);mQuery('.btn-redo').prop('disabled',true);return;}
mQuery('.btn-undo').prop('disabled',false).on('click',function(){Le.undoVersion(undoCallback);});mQuery('.btn-redo').prop('disabled',false).on('click',function(){Le.redoVersion(redoCallback);});Le.currentContentVersion=-1;if(!namespace){namespace=window.location.href;}
if(typeof Le.contentVersions[namespace]=='undefined'){Le.contentVersions[namespace]=[];}
Le.versionNamespace=namespace;console.log(namespace);};Le.clearVersioning=function(){if(!Le.versionNamespace){throw'Versioning not configured';}
if(typeof Le.contentVersions[Le.versionNamespace]!=='undefined'){delete Le.contentVersions[Le.versionNamespace];}
Le.versionNamespace='';Le.currentContentVersion=-1;};Le.storeVersion=function(content){if(!Le.versionNamespace){throw'Versioning not configured';}
Le.contentVersions[Le.versionNamespace].push(content);Le.currentContentVersion=Le.contentVersions[Le.versionNamespace].length;};Le.undoVersion=function(callback){console.log('undo');if(!Le.versionNamespace){throw'Versioning not configured';}
if(Le.currentContentVersion<0){return;}
var version=Le.currentContentVersion-1;if(Le.getVersion(version,callback)){--Le.currentContentVersion;};};Le.redoVersion=function(callback){console.log('redo');if(!Le.versionNamespace){throw'Versioning not configured';}
if(Le.currentContentVersion<0||Le.contentVersions[Le.versionNamespace].length===Le.currentContentVersion){return;}
var version=Le.currentContentVersion+1;if(Le.getVersion(version,callback)){++Le.currentContentVersion;};};Le.getVersion=function(version,callback){var content=false;if(typeof Le.contentVersions[Le.versionNamespace][version]!=='undefined'){content=Le.contentVersions[Le.versionNamespace][version];}
if(false!==content&&typeof callback=='function'){callback(content);return true;}
return false;};;Le.clientOnLoad=function(container){if(mQuery(container+' #list-search').length){Le.activateSearchAutocomplete('list-search','api.client');}};Le.refreshApiClientForm=function(url,modeEl){var mode=mQuery(modeEl).val();if(mQuery('#client_redirectUris').length){mQuery('#client_redirectUris').prop('disabled',true);}else{mQuery('#client_callback').prop('disabled',true);}
mQuery('#client_name').prop('disabled',true);Le.loadContent(url+'/'+mode);};;Le.assetOnLoad=function(container){if(typeof leAssetUploadEndpoint!=='undefined'&&mQuery('div#dropzone').length){Le.initializeDropzone();}
Le.removeActionButtons();};Le.assetOnUnload=function(id){if(id==='#app-content'){delete Le.assetDropzone;}};Le.updateRemoteBrowser=function(provider,path){path=typeof path!=='undefined'?path:'';var spinner=mQuery('<i class="fa fa-fw fa-spinner fa-spin"></i>');spinner.appendTo('#tab'+provider+' a');mQuery.ajax({url:leAjaxUrl,type:"POST",data:"action=asset:fetchRemoteFiles&provider="+provider+"&path="+path,dataType:"json",success:function(response){if(response.success){mQuery('div#remoteFileBrowser').html(response.output);mQuery('.remote-file-search').quicksearch('#remoteFileBrowser .remote-file-list a');}else{}},error:function(request,textStatus,errorThrown){Le.processAjaxError(request,textStatus,errorThrown);},complete:function(){spinner.remove();}})};Le.selectRemoteFile=function(url){mQuery('#asset_remotePath').val(url);mQuery('#RemoteFileModal').modal('hide');};Le.changeAssetStorageLocation=function(){if(mQuery('#asset_storageLocation_0').prop('checked')){mQuery('#storage-local').removeClass('hide');mQuery('#storage-remote').addClass('hide');mQuery('#remote-button').addClass('hide');}else{mQuery('#storage-local').addClass('hide');mQuery('#storage-remote').removeClass('hide');mQuery('#remote-button').removeClass('hide');}};Le.initializeDropzone=function(){var options={url:leAssetUploadEndpoint,uploadMultiple:false,filesizeBase:1024,init:function(){this.on("addedfile",function(){if(this.files[1]!=null){this.removeFile(this.files[0]);}});}};if(typeof leAssetUploadMaxSize!=='undefined'){options.maxFilesize=leAssetUploadMaxSize;}
if(typeof leAssetUploadMaxSizeError!=='undefined'){options.dictFileTooBig=leAssetUploadMaxSizeError;}
if(typeof leAssetUploadExtensions!=='undefined'){options.acceptedFiles=leAssetUploadExtensions;}
if(typeof leAssetUploadExtensionError!=='undefined'){options.dictInvalidFileType=leAssetUploadExtensionError;}
Le.assetDropzone=new Dropzone("div#dropzone",options);var preview=mQuery('.preview div.text-center');Le.assetDropzone.on("sending",function(file,request,formData){request.setRequestHeader('X-CSRF-Token',leAjaxCsrf);formData.append('tempId',mQuery('#asset_tempId').val());}).on("addedfile",function(file){preview.fadeOut('fast');}).on("success",function(file,response,progress){if(response.tmpFileName){mQuery('#asset_tempName').val(response.tmpFileName);}
var messageArea=mQuery('.mdropzone-error');if(response.error||!response.tmpFileName){if(!response.error){var errorText='';}else{var errorText=(typeof response.error=='object')?response.error.text:response.error;}
messageArea.text(errorText);messageArea.closest('.form-group').addClass('has-error').removeClass('is-success');var node,_i,_len,_ref,_results;file.previewElement.classList.add('dz-error');_ref=file.previewElement.querySelectorAll('data-dz-errormessage');_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){node=_ref[_i];_results.push(node.textContent=errorText);}
return _results;}else{messageArea.text('');messageArea.closest('.form-group').removeClass('has-error').addClass('is-success');}
var titleInput=mQuery('#asset_title');if(file.name&&!titleInput.val()){titleInput.val(file.name);}
if(file.name){mQuery('#asset_originalFileName').val(file.name);}}).on("error",function(file,response){preview.fadeIn('fast');var messageArea=mQuery('.mdropzone-error');if(typeof response=="string"){response={'error':response};}
if(response.error){if(!response.error){var errorText='';}else{var errorText=(typeof response.error=='object')?response.error.text:response.error;}
messageArea.text(errorText);messageArea.closest('.form-group').addClass('has-error').removeClass('is-success');var node,_i,_len,_ref,_results;file.previewElement.classList.add('dz-error');_ref=file.previewElement.querySelectorAll('[data-dz-errormessage]');_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){node=_ref[_i];_results.push(node.textContent=errorText);}
return _results;}}).on("thumbnail",function(file,url){if(file.accepted===true){var extension=file.name.substr((file.name.lastIndexOf('.')+1)).toLowerCase();var previewContent='';if(mQuery.inArray(extension,['jpg','jpeg','gif','png'])!==-1){previewContent=mQuery('<img />').addClass('img-thumbnail').attr('src',url);}else if(extension==='pdf'){previewContent=mQuery('<iframe />').attr('src',url);}
preview.empty().html(previewContent);preview.fadeIn('fast');}});}
Le.copyAssetUrl=function(id){var copyValue=id.getAttribute('url');var $temp=mQuery("<input>");mQuery("body").append($temp);$temp.val(copyValue).select();document.execCommand("copy");$temp.remove();var copyTexts=id;copyTexts.innerHTML='copied';setTimeout(function(){var copyTexta=id;copyTextval='Copy';copyTexta.innerHTML=copyTextval;},1000);};;Le.calendarOnLoad=function(container){Le.loadCalendarEvents(container);};Le.calendarModalOnLoad=function(container,response){mQuery('#calendar').fullCalendar('refetchEvents');mQuery(container+" a[data-toggle='ajax']").off('click.ajax');mQuery(container+" a[data-toggle='ajax']").on('click.ajax',function(event){event.preventDefault();mQuery('.modal').modal('hide');return Le.ajaxifyLink(this,event);});};Le.initializeCalendarModals=function(container){mQuery(container+" *[data-toggle='ajaxmodal']").off('click.ajaxmodal');mQuery(container+" *[data-toggle='ajaxmodal']").on('click.ajaxmodal',function(event){event.preventDefault();Le.ajaxifyModal(this,event);});}
Le.loadCalendarEvents=function(container){mQuery('#calendar').fullCalendar({events:leAjaxUrl+"?action=calendar:generateData",lang:'en',eventLimit:true,eventLimitText:"more",eventRender:function(event,element){element=mQuery(element);if(event.iconClass){element.find('.fc-title').before(mQuery('<i />').addClass(event.iconClass));}
if(event.attr){element.attr(event.attr);}
if(event.description){var checkDay=new Date(event.start._d);if(checkDay.getDay()==0){element.tooltip({'title':event.description,placement:'right'});}else{element.tooltip({'title':event.description,placement:'left'});}}},loading:function(bool){if(!bool){Le.initializeCalendarModals(container);}},eventDrop:function(event,delta,revertFunc){mQuery.ajax({url:leAjaxUrl+"?action=calendar:updateEvent",data:'entityId='+event.entityId+'&entityType='+event.entityType+'&setter='+event.setter+'&startDate='+event.start.format(),type:"POST",dataType:"json",success:function(response){if(!response.success){revertFunc();}
Le.initializeCalendarModals(container);if(response.flashes){Le.setFlashes(response.flashes);Le.hideFlashes();}},error:function(response,textStatus,errorThrown){revertFunc();Le.processAjaxError(response,textStatus,errorThrown,true);}});}});};Le.SVGNAMESPACEURI="http://www.w3.org/2000/svg";Le.WF_TRIGGER_NODE_WIDTH_ADJUST=32;Le.WF_TRIGGER_NODE_HEIGHT_ADJUST=49;Le.WF_FORK_NODE_HEIGHT_ADJUST=40;Le.WF_STEP_NODE_HEIGHT_ADJUST=20;Le.WF_FORK_NODE_PATH_HEIGHT_ADJUST=150;Le.WF_DECISION_NODE_PATH_HEIGHT_ADJUST=159;Le.WF_FORK_DECISION_NODE_PATH_HEIGHT_CONSTANT=90;Le.WF_TRIGGER_NODE_PATH_HEIGHT_CONSTANT=70;Le.WF_TRIGGER_NODE_GAP_WIDTH_CONSTANT=16;Le.WF_COUNT_NODE_HEIGHT_ADJUST=27;Le.WF_NODE_PATH_HEIGHT_ADJUST=49;Le.SVG_NODE_HEIGHT_ADJUST=200;Le.WF_SHOW_STATSTICS=true;Le.LAST_SELECTED_GROUPNAME="";Le.getActionNodeJSON=function(){var json={"id":Le.randomString(32),"type":"action","category":"action","subcategory":"campaign.defaultaction","view":{"label":"Define your action...","incomplete":true}};return json;};Le.getDelayNodeJSON=function(){var json={"id":Le.randomString(32),"type":"delay","category":"action","subcategory":"campaign.defaultdelay","view":{"label":"Define your delay...","incomplete":true},};return json;};Le.getExitNodeJSON=function(){var json={"id":Le.randomString(32),"type":"exit","category":"action","subcategory":"campaign.defaultexit",};return json;};Le.getForkNodeJSON=function(){var json={"id":Le.randomString(32),"type":"fork","paths":[{"id":Le.randomString(32),"type":"path","triggers":[],"steps":[]},{"id":Le.randomString(32),"type":"path","triggers":[],"steps":[]}]};return json;};Le.getDecisionNodeJSON=function(){var json={"id":Le.randomString(32),"type":"decision","view":{"label":"Define your condition...","incomplete":true},"category":"condition","subcategory":"lead.campaign_list_filter","true_path":{"id":Le.randomString(32),"type":"path","triggers":[],"steps":[]},"false_path":{"id":Le.randomString(32),"type":"path","triggers":[],"steps":[]},};return json;};Le.getInterruptNodeJSON=function(){var json={"id":Le.randomString(32),"type":"interrupt","triggers":[{"id":Le.randomString(32),"type":"trigger","category":"source","subcategory":"campaign.defaultsource","entry_point":false,"view":{"label":"Define your trigger...","incomplete":true}}]};return json;};Le.getNewWorkFlowJSON=function(){var json={"id":Le.randomString(32),"type":"path","triggers":[{"id":Le.randomString(32),"type":"trigger","category":"source","subcategory":"campaign.defaultsource","entry_point":true,"view":{"label":"Define your trigger...","incomplete":true}}],"steps":[{"id":Le.randomString(32),"type":"exit","category":"action","subcategory":"campaign.defaultexit",}]};return json;};Le.getNewPathJSON=function(){var json={"id":Le.randomString(32),"type":"path","triggers":[],"steps":[]};return json;};Le.getNewTriggerNodeJSON=function(){var json={"id":Le.randomString(32),"type":"trigger","category":"source","subcategory":"campaign.defaultsource","entry_point":true,"view":{"label":"Define your trigger...","incomplete":true}};return json;};Le.getJSONByEventType=function(type){if(type=='action'){return Le.getActionNodeJSON();}else if(type=='decision'){return Le.getDecisionNodeJSON();}else if(type=='fork'){return Le.getForkNodeJSON();}else if(type=='goal'){return Le.getInterruptNodeJSON();}else if(type=='delay'){return Le.getDelayNodeJSON();}else if(type=='exit'){return Le.getExitNodeJSON();}else{return{};}};Le.campaignupdatedjson={};Le.lastclickedinsertpoint={"id":'',"insertat":-1,};Le.lastclickedwfnode={"id":'',"type":'',"eventType":'',};Le.campaignOnLoad=function(container,response){if(mQuery(container+' #list-search').length){Le.activateSearchAutocomplete('list-search','campaign');}
mQuery('#ui-tab-stat-header1').click(function(){mQuery('#ui-tab-stat-header1').addClass('btn-default ui-tabs-selected');mQuery('#ui-tab-stat-header2').removeClass('btn-default ui-tabs-selected');mQuery('#fragment-stat-1').removeClass('hide');mQuery('#fragment-stat-2').addClass('hide');});mQuery('#ui-tab-stat-header2').click(function(){mQuery('#ui-tab-stat-header2').addClass('btn-default ui-tabs-selected');mQuery('#ui-tab-stat-header1').removeClass('btn-default ui-tabs-selected');mQuery('#fragment-stat-2').removeClass('hide');mQuery('#fragment-stat-1').addClass('hide');});if(mQuery('.workflow-canvas').length){Le.launchCampaignEditor();}
mQuery('#campaign_buttons').addClass('hide');mQuery('.chosen-single').css("background","#fff");Le.removeActionButtons();if(mQuery('table.campaign-list').length){mQuery('tr.wf-row-stats').each(function(){var id=mQuery(this).attr('data-stats');Le.ajaxActionRequest('campaign:getWorkFlowCountStats',{id:id},function(response){if(response.success&&mQuery('#wf-progress-'+id+' div').length){mQuery('#wf-progress-'+id+' > a').html(response.progress);mQuery('#wf-completed-'+id+' > a').html(response.completed);mQuery('#wf-goal-'+id+' > a').html(response.goals);}},false,true);});}
Le.hideFlashMessage();if(!mQuery('html').hasClass('sidebar-minimized')){mQuery('.campaign-zoom-button-div').css("margin-left","-15%");}};Le.getNodeElement=function(rootelement,type,id,width,label,incomplete,lastnode){mQuery('.le-modal-box-align').attr("style","margin-left:15%");var gelement=document.createElementNS(Le.SVGNAMESPACEURI,"g");if(incomplete){label='Define your '+type+'...';gelement.setAttributeNS(null,"class",'wf-'+type+' incomplete');}else{gelement.setAttributeNS(null,"class",'wf-'+type);}
gelement.setAttributeNS(null,"id",type+'-'+id);gelement.setAttributeNS(null,"width",width);if(type!='interrupt'){var gelement1=document.createElementNS(Le.SVGNAMESPACEURI,"g");gelement1.setAttributeNS(null,"class",'wf-node-labels');var gelement2=document.createElementNS(Le.SVGNAMESPACEURI,"g");gelement2.setAttributeNS(null,"class",'wf-'+type+'-primary-label wf-node-primary-label');gelement2.setAttributeNS(null,"transform",'translate(0,0)');var gelement3=document.createElementNS(Le.SVGNAMESPACEURI,"g");gelement3.setAttributeNS(null,"class",'wf-label-wrap');if(type=='fork'){gelement3.setAttributeNS(null,"transform",'translate(10,10)');}else{gelement3.setAttributeNS(null,"transform",'translate(16,16)');}
var textelement=document.createElementNS(Le.SVGNAMESPACEURI,"text");textelement.setAttributeNS(null,"class",'wf-label');textelement.setAttributeNS(null,"y",'12');textelement.setAttributeNS(null,"dy",'0');var rectwidth=40;var rectheight=Le.WF_TRIGGER_NODE_HEIGHT_ADJUST;if(type=='fork'){rectheight=Le.WF_FORK_NODE_HEIGHT_ADJUST;gelement3.appendChild(textelement);var forkpathelement=document.createElementNS(Le.SVGNAMESPACEURI,"path");forkpathelement.setAttributeNS(null,"class",'wf-fork-icon');forkpathelement.setAttributeNS(null,"d",'M19.9,15.7L17.1,16C16.9,9.5,14.4,7.5,13,5.6C11.6,3.7,11.7,0,11.7,0h0H8.3h0c0,0,0.1,3.7-1.3,5.6C5.6,7.5,3.1,9.5,2.9,16 l-2.7-0.2C0,15.7,0,15.8,0,15.9l2.2,2l2.2,2c0.1,0.1,0.2,0.1,0.3,0l2.2-2l2.2-2c0.1-0.1,0-0.2-0.1-0.2L6.2,16 c0.2-5.9,2.4-7.2,3.8-8.9c1.4,1.6,3.6,3,3.8,8.9l-2.9-0.3c-0.1,0-0.2,0.1-0.1,0.2l2.2,2l2.2,2c0.1,0.1,0.2,0.1,0.3,0l2.2-2l2.2-2 C20,15.8,20,15.7,19.9,15.7z');forkpathelement.setAttributeNS(null,"fill-rule",'evenodd');gelement3.appendChild(forkpathelement);}else{var tspanelement=document.createElementNS(Le.SVGNAMESPACEURI,"tspan");tspanelement.setAttributeNS(null,"x",'0');tspanelement.setAttributeNS(null,"y",'12');tspanelement.setAttributeNS(null,"dy",'0em');tspanelement.textContent=label;textelement.appendChild(tspanelement);gelement3.appendChild(textelement);rootelement.appendChild(gelement3);var bcr=gelement3.getBoundingClientRect();rectwidth=bcr.width+Le.WF_TRIGGER_NODE_WIDTH_ADJUST;gelement3.parentNode.removeChild(gelement3);}
var rectelement=document.createElementNS(Le.SVGNAMESPACEURI,"rect");rectelement.setAttributeNS(null,"class",'wf-enclosure');rectelement.setAttributeNS(null,"x",'0');rectelement.setAttributeNS(null,"y",'0');rectelement.setAttributeNS(null,"rx",'4');rectelement.setAttributeNS(null,"ry",'4');rectelement.setAttributeNS(null,"width",rectwidth);rectelement.setAttributeNS(null,"height",rectheight);gelement.setAttributeNS(null,"width",rectwidth);gelement1.setAttributeNS(null,"width",rectwidth);gelement2.appendChild(rectelement);gelement2.appendChild(gelement3);gelement1.appendChild(gelement2);if(type!='fork'&&type!='decision'&&Le.WF_SHOW_STATSTICS){gelement1.appendChild(Le.getCountNode(rootelement,rectwidth,type,id));}
var removenodexposition=0;if(type!='trigger'){rootelement.appendChild(gelement1);var bcr=gelement1.getBoundingClientRect();var xposition=(width-(rectwidth))/2;removenodexposition=(xposition+ +rectwidth)-8;gelement1.setAttributeNS(null,"transform",'translate('+xposition+',20)');gelement1.parentNode.removeChild(gelement1);}
if(type!='exit'&&type!='fork'){Le.registerClickListener(gelement1);}
Le.registerMouseListener(gelement1);gelement.appendChild(gelement1);var needremove=false;if(type=='exit'){var rootparentel=rootelement.parentNode.parentNode;var rootparenttag=rootparentel.tagName;if(rootparenttag=='svg'&&lastnode){needremove=true;}}
if(type!='exit'||(type=='exit'&&!needremove)){var removeelement=document.createElementNS(Le.SVGNAMESPACEURI,"g");removeelement.setAttributeNS(null,"class",'wf-remove-button wf-remove-node-button');removeelement.setAttributeNS(null,"transform",'translate('+(removenodexposition)+',12)');var circlelement=document.createElementNS(Le.SVGNAMESPACEURI,"circle");circlelement.setAttributeNS(null,"class",'wf-remove-button-enclosure');circlelement.setAttributeNS(null,"r",'8');circlelement.setAttributeNS(null,"cx",'8');circlelement.setAttributeNS(null,"cy",'8');var lineelement1=document.createElementNS(Le.SVGNAMESPACEURI,"line");lineelement1.setAttributeNS(null,"class",'wf-x-bar');lineelement1.setAttributeNS(null,"x1",'5');lineelement1.setAttributeNS(null,"y1",'5');lineelement1.setAttributeNS(null,"x2",'11');lineelement1.setAttributeNS(null,"y2",'11');var lineelement2=document.createElementNS(Le.SVGNAMESPACEURI,"line");lineelement2.setAttributeNS(null,"class",'wf-x-bar');lineelement2.setAttributeNS(null,"x1",'11');lineelement2.setAttributeNS(null,"y1",'5');lineelement2.setAttributeNS(null,"x2",'5');lineelement2.setAttributeNS(null,"y2",'11');removeelement.appendChild(circlelement);removeelement.appendChild(lineelement1);removeelement.appendChild(lineelement2);Le.registerClickListener(removeelement);Le.registerMouseListener(removeelement);gelement.appendChild(removeelement);}
if(type!='fork'){gelement.appendChild(Le.getInfoNode(rootelement,type,xposition));}
if(type=='fork'){var finsertionpoint=Le.getTriggerInsertionPointNode(id,'fork');finsertionpoint.setAttributeNS(null,'transform','translate('+(removenodexposition+ +18)+',32)')
gelement.appendChild(finsertionpoint);}}
return gelement;}
Le.getInfoNode=function(rootelement,type,xposition){var icontype=type;if(type=='trigger'){var rootclass=rootelement.getAttributeNS(null,'class');if(rootclass=='wf-interrupt'){icontype='goal';}}
var inforectelement=document.createElementNS(Le.SVGNAMESPACEURI,"rect");inforectelement.setAttributeNS(null,"class",'wf-enclosure');inforectelement.setAttributeNS(null,"x",'-2');inforectelement.setAttributeNS(null,"y",'-2');inforectelement.setAttributeNS(null,"rx",'0');inforectelement.setAttributeNS(null,"ry",'0');inforectelement.setAttributeNS(null,"width",'20');inforectelement.setAttributeNS(null,"height",'20');var infoelement=document.createElementNS(Le.SVGNAMESPACEURI,"g");infoelement.setAttributeNS(null,"class",'wf-info-button wf-'+type+'-info-node-button');var infox=-10;var infoy=18;if(xposition>0){infox=xposition-10;infoy=36;}
infoelement.setAttributeNS(null,"transform",'translate('+infox+','+infoy+')');var infopathelement=document.createElementNS(Le.SVGNAMESPACEURI,"path");infopathelement.setAttributeNS(null,'d',Le.getIconPathDimensionByType(icontype));infoelement.appendChild(inforectelement);infoelement.appendChild(infopathelement);return infoelement;}
Le.getCountNode=function(rootelement,nodewidth,type,id){var label='0 done';if(type=='trigger'){if(Le.campaignBuilderStatistics[id]){label=Le.campaignBuilderStatistics[id].total;}else{label='0';}
var rootclass=rootelement.getAttributeNS(null,'class');if(rootclass=='wf-interrupt'){label=label+' achieved';}else{label=label+' triggered';}}else{var current=0;var done=0;if(Le.campaignBuilderStatistics[id]){current=Le.campaignBuilderStatistics[id].current;done=Le.campaignBuilderStatistics[id].done;}
if(type=='delay'){label=current+' scheduled / '+done+' done';}else{label=done+' done';}}
var textelement=document.createElementNS(Le.SVGNAMESPACEURI,"text");textelement.setAttributeNS(null,"class",'wf-label');textelement.setAttributeNS(null,"y",'12');textelement.setAttributeNS(null,"dy",'0');var tspanelement=document.createElementNS(Le.SVGNAMESPACEURI,"tspan");tspanelement.setAttributeNS(null,"x",'0');tspanelement.setAttributeNS(null,"y",'12');tspanelement.setAttributeNS(null,"dy",'0em');tspanelement.textContent=label;textelement.appendChild(tspanelement);var gelement=document.createElementNS(Le.SVGNAMESPACEURI,"g");gelement.setAttributeNS(null,"class",'wf-label-wrap');gelement.setAttributeNS(null,"transform",'translate(6,6)');gelement.appendChild(textelement);rootelement.appendChild(gelement);var bcr=gelement.getBoundingClientRect();var rectwidth=bcr.width;gelement.parentNode.removeChild(gelement);var rectelement=document.createElementNS(Le.SVGNAMESPACEURI,"rect");rectelement.setAttributeNS(null,"class",'wf-enclosure');rectelement.setAttributeNS(null,"x",'0');rectelement.setAttributeNS(null,"y",'0');rectelement.setAttributeNS(null,"rx",'4');rectelement.setAttributeNS(null,"ry",'4');rectelement.setAttributeNS(null,"width",rectwidth);rectelement.setAttributeNS(null,"height",Le.WF_COUNT_NODE_HEIGHT_ADJUST);var gelement1=document.createElementNS(Le.SVGNAMESPACEURI,"g");gelement1.setAttributeNS(null,"class",'wf-node-count-label');gelement1.appendChild(rectelement);gelement1.appendChild(gelement);var xposition=(nodewidth-rectwidth)/2;gelement1.setAttributeNS(null,"transform",'translate('+xposition+',51)');return gelement1;}
Le.getIconPathDimensionByType=function(type){if(type=='trigger'){return'M9.25 7c0 0.133-0.055 0.258-0.148 0.352l-4.25 4.25c-0.094 0.094-0.219 0.148-0.352 0.148-0.273 0-0.5-0.227-0.5-0.5v-2.25h-3.5c-0.273 0-0.5-0.227-0.5-0.5v-3c0-0.273 0.227-0.5 0.5-0.5h3.5v-2.25c0-0.273 0.227-0.5 0.5-0.5 0.133 0 0.258 0.055 0.352 0.148l4.25 4.25c0.094 0.094 0.148 0.219 0.148 0.352zM12 4.25v5.5c0 1.242-1.008 2.25-2.25 2.25h-2.5c-0.133 0-0.25-0.117-0.25-0.25 0-0.219-0.102-0.75 0.25-0.75h2.5c0.688 0 1.25-0.563 1.25-1.25v-5.5c0-0.688-0.563-1.25-1.25-1.25h-2.25c-0.195 0-0.5 0.039-0.5-0.25 0-0.219-0.102-0.75 0.25-0.75h2.5c1.242 0 2.25 1.008 2.25 2.25z';}else if(type=='action'){return'M10.914 4.422c0.086 0.094 0.109 0.227 0.055 0.344l-4.219 9.039c-0.062 0.117-0.187 0.195-0.328 0.195-0.031 0-0.070-0.008-0.109-0.016-0.172-0.055-0.273-0.219-0.234-0.383l1.539-6.312-3.172 0.789c-0.031 0.008-0.062 0.008-0.094 0.008-0.086 0-0.18-0.031-0.242-0.086-0.094-0.078-0.125-0.195-0.102-0.305l1.57-6.445c0.039-0.148 0.18-0.25 0.344-0.25h2.563c0.195 0 0.352 0.148 0.352 0.328 0 0.047-0.016 0.094-0.039 0.141l-1.336 3.617 3.094-0.766c0.031-0.008 0.062-0.016 0.094-0.016 0.102 0 0.195 0.047 0.266 0.117z';}else if(type=='decision'){return'M7 11h2v2h-2zM11 4c0.552 0 1 0.448 1 1v3l-3 2h-2v-1l3-2v-1h-5v-2h6zM8 1.5c-1.736 0-3.369 0.676-4.596 1.904s-1.904 2.86-1.904 4.596c0 1.736 0.676 3.369 1.904 4.596s2.86 1.904 4.596 1.904c1.736 0 3.369-0.676 4.596-1.904s1.904-2.86 1.904-4.596c0-1.736-0.676-3.369-1.904-4.596s-2.86-1.904-4.596-1.904zM8 0v0c4.418 0 8 3.582 8 8s-3.582 8-8 8c-4.418 0-8-3.582-8-8s3.582-8 8-8z';}else if(type=='delay'){return'M10.293 11.707l-3.293-3.293v-4.414h2v3.586l2.707 2.707zM8 0c-4.418 0-8 3.582-8 8s3.582 8 8 8 8-3.582 8-8-3.582-8-8-8zM8 14c-3.314 0-6-2.686-6-6s2.686-6 6-6c3.314 0 6 2.686 6 6s-2.686 6-6 6z';}else if(type=='exit'){return'M5 11.25c0 0.219 0.102 0.75-0.25 0.75h-2.5c-1.242 0-2.25-1.008-2.25-2.25v-5.5c0-1.242 1.008-2.25 2.25-2.25h2.5c0.133 0 0.25 0.117 0.25 0.25 0 0.219 0.102 0.75-0.25 0.75h-2.5c-0.688 0-1.25 0.563-1.25 1.25v5.5c0 0.688 0.563 1.25 1.25 1.25h2.25c0.195 0 0.5-0.039 0.5 0.25zM12.25 7c0 0.133-0.055 0.258-0.148 0.352l-4.25 4.25c-0.094 0.094-0.219 0.148-0.352 0.148-0.273 0-0.5-0.227-0.5-0.5v-2.25h-3.5c-0.273 0-0.5-0.227-0.5-0.5v-3c0-0.273 0.227-0.5 0.5-0.5h3.5v-2.25c0-0.273 0.227-0.5 0.5-0.5 0.133 0 0.258 0.055 0.352 0.148l4.25 4.25c0.094 0.094 0.148 0.219 0.148 0.352z';}else if(type=='goal'){return'M13 3v-2h-10v2h-3v2c0 1.657 1.343 3 3 3 0.314 0 0.616-0.048 0.9-0.138 0.721 1.031 1.822 1.778 3.1 2.037v3.1h-1c-1.105 0-2 0.895-2 2h8c0-1.105-0.895-2-2-2h-1v-3.1c1.278-0.259 2.378-1.006 3.1-2.037 0.284 0.089 0.587 0.138 0.9 0.138 1.657 0 3-1.343 3-3v-2h-3zM3 6.813c-0.999 0-1.813-0.813-1.813-1.813v-1h1.813v1c0 0.628 0.116 1.229 0.327 1.782-0.106 0.019-0.216 0.030-0.327 0.030zM14.813 5c0 0.999-0.813 1.813-1.813 1.813-0.112 0-0.221-0.011-0.327-0.030 0.211-0.554 0.327-1.154 0.327-1.782v-1h1.813v1z';}}
Le.updateTriggerPath=function(rootelement){var rootfixedwidth=rootelement.getAttributeNS(null,'width');var childrens=rootelement.children;var totalwidth=0;for(var ch=0;ch<childrens.length;ch++){var child=childrens[ch];var bcr=child.getBoundingClientRect();totalwidth+=bcr.width;}
var posistionadjust=-4;if(childrens.length>1){posistionadjust=posistionadjust+(Le.WF_TRIGGER_NODE_GAP_WIDTH_CONSTANT*(childrens.length-1));}
totalwidth=totalwidth+ +posistionadjust;var startposition=(rootfixedwidth-totalwidth)/2;var nextposition=startposition;for(var ch=0;ch<childrens.length;ch++){var child=childrens[ch];var bcr=child.getBoundingClientRect();child.setAttributeNS(null,"transform",'translate('+nextposition+',0)');var removenode=child.children[1];removenode.setAttributeNS(null,"transform",'translate('+(bcr.width-20)+',-8)');nextposition=(+nextposition+ +bcr.width);nextposition=nextposition+ +Le.WF_TRIGGER_NODE_GAP_WIDTH_CONSTANT;}
var insertnode=rootelement.parentNode.children[rootelement.parentNode.children.length-1];var rootnodematrix={};if(typeof(rootelement.transform.baseVal.length)==="undefined")
{rootnodematrix=rootelement.transform.baseVal.getItem(0).matrix;}else{rootnodematrix=rootelement.transform.baseVal[0].matrix;}
insertnode.setAttributeNS(null,"transform",'translate('+nextposition+','+(rootnodematrix.f+ +14)+')');var paths=[];for(var ch=0;ch<childrens.length;ch++){var child=childrens[ch];var matrix={};if(typeof(child.transform.baseVal.length)==="undefined")
{matrix=child.transform.baseVal.getItem(0).matrix;}else{matrix=child.transform.baseVal[0].matrix;}
var bcr=child.getBoundingClientRect();var xposition=matrix.e;var mx=((+(bcr.width)/2)+ +xposition);mx=mx-6;var x1=mx;var x2=rootfixedwidth/2;var x=x2;var my=Le.WF_NODE_PATH_HEIGHT_ADJUST;var y=+my+ +Le.WF_TRIGGER_NODE_PATH_HEIGHT_CONSTANT;var y1=(+my+ +y)/2;var y2=y1;var dimension="M"+mx+","+my+"C"+x1+","+y1+" "+x2+","+y2+" "+x+","+y;var pathelement=document.createElementNS(Le.SVGNAMESPACEURI,"path");pathelement.setAttributeNS(null,"class",'wf-link');pathelement.setAttributeNS(null,"d",dimension);paths.push(pathelement);}
for(var p=0;p<paths.length;p++){rootelement.appendChild(paths[p]);}}
Le.removeAllByTags=function(element,tag){var tags=element.getElementsByTagName(tag);while(tags.length>0){element.removeChild(tags[0]);tags=element.getElementsByTagName(tag);}}
Le.randomString=function(length){return Math.round((Math.pow(36,length+1)-Math.random()*Math.pow(36,length))).toString(36).slice(1);}
Le.iterateJSONOBJECT=function(data,width,parent,tracker,lastnode){var id=data.id;var type=data.type;if(type=='path'){var triggers=data.triggers;var steps=data.steps;var pathnode=Le.getPathNode(id,width);var triggernode=Le.getTriggersNode(id,width);var stepsnode=Le.getStepsNode(id,width);parent.appendChild(pathnode);pathnode.appendChild(triggernode);pathnode.appendChild(stepsnode);if(triggers.length>0){pathnode.appendChild(Le.getTriggerInsertionPointNode(id,'trigger'));}
Le.setTransformAttr(triggernode,0,mQuery.isEmptyObject(triggers)?0:Le.WF_STEP_NODE_HEIGHT_ADJUST);if(!mQuery.isEmptyObject(triggers)){mQuery.each(triggers,function(index,trigger){triggernode.appendChild(Le.getNodeElement(pathnode,trigger.type,trigger.id,width,trigger.view.label,trigger.view.incomplete,(index==triggers.length-1)));});Le.updateTriggerPath(triggernode);}
var triggerbcr=triggernode.getBoundingClientRect();Le.setTransformAttr(stepsnode,0,mQuery.isEmptyObject(triggers)?0:(triggerbcr.height+ +12));if(!mQuery.isEmptyObject(steps)){var stepsindex=0;mQuery.each(steps,function(index,event){stepsnode.appendChild(Le.getStepNode(stepsnode,Le.randomString(32),width,'insertion-point','',false,lastnode));tracker=Le.iterateJSONOBJECT(event,width,stepsnode,tracker,(index==steps.length-1));if(event.type!='exit'&&stepsindex==steps.length-1){stepsnode.appendChild(Le.getStepNode(stepsnode,Le.randomString(32),width,'insertion-point','',false,lastnode));}
stepsindex++;});var yposition=Le.updateStepsPosition(stepsnode);if(parent.tagName=='svg'){Le.adjustSizeforSVG(parent,stepsnode,yposition);}}else{tracker+="insert point alone"+"----->"+width+"\n";stepsnode.appendChild(Le.getStepNode(stepsnode,Le.randomString(32),width,'insertion-point','',false,lastnode));}}else if(type=='action'){tracker+=data.view.label+"----->"+width+"\n";parent.appendChild(Le.getStepNode(parent,id,width,type,data.view.label,data.view.incomplete,lastnode));}else if(type=='decision'){tracker+=data.description+"----->"+width+"\n";var stepnode=Le.getStepNode(parent,id,width,type,data.view.label,data.view.incomplete,lastnode);var decisionnode=stepnode.children[0];parent.appendChild(stepnode);var decisionnodewidth=width/2;var truepath=data.true_path;var falsepath=data.false_path;var truepathnode=Le.getWfPathNode(truepath.id,decisionnodewidth,'true');var falsepathnode=Le.getWfPathNode(falsepath.id,decisionnodewidth,'false');Le.setTransformAttr(truepathnode,0,Le.WF_DECISION_NODE_PATH_HEIGHT_ADJUST);Le.setTransformAttr(falsepathnode,decisionnodewidth,Le.WF_DECISION_NODE_PATH_HEIGHT_ADJUST);decisionnode.appendChild(truepathnode);decisionnode.appendChild(falsepathnode);tracker=Le.iterateJSONOBJECT(truepath,decisionnodewidth,truepathnode,tracker,lastnode);tracker=Le.iterateJSONOBJECT(falsepath,decisionnodewidth,falsepathnode,tracker,lastnode);}else if(type=='delay'){tracker+=data.description+"----->"+width+"\n";parent.appendChild(Le.getStepNode(parent,id,width,type,data.view.label,data.view.incomplete,lastnode));}else if(type=='exit'){tracker+="exit called"+"----->"+width+"\n";parent.appendChild(Le.getStepNode(parent,id,width,type,'Exit',false,lastnode));}else if(type=='fork'){tracker+="fork called"+"----->"+width+"\n";var stepnode=Le.getStepNode(parent,id,width,type,'Fork',false,lastnode);var forknode=stepnode.children[0];parent.appendChild(stepnode);var paths=data.paths;var forkxposition=0;mQuery.each(paths,function(index,value){var forknodewidth=width/paths.length;var forkpathnode=Le.getWfPathNode(value.id,forknodewidth,'fork');Le.setTransformAttr(forkpathnode,forkxposition,Le.WF_FORK_NODE_PATH_HEIGHT_ADJUST);forkxposition=forkxposition+forknodewidth;forknode.appendChild(forkpathnode);tracker=Le.iterateJSONOBJECT(value,forknodewidth,forkpathnode,tracker,lastnode);});}else if(type=='interrupt'){tracker+="interrupt called"+"----->"+width+"\n";var stepnode=Le.getStepNode(parent,id,width,type,'',false,lastnode);parent.appendChild(stepnode);var interruptnode=stepnode.children[0];var triggernode=Le.getTriggersNode(id,width);Le.setTransformAttr(triggernode,0,Le.WF_STEP_NODE_HEIGHT_ADJUST+ +20);interruptnode.appendChild(triggernode);var triggers=data.triggers;if(triggers.length>0){interruptnode.appendChild(Le.getTriggerInsertionPointNode(id,'trigger'));}
if(!mQuery.isEmptyObject(triggers)){mQuery.each(triggers,function(index,trigger){triggernode.appendChild(Le.getNodeElement(interruptnode,trigger.type,trigger.id,width,trigger.view.label,trigger.view.incomplete,(index==triggers.length-1)));});Le.updateTriggerPath(triggernode);}}
return tracker;}
Le.getPathNode=function(id,width){var path=document.createElementNS(Le.SVGNAMESPACEURI,"g");path.setAttributeNS(null,"class",'path');path.setAttributeNS(null,"id",'path'+'-'+id);path.setAttributeNS(null,"width",width);return path;}
Le.getWfPathNode=function(id,width,type){var path=document.createElementNS(Le.SVGNAMESPACEURI,"g");path.setAttributeNS(null,"class",'wf-'+type+'-path');path.setAttributeNS(null,"id",type+'-path'+'-'+id);path.setAttributeNS(null,"width",width);return path;}
Le.getStepsNode=function(id,width){var steps=document.createElementNS(Le.SVGNAMESPACEURI,"g");steps.setAttributeNS(null,"class",'steps');steps.setAttributeNS(null,"id",'steps'+'-'+id);steps.setAttributeNS(null,"width",width);return steps;}
Le.getTriggersNode=function(id,width){var triggers=document.createElementNS(Le.SVGNAMESPACEURI,"g");triggers.setAttributeNS(null,"class",'triggers');triggers.setAttributeNS(null,"id",'triggers'+'-'+id);triggers.setAttributeNS(null,"width",width);return triggers;}
Le.getStepNode=function(parent,id,width,type,label,incomplete,lastnode){var step=document.createElementNS(Le.SVGNAMESPACEURI,"g");step.setAttributeNS(null,"class",'step');step.setAttributeNS(null,"id",'step'+'-'+id);step.setAttributeNS(null,"width",width);var child=null;if(type=='insertion-point'){child=Le.getInsertionPointNode(id,width,label);}else{child=Le.getNodeElement(parent,type,id,width,label,incomplete,lastnode);}
step.appendChild(child);return step;}
Le.getInsertionPointNode=function(id,width){var xposition=width/2;xposition=xposition-8;var ip=document.createElementNS(Le.SVGNAMESPACEURI,"g");ip.setAttributeNS(null,"class",'wf-insertion-point');ip.setAttributeNS(null,"id",'insertion-point'+'-'+id);ip.setAttributeNS(null,"width",width);ip.setAttributeNS(null,"transform",'translate('+xposition+',0)');var circlelement=document.createElementNS(Le.SVGNAMESPACEURI,"circle");circlelement.setAttributeNS(null,"class",'wf-insert-button');circlelement.setAttributeNS(null,"r",'8');circlelement.setAttributeNS(null,"cx",'8');circlelement.setAttributeNS(null,"cy",'8');var lineelement1=document.createElementNS(Le.SVGNAMESPACEURI,"line");lineelement1.setAttributeNS(null,"class",'wf-plus-bar');lineelement1.setAttributeNS(null,"x1",'4');lineelement1.setAttributeNS(null,"y1",'8');lineelement1.setAttributeNS(null,"x2",'12');lineelement1.setAttributeNS(null,"y2",'8');var lineelement2=document.createElementNS(Le.SVGNAMESPACEURI,"line");lineelement2.setAttributeNS(null,"class",'wf-plus-bar');lineelement2.setAttributeNS(null,"x1",'8');lineelement2.setAttributeNS(null,"y1",'4');lineelement2.setAttributeNS(null,"x2",'8');lineelement2.setAttributeNS(null,"y2",'12');ip.appendChild(circlelement);ip.appendChild(lineelement1);ip.appendChild(lineelement2);Le.registerClickListener(ip);return ip;}
Le.getTriggerInsertionPointNode=function(id,type){var ip=document.createElementNS(Le.SVGNAMESPACEURI,"g");ip.setAttributeNS(null,"class",type+'-insertion-point insertion-point');ip.setAttributeNS(null,"id",type+'-insertion-point'+'-'+id);ip.setAttributeNS(null,"transform",'translate(0,0)');var circlelement=document.createElementNS(Le.SVGNAMESPACEURI,"circle");circlelement.setAttributeNS(null,"class",'wf-insert-button');circlelement.setAttributeNS(null,"r",'8');circlelement.setAttributeNS(null,"cx",'8');circlelement.setAttributeNS(null,"cy",'8');var lineelement1=document.createElementNS(Le.SVGNAMESPACEURI,"line");lineelement1.setAttributeNS(null,"class",'wf-plus-bar');lineelement1.setAttributeNS(null,"x1",'4');lineelement1.setAttributeNS(null,"y1",'8');lineelement1.setAttributeNS(null,"x2",'12');lineelement1.setAttributeNS(null,"y2",'8');var lineelement2=document.createElementNS(Le.SVGNAMESPACEURI,"line");lineelement2.setAttributeNS(null,"class",'wf-plus-bar');lineelement2.setAttributeNS(null,"x1",'8');lineelement2.setAttributeNS(null,"y1",'4');lineelement2.setAttributeNS(null,"x2",'8');lineelement2.setAttributeNS(null,"y2",'12');ip.appendChild(circlelement);ip.appendChild(lineelement1);ip.appendChild(lineelement2);Le.registerClickListener(ip);return ip;}
Le.setTransformAttr=function(node,x,y){node.setAttributeNS(null,"transform",'translate('+x+','+y+')');}
Le.updateStepsPosition=function(steps){var childrens=steps.children;var yposition=0;mQuery.each(childrens,function(index,child){var wfnode=child.children[0];var classname=wfnode.getAttributeNS(null,'class');if(classname!='wf-insertion-point'){var id=wfnode.getAttributeNS(null,'id');var response=id.split('-');var type=response[0];var width=child.getAttributeNS(null,'width');var lastchild=(index==childrens.length-1);var xposition=width/2;if(type!='interrupt'){var pathsplit=Le.getPathConnectorNode('split','M'+xposition+',0C'+xposition+',10 '+xposition+',10 '+xposition+',20');child.appendChild(pathsplit);if((type!='decision'&&type!='fork'&&type!='exit')||(type=='exit'&&!lastchild)){var my=Le.WF_NODE_PATH_HEIGHT_ADJUST+ +Le.WF_STEP_NODE_HEIGHT_ADJUST;var y=Le.WF_NODE_PATH_HEIGHT_ADJUST+ +(Le.WF_STEP_NODE_HEIGHT_ADJUST*2);var y1=(my+ +y)/2;var y2=y1;var pathlink=Le.getPathConnectorNode('link','M'+xposition+','+my+'C'+xposition+','+y1+' '+xposition+','+y2+' '+xposition+','+y+'');child.appendChild(pathlink);}else if(type=='decision'){Le.updateDecisionPath(child);}else if(type=='fork'){Le.updateForkPath(child);}}else{var wfnode=child.children[0];var horizontalbar=Le.getLineConnectorNode('break-bar',xposition-10,20,(xposition+ +10),20);var verticalbar=Le.getLineConnectorNode('break-bar',xposition,0,xposition,20);wfnode.appendChild(verticalbar);wfnode.appendChild(horizontalbar);}}
Le.setTransformAttr(child,0,yposition);var bcr=child.getBoundingClientRect();yposition=yposition+bcr.height;});return yposition;}
Le.updateDecisionPath=function(stepnode){var wfnode=stepnode.children[0];var width=stepnode.getAttributeNS(null,'width');var avgwidth=width/4;var wfnodes=Le.filterWfNodeByClass(wfnode,'wf-true-path');var truepathnode=wfnodes[0];var wfnodes=Le.filterWfNodeByClass(wfnode,'wf-false-path');var falsepathnode=wfnodes[0];var tpbcr=truepathnode.getBoundingClientRect();var fpbcr=falsepathnode.getBoundingClientRect();var tpheight=tpbcr.height;var fpheight=fpbcr.height;var maxheight=Math.max(tpheight,fpheight);var tpmy=tpheight+ +Le.WF_DECISION_NODE_PATH_HEIGHT_ADJUST;var tpy=maxheight+ +(Le.WF_DECISION_NODE_PATH_HEIGHT_ADJUST+ +Le.WF_FORK_DECISION_NODE_PATH_HEIGHT_CONSTANT);var tpy1=(tpmy+ +tpy)/2;var tpy2=tpy1;var fpmy=fpheight+ +Le.WF_DECISION_NODE_PATH_HEIGHT_ADJUST;var fpy=tpy;var fpy1=(fpmy+ +fpy)/2;var fpy2=fpy1;var tpmx=avgwidth;var tpx1=tpmx;var tpx2=avgwidth*2;var tpx=tpx2;var fpmx=avgwidth*3;var fpx1=fpmx;var fpx2=avgwidth*2;var fpx=fpx2;if(Le.isLinkPathRequired(truepathnode)){var tpathlink=Le.getPathConnectorNode('link','M'+tpmx+','+tpmy+'C'+tpx1+','+tpy1+' '+tpx2+','+tpy2+' '+tpx+','+tpy+'');wfnode.appendChild(tpathlink);}
if(Le.isLinkPathRequired(falsepathnode)){var fpathlink=Le.getPathConnectorNode('link','M'+fpmx+','+fpmy+'C'+fpx1+','+fpy1+' '+fpx2+','+fpy2+' '+fpx+','+fpy+'');wfnode.appendChild(fpathlink);}
var splitystart=Le.WF_TRIGGER_NODE_HEIGHT_ADJUST+ +Le.WF_STEP_NODE_HEIGHT_ADJUST;var splityend=splitystart+ +Le.WF_FORK_DECISION_NODE_PATH_HEIGHT_CONSTANT;var splitymid=(splitystart+ +splityend)/2;var tpathsplit=Le.getPathConnectorNode('split','M'+tpx+','+splitystart+'C'+tpx2+','+splitymid+' '+tpx1+','+splitymid+' '+tpmx+','+splityend+'');wfnode.appendChild(tpathsplit);var fpathsplit=Le.getPathConnectorNode('split','M'+fpx+','+splitystart+'C'+fpx2+','+splitymid+' '+fpx1+','+splitymid+' '+fpmx+','+splityend+'');wfnode.appendChild(fpathsplit);var yesx=((tpmx+ +tpx)/2)-30;var yesy=splitymid-10;wfnode.appendChild(Le.getDecisionIndicatorNode(wfnode,"Yes",yesx,yesy));var nox=(fpmx+ +fpx)/2;var noy=splitymid-10;wfnode.appendChild(Le.getDecisionIndicatorNode(wfnode,"No",nox,noy));}
Le.updateForkPath=function(stepnode){var wfnode=stepnode.children[0];var width=stepnode.getAttributeNS(null,'width');var wfnodes=Le.filterWfNodeByClass(wfnode,'wf-fork-path');var avgwidth=width/(wfnodes.length*2);var maxheight=0;for(var n=0;n<wfnodes.length;n++){var node=wfnodes[n];var nbcr=node.getBoundingClientRect();maxheight=Math.max(maxheight,nbcr.height);}
var xposmultiply=1;for(var n=0;n<wfnodes.length;n++){var node=wfnodes[n];var nbcr=node.getBoundingClientRect();var mx=avgwidth*xposmultiply;var x1=mx;var x2=avgwidth*wfnodes.length;var x=x2;var my=nbcr.height+ +Le.WF_FORK_NODE_PATH_HEIGHT_ADJUST;var y=maxheight+ +(Le.WF_FORK_NODE_PATH_HEIGHT_ADJUST+ +Le.WF_FORK_DECISION_NODE_PATH_HEIGHT_CONSTANT);var y1=(my+ +y)/2;var y2=y1;if(Le.isLinkPathRequired(node)){var fpathlink=Le.getPathConnectorNode('link','M'+mx+','+my+'C'+x1+','+y1+' '+x2+','+y2+' '+x+','+y+'');wfnode.appendChild(fpathlink);}
var splitystart=Le.WF_FORK_NODE_HEIGHT_ADJUST+ +Le.WF_STEP_NODE_HEIGHT_ADJUST;var splityend=splitystart+Le.WF_FORK_DECISION_NODE_PATH_HEIGHT_CONSTANT;var splitymid=(splitystart+ +splityend)/2;var fpathsplit=Le.getPathConnectorNode('split','M'+x+','+splitystart+'C'+x2+','+splitymid+' '+x1+','+splitymid+' '+mx+','+splityend+'');wfnode.appendChild(fpathsplit);xposmultiply=xposmultiply+2;}}
Le.isLinkPathRequired=function(wfnode){var pathnode=wfnode.children[0];var steps=pathnode.children[1];if(steps.children.length%2==0){return false;}else{return true;}}
Le.filterWfNodeByClass=function(parent,classname){var childrens=parent.children;var wfnodes=[];for(var ch=0;ch<childrens.length;ch++){var child=childrens[ch];if(child.getAttributeNS(null,'class')==classname){wfnodes.push(child);}}
return wfnodes;}
Le.getPathConnectorNode=function(classname,dimension){var path=document.createElementNS(Le.SVGNAMESPACEURI,"path");path.setAttributeNS(null,"class",'wf-'+classname);path.setAttributeNS(null,"d",dimension);return path;}
Le.getDecisionIndicatorNode=function(parent,indicator,x,y){try{var gelement=document.createElementNS(Le.SVGNAMESPACEURI,"g");gelement.setAttributeNS(null,'class','wf-decision-path-label wf-'+indicator.toLowerCase()+'-label');var gelement1=document.createElementNS(Le.SVGNAMESPACEURI,"g");gelement1.setAttributeNS(null,'class','wf-label-wrap');gelement1.setAttributeNS(null,'transform','translate(5,2)');var textelement=document.createElementNS(Le.SVGNAMESPACEURI,"text");textelement.setAttributeNS(null,"y",'12');textelement.setAttributeNS(null,"dy",'0');textelement.textContent=indicator;gelement1.appendChild(textelement);parent.appendChild(gelement1);var bcr=gelement1.getBoundingClientRect();var labelwidth=bcr.width+ +10;gelement1.parentNode.removeChild(gelement1);var rectelement=document.createElementNS(Le.SVGNAMESPACEURI,"rect");rectelement.setAttributeNS(null,"class",'wf-enclosure');rectelement.setAttributeNS(null,"x",'0');rectelement.setAttributeNS(null,"y",'0');rectelement.setAttributeNS(null,"rx",'3');rectelement.setAttributeNS(null,"ry",'3');rectelement.setAttributeNS(null,"width",labelwidth);rectelement.setAttributeNS(null,"height",'20');gelement.appendChild(rectelement);gelement.appendChild(gelement1);Le.setTransformAttr(gelement,x,y);}catch(err){alert(err);}
return gelement;}
Le.getLineConnectorNode=function(classname,x1,y1,x2,y2){var line=document.createElementNS(Le.SVGNAMESPACEURI,"line");line.setAttributeNS(null,"class",'wf-'+classname);line.setAttributeNS(null,"x1",x1);line.setAttributeNS(null,"y1",y1);line.setAttributeNS(null,"x2",x2);line.setAttributeNS(null,"y2",y2);return line;}
Le.registerMouseListener=function(wfnode){wfnode.addEventListener("mouseover",function(event){event.stopPropagation();try{var el=this;el.parentNode.classList.add("node-active");}catch(error){alert(error);}});wfnode.addEventListener("mouseout",function(event){event.stopPropagation();try{var el=this;el.parentNode.classList.remove("node-active");}catch(error){alert(error);}});}
Le.registerClickListener=function(element){element.addEventListener("click",function(event){event.stopPropagation();try{var el=this;var classlist=el.classList;var classname=classlist[0];if(classname=='wf-insertion-point'){Le.showCampaignTypeModel();var stepnode=el.parentNode;var stepsnode=stepnode.parentNode;var childindex=Array.from(stepsnode.children).indexOf(stepnode);var id=stepsnode.getAttributeNS(null,'id');var response=id.split('-');var findid=response[1];Le.lastclickedinsertpoint.id=findid;Le.lastclickedinsertpoint.insertat=childindex/2;}else if(classname=='trigger-insertion-point'){var parentnode=el.parentNode;var id=parentnode.getAttributeNS(null,'id');var response=id.split('-');var findtype=response[0];var findid=response[1];var added=Le.findAndAddObjectIntoJson(Le.campaignupdatedjson,findtype,findid,-1,false);if(added){Le.refreshWorkFlowCanvas();}}else if(classname=='fork-insertion-point'){var forknode=el.parentNode;var id=forknode.getAttributeNS(null,'id');var response=id.split('-');var findid=response[1];var added=Le.findAndAddObjectIntoJson(Le.campaignupdatedjson,'fork',findid,-1,false);if(added){Le.refreshWorkFlowCanvas();}}else if(classname=='wf-remove-button'){Le.removeWfNode(el.parentNode);}else if(classname=='wf-node-labels'){var id=el.parentNode.getAttributeNS(null,'id');var response=id.split('-');var findtype=response[0];var findid=response[1];var matchobj=Le.findAndGetObjectFromJSON(Le.campaignupdatedjson,findtype,findid,[]);if(matchobj.length>0){Le.invokeCampaignEventEditAction(matchobj[0])}}}catch(error){alert(error);}});};Le.removeWfNode=function(wfnode){var id=wfnode.getAttributeNS(null,'id');var response=id.split('-');var findtype=response[0];var findid=response[1];if(findtype=='trigger'){var triggerschilds=wfnode.parentNode.children;if(triggerschilds.length==2){var triggersparent=wfnode.parentNode.parentNode;var tpclassname=triggersparent.getAttributeNS(null,'class');var tpid=triggersparent.getAttributeNS(null,'id');if(tpclassname=='wf-interrupt'){response=tpid.split('-');findtype=response[0];findid=response[1];}}}
var deleted=Le.findAndRemoveObjectFromJson(Le.campaignupdatedjson,findtype,findid,false);if(deleted){Le.refreshWorkFlowCanvas();}}
var save=function(filename,content){saveAs(new Blob([content],{type:'text/plain;charset=utf-8'}),filename);};Le.findAndRemoveObjectFromJson=function(data,findtype,findid,deleted){var type=data.type;if(type=='path'&&!deleted){var triggers=data.triggers;var steps=data.steps;if(!mQuery.isEmptyObject(triggers)){mQuery.each(triggers,function(index,trigger){if(trigger.type==findtype&&trigger.id==findid){if(triggers.length>1){triggers.splice(index,1);deleted=true;return false;}}});}
if(!mQuery.isEmptyObject(steps)){mQuery.each(steps,function(index,event){if(event.type==findtype&&event.id==findid){steps.splice(index,1);deleted=true;return false;}else{deleted=Le.findAndRemoveObjectFromJson(event,findtype,findid,deleted);}});}}if(type=='decision'&&!deleted){var truepath=data.true_path;var falsepath=data.false_path;deleted=Le.findAndRemoveObjectFromJson(truepath,findtype,findid,deleted);deleted=Le.findAndRemoveObjectFromJson(falsepath,findtype,findid,deleted);}else if(type=='fork'&&!deleted){var paths=data.paths;mQuery.each(paths,function(index,value){deleted=Le.findAndRemoveObjectFromJson(value,findtype,findid,deleted);});}else if(type=='interrupt'){var triggers=data.triggers;if(!mQuery.isEmptyObject(triggers)){mQuery.each(triggers,function(index,trigger){if(trigger.type==findtype&&trigger.id==findid){if(triggers.length>1){triggers.splice(index,1);deleted=true;return false;}}});}}
return deleted;}
Le.findAndAddObjectIntoJson=function(data,findtype,findid,insertat,added){var type=data.type;var id=data.id;if(type=='path'&&!added){var triggers=data.triggers;var steps=data.steps;if(insertat==-1&&id==findid){var newjson=Le.getNewTriggerNodeJSON();triggers.push(newjson);added=true;Le.invokeCampaignEventAddAction(newjson,function(response){if(!response){}});}else if(insertat>=0&&id==findid){var newjson=Le.getJSONByEventType(findtype);if(findtype=='fork'){steps.splice(insertat,0,newjson);added=true;}else{steps.splice(insertat,0,newjson);added=true;Le.invokeCampaignEventAddAction(newjson,function(response){if(!response){}});}}else{if(!mQuery.isEmptyObject(steps)){mQuery.each(steps,function(index,event){added=Le.findAndAddObjectIntoJson(event,findtype,findid,insertat,added);});}}}if(type=='decision'&&!added){var truepath=data.true_path;var falsepath=data.false_path;added=Le.findAndAddObjectIntoJson(truepath,findtype,findid,insertat,added);added=Le.findAndAddObjectIntoJson(falsepath,findtype,findid,insertat,added);}else if(type=='fork'&&!added){var paths=data.paths;if(findtype==type&&id==findid){paths.push(Le.getNewPathJSON());added=true;}else{mQuery.each(paths,function(index,value){added=Le.findAndAddObjectIntoJson(value,findtype,findid,insertat,added);});}}else if(type=='interrupt'){var triggers=data.triggers;if(findtype==type&&id==findid){var newjson=Le.getNewTriggerNodeJSON();newjson.entry_point=false;triggers.push(newjson);added=true;Le.invokeCampaignEventAddAction(newjson,function(response){if(!response){}});}}
return added;}
Le.findAndGetObjectFromJSON=function(data,findtype,findid,matchobj){var type=data.type;if(type=='path'&&matchobj.length==0){var triggers=data.triggers;var steps=data.steps;if(!mQuery.isEmptyObject(triggers)){mQuery.each(triggers,function(index,trigger){if(trigger.id==findid){matchobj.push(trigger);return false;}});}
if(!mQuery.isEmptyObject(steps)&&matchobj.length==0){mQuery.each(steps,function(index,event){if(event.id==findid){matchobj.push(event);return false;}else{matchobj=Le.findAndGetObjectFromJSON(event,findtype,findid,matchobj);}});}}if(type=='decision'&&matchobj.length==0){var truepath=data.true_path;var falsepath=data.false_path;matchobj=Le.findAndGetObjectFromJSON(truepath,findtype,findid,matchobj);matchobj=Le.findAndGetObjectFromJSON(falsepath,findtype,findid,matchobj);}else if(type=='fork'&&matchobj.length==0){var paths=data.paths;mQuery.each(paths,function(index,value){matchobj=Le.findAndGetObjectFromJSON(value,findtype,findid,matchobj);if(matchobj.length>0){return false;}});}else if(type=='interrupt'&&matchobj.length==0){var triggers=data.triggers;if(!mQuery.isEmptyObject(triggers)){mQuery.each(triggers,function(index,trigger){if(trigger.id==findid){matchobj.push(trigger);return false;}});}}
return matchobj;}
Le.findAndUpdateObjectIntoJson=function(data,findtype,findid,info,updated){var type=data.type;var id=data.id;if(type=='path'&&!updated){var triggers=data.triggers;var steps=data.steps;if(findtype=='source'){mQuery.each(triggers,function(index,value){if(value.id==findid){value.view.label=info.label;value.view.incomplete=info.incomplete;value.category=info.category;value.subcategory=info.subcategory;updated=true;return false;}});}
if(!mQuery.isEmptyObject(steps)&&!updated){mQuery.each(steps,function(index,event){updated=Le.findAndUpdateObjectIntoJson(event,findtype,findid,info,updated);});}}else if(type=='fork'&&!updated){var paths=data.paths;mQuery.each(paths,function(index,value){updated=Le.findAndUpdateObjectIntoJson(value,findtype,findid,info,updated);});}else if(type=='interrupt'&&!updated){var triggers=data.triggers;if(findtype=='source'){mQuery.each(triggers,function(index,value){if(value.id==findid){value.view.label=info.label;value.view.incomplete=info.incomplete;value.category=info.category;value.subcategory=info.subcategory;updated=true;return false;}});}}else if(!updated&&(type=='decision'||type=='action'||type=='delay')){if(id==findid){data.view.label=info.label;data.view.incomplete=info.incomplete;data.category=info.category;data.subcategory=info.subcategory;updated=true;}else if(type=='decision'){var truepath=data.true_path;var falsepath=data.false_path;updated=Le.findAndUpdateObjectIntoJson(truepath,findtype,findid,info,updated);updated=Le.findAndUpdateObjectIntoJson(falsepath,findtype,findid,info,updated);}}
return updated;}
Le.refreshWorkFlowCanvas=function(){Le.zoomReset();Le.WF_NODE_PATH_HEIGHT_ADJUST=Le.WF_TRIGGER_NODE_HEIGHT_ADJUST;if(Le.WF_SHOW_STATSTICS){Le.WF_NODE_PATH_HEIGHT_ADJUST=Le.WF_NODE_PATH_HEIGHT_ADJUST+ +Le.WF_COUNT_NODE_HEIGHT_ADJUST;}
var svgelements=mQuery('.workflow-canvas').children();var oldsvg=svgelements[0];var newsvg=oldsvg.cloneNode(false);oldsvg.parentNode.replaceChild(newsvg,oldsvg);var svgwidth=mQuery(window).width();if(svgwidth>0){svgwidth=svgwidth+30;}
if(Le.campaignupdatedjson.width>svgwidth){svgwidth=Le.campaignupdatedjson.width;}
svgwidth=Math.ceil(svgwidth);Le.iterateJSONOBJECT(Le.campaignupdatedjson,svgwidth,newsvg,'',false);}
Le.registerKeyupCampaignName=function(){if(mQuery('#campaign_isPublished_1').attr('checked')=="checked"){mQuery('#campaignPublishButton').removeClass('background-orange').addClass('background-pink');mQuery('#campaignPublishButton').html('Stop Workflow');mQuery('#campaignPublishButton').attr("value","unpublish");mQuery('#campaignPublishButton').attr("data-original-title","Stop this workflow.");}else{mQuery('#campaignPublishButton').removeClass('background-pink').addClass('background-orange');mQuery('#campaignPublishButton').html('Start Workflow');mQuery('#campaignPublishButton').attr("value","publish");mQuery('#campaignPublishButton').attr("data-original-title"," workflow will be in draft/ pause till you start. Tap this button to start this workflow.");}};Le.CloseStatisticsWidget=function(){var value=mQuery('#campaignStatistics').attr("value");if(value=="close"){mQuery('#campaignStatistics').attr("value","open");mQuery('.campaign-statistics').addClass('minimized');mQuery('.'+value+'Group').addClass('hide');mQuery('#campaginStatClass').addClass('fa fa-angle-double-right');mQuery('.status-body').addClass('hide');}else{mQuery('#campaignStatistics').attr("value","close");mQuery('.campaign-statistics').removeClass('minimized');mQuery('.campaign-event-list').removeClass('hide');mQuery('#campaginStatClass').removeClass('fa fa-angle-double-right');mQuery('#campaginStatClass').addClass('fa fa-angle-double-left');mQuery('.status-body').removeClass('hide');}};Le.publishCampaign_old=function(flag){var campaignname=mQuery('#campaign_name').val();var msg="Workflow"+" "+'"'+campaignname+'"'+" "+" successfully";if(flag){mQuery('#flash').css('display','inline-block');mQuery('#flash').html(msg+' started.');}else{mQuery('#flash').css('display','inline-block');mQuery('#flash').html(msg+' stopped.');}
mQuery(function(){mQuery('#flash').delay(800).fadeIn('normal',function(){mQuery(this).delay(1500).fadeOut();});});}
Le.changeCampaignState=function(el){try{var wfstate=mQuery(el).attr('data-wf-state');if(wfstate=='true'){mQuery(el).addClass("btn-wf-state-start");mQuery(el).removeClass("btn-wf-state-stop");mQuery(el).html("Start Workflow");mQuery(el).attr("data-wf-state",'false');}else{mQuery(el).addClass("btn-wf-state-stop");mQuery(el).removeClass("btn-wf-state-start");mQuery(el).html("Stop Workflow");mQuery(el).attr("data-wf-state",'true');}
Le.publishCampaign(wfstate=='false');}catch(err){alert(err);}}
Le.publishCampaign=function(flag){var campaignname=mQuery('#campaign_name').val();var msg="Workflow"+" "+'"'+campaignname+'"'+" "+" successfully";if(flag){mQuery('#campaign_isPublished_1').attr('checked',true);mQuery('#campaign_isPublished_0').attr('checked',false);var potherLabel=mQuery('#campaign_isPublished_1').parent().parent().find('.btn-yes');mQuery(potherLabel).addClass('active');var uotherLabel=mQuery('#campaign_isPublished_0').parent().parent().find('.btn-no');mQuery(uotherLabel).removeClass('active');mQuery('#flash').css('display','inline-block');mQuery('#flash').html(msg+' started.');}else{Le.toggleYesNoButtonClass('campaign_isPublished_0');mQuery('#campaign_isPublished_0').attr('checked',true);var uotherLabel=mQuery('#campaign_isPublished_0').parent().parent().find('.btn-no');mQuery(uotherLabel).addClass('active');var potherLabel=mQuery('#campaign_isPublished_1').parent().parent().find('.btn-yes');mQuery(potherLabel).removeClass('active');mQuery('#flash').css('display','inline-block');mQuery('#flash').html(msg+' stopped.');}
mQuery(function(){mQuery('#flash').delay(800).fadeIn('normal',function(){mQuery(this).delay(1500).fadeOut();});});};Le.applyCampaignFromBuilder=function(){Le.activateButtonLoadingIndicator(mQuery('.btn-apply-builder'));Le.updateConnections(function(err){if(!err){var applyBtn=mQuery('.btn-apply');Le.inBuilderSubmissionOn(applyBtn.closest('form'));applyBtn.trigger('click');Le.inBuilderSubmissionOff();}});};Le.saveCampaignFromBuilder=function(){Le.activateButtonLoadingIndicator(mQuery('.btn-save-builder'));Le.updateConnections(function(err){if(!err){mQuery('body').css('overflow-y','');var saveBtn=mQuery('.btn-save');Le.inBuilderSubmissionOn(saveBtn.closest('form'));saveBtn.trigger('click');Le.inBuilderSubmissionOff();}});};Le.updateConnections=function(callback){var campaignId=mQuery('#campaignId').val();var query="action=campaign:updateConnections&campaignId="+campaignId;var canvasSettings={canvasSettings:JSON.stringify(Le.campaignupdatedjson)};mQuery.ajax({url:leAjaxUrl+'?'+query,type:"POST",data:canvasSettings,dataType:"json",success:function(response){if(typeof callback==='function')callback(false,response);},error:function(response,textStatus,errorThrown){Le.processAjaxError(response,textStatus,errorThrown);if(typeof callback==='function')callback(true,response);}});};Le.closeCampaignBuilder=function(){var builderCss={margin:"0",padding:"0",border:"none",width:"100%",height:"100%"};var panelHeight=(mQuery('.builder-content').css('right')=='0px')?mQuery('.builder-panel').height():0,panelWidth=(mQuery('.builder-content').css('right')=='0px')?0:mQuery('.builder-panel').width(),spinnerLeft=(mQuery(window).width()-panelWidth-60)/2,spinnerTop=(mQuery(window).height()-panelHeight-60)/2;var overlay=mQuery('<div id="builder-overlay" class="modal-backdrop fade in"><div style="position: absolute; top:'+spinnerTop+'px; left:'+spinnerLeft+'px" class=".builder-spinner"><i class="fa fa-spinner fa-spin fa-5x"></i></div></div>').css(builderCss).appendTo('.builder-content');mQuery('.btn-close-builder').prop('disabled',true);Le.removeButtonLoadingIndicator(mQuery('.btn-apply-builder'));mQuery('#builder-errors').hide('fast').text('');Le.updateConnections(function(err,response){if(!err){mQuery('#builder-overlay').remove();if(response.success){}
mQuery('.btn-close-builder').prop('disabled',false);var cancelBtn=mQuery('.btn-cancel');Le.inBuilderSubmissionOn(cancelBtn.closest('form'));cancelBtn.trigger('click');Le.inBuilderSubmissionOff();}});};Le.campaignToggleTimeframes=function(){if(mQuery('#campaignevent_triggerMode_2').length){var immediateChecked=mQuery('#campaignevent_triggerMode_0').prop('checked');var intervalChecked=mQuery('#campaignevent_triggerMode_1').prop('checked');var dateChecked=mQuery('#campaignevent_triggerMode_2').prop('checked');}else{var immediateChecked=false;var intervalChecked=mQuery('#campaignevent_triggerMode_0').prop('checked');var dateChecked=mQuery('#campaignevent_triggerMode_1').prop('checked');}
if(mQuery('#campaignevent_triggerInterval').length){if(immediateChecked){mQuery('#triggerInterval').addClass('hide');mQuery('#triggerDate').addClass('hide');}else if(intervalChecked){mQuery('#triggerInterval').removeClass('hide');mQuery('#triggerDate').addClass('hide');}else if(dateChecked){mQuery('#triggerInterval').addClass('hide');mQuery('#triggerDate').removeClass('hide');}}};Le.CloseDataModelCampaign=function(){if(mQuery('#campaign_name').val()!=""){mQuery('#leSharedModal').modal('hide');}else{mQuery('#campaign_name .help-block').html("A name is required");}};Le.launchCampaignEditor=function(){Le.zoomReset();Le.stopIconSpinPostEvent();mQuery('body').css('overflow-y','hidden');mQuery('.builder').addClass('builder-active').removeClass('hide');Le.setStatisticsBtn();try{Le.campaignupdatedjson=Le.campaignBuilderCanvasSettings;var svgwidth=mQuery(window).width();if(svgwidth>0){svgwidth=svgwidth+30;}
if(typeof Le.campaignupdatedjson.width!='number'){Le.campaignupdatedjson['width']=svgwidth;}
if(Le.campaignupdatedjson.width>svgwidth){svgwidth=Le.campaignupdatedjson.width;}
svgwidth=Math.ceil(svgwidth);var svgelement=document.createElementNS(Le.SVGNAMESPACEURI,"svg");svgelement.setAttributeNS(null,"id",'workflow'+'-'+Le.randomString(8));svgelement.setAttributeNS(null,"width",svgwidth);mQuery('.workflow-canvas').append(svgelement);Le.WF_NODE_PATH_HEIGHT_ADJUST=Le.WF_TRIGGER_NODE_HEIGHT_ADJUST;if(Le.WF_SHOW_STATSTICS){Le.WF_NODE_PATH_HEIGHT_ADJUST=Le.WF_NODE_PATH_HEIGHT_ADJUST+ +Le.WF_COUNT_NODE_HEIGHT_ADJUST;}
Le.iterateJSONOBJECT(Le.campaignupdatedjson,svgwidth,svgelement,'',false);}catch(error){alert(error);}};Le.selectCampaignType=function(eventType){Le.closeCampaignTypeModel();var added=Le.findAndAddObjectIntoJson(Le.campaignupdatedjson,eventType,Le.lastclickedinsertpoint.id,Le.lastclickedinsertpoint.insertat,false);if(added){Le.refreshWorkFlowCanvas();}};Le.closeCampaignTypeModel=function(){mQuery('.campaignevent-type-modal-backdrop').addClass('hide');mQuery('.campaignevent-type-modal').addClass('hide');mQuery('.campaignevent-type-modal').removeClass('in');};Le.showCampaignTypeModel=function(){mQuery('.campaignevent-type-modal').addClass('in');mQuery('.campaignevent-type-modal-backdrop').removeClass('hide');mQuery('.campaignevent-type-modal').removeClass('hide');};Le.invokeCampaignEventEditAction=function(lastclickednode){var campaignId=mQuery('#campaignId').val();var posturl=mQuery('#campaign-request-url').attr('data-href');posturl=posturl.replace("objectAction",'edit');posturl=posturl+"/"+lastclickednode.id;var route=posturl+"?campaignId="+campaignId+"&type="+lastclickednode.subcategory+"&eventType="+lastclickednode.category;var divelement=document.createElement("div");divelement.setAttribute('data-target','#CampaignEventModal');divelement.setAttribute('data-href',route);Le.ajaxifyModal(divelement);};Le.invokeCampaignEventAddAction=function(wfjson,callback){Le.LAST_SELECTED_GROUPNAME="";var wfnodetype=wfjson.type;if(wfjson.type=='interrupt'){wfjson=wfjson.triggers[0];}
if(wfjson.type=='trigger'&&!wfjson.entry_point){wfnodetype='interrupt';}
var campaignId=mQuery('#campaignId').val();var posturl=mQuery('#campaign-request-url').attr('data-href');posturl=posturl.replace("objectAction",'new');var route=posturl+"?campaignId="+campaignId;var data={campaignId:campaignId,type:wfjson.subcategory,eventType:wfjson.category,keyId:wfjson.id,wfnodetype:wfnodetype};mQuery.ajax({url:route,type:"POST",data:data,dataType:"json",success:function(response){if(typeof callback==='function')callback(false,response);},error:function(response,textStatus,errorThrown){Le.processAjaxError(response,textStatus,errorThrown);if(typeof callback==='function')callback(true,response);}});};Le.invokeCampaignEventDeleteAction=function(id,callback){var campaignId=mQuery('#campaignId').val();var posturl=mQuery('#campaign-request-url').attr('data-href');posturl=posturl.replace("objectAction",'delete');posturl=posturl+"/"+id;var route=posturl+"?campaignId="+campaignId;mQuery.ajax({url:route,type:"POST",data:{},dataType:"json",success:function(response){if(typeof callback==='function')callback(false,response);},error:function(response,textStatus,errorThrown){Le.processAjaxError(response,textStatus,errorThrown);if(typeof callback==='function')callback(true,response);}});};Le.campaignEventOnLoad=function(container,response){var value=mQuery('#campaignevent_properties_campaigntype').val();var eventNames=mQuery('#campaignevent_type').val();if(eventNames=="openEmail"||eventNames=="clickEmail"){Le.getSelectedCampaignValue(value);}
if(eventNames=="lead.campaign_list_filter"){Le.leadlistOnLoad(container);}
var eventType=response.eventType;if(!response.closeModal&&!response.deleted){var cegselctize=mQuery('#campaignevent_group').selectize({persist:true,maxItems:1,valueField:'label',labelField:'label',searchField:['label'],sortField:[{field:'order',direction:'asc'},],options:[],render:{item:function(item,escape){return'<div>'+escape(item.label)+'</div>';},option:function(item,escape){return'<div style="display: block;color:#47535f;font-weight: 600">'+escape(item.label)+'</div>';}},})[0].selectize;var cesgselectize=mQuery('#campaignevent_subgroup').selectize({persist:true,maxItems:1,placeholder:eventType=='source'?'Choose a trigger..':'Choose a action..',valueField:'category',labelField:'label',searchField:['label','desc'],sortField:[{field:'order',direction:'asc'},],options:[],render:{item:function(item,escape){return'<div>'+escape(item.label)+'</div>';},option:function(item,escape){return'<div>'+'<div style="display: block;color:#47535f;font-weight: 600";>'+escape(item.label)+'</div>'+'<div style="display: block;color: #666;">'+escape(item.desc)+'</div>'+'</div>';}},})[0].selectize;cegselctize.on('change',function(value){var groupname=this.options[value].label;var suboptions=[];if(eventType=='source'){suboptions=Le.getFilteredCampaignSourceSubgroupOptions(groupname);}else{suboptions=Le.getFilteredCampaignEventSubgroupOptions(groupname);}
try{cesgselectize.clearOptions();}catch(err){}
for(var index=0;index<suboptions.length;index++){cesgselectize.addOption(suboptions[index]);}
cesgselectize.refreshOptions(false);if(cesgselectize.isOpen){cesgselectize.close();}
if(Le.LAST_SELECTED_GROUPNAME!=""&&Le.LAST_SELECTED_GROUPNAME!=value){Le.LAST_SELECTED_GROUPNAME=value;var category='';if(eventType=="source"){category="campaign.defaultsource";}else{category="campaign.defaultaction";}
Le.invokeCampaignEventAction(category,eventType);}});var groupoptions=[];if(eventType=="source"){groupoptions=Le.getFilteredCampaignSourcegroupOptions();}else{groupoptions=Le.getFilteredCampaignActiongroupOptions();}
for(var index=0;index<groupoptions.length;index++){cegselctize.addOption(groupoptions[index]);}
cesgselectize.on('change',function(value){var category=this.options[value].category;Le.invokeCampaignEventAction(category,eventType);});var campaignEventType=mQuery('#campaignevent_type').val();var eventName="";if(eventType=='source'){eventName=Le.getCampaignSourceGroupName(campaignEventType);}else{eventName=Le.getCampaignEventGroupName(campaignEventType);}
Le.LAST_SELECTED_GROUPNAME=eventName;cegselctize.setValue(eventName,false);if(campaignEventType!='campaign.defaultsource'&&campaignEventType!='campaign.defaultaction'){cesgselectize.setValue(campaignEventType,true);}}
if(response.deleted){}else if(response.success){try{var eventId=response.eventId;var eventName=response.eventName;var type=response.type;var info={'label':eventName,'category':eventType,'subcategory':type,'incomplete':(type!='campaign.defaultdelay'&&type.includes("campaign.default"))?true:false};var updated=Le.findAndUpdateObjectIntoJson(Le.campaignupdatedjson,eventType,eventId,info,false);if(updated){Le.refreshWorkFlowCanvas();}}catch(err){alert(err);}}
var value=mQuery('#campaignevent_properties_useremail_email').val()
if(value===''||value===null){mQuery('#campaignevent_properties_useremail_previewEmailButton').prop('disabled',true);}else{mQuery('#campaignevent_properties_useremail_previewEmailButton').prop('disabled',false);}
mQuery(".custom-datepicker").datetimepicker({minDate:0});};Le.invokeCampaignEventAction=function(category,eventType){var campaignId=mQuery('#campaignId').val();var posturl=mQuery('#campaigneventgroup').attr('data-href');var route=posturl+"?type="+category+"&eventType="+eventType+"&campaignId="+campaignId+"&keyId="+Le.lastclickedwfnode.id;var divelement=document.createElement("div");divelement.setAttribute('data-target','#CampaignEventModal');divelement.setAttribute('data-href',route);Le.updateAjaxModal('#CampaignEventModal',route,'GET');};Le.getFilteredCampaignSourcegroupOptions=function(){var filteroptions=[];for(var index=0;index<Le.campaignBuilderSourceOptions.length;index++){var options=Le.campaignBuilderGroupOptions[index];if(typeof options!=="undefined"&&(options.visibleFor==0||options.visibleFor==1)){filteroptions.push(options);}}
return filteroptions;};Le.getFilteredCampaignActiongroupOptions=function(){var filteroptions=[];for(var index=0;index<Le.campaignBuilderSourceOptions.length;index++){var options=Le.campaignBuilderGroupOptions[index];if(typeof options!=="undefined"&&(options.visibleFor==0||options.visibleFor==2)){filteroptions.push(options);}}
return filteroptions;};Le.getFilteredCampaignEventSubgroupOptions=function(groupname){var filteroptions=[];for(var index=0;index<Le.campaignBuilderEventOptions.length;index++){var options=Le.campaignBuilderEventOptions[index];if(options.group==groupname){filteroptions.push(options);}}
return filteroptions;};Le.getFilteredCampaignSourceSubgroupOptions=function(groupname){var filteroptions=[];for(var index=0;index<Le.campaignBuilderSourceOptions.length;index++){var options=Le.campaignBuilderSourceOptions[index];if(options.group==groupname){filteroptions.push(options);}}
return filteroptions;};Le.getCampaignEventGroupName=function(subgroup){for(var index=0;index<Le.campaignBuilderEventOptions.length;index++){var options=Le.campaignBuilderEventOptions[index];if(options.category==subgroup){return options.group;break;}}
return Le.LAST_SELECTED_GROUPNAME==""?Le.campaignBuilderGroupOptions[0].label:Le.LAST_SELECTED_GROUPNAME;};Le.getCampaignSourceGroupName=function(subgroup){for(var index=0;index<Le.campaignBuilderSourceOptions.length;index++){var options=Le.campaignBuilderSourceOptions[index];if(options.category==subgroup){return options.group;break;}}
return Le.LAST_SELECTED_GROUPNAME==""?Le.campaignBuilderGroupOptions[0].label:Le.LAST_SELECTED_GROUPNAME;};Le.submitCampaignEvent=function(e){e.preventDefault();mQuery('#campaignevent_canvasSettings_droppedX').val(mQuery('#droppedX').val());mQuery('#campaignevent_canvasSettings_droppedY').val(mQuery('#droppedY').val());mQuery('form[name="campaignevent"]').submit();};Le.showStatistics=function(show){Le.WF_SHOW_STATSTICS=show;Le.refreshWorkFlowCanvas();}
Le.adjustSizeforSVG=function(svgnode,stepsnode,yposition){var bcr=stepsnode.parentNode.getBoundingClientRect();var svgwidth=mQuery(window).width();if(svgwidth<bcr.width){svgwidth=bcr.width+ +100;}else{svgwidth=svgwidth+30;}
svgwidth=Math.ceil(svgwidth);Le.campaignupdatedjson.width=svgwidth;svgnode.setAttributeNS(null,"height",yposition+ +Le.SVG_NODE_HEIGHT_ADJUST);svgnode.setAttributeNS(null,"width",svgwidth);}
Le.setStatisticsBtn=function(){if(Le.WF_SHOW_STATSTICS==true){mQuery('#campaign_showAnalytics_1').parent().removeClass('btn-default').addClass('btn-success active');mQuery('#campaign_showAnalytics_0').parent().removeClass('btn-danger active').addClass('btn-default');}else{mQuery('#campaign_showAnalytics_1').parent().removeClass('btn-success active ').addClass('btn-default');mQuery('#campaign_showAnalytics_0').parent().removeClass('btn-default').addClass(' btn-danger active');}}
Le.currentZoom=1;Le.zoomIn=function(){try{if(Le.currentZoom<1){Le.currentZoom+=0.25;mQuery('.workflow-canvas').css({'transform':"scale("+Le.currentZoom+")",'transform-origin':"top center",'-moz-transform':"scale("+Le.currentZoom+")",'-moz-transform-origin':"top center",});mQuery('.campaign-zoom-button-div .zoom-percentage').text((Le.currentZoom*100)+"%");}}catch(err){alert(err);}}
Le.zoomReset=function(){try{Le.currentZoom=1;mQuery('.workflow-canvas').css({'transform':"scale("+Le.currentZoom+")",'transform-origin':"top center",'-moz-transform':"scale("+Le.currentZoom+")",'-moz-transform-origin':"top center",});mQuery('.campaign-zoom-button-div .zoom-percentage').text((Le.currentZoom*100)+"%");}catch(err){alert(err);}}
Le.zoomOut=function(){try{if(Le.currentZoom>0.25){Le.currentZoom-=0.25;mQuery('.workflow-canvas').css({'transform':"scale("+Le.currentZoom+")",'transform-origin':"top center",'-moz-transform':"scale("+Le.currentZoom+")",'-moz-transform-origin':"top center",});mQuery('.campaign-zoom-button-div .zoom-percentage').text((Le.currentZoom*100)+"%");}}catch(err){alert(err);}};Le.categoryOnLoad=function(container,response){if(mQuery(container+' #list-search').length){Le.activateSearchAutocomplete('list-search','category');}
if(response&&response.inForm){var newOption=mQuery('<option />').val(response.categoryId);newOption.html(response.categoryName);mQuery(".category-select option:last").prev().before(newOption);newOption.prop('selected',true);mQuery('.category-select').trigger("chosen:updated");}};;Le.messagesOnLoad=function(container){mQuery(container+' .sortable-panel-wrapper .modal').each(function(){mQuery(this).closest('.panel').append(mQuery(this));});};Le.toggleChannelFormDisplay=function(el,channel){Le.toggleTabPublished(el);if(mQuery(el).val()==="1"&&mQuery(el).prop('checked')){mQuery(el).closest('.tab-pane').find('.message_channel_properties_'+channel).removeClass('hide')}else{mQuery(el).closest('.tab-pane').find('.message_channel_properties_'+channel).addClass('hide');}};Le.cancelQueuedMessageEvent=function(channelId){Le.ajaxActionRequest('channel:cancelQueuedMessageEvent',{channelId:channelId},function(response){if(response.success){mQuery('#queued-message-'+channelId).addClass('disabled');mQuery('#queued-status-'+channelId).html(Le.translate('le.message.queue.status.cancelled'));}},false);};;Le.hideSpecificConfigFields=function(formName){initializeFormFieldVisibilitySwitcher(formName);};Le.removeConfigValue=function(action,el){Le.executeAction(action,function(response){if(response.success){mQuery(el).parent().addClass('hide');}});};Le.parseQuery=function(query){var vars=query.split('&');var queryString={};for(var i=0;i<vars.length;i++){var pair=vars[i].split('=');var key=decodeURIComponent(pair[0]);var value=decodeURIComponent(pair[1]);if(typeof queryString[key]==='undefined'){queryString[key]=decodeURIComponent(value);}else if(typeof queryString[key]==='string'){var arr=[queryString[key],decodeURIComponent(value)];queryString[key]=arr;}else{queryString[key].push(decodeURIComponent(value));}}
return queryString;}
Le.parseUrlHashParameter=function(url){var url=url.split('#');if('undefined'!=typeof url[1]){return url[1];}
return false;}
Le.observeConfigTabs=function(){if(!mQuery('#config_emailconfig_last_shown_tab').length){return;}
var parameters=Le.parseQuery(window.location.search.substr(1));if('undefiend'!=typeof parameters['tab']){mQuery('#config_emailconfig_last_shown_tab').val(parameters['tab']);mQuery('a[data-toggle="tab"]').each(function(i,tab){if(mQuery(tab).attr('href')==('#'+parameters['tab'])){mQuery(tab).tab('show');}});}
mQuery('a[data-toggle="tab"]').on('show.bs.tab',function(e){var tab=Le.parseUrlHashParameter(e.target.href);if(tab){mQuery('#config_emailconfig_last_shown_tab').val(tab);}});}
mQuery(Le.observeConfigTabs);;Le.dashboardOnLoad=function(container){Le.initWidgetSorting();Le.initWidgetRemoveButtons(mQuery('#dashboard-widgets'));};Le.dashboardOnUnload=function(id){mQuery('.jvectormap-tip').remove();};Le.widgetOnLoad=function(container,response){if(!response.widgetId)return;var widget=mQuery('[data-widget-id='+response.widgetId+']');var widgetHtml=mQuery(response.widgetHtml);widgetHtml.find("*[data-toggle='ajaxmodal']").on('click.ajaxmodal',function(event){event.preventDefault();Le.ajaxifyModal(this,event);});if(!widget.length){widget=mQuery('<div/>').addClass('widget').attr('data-widget-id',response.widgetId);mQuery('#dashboard-widgets').prepend(widget);}
widget.html(widgetHtml).css('width',response.widgetWidth+'%').css('height',response.widgetHeight+'%');Le.renderCharts(widgetHtml);Le.renderMaps(widgetHtml);Le.initWidgetRemoveButtons(widgetHtml);Le.saveWidgetSorting();}
Le.initWidgetSorting=function(){var widgetsWrapper=mQuery('#dashboard-widgets');var bodyOverflow={};widgetsWrapper.sortable({handle:'.card-header h4',placeholder:'sortable-placeholder',items:'.widget',opacity:0.9,scroll:true,scrollSpeed:10,tolerance:"pointer",cursor:'move',appendTo:'#dashboard-widgets',helper:function(e,ui){ui.children().each(function(){mQuery(this).width(mQuery(this).width());mQuery(this).height(mQuery(this).height());});bodyOverflow.overflowX=mQuery('body').css('overflow-x');bodyOverflow.overflowY=mQuery('body').css('overflow-y');mQuery('body').css({overflowX:'visible',overflowY:'visible'});mQuery("#dashboard-widgets .widget").each(function(i){var item=mQuery(this);var item_clone=item.clone();var canvas=item.find('canvas').first();if(canvas.length){var destCanvas=item_clone.find('canvas').first();var destCtx=destCanvas[0].getContext('2d');destCtx.drawImage(canvas[0],0,0);}
item.data("clone",item_clone);var position=item.position();item_clone.css({left:position.left,top:position.top,width:item.width(),visibility:"visible",position:"absolute",zIndex:1});item.css('visibility','hidden');mQuery("#cloned-widgets").append(item_clone);});return ui;},start:function(e,ui){ui.helper.css('visibility','visible');ui.helper.data("clone").hide();},sort:function(e,ui){var card=ui.item.find('.card').first();ui.placeholder.width(card.width());ui.placeholder.height(card.height());ui.placeholder.css({marginTop:"5px",marginBottom:"5px",marginLeft:0,marginRight:0});},stop:function(){mQuery('body').css(bodyOverflow);mQuery("#dashboard-widgets .widget.exclude-me").each(function(){var item=mQuery(this);var clone=item.data("clone");var position=item.position();clone.css("left",position.left);clone.css("top",position.top);clone.show();item.removeClass("exclude-me");});mQuery("#dashboard-widgets .widget").css("visibility","visible");mQuery("#cloned-widgets .widget").remove();Le.saveWidgetSorting();},change:function(e,ui){mQuery("#dashboard-widgets .widget:not(.exclude-me)").each(function(){var item=mQuery(this);var clone=item.data("clone");clone.stop(true,false);var position=item.position();clone.animate({left:position.left,top:position.top},200);});}}).disableSelection();}
Le.saveWidgetSorting=function(){var widgetsWrapper=mQuery('#dashboard-widgets');var widgets=widgetsWrapper.children();var ordering=[];widgets.each(function(index,value){ordering.push(mQuery(this).attr('data-widget-id'));});Le.ajaxActionRequest('dashboard:updateWidgetOrdering',{'ordering':ordering},function(response){});}
Le.updateWidgetForm=function(element){Le.activateLabelLoadingIndicator('widget_type');var formWrapper=mQuery(element).closest('form');var WidgetFormValues=formWrapper.serializeArray();Le.ajaxActionRequest('dashboard:updateWidgetForm',WidgetFormValues,function(response){if(response.formHtml){var formHtml=mQuery(response.formHtml);formHtml.find('#widget_buttons').addClass('hide hidden');formWrapper.html(formHtml.children());Le.onPageLoad('#widget_params');}
Le.removeLabelLoadingIndicator();});};Le.initWidgetRemoveButtons=function(scope){scope.find('.remove-widget').on('click',function(e){e.preventDefault();var button=mQuery(this);var wrapper=button.closest('.widget');var widgetId=wrapper.attr('data-widget-id');wrapper.hide('slow');Le.ajaxActionRequest('dashboard:delete',{widget:widgetId},function(response){if(!response.success){wrapper.show('slow');}});});};Le.exportDashboardLayout=function(text,baseUrl){var name=prompt(text,"");if(name!==null){if(name){baseUrl=baseUrl+"?name="+encodeURIComponent(name);}
window.location=baseUrl;}};Le.saveDashboardLayout=function(text){var name=prompt(text,"");if(name){mQuery.ajax({type:'POST',url:leBaseUrl+'s/dashboard/save',data:{name:name}});}};;Le.toggleDwcFilters=function(){mQuery("#dwcFiltersTab, #slotNameDiv").toggleClass("hide");if(mQuery("#dwcFiltersTab").hasClass('hide')){mQuery('.nav-tabs a[href="#details"]').click();}else{Le.dynamicContentOnLoad();}};Le.dynamicContentOnLoad=function(container,response){if(typeof container!=='object'){if(mQuery(container+' #list-search').length){Le.activateSearchAutocomplete('list-search','dynamicContent');}}
var availableFilters=mQuery('div.dwc-filter').find('select[data-le="available_filters"]');Le.activateChosenSelect(availableFilters,false);Le.leadlistOnLoad('div.dwc-filter');};Le.standardDynamicContentUrl=function(options){if(!options){return;}
var url=options.windowUrl;if(url){var editDynamicContentKey='/dwc/edit/dynamicContentId';var previewDynamicContentKey='/dwc/preview/dynamicContentId';if(url.indexOf(editDynamicContentKey)>-1||url.indexOf(previewDynamicContentKey)>-1){options.windowUrl=url.replace('dynamicContentId',mQuery('#campaignevent_properties_dynamicContent').val());}}
return options;};Le.disabledDynamicContentAction=function(opener){if(typeof opener=='undefined'){opener=window;}
var dynamicContent=opener.mQuery('#campaignevent_properties_dynamicContent').val();var disabled=dynamicContent===''||dynamicContent===null;opener.mQuery('#campaignevent_properties_editDynamicContentButton').prop('disabled',disabled);};if(typeof MauticIsDwcReady==='undefined'){var MauticIsDwcReady=true;if(document.readyState==="complete"||!(document.readyState==="loading"||document.documentElement.doScroll)){Le.dynamicContentOnLoad();}else{document.addEventListener("DOMContentLoaded",Le.dynamicContentOnLoad);}};Le.testMonitoredEmailServerConnection=function(mailbox){var data={host:mQuery('#config_emailconfig_monitored_email_'+mailbox+'_host').val(),port:mQuery('#config_emailconfig_monitored_email_'+mailbox+'_port').val(),encryption:mQuery('#config_emailconfig_monitored_email_'+mailbox+'_encryption').val(),user:mQuery('#config_emailconfig_monitored_email_'+mailbox+'_user').val(),password:mQuery('#config_emailconfig_monitored_email_'+mailbox+'_password').val(),mailbox:mailbox};var abortCall=false;if(!data.host){mQuery('#config_emailconfig_monitored_email_'+mailbox+'_host').parent().addClass('has-error');abortCall=true;}else{mQuery('#config_emailconfig_monitored_email_'+mailbox+'_host').parent().removeClass('has-error');}
if(!data.port){mQuery('#config_emailconfig_monitored_email_'+mailbox+'_port').parent().addClass('has-error');abortCall=true;}else{mQuery('#config_emailconfig_monitored_email_'+mailbox+'_port').parent().removeClass('has-error');}
if(abortCall){return;}
mQuery('#'+mailbox+'TestButtonContainer .fa-spinner').removeClass('hide');Le.ajaxActionRequest('email:testMonitoredEmailServerConnection',data,function(response){var theClass=(response.success)?'has-success':'has-error';var theMessage=response.message;mQuery('#'+mailbox+'TestButtonContainer').removeClass('has-success has-error').addClass(theClass);mQuery('#'+mailbox+'TestButtonContainer .help-block').html(theMessage);mQuery('#'+mailbox+'TestButtonContainer .fa-spinner').addClass('hide');if(response.folders){if(mailbox=='general'){mQuery('select[data-imap-folders]').each(function(index){var thisMailbox=mQuery(this).data('imap-folders');if(mQuery('#config_emailconfig_monitored_email_'+thisMailbox+'_override_settings_0').is(':checked')){var folder='#config_emailconfig_monitored_email_'+thisMailbox+'_folder';var curVal=mQuery(folder).val();mQuery(folder).html(response.folders);mQuery(folder).val(curVal);mQuery(folder).trigger('chosen:updated');}});}else{var folder='#config_emailconfig_monitored_email_'+mailbox+'_folder';var curVal=mQuery(folder).val();mQuery(folder).html(response.folders);mQuery(folder).val(curVal);mQuery(folder).trigger('chosen:updated');}}});};Le.testEmailServerConnection=function(sendEmail){Le.updateEmailStatus();var transport=mQuery('#config_emailconfig_mailer_transport').val();var port=mQuery('#config_emailconfig_mailer_host').val();var host=mQuery('#config_emailconfig_mailer_host').val();var password=mQuery('#config_emailconfig_mailer_password').val();var user=mQuery('#config_emailconfig_mailer_user').val();if(transport=="smtp"&&(port==""||host==""||user==""||password=="")){mQuery('#emailActivateModel').modal('hide');mQuery('#mailerTestButtonContainer .fa-spinner').removeClass('hide');mQuery('.emailconfig #mailerTestButtonContainer').removeClass('has-success has-error').addClass("has-error");mQuery('.emailconfig #mailerTestButtonContainer .help-block').html("Please configure all the values.");mQuery('.emailconfig #mailerTestButtonContainer .fa-spinner').addClass('hide');return;}
var toemail="";var trackingcode="";var additionalinfo="";if(typeof mQuery('#config_trackingconfig_emailInstructionsto')!=="undefined"&&mQuery('#config_trackingconfig_emailInstructionsto')!=null){toemail=mQuery('#config_trackingconfig_emailInstructionsto').val();trackingcode=mQuery('#script_preTag').html();additionalinfo=mQuery('#config_trackingconfig_emailAdditionainfo').val();}
var fromemail="";var selectedid=0;if(typeof mQuery('#activate_sender_email')!=="undefined"&&mQuery('#activate_sender_email')!=null&&sendEmail){selectedid=mQuery("#activate_sender_email").prop('selectedIndex');fromemail=mQuery('#activate_sender_email').val();}
var data={amazon_region:mQuery('#config_emailconfig_mailer_amazon_region').val(),api_key:mQuery('#config_emailconfig_mailer_api_key').val(),authMode:mQuery('#config_emailconfig_mailer_auth_mode').val(),encryption:mQuery('#config_emailconfig_mailer_encryption').val(),from_email:(sendEmail)?fromemail:mQuery('#config_emailconfig_mailer_from_email').val(),from_name:mQuery('#config_emailconfig_mailer_from_name').val(),host:mQuery('#config_emailconfig_mailer_host').val(),password:mQuery('#config_emailconfig_mailer_password').val(),port:mQuery('#config_emailconfig_mailer_port').val(),send_test:(typeof sendEmail!=='undefined')?sendEmail:false,transport:mQuery('#config_emailconfig_mailer_transport').val(),user:mQuery('#config_emailconfig_mailer_user').val(),toemail:toemail,trackingcode:trackingcode,additionalinfo:additionalinfo};mQuery('#emailActivateModel').modal('hide');mQuery('#mailerTestButtonContainer .fa-spinner').removeClass('hide');Le.ajaxActionRequest('email:testEmailServerConnection',data,function(response){var theClass=(response.success)?'has-success':'has-error';var theMessage=response.message;if(theClass=='has-success'){mQuery('#config_emailconfig_email_status').val('Active');mQuery('#config_emailconfig_email_status').removeClass('status_fail');mQuery('#config_emailconfig_email_status').addClass('status_success');}
if(theClass=='has-error'){mQuery('#config_emailconfig_email_status').val('InActive');mQuery('#config_emailconfig_email_status').removeClass('status_success');mQuery('#config_emailconfig_email_status').addClass('status_fail');}
if(!mQuery('.emailconfig #mailerTestButtonContainer').is(':hidden')){mQuery('.emailconfig #mailerTestButtonContainer').removeClass('has-success has-error').addClass(theClass);mQuery('.emailconfig #mailerTestButtonContainer .help-block').html(theMessage);mQuery('.emailconfig #mailerTestButtonContainer .fa-spinner').addClass('hide');}else{mQuery('.trackingconfig #mailerTestButtonContainer').removeClass('has-success has-error').addClass(theClass);mQuery('.trackingconfig #mailerTestButtonContainer .fa-spinner').addClass('hide');if(response.to_address_empty){mQuery('.trackingconfig .emailinstructions').addClass('has-error');}else{mQuery('.trackingconfig #mailerTestButtonContainer .help-block').html(theMessage);mQuery('.trackingconfig .emailinstructions').removeClass('has-error');}}
var id='';if((response.success)){Le.changeSenderProfileStatusFrontEnd(true,fromemail,selectedid);}else{Le.changeSenderProfileStatusFrontEnd(false,fromemail,selectedid);}});};Le.copytoClipboardforms=function(id){try{var copyText=document.getElementById(id);copyText.select();document.execCommand("Copy");var copyTexts=document.getElementById(id+"_atag");copyTexts.innerHTML='<i aria-hidden="true" class="fa fa-clipboard"></i>copied';setTimeout(function(){var copyTexta=document.getElementById(id+"_atag");copyTextval='<i aria-hidden="true" class="fa fa-clipboard"></i>copy to clipboard';copyTexta.innerHTML=copyTextval;},1000);}catch(err){alert(err);}};Le.copySpanTextToClipBoard=function(id){try{var range,selection;if(document.body.createTextRange){range=document.body.createTextRange();range.moveToElementText(document.getElementById(id));range.select();}else if(window.getSelection){selection=window.getSelection();range=document.createRange();range.selectNodeContents(document.getElementById(id));selection.removeAllRanges();selection.addRange(range);}
document.execCommand("Copy");var copyTexts=document.getElementById(id+"_atag");copyTexts.innerHTML='<i aria-hidden="true" class="fa fa-clipboard"></i>copied';setTimeout(function(){var copyTexta=document.getElementById(id+"_atag");copyTextval='<i aria-hidden="true" class="fa fa-clipboard"></i>copy to clipboard';copyTexta.innerHTML=copyTextval;},1000);}catch(err){alert(err);}};Le.copyClipboardforms=function(id){var copyText=document.getElementById(id);copyText.select();document.execCommand("Copy");var copyTexts=document.getElementById(id+"_atag");copyTexts.innerHTML='<i aria-hidden="true" class="fa fa-clipboard"> </i> Copied';setTimeout(function(){var copyTexta=document.getElementById(id+"_atag");copyTextval='<i aria-hidden="true" class="fa fa-clipboard"> </i> Copy Script';copyTexta.innerHTML=copyTextval;},1000);};Le.showBounceCallbackURL=function(modeEl){var mode=mQuery(modeEl).val();if(mode!="le.transport.amazon"&&mode!="le.transport.sendgrid_api"&&mode!="le.transport.sparkpost"&&mode!="le.transport.elasticemail"){mQuery('.transportcallback').addClass('hide');mQuery('.transportcallback_spam').addClass('hide');mQuery('#known-providers').addClass('hide');mQuery('#other-providers').removeClass('hide');}else{var urlvalue=mQuery('#transportcallback').val();var replaceval="";mQuery('.transportcallback').removeClass('hide');mQuery('.transportcallback_spam').addClass('hide');var notificationHelpURL="http://help.leadsengage.io/container/show/";mQuery("#callback_label_1").text("Bounce/ Spam Notification Callback URL");if(mode=="le.transport.amazon"){replaceval="amazon";notificationHelpURL+="amazon-ses";mQuery("#callback_label_1").text("Bounce Notification Callback URL");mQuery('.transportcallback_spam').removeClass('hide');}else if(mode=="le.transport.sendgrid_api"){replaceval="sendgrid_api";notificationHelpURL+=replaceval;}else if(mode=="le.transport.sparkpost"){replaceval="sparkpost";notificationHelpURL+=replaceval;}else if(mode=="le.transport.elasticemail"){replaceval="elasticemail";notificationHelpURL+=replaceval}
mQuery('#known-providers').removeClass('hide');mQuery('#other-providers').addClass('hide');mQuery('#notificationHelpURL').attr('href',notificationHelpURL);var toreplace=urlvalue.split('/');toreplace=toreplace[toreplace.length-2];urlvalue=urlvalue.replace(toreplace,replaceval);mQuery('#transportcallback').val(urlvalue);}
mQuery('#config_emailconfig_mailer_user').val('');mQuery('#config_emailconfig_mailer_password').val('');mQuery('#config_emailconfig_mailer_api_key').val('');if(mode!='le.transport.vialeadsengage'){mQuery('#config_emailconfig_mailer_transport').val(mode);}
mQuery('#config_emailconfig_mailer_amazon_region').val('');};Le.configOnLoad=function(container){mQuery('#unsubscribe_text_div').find('.fr-element').attr('style','min-height:150px;');mQuery('#emailVerifyModel').on("hidden.bs.modal",function(){mQuery('#aws_email_verification').val('');mQuery('#user_email .help-block').addClass('hide');mQuery('#user_email .help-block').html("");});mQuery('.sender_profile_create_btn').click(function(e){e.preventDefault();mQuery('#sender_profile_from_name_errors').html("");mQuery('#sender_profile_from_email_errors').html("");mQuery('#sender_profile_from_name').html("");mQuery('#sender_profile_from_email').html("");});mQuery('.sender_profile_verify_btn').click(function(e){e.preventDefault();var currentLink=mQuery(this);var email=mQuery('#sender_profile_from_email').val();var fromname=mQuery('#sender_profile_from_name').val();var mailformat=/^([\w-\.]+@(?!gmail.com)(?!yahoo.com)(?!yahoo.co.in)(?!yahoo.in)(?!hotmail.com)(?!yahoo.co.in)(?!aol.com)(?!abc.com)(?!xyz.com)(?!pqr.com)(?!rediffmail.com)(?!live.com)(?!outlook.com)(?!me.com)(?!msn.com)(?!ymail.com)([\w-]+\.)+[\w-]{2,6})?$/;if(fromname==""){mQuery('#sender_profile_from_name_errors').html("From name cannot be empty!");return;}
if(!email.match(mailformat)){mQuery('#sender_profile_from_email_errors').html("Please provide your business email address, since free emails like gmail/ yahoo/ hotmail and a few more are not allowed due to DMARC rules.");return;}
mQuery('#user_email .help-block').removeClass('hide');Le.activateButtonLoadingIndicator(currentLink);Le.ajaxActionRequest('email:senderProfileVerify',{'email':email,'name':fromname},function(response){Le.removeButtonLoadingIndicator(currentLink);if(response.success){Le.redirectWithBackdrop(response.redirect);mQuery('#emailVerifyModel').addClass('hide');}else{mQuery('#sender_profile_from_email_errors').html(response.message);return;}});});mQuery('.remove_sender_profile_btn').click(function(e){e.preventDefault();var currentLink=mQuery(this);var currentrow=currentLink.closest("tr");var fromemail=currentrow.find(".sender_profile_from_email_col");var email=fromemail.text();Le.activateButtonLoadingIndicator(currentLink);Le.ajaxActionRequest('email:deleteSenderProfile',{'email':email},function(response){Le.removeButtonLoadingIndicator(currentLink);if(response.success){Le.redirectWithBackdrop(response.redirect);}else{mQuery('#sender_profile_errors').html(response.message);return;}});});mQuery('.verify_sender_profile_btn').click(function(e){e.preventDefault();var currentLink=mQuery(this);var currentrow=currentLink.closest("tr");var fromemail=currentrow.find(".sender_profile_from_email_col");var email=fromemail.text();email=email.trim();var fromname=currentrow.find(".sender_profile_from_name_col");var name=fromname.text();name=name.trim();var id=currentLink.attr('id');id=id.substr(-1);Le.activateButtonLoadingIndicator(currentLink);Le.ajaxActionRequest('email:reVerifySenderProfile',{'email':email,'name':name},function(response){Le.removeButtonLoadingIndicator(currentLink);if(response.response!=""){mQuery('#sender_profile_errors').html(response.response);}else{Le.changeSenderProfileStatusFrontEnd(true,email,id);}});});Le.hideFlashMessage();Le.smsconfigOnLoad(container);mQuery('a[data-toggle="tab"]').off().on('click',function(){Le.hideConfigButtonsByTabSelect(mQuery(this).attr('href'));});var selectedConfigtab=mQuery("ul[class='list-group list-group-tabs']").find("li[class='list-group-item in active']").find("a[class='steps']");var sendingdomainbuttonid="config_buttons_sendingdomain_toolbar";if(Le.isMobile()){sendingdomainbuttonid="config_buttons_sendingdomain_toolbar_mobile";}
mQuery('#'+sendingdomainbuttonid).click(function(e){e.preventDefault();mQuery('#sender_domain_name').val('');mQuery('#sender_domain_name_errors').html('');mQuery('#sendingdomaincreateModel').modal('show');});mQuery('.sender_domain_add_btn').click(function(e){e.preventDefault();var currentLink=mQuery(this);var $url=window.location.href;var domain=mQuery('#sender_domain_name').val();if(domain==""){mQuery('#sender_domain_name_errors').html("domain name can't be empty !");return;}
if(domain.indexOf('www')!=-1||domain.indexOf('WWW')!=-1||domain.indexOf('http')!=-1||domain.indexOf('https')!=-1||domain.indexOf('empty')!=-1){mQuery('#sender_domain_name_errors').html("You can't use reserved keys like www,http,https");return;}
if($url.indexOf('//cops.')==-1){if(domain.indexOf('anyfunnels.net')!=-1||domain.indexOf('anyfunnels.com')!=-1||domain.indexOf('anyfunnels.io')!=-1){mQuery('#sender_domain_name_errors').html("You can't add reserved domains");return;}}
Le.activateButtonLoadingIndicator(currentLink);Le.ajaxActionRequest('email:senderDomainCreate',{'domain':domain},function(response){Le.removeButtonLoadingIndicator(currentLink);if(response.success){mQuery('.sending-domain-container').html(response.content);mQuery('#sendingdomaincreateModel').modal('hide');Le.refreshSendingDomainListeners();Le.deactivateBackgroup();}else{mQuery('#sender_domain_name_errors').html(response.message);return;}});});Le.refreshSendingDomainListeners();}
Le.refreshSendingDomainListeners=function(){mQuery('.verify-sending-domain').click(function(e){e.preventDefault();mQuery('#sendingdomainverifyModel .spf-validation-status').html('<i class="fa fa-spin fa-spinner"></i>');mQuery('#sendingdomainverifyModel .dkim-validation-status').html('<i class="fa fa-spin fa-spinner"></i>');mQuery('#sendingdomainverifyModel .dmark-validation-status').html('<i class="fa fa-spin fa-spinner"></i>');var currentLink=mQuery(this);var domain=currentLink.attr("data-domain");mQuery('#sendingdomainverifyModel').modal('show');Le.ajaxActionRequest('email:senderDomainValidation',{'domain':domain},function(response){if(response.success){Le.deactivateBackgroup();mQuery('.sending-domain-container').html(response.content);if(response.spf_check){mQuery('#sendingdomainverifyModel .spf-validation-status').html('<i class="fa fa-check-circle on-left" style="color:green;"></i> Valid');}else{mQuery('#sendingdomainverifyModel .spf-validation-status').html('<i class="fa fa-times-circle  on-left" style="color:red;"></i> Error: Could not find the valid TXT record, <a onclick="Le.openSendingDomainHelp(\'spf\')" style="color:blue;text-decoration: underline;" data-help="spf">Click here</a> to know more about SPF configuration.');}
if(response.dkim_check){mQuery('#sendingdomainverifyModel .dkim-validation-status').html('<i class="fa fa-check-circle on-left" style="color:green;"></i> Valid');}else{mQuery('#sendingdomainverifyModel .dkim-validation-status').html('<i class="fa fa-times-circle  on-left" style="color:red;"></i> Error: Could not find the valid DKIM record, <a onclick="Le.openSendingDomainHelp(\'dkim\')" style="color:blue;text-decoration: underline;">Click here</a> to know more about DKIM configuration.');}
if(response.dmark_check){mQuery('#sendingdomainverifyModel .dmark-validation-status').html('<i class="fa fa-check-circle on-left" style="color:green;"></i> Valid');}else{mQuery('#sendingdomainverifyModel .dmark-validation-status').html('<i class="fa fa-times-circle  on-left" style="color:red;"></i> Error: Could not find the valid DMARC record');}
Le.refreshSendingDomainListeners();}});});mQuery('.remove-sending-domain').click(function(e){e.preventDefault();var currentLink=mQuery(this);var domain=currentLink.attr("data-domain");Le.activateButtonLoadingIndicator(currentLink);Le.ajaxActionRequest('email:senderDomainDelete',{'domain':domain},function(response){Le.removeButtonLoadingIndicator(currentLink);if(response.success){Le.deactivateBackgroup();}else{Le.successModel('Error!',response.message,'error');}
mQuery('.sending-domain-container').html(response.content);Le.refreshSendingDomainListeners();});});mQuery('.default-sending-domain').click(function(e){e.preventDefault();var currentLink=mQuery(this);var domain=currentLink.attr("data-domain");Le.activateButtonLoadingIndicator(currentLink);Le.ajaxActionRequest('email:senderDomainDefault',{'domain':domain},function(response){Le.removeButtonLoadingIndicator(currentLink);if(response.success){Le.deactivateBackgroup();mQuery('.sending-domain-container').html(response.content);Le.refreshSendingDomainListeners();}else{Le.successModel('Error!',response.message,'error');}});});mQuery('.sending-domain-container .ecircle').click(function(e){e.preventDefault();var currentLink=mQuery(this);var parentEl=currentLink.parent();var help=parentEl.attr("data-help");Le.openSendingDomainHelp(help);});}
Le.openSendingDomainHelp=function(help){mQuery('#sendingdomain'+help+'HelpModel').modal('show');};Le.updateEmailStatus=function(){mQuery('#config_emailconfig_email_status').val('InActive');mQuery('#config_emailconfig_email_status').removeClass('status_success');mQuery('#config_emailconfig_email_status').addClass('status_fail');mQuery('#config_emailconfig_email_status').css('border-color','#ff0000');Le.updateSenderProfileStatus();}
Le.updateSenderProfileStatus=function(){Le.ajaxActionRequest('email:DisableAllSenderProfile',{},function(response){if(response.success){mQuery('.pending_verify_button').html("Pending");mQuery('.pending_verify_button').css('background','#ff4d4d');mQuery('.verify_sender_profile_btn').removeClass('hide');return;}});}
Le.changeSenderProfileStatusFrontEnd=function(isActive,fromemail,id){if(isActive){mQuery('#pending-verified-button-'+id).html("Verified");mQuery('#pending-verified-button-'+id).css('background','#39ac73');mQuery('#re-verify-button-'+id).addClass('hide');}else{mQuery('#pending-verified-button-'+id).html("Pending");mQuery('#pending-verified-button-'+id).css('background','#ff4d4d');mQuery('#re-verify-button-'+id).removeClass('hide');}
return;}
Le.hideConfigButtonsByTabSelect=function(tabSelect){if(tabSelect=='#sendingdomain_config'){mQuery("#config_buttons_cancel_toolbar").addClass("hide");mQuery("#config_buttons_save_toolbar").addClass("hide");mQuery("#config_buttons_apply_toolbar").addClass("hide");mQuery(".sendingdomain_config").removeClass("hide");}else{mQuery("#config_buttons_cancel_toolbar").removeClass("hide");mQuery("#config_buttons_save_toolbar").removeClass("hide");mQuery("#config_buttons_apply_toolbar").removeClass("hide");mQuery("#config_buttons_sendingdomain_toolbar").addClass("hide");}};Le.dripemailOnLoad=function(container,response){Le.initSelectBeeTemplate(mQuery('#emailform_template'),'dripemail');Le.initEmailDynamicContent();Le.leadlistOnLoad(container);mQuery('#unsubscribe_text_div').find('.fr-element').attr('style','min-height:100px;');var url=window.location.href;if(url.indexOf('emails/edit')!=-1){if(mQuery('textarea.builder-html').val()!='false'&&mQuery('textarea.builder-html').val().indexOf("false")<0&&mQuery('textarea.builder-html').val()!=''){}}
if(!mQuery("#fragment-4").hasClass('ui-tabs-hide')){mQuery('.scheduleEmailTest').removeClass('hide');}else{mQuery('.scheduleEmailTest').addClass('hide');}
mQuery('#dripemail_advance_editor .chosen-container-single').removeClass('hide');mQuery('.next-tab, .prev-tab, .ui-state-default').click(function(){var selectrel=mQuery(this).attr("rel");mQuery('#dripEmail_PublicName .help-block').addClass('hide').html("");mQuery('#dripEmail_PublicName').removeClass('has-success has-error');if(mQuery('#dripemailform_name').val()==""){mQuery('#dripEmail_PublicName').removeClass('has-success has-error').addClass('has-error');mQuery('#dripEmail_PublicName .custom-help').removeClass('hide').html("Campaign name can't be empty");return;}else{mQuery('#dripEmail_PublicName').removeClass('has-success has-error');mQuery('#dripEmail_PublicName .custom-help').html("");}
if(selectrel==4){mQuery('.scheduleEmailTest').removeClass('hide');}else{mQuery('.scheduleEmailTest').addClass('hide');}
mQuery(".ui-tabs-panel").addClass('ui-tabs-hide');mQuery("#fragment-"+selectrel).removeClass('ui-tabs-hide');mQuery(".ui-state-default").removeClass('ui-tabs-selected ui-state-active');mQuery("#ui-tab-header"+selectrel).addClass('ui-tabs-selected ui-state-active');});var url=window.location.href;if(url.indexOf('drip/edit')!=-1){Le.loadEmailsinDripStatCounts();}else if(url.indexOf('drip/view')!=-1){Le.loadEmailsViewDripStatCounts();}
Le.reorderEmailsData(container);Le.getTokens('email:getBuilderTokens',function(tokens){tokens=[];tokens['{leadfield=title}']='Title';tokens['{leadfield=firstname}']='First Name';tokens['{leadfield=lastname}']='Last Name';tokens['{leadfield=company_name}']='Company';tokens['{lead_owner_name}']='Lead Owner Name';tokens['{lead_owner_mobile}']='Lead Owner Mobile';tokens['{lead_owner_email}']='Lead Owner Email';var k,keys=[];for(k in tokens){if(tokens.hasOwnProperty(k)){keys.push(k);}}
var tborder="<div border='1' class='email-subject-table' ><tbody style='background-color:whitesmoke;'><tr>";for(var i=0;i<keys.length;i++){var val=keys[i];var title=tokens[val];if(i%3==0&&i!=0){tborder+="</tr><tr>";}
var value='<li class="email-subject-table-border"><a class="email-subject-token" id="insert-value" data-cmd="inserttoken" data-email-token="'+val+'" title="'+title+'">'+title+'</a></li>';tborder+=value;}
tborder+="</div>";mQuery('.insert-tokens').html(tborder);mQuery('[data-email-token]').click(function(e){e.preventDefault();var currentLink=mQuery(this);var value=currentLink.attr('data-email-token');var subValue=mQuery('#emailform_subject').val();if(subValue==''){mQuery("#emailform_subject").val(value);}else{if(subValue.includes(value)){}else{var cursorPos=mQuery('#emailform_subject').prop('selectionStart');var v=subValue;var textBefore=v.substring(0,cursorPos);var textAfter=v.substring(cursorPos,v.length);mQuery('#emailform_subject').val(textBefore+value+textAfter);}}});});mQuery('[data-verified-emails]').click(function(e){e.preventDefault();var currentLink=mQuery(this);var email=currentLink.attr('data-verified-emails');var name=currentLink.attr('data-verified-fromname');mQuery("#dripemailform_fromAddress").val(email);mQuery("#dripemailform_fromName").val(name);});Le.filterBeeTemplates=function(){d=document.getElementById("filters").value;if(d=="all"){mQuery('.bee-template').removeClass('hide');}else{mQuery('.bee-template').addClass('hide');mQuery('.'+d).removeClass('hide');}};Le.removeActionButtons();if(mQuery('#drip-email-delay').length){mQuery('#drip-email-delay .chosen-single').addClass('chosen-dripemail-single');}
Le.loadDripEmailStatCounts();Le.hideFlashMessage();if(mQuery('#dripEmail_PublicName').hasClass('has-error')||mQuery('#drip_daysEmailSend').hasClass('has-error')||mQuery('#email_FromAddress').hasClass('has-error')){mQuery('#ui-tab-header4').addClass('ui-tabs-selected ui-state-active');mQuery('#ui-tab-header3').removeClass('ui-tabs-selected ui-state-active');mQuery('#ui-tab-header2').removeClass('ui-tabs-selected ui-state-active');mQuery('#fragment-1').addClass('ui-tabs-hide');mQuery('#fragment-2').addClass('ui-tabs-hide');mQuery('#fragment-3').addClass('ui-tabs-hide');mQuery('#fragment-4').removeClass('ui-tabs-hide');}
mQuery('body').css('overflow-y','');};Le.loadDripEmailScheduledStatCounts=function(){if(mQuery('table.email-list').length){mQuery('td.drip-col-stats').each(function(){var id=mQuery(this).attr('data-stats');Le.ajaxActionRequest('email:getDripEmailScheduledCountStats',{id:id},function(response){if(response.success&&mQuery('#scheduled-count-'+id+' div').length){mQuery('#scheduled-count-'+id+' > a').html(response.scheduledcount);}},false,true);});}}
Le.loadDripEmailStatCounts=function(){if(mQuery('table.email-list').length){var ids=[];mQuery('tr.drip-email-col-stats').each(function(){var id=mQuery(this).attr('data-stats');ids.push(id);});while(ids.length>0){var batchIds=ids.splice(0,10);Le.ajaxActionRequest('email:getDripEmailStats',{ids:batchIds},function(response){if(response.success&&response.stats){for(var i=0;i<response.stats.length;i++){var stat=response.stats[i];if(mQuery('#drip-sent-count-'+stat.id).length){mQuery('#drip-sent-count-'+stat.id+' > a').html(stat.sentcount);mQuery('#drip-read-count-'+stat.id+' > a').html(stat.readcount);mQuery('#drip-click-count-'+stat.id+' > a').html(stat.clickcount);mQuery('#drip-unsubscribe-count-'+stat.id+' > a').html(stat.unsubscribe);mQuery('#drip-bounce-count-'+stat.id+' > a').html(stat.bouncecount);mQuery('#drip-spam-count-'+stat.id+' > a').html(stat.spam);mQuery('#drip-failed-count-'+stat.id+' > a').html(stat.failed);mQuery('#drip-lead-count-'+stat.id+' > a').html(stat.leadcount);mQuery('#drip-pending-count-'+stat.id+' > a').html(stat.pendingcount);}}}},false,true);}}}
Le.loadEmailsinDripStatCounts=function(){if(mQuery('table.dripemail-list').length){mQuery('tr.drip-emailcol-stats').each(function(){var id=mQuery(this).attr('data-stats');Le.ajaxActionRequest('email:getEmailsinDripCountStats',{id:id},function(response){if(response.success&&mQuery('#sent-count-'+id+' div').length){mQuery('#sent-count-'+id+' > a').html(response.sentCount);mQuery('#read-count-'+id+' > a').html(response.readCount);mQuery('#read-percent-'+id+' > a').html(response.readPercent);mQuery('#scheduled-count-'+id+' > a').html(response.scheduledcount);}},false,true);});}}
Le.loadEmailsViewDripStatCounts=function(){if(mQuery('table.dripemail-list').length){mQuery('tr.drip-emailcol-stats-view').each(function(){var id=mQuery(this).attr('data-stats');Le.ajaxActionRequest('email:getEmailsViewDripCountStats',{id:id},function(response){if(response.success&&mQuery('#sent-count-'+id+' div').length){mQuery('#sent-count-'+id+' > span').html(response.sentCount);mQuery('#read-count-'+id+' > span').html(response.readCount);mQuery('#not-read-count-'+id+' > span').html(response.noreadCount);mQuery('#read-percent-'+id+' > span').html(response.readPercent);mQuery('#unsubscribe-count-'+id+' > span').html(response.unsubscribeCount);mQuery('#bounced-count-'+id+' > span').html(response.bounceCount);mQuery('#spam-count-'+id+' > span').html(response.spamCount);mQuery('#failed-count-'+id+' > span').html(response.failedCount);}},false,true);});}}
Le.reorderEmailsData=function(container){if(mQuery(container+' .dripemail-list').length){var bodyOverflow={};mQuery(container+' .dripemail-list tbody').sortable({handle:'.fa-ellipsis-v',helper:function(e,ui){ui.children().each(function(){mQuery(this).width(mQuery(this).width());});bodyOverflow.overflowX=mQuery('body').css('overflow-x');bodyOverflow.overflowY=mQuery('body').css('overflow-y');mQuery('body').css({overflowX:'visible',overflowY:'visible'});return ui;},scroll:false,axis:'y',containment:container+' .dripemail-list',stop:function(e,ui){mQuery('body').css(bodyOverflow);var order=0;mQuery('tr.drip-emailcol-stats').each(function(){var id=mQuery(this).attr('data-stats');order=order+1;Le.ajaxActionRequest('email:reorderEmails',{id:id,order:order,totalsize:mQuery('tr.drip-emailcol-stats').length,},function(response){if(response.success){}},false,true);});}});}}
Le.setValueforNewButton=function(value,ele){mQuery('#new-drip-email').attr('value',value);mQuery('.editor_select').addClass('editor_layout').removeClass('editor_select');mQuery(ele).addClass('editor_select').removeClass('editor_layout');}
Le.openDripEmailEditor=function(){var editorname=mQuery('#new-drip-email').attr('value');if(editorname=="basic_editor"){mQuery('#emailform_customHtml').val('');}
editorname="dripemail_"+editorname;mQuery('#drip-email-container').removeClass('hide');mQuery('#drip-email-list-container').addClass('hide');mQuery('.dripemail_content').addClass('hide');mQuery('#'+editorname).removeClass('hide');mQuery('.newbutton-container').addClass('hide');mQuery('.saveclose-container').removeClass('hide');Le.showChangeThemeWarning=true;}
Le.saveDripEmail=function(dripEntity){var subject=mQuery('#emailform_subject').val();var previewText=mQuery('#emailform_previewText').val();var customHtml=mQuery('#emailform_customHtml').val();var beeJson=mQuery('#emailform_beeJSON').val();if(!Le.isValidEmailSave()){return false;}
var editorname=mQuery('#new-drip-email').attr('value');if(editorname=="basic_editor"){beeJson="";}
var data={subject:subject,previewText:previewText,customHtml:customHtml,beeJson:beeJson,dripEntity:dripEntity,};Le.ajaxActionRequest('email:createDripEmails',data,function(response){if(response.success){Le.refreshDripEmailList(response.content);mQuery('#emailform_subject').val('');mQuery('#emailform_previewText').val('');mQuery('#emailform_customHtml').val('');}});}
Le.updateDripEmail=function(){var Emailid=mQuery('#update-drip-email').attr('value');if(Emailid==""){return false;}
var subject=mQuery('#emailform_subject').val();var previewText=mQuery('#emailform_previewText').val();var customHtml=mQuery('#emailform_customHtml').val();var beeJson=mQuery('#emailform_beeJSON').val();if(!Le.isValidEmailSave()){return false;}
var data={subject:subject,previewText:previewText,customHtml:customHtml,Emailid:Emailid,};Le.ajaxActionRequest('email:updateDripEmails',data,function(response){if(response.success){Le.refreshDripEmailList(response.content);mQuery('#emailform_subject').val('');mQuery('#emailform_previewText').val('');mQuery('#emailform_customHtml').val('');}});}
Le.isValidEmailSave=function(){var subject=mQuery('#emailform_subject').val();if(subject==''){mQuery('#DripEmail_Subject').removeClass('has-success has-error').addClass('has-error');mQuery('#DripEmail_Subject .custom-help').removeClass('hide').html("Subject can't be empty");return false;}
return true;}
Le.removeEmailfromDrip=function(Emailid,DripEmail){if(confirm(Le.translate('You are removing one of the emails in this drip campaign. Existing scheduled leads would no longer receive this email.'))){var data={emailId:Emailid,dripEmail:DripEmail};Le.ajaxActionRequest('email:deleteDripEmails',data,function(response){if(response.success){Le.refreshDripEmailList(response.content);Le.reorderEmailsData('#app-content');}});}else{return;}}
Le.refreshDripEmailList=function(content){mQuery('.newbutton-container').removeClass('hide');mQuery('.saveclose-container').addClass('hide');mQuery('.update-container').addClass('hide');mQuery('#drip-email-container').addClass('hide');mQuery('#drip-email-list-container').removeClass('hide');mQuery('#drip-email-list-container').html('');mQuery('#drip-email-list-container').html(content);if(!Le.isMobile()){Le.activateChosenSelect(mQuery('.dripemail_form_scheduleTime'),true);}
if(mQuery('#drip-email-delay').length){mQuery('#drip-email-delay .chosen-single').addClass('chosen-dripemail-single')}
Le.loadEmailsinDripStatCounts();}
Le.editSelectedEmail=function(){mQuery('.newbutton-container').addClass('hide');mQuery('.saveclose-container').addClass('hide');mQuery('.update-container').removeClass('hide');mQuery('#drip-email-container').removeClass('hide');mQuery('#drip-email-list-container').addClass('hide');mQuery('#drip-email-list-container').html('');}
Le.updateFrequencyValue=function(EmailId){var frequencyUnit=mQuery('#drip_emailform_scheduleTime-'+EmailId).val();Le.updateDripEmailFrequency(frequencyUnit,EmailId);}
Le.updateDripEmailFrequency=function(frequencyUnit,EmailId){var frequencyValue=mQuery('#drip-email-frequency-value-'+EmailId).val();var data={frequencyUnit:frequencyUnit,frequencyValue:frequencyValue,EmailId:EmailId};Le.ajaxActionRequest('email:updateDripEmailFrequency',data,function(response){if(response.success){}});}
Le.allowEditEmailfromDrip=function(emailId){var data={Emailid:emailId};Le.ajaxActionRequest('email:getEmailDetails',data,function(response){if(response.success){Le.editSelectedEmail();mQuery('#update-drip-email').attr('value',response.Emailid);mQuery('#emailform_subject').val(response.subject);mQuery('#emailform_previewText').val(response.preview);mQuery('#emailform_customHtml').val(response.emailcontent);if(response.emailcontent!=""){mQuery('.dripemail_content .fr-placeholder').attr('style','display:none;');}
mQuery('.dripemail_content .fr-element').html(response.emailcontent);mQuery('#emailform_beeJSON').val(response.beeJSON);if(!response.isBeeEditor){mQuery('#dripemail_basic_editor').removeClass('hide');mQuery('#dripemail_advance_editor').addClass('hide');}else{Le.showdripEmailpreviewoftemplate(response.emailcontent);mQuery('#dripemail_basic_editor').addClass('hide');}}});}
Le.openBluePrintPage=function(){mQuery('.drip-blue-prints').removeClass('hide');mQuery('.dripemail-body').addClass('hide');mQuery('body').css('overflow','hidden');}
Le.closeBluePrintPage=function(){mQuery('.drip-blue-prints').addClass('hide');mQuery('.dripemail-body').removeClass('hide');mQuery('body').css('overflow','');}
Le.useBluePrintDrip=function(ele){var dripId=mQuery(ele).attr('value');var currentId=mQuery(ele).attr('dripvalue');var data={dripId:dripId,currentId:currentId};Le.ajaxActionRequest('email:createBlueprintEmails',data,function(response){if(response.success){Le.closeBluePrintPage();Le.refreshDripEmailList(response.content);Le.reorderEmailsData('#app-content');}});}
Le.ClearScheduleTimeWidget=function(){mQuery('#dripemailform_scheduleDate').val('');}
Le.toggleDripEmailPublisedListVisibility=function(){setTimeout(function(){var warningtxt="This campaign does not have any emails. Would you like to continue with activation?";if(mQuery('table.dripemail-list').length){warningtxt="Are you sure you want to activate this Campaign? Recipients will start receiving the emails as you configured in this campaign.";}
if(mQuery('#dripemailform_isPublished_1').prop('checked')){if(confirm(Le.translate(warningtxt))){}else{mQuery('#dripemailform_isPublished_0').prop('checked',true);mQuery('#dripemailform_isPublished_1').prop('checked',false);Le.toggleYesNoButtonClass('dripemailform_isPublished_0');mQuery('#dripemailform_isPublished_1').parent().removeClass('active');mQuery('#dripemailform_isPublished_0').parent().addClass('active');}}},10);};Le.activateDripAction=function(isPublish){if(mQuery('#dripemailform_name').val()!=''){if(isPublish=="activate"){mQuery('#dripemailform_isPublished_0').prop('checked',false);mQuery('#dripemailform_isPublished_1').prop('checked',true);mQuery('#dripemailform_isPublished_1').parent().addClass('active');mQuery('#dripemailform_isPublished_0').parent().removeClass('active');Le.toggleYesNoButtonClass('dripemailform_isPublished_1');}else{mQuery('#dripemailform_isPublished_0').prop('checked',true);mQuery('#dripemailform_isPublished_1').prop('checked',false);mQuery('#dripemailform_isPublished_1').parent().removeClass('active');mQuery('#dripemailform_isPublished_0').parent().addClass('active');Le.toggleYesNoButtonClass('dripemailform_isPublished_0');}}
var bgSaveBtn=mQuery('.btn-save');bgSaveBtn.trigger('click');};;Le.emailOnLoad=function(container,response){if(mQuery('#emailform_plainText').length){Le.leadlistOnLoad(container);var plaintext=mQuery('#emailform_plainText');Le.initAtWho(plaintext,plaintext.attr('data-token-callback'));Le.initSelectBeeTemplate(mQuery('#emailform_template'),'email');Le.initEmailDynamicContent();Le.prepareVersioning(function(content){console.log('undo');},function(content){console.log('redo');});if(response&&response.inBuilder){Le.isInBuilder=true;Le.launchBuilder('emailform');Le.processBuilderErrors(response);}}else if(mQuery(container+' #list-search').length){Le.activateSearchAutocomplete('list-search','email');}
mQuery('#unsubscribe_text_div').find('.fr-element').attr('style','min-height:100px;');mQuery(".ui-tabs-panel").each(function(i){var totalSize=mQuery(".ui-tabs-panel").size()-1;if(i!=totalSize){if(i==0){}
next=i+2;}
if(i!=0){prev=i;}});if(!mQuery("#fragment-3").hasClass('ui-tabs-hide')){mQuery('.sendEmailTest').removeClass('hide');}else{mQuery('.sendEmailTest').addClass('hide');}
mQuery('.next-tab, .prev-tab, .ui-state-default').click(function(){var selectrel=mQuery(this).attr("rel");if(mQuery("#ui-tab-header"+selectrel).hasClass('disable_ele')){var prevrel=parseInt(selectrel,10)-1;var nextrel=parseInt(selectrel,10)+1;if(mQuery("#ui-tab-header"+prevrel).hasClass('ui-tabs-selected ui-state-active')){selectrel=nextrel;}else{selectrel=prevrel;}}
mQuery('#Email_TemplateName').removeClass('has-success has-error');mQuery('#Email_Subject').removeClass('has-success has-error');mQuery('#leadlists').removeClass('has-success has-error');mQuery('#Email_TemplateName .help-block').addClass('hide').html("");mQuery('#Email_Subject .help-block').addClass('hide').html("");mQuery('#leadlists .help-block').addClass('hide').html("");if(mQuery('#emailform_name').val()==""&&mQuery('#emailform_subject').val()==""){mQuery('#Email_TemplateName').removeClass('has-success has-error').addClass('has-error');mQuery('#Email_TemplateName .custom-help').removeClass('hide').html("Campaign name can't be empty");mQuery('#Email_Subject').removeClass('has-success has-error').addClass('has-error');mQuery('#Email_Subject .custom-help').removeClass('hide').html("Subject can't be empty");return;}else{mQuery('#Email_TemplateName').removeClass('has-success has-error');mQuery('#Email_TemplateName .custom-help').html("");mQuery('#Email_Subject').removeClass('has-success has-error');mQuery('#Email_Subject .custom-help').html("");}
if(mQuery('#emailform_name').val()==""){mQuery('#Email_TemplateName').removeClass('has-success has-error').addClass('has-error');mQuery('#Email_TemplateName .custom-help').removeClass('hide').html("Campaign name can't be empty");return;}else{mQuery('#Email_TemplateName').removeClass('has-success has-error');mQuery('#Email_TemplateName .custom-help').html("");}
if(mQuery('#emailform_subject').val()==""){mQuery('#Email_Subject').removeClass('has-success has-error').addClass('has-error');mQuery('#Email_Subject .custom-help').removeClass('hide').html("Subject can't be empty");return;}else{mQuery('#Email_Subject').removeClass('has-success has-error');mQuery('#Email_Subject .custom-help').html("");}
if(mQuery('#emailform_variantSettings_weight').val()==""&&mQuery('#emailform_variantSettings_winnerCriteria').val()==""){mQuery('#Email_trafficweight').removeClass('has-success has-error').addClass('has-error');mQuery('#Email_trafficweight .help-block').html("Traffic Weight can't be empty");mQuery('#Email_winnercriteria').removeClass('has-success has-error').addClass('has-error');mQuery('#Email_winnercriteria .help-block').html("Winner Criteria can't be empty");return;}else{mQuery('#Email_trafficweight').removeClass('has-success has-error');mQuery('#Email_trafficweight .help-block').html("");mQuery('#Email_winnercriteria').removeClass('has-success has-error');mQuery('#Email_winnercriteria .help-block').html("");}
if(mQuery('#emailform_variantSettings_weight').val()==""){mQuery('#Email_trafficweight').removeClass('has-success has-error').addClass('has-error');mQuery('#Email_trafficweight .help-block').html("Traffic Weight can't be empty");return;}else{mQuery('#Email_trafficweight').removeClass('has-success has-error');mQuery('#Email_trafficweight .help-block').html("");}
if(mQuery('#emailform_variantSettings_winnerCriteria').val()==""){mQuery('#Email_winnercriteria').removeClass('has-success has-error').addClass('has-error');mQuery('#Email_winnercriteria .help-block').html("Winner Criteria can't be empty");return;}else{mQuery('#Email_winnercriteria').removeClass('has-success has-error');mQuery('#Email_winnercriteria .help-block').html("");}
if(!mQuery('#email-advance-container').hasClass('hide')){if(selectrel==4&&!mQuery(this).hasClass('ui-state-default')){}
var url=window.location.href;if(url.indexOf('broadcast/new')==-1&&mQuery('textarea.bee-editor-json').val()!="RichTextEditor"){if(mQuery('textarea.builder-html').val()!='false'&&mQuery('textarea.builder-html').val().indexOf("false")<0&&mQuery('textarea.builder-html').val()!=''){}}}
mQuery(".ui-tabs-panel").addClass('ui-tabs-hide');mQuery("#fragment-"+selectrel).removeClass('ui-tabs-hide');mQuery(".ui-state-default").removeClass('ui-tabs-selected ui-state-active');mQuery("#ui-tab-header"+selectrel).addClass('ui-tabs-selected ui-state-active');if(selectrel==3){mQuery('.sendEmailTest').removeClass('hide');}else{mQuery('.sendEmailTest').addClass('hide');}
if(mQuery('#ui-tab-header3').hasClass('ui-tabs-selected'))
{if(!mQuery('#email-content-preview').hasClass('hide')){mQuery('#builder_btn').removeClass('hide');}else{mQuery('#builder_btn').addClass('hide');}}else{mQuery('#builder_btn').addClass('hide');}});if(mQuery('#Email_TemplateName').hasClass('has-error')){mQuery("#ui-tab-header3").addClass('ui-tabs-selected ui-state-active');mQuery("#ui-tab-header2").removeClass('ui-tabs-selected ui-state-active');mQuery("#ui-tab-header1").removeClass('ui-tabs-selected ui-state-active');mQuery("#fragment-1").addClass('ui-tabs-hide');mQuery("#fragment-2").addClass('ui-tabs-hide');mQuery("#fragment-3").removeClass('ui-tabs-hide');}
Le.loadEmailStatCounts();Le.getTokens('email:getBuilderTokens',function(tokens){tokens=[];tokens['{leadfield=title}']='Title';tokens['{leadfield=firstname}']='First Name';tokens['{leadfield=lastname}']='Last Name';tokens['{leadfield=company_name}']='Company';tokens['{lead_owner_name}']='Lead Owner Name';tokens['{lead_owner_mobile}']='Lead Owner Mobile';tokens['{lead_owner_email}']='Lead Owner Email';var k,keys=[];for(k in tokens){if(tokens.hasOwnProperty(k)){keys.push(k);}}
var tborder="<div border='1' class='email-subject-table' ><tbody style='background-color:whitesmoke;'><tr>";for(var i=0;i<keys.length;i++){var val=keys[i];var title=tokens[val];if(i%3==0&&i!=0){tborder+="</tr><tr>";}
var value='<li class="email-subject-table-border"><a class="email-subject-token" id="insert-value" data-cmd="inserttoken" data-email-token="'+val+'" title="'+title+'">'+title+'</a></li>';tborder+=value;}
tborder+="</div>";mQuery('.insert-tokens').html(tborder);mQuery('[data-email-token]').click(function(e){e.preventDefault();var currentLink=mQuery(this);var value=currentLink.attr('data-email-token');var subValue=mQuery('#emailform_subject').val();if(subValue==''){mQuery("#emailform_subject").val(value);}else{if(subValue.includes(value)){}else{var cursorPos=mQuery('#emailform_subject').prop('selectionStart');var v=subValue;var textBefore=v.substring(0,cursorPos);var textAfter=v.substring(cursorPos,v.length);mQuery('#emailform_subject').val(textBefore+value+textAfter);}}});});mQuery('[data-verified-emails]').click(function(e){e.preventDefault();var currentLink=mQuery(this);var email=currentLink.attr('data-verified-emails');var name=currentLink.attr('data-verified-fromname');mQuery("#emailform_fromAddress").val(email);mQuery("#emailform_fromName").val(name);});Le.filterBeeTemplates=function(){d=document.getElementById("template_filters").value;if(d=="all"){mQuery('.bee-template').removeClass('hide');}else{mQuery('.bee-template').addClass('hide');mQuery('.'+d).removeClass('hide');}};Le.removeActionButtons();if(mQuery('.filter-field-segment').hasClass('has-error')){mQuery('#ui-tab-header2').click();}};Le.loadEmailStatCounts=function(){if(mQuery('table.email-list').length){var ids=[];mQuery('tr.email-row-stats').each(function(){var id=mQuery(this).attr('data-stats');ids.push(id);});while(ids.length>0){var batchIds=ids.splice(0,10);Le.ajaxActionRequest('email:getEmailCountStats',{ids:batchIds},function(response){if(response.success&&response.stats){for(var i=0;i<response.stats.length;i++){var stat=response.stats[i];if(mQuery('#sent-count-'+stat.id).length){if(stat.queued){mQuery('#queued-'+stat.id+' > a').html(stat.queued);mQuery('#queued-'+stat.id).removeClass('hide');}
mQuery('#pending-'+stat.id+' > a').html(stat.pending);mQuery('#sent-count-'+stat.id+' > a').html(stat.sentCount);mQuery('#read-count-'+stat.id+' > a').html(stat.readCount);mQuery('#read-percent-'+stat.id+' > a').html(stat.readPercent);mQuery('#failure-count-'+stat.id+' > a').html(stat.failureCount);mQuery('#unsubscribe-count-'+stat.id+' > a').html(stat.unsubscribeCount);mQuery('#bounce-count-'+stat.id+' > a').html(stat.bounceCount);mQuery('#spam-count-'+stat.id+' > a').html(stat.spamCount);mQuery('#failed-count-'+stat.id+' > a').html(stat.failedCount);}}}},false,true);}}}
Le.emailOnUnload=function(id){if(id==='#app-content'){delete Le.listCompareChart;}
if(typeof Le.ajaxActionXhrQueue!=='undefined'){delete Le.ajaxActionXhrQueue['email:getEmailCountStats'];}};Le.opengoogletags=function(id){if(id=='emailform_google_tags_1'){mQuery(".gtags").removeClass('hide');Le.toggleYesNoButtonClass(id);}else{Le.toggleYesNoButtonClass(id);mQuery(".gtags").addClass('hide');}};Le.insertEmailBuilderToken=function(editorId,token){var editor=Le.getEmailBuilderEditorInstances();editor[instance].insertText(token);};Le.getEmailAbTestWinnerForm=function(abKey){if(abKey&&mQuery(abKey).val()&&mQuery(abKey).closest('.form-group').hasClass('has-error')){mQuery(abKey).closest('.form-group').removeClass('has-error');if(mQuery(abKey).next().hasClass('help-block')){mQuery(abKey).next().remove();}}
Le.activateLabelLoadingIndicator('emailform_variantSettings_winnerCriteria');var emailId=mQuery('#emailform_sessionId').val();var query="action=email:getAbTestForm&abKey="+mQuery(abKey).val()+"&emailId="+emailId;mQuery.ajax({url:leAjaxUrl,type:"POST",data:query,dataType:"json",success:function(response){if(typeof response.html!='undefined'){if(mQuery('#emailform_variantSettings_properties').length){mQuery('#emailform_variantSettings_properties').replaceWith(response.html);}else{mQuery('#emailform_variantSettings').append(response.html);}
if(response.html!=''){Le.onPageLoad('#emailform_variantSettings_properties',response);}}},error:function(request,textStatus,errorThrown){Le.processAjaxError(request,textStatus,errorThrown);},complete:function(){Le.removeLabelLoadingIndicator();}});};Le.submitSendForm=function(){Le.dismissConfirmation();mQuery('.btn-send').prop('disabled',true);mQuery('form[name=\'batch_send\']').submit();};Le.emailSendOnLoad=function(container,response){if(mQuery('.email-send-progress').length){if(!mQuery('#emailSendProgress').length){Le.clearModeratedInterval('emailSendProgress');}else{Le.setModeratedInterval('emailSendProgress','sendEmailBatch',2000);}}};Le.emailSendOnUnload=function(){if(mQuery('.email-send-progress').length){Le.clearModeratedInterval('emailSendProgress');if(typeof Le.sendEmailBatchXhr!='undefined'){Le.sendEmailBatchXhr.abort();delete Le.sendEmailBatchXhr;}}};Le.sendEmailBatch=function(){var data='id='+mQuery('.progress-bar-send').data('email')+'&pending='+mQuery('.progress-bar-send').attr('aria-valuemax')+'&batchlimit='+mQuery('.progress-bar-send').data('batchlimit');Le.sendEmailBatchXhr=Le.ajaxActionRequest('email:sendBatch',data,function(response){if(response.progress){if(response.progress[0]>0){mQuery('.imported-count').html(response.progress[0]);mQuery('.progress-bar-send').attr('aria-valuenow',response.progress[0]).css('width',response.percent+'%');mQuery('.progress-bar-send span.sr-only').html(response.percent+'%');}
if(response.progress[0]>=response.progress[1]){Le.clearModeratedInterval('emailSendProgress');setTimeout(function(){mQuery.ajax({type:'POST',showLoadingBar:false,url:window.location,data:'complete=1',success:function(response){if(response.newContent){Le.processPageContent(response);}}});},1000);}}
Le.moderatedIntervalCallbackIsComplete('emailSendProgress');});};Le.autoGeneratePlaintext=function(){mQuery('.plaintext-spinner').removeClass('hide');Le.ajaxActionRequest('email:generatePlaintText',{id:mQuery('#emailform_sessionId').val(),custom:mQuery('#emailform_customHtml').val()},function(response){mQuery('#emailform_plainText').val(response.text);mQuery('.plaintext-spinner').addClass('hide');});};Le.selectEmailType=function(emailType){if(emailType=='list'){mQuery('#leadList').removeClass('hide');mQuery('#segmentTranslationParent').removeClass('hide');mQuery('#templateTranslationParent').addClass('hide');mQuery('.page-header h3').text(leLang.newListEmail);}else{mQuery('#segmentTranslationParent').addClass('hide');mQuery('#templateTranslationParent').removeClass('hide');mQuery('#leadList').addClass('hide');mQuery('.page-header h3').text(leLang.newTemplateEmail);}
mQuery('#emailform_emailType').val(emailType);mQuery('body').removeClass('noscroll');mQuery('.email-type-modal').remove();mQuery('.email-type-modal-backdrop').remove();};Le.selectEmailEditor=function(editorType){var basic=mQuery('#email-basic-container');var advance=mQuery('#email-advance-container');var other=mQuery('#email-other-container');var builderbtn=mQuery('.btn-beeditor');var activateTab='';if(editorType=='basic'||editorType=='code'){advance.addClass('hide');builderbtn.addClass('hide');var textarea=mQuery('textarea.bee-editor-json');textarea.val("RichTextEditor");mQuery('#emailform_template').val('');Le.beeTemplate="";activateTab='basic';}else{mQuery('#unsubscribe_text_div').addClass('hide');var templateJSON=mQuery('textarea.bee-editor-json');if(!templateJSON.length||!templateJSON.val().length){Le.setBeeTemplateJSON(Le.beeTemplate);}
advance.removeClass('hide');mQuery('#next-tab-3').attr('style','margin-left:74.7%;');mQuery('#previous-button-3').attr('style','margin-left:-15.9%;');mQuery('#email-2-button-div').attr('style','margin-right:148px;');mQuery('#open_editor_email_button').removeClass('hide');basic.addClass('hide');activateTab='advance';}
var fromAddress=mQuery('[for=emailform_fromAddress]');var fromAddressParent=fromAddress.parent();if(fromAddressParent.hasClass('has-error')){activateTab='other';}
if(activateTab=='basic'){basic.trigger('click');if(editorType=='code'){var editor=mQuery('.builder-html').data('froala.editor');editor.commands.exec('html');}
mQuery('#filters_chosen').addClass('hide');}else if(activateTab=='advance'){advance.trigger('click');}else{other.trigger('click');}
mQuery('.email-type-modal').remove();mQuery('.email-type-modal-backdrop').remove();};Le.getTotalAttachmentSize=function(){var assets=mQuery('#emailform_assetAttachments').val();if(assets){assets={'assets':assets};Le.ajaxActionRequest('email:getAttachmentsSize',assets,function(response){if(response.size=="failed"){mQuery('#Emailasset_Attachments').removeClass('has-success has-error').addClass('has-error');mQuery('#Emailasset_Attachments .help-block').html("This attachment exceeds the limit, and you can attach a maximum 1 MB of file size in total.");}else{mQuery('#Emailasset_Attachments').removeClass('has-success has-error');mQuery('#Emailasset_Attachments .help-block').html("");mQuery('#attachment-size').text(response.size);}});}else{mQuery('#attachment-size').text('0');}};Le.standardEmailUrl=function(options){if(options&&options.windowUrl&&options.origin){var url=options.windowUrl;var editEmailKey='/broadcast/edit/emailId';var previewEmailKey='/broadcast/preview/emailId';if(options.origin=='#campaignevent_properties_useremail_email'||options.origin=='#formaction_properties_useremail_email'){previewEmailKey='/emailnotifications/preview/emailId';}
if(url.indexOf(editEmailKey)>-1||url.indexOf(previewEmailKey)>-1){options.windowUrl=url.replace('emailId',mQuery(options.origin).val());}}
return options;};Le.disabledEmailAction=function(opener,origin){if(typeof opener=='undefined'){opener=window;}
var email=opener.mQuery(origin);if(email.length==0)return;var emailId=email.val();var disabled=emailId===''||emailId===null;opener.mQuery('[id$=_editEmailButton]').prop('disabled',disabled);opener.mQuery('[id$=_previewEmailButton]').prop('disabled',disabled);};Le.initEmailDynamicContent=function(){if(mQuery('#dynamic-content-container').length){mQuery('#emailFilters .remove-selected').each(function(index,el){mQuery(el).on('click',function(){mQuery(this).closest('.panel').animate({'opacity':0},'fast',function(){mQuery(this).remove();});if(!mQuery('#emailFilters li:not(.placeholder)').length){mQuery('#emailFilters li.placeholder').removeClass('hide');}else{mQuery('#emailFilters li.placeholder').addClass('hide');}});});mQuery('#addNewDynamicContent').on('click',function(e){e.preventDefault();Le.createNewDynamicContentItem();});Le.initDynamicContentItem();}};Le.createNewDynamicContentItem=function(jQueryVariant){var mQuery=(typeof jQueryVariant!='undefined')?jQueryVariant:window.mQuery;var tabHolder=mQuery('#dynamicContentTabs');var filterHolder=mQuery('#dynamicContentContainer');var dynamicContentPrototype=mQuery('#dynamicContentPrototype').data('prototype');var dynamicContentIndex=tabHolder.find('li').length-1;while(mQuery('#emailform_dynamicContent_'+dynamicContentIndex).length>0){dynamicContentIndex++;}
var tabId='#emailform_dynamicContent_'+dynamicContentIndex;var tokenName='Dynamic Content '+(dynamicContentIndex+1);var newForm=dynamicContentPrototype.replace(/__name__/g,dynamicContentIndex);var newTab=mQuery('<li><a role="tab" data-toggle="tab" href="'+tabId+'">'+tokenName+'</a></li>');tabHolder.append(newTab);filterHolder.append(newForm);var itemContainer=mQuery(tabId);var textarea=itemContainer.find('.editor');var firstInput=itemContainer.find('input[type="text"]').first();textarea.froalaEditor(mQuery.extend({},Le.basicFroalaOptions,{toolbarSticky:false,toolbarButtons:['undo','redo','|','bold','italic','underline','paragraphFormat','fontFamily','fontSize','color','align','formatOL','formatUL','quote','clearFormatting','token','insertLink','insertImage','insertTable','html','fullscreen'],heightMin:100}));tabHolder.find('i').first().removeClass('fa-spinner fa-spin').addClass('fa-plus text-success');newTab.find('a').tab('show');firstInput.focus();Le.updateDynamicContentDropdown();Le.initDynamicContentItem(tabId,mQuery,tokenName);return tabId;};Le.createNewDynamicContentFilter=function(el,jQueryVariant){var mQuery=(typeof jQueryVariant!='undefined')?jQueryVariant:window.mQuery;var $this=mQuery(el);var parentElement=$this.parents('.panel');var tabHolder=parentElement.find('.nav');var filterHolder=parentElement.find('.tab-content');var filterBlockPrototype=mQuery('#filterBlockPrototype');var filterIndex=filterHolder.find('.tab-pane').length-1;var dynamicContentIndex=$this.parents('.tab-pane').attr('id').match(/\d+$/)[0];var filterPrototype=filterBlockPrototype.data('prototype');var filterContainerId='#emailform_dynamicContent_'+dynamicContentIndex+'_filters_'+filterIndex;while(mQuery(filterContainerId).length>0){filterIndex++;filterContainerId='#emailform_dynamicContent_'+dynamicContentIndex+'_filters_'+filterIndex;}
var newTab=mQuery('<li><a role="tab" data-toggle="tab" href="'+filterContainerId+'">Variation '+(filterIndex+1)+'</a></li>');var newForm=filterPrototype.replace(/__name__/g,filterIndex).replace(/dynamicContent_0_filters/g,'dynamicContent_'+dynamicContentIndex+'_filters').replace(/dynamicContent]\[0]\[filters/g,'dynamicContent]['+dynamicContentIndex+'][filters');tabHolder.append(newTab);filterHolder.append(newForm);var filterContainer=mQuery(filterContainerId);var availableFilters=filterContainer.find('select[data-le="available_filters"]');var altTextarea=filterContainer.find('.editor');var removeButton=filterContainer.find('.remove-item');Le.activateChosenSelect(availableFilters,false,mQuery);availableFilters.on('change',function(){var $this=mQuery(this);if($this.val()){Le.addDynamicContentFilter($this.val(),mQuery);$this.val('');$this.trigger('chosen:updated');}});altTextarea.froalaEditor(mQuery.extend({},Le.basicFroalaOptions,{toolbarSticky:false,toolbarButtons:['undo','redo','|','bold','italic','underline','paragraphFormat','fontFamily','fontSize','color','align','formatOL','formatUL','quote','clearFormatting','token','insertLink','insertImage','insertTable','html','fullscreen'],heightMin:100}));Le.initRemoveEvents(removeButton,mQuery);newTab.find('a').tab('show');return filterContainerId;};Le.initDynamicContentItem=function(tabId,jQueryVariant,tokenName){var mQuery=(typeof jQueryVariant!='undefined')?jQueryVariant:window.mQuery;var $el=mQuery('#dynamic-content-container');if($el.size()==0){mQuery=parent.mQuery;$el=mQuery('#dynamic-content-container');}
if(tabId||typeof tabId!="undefined"){$el=mQuery(tabId);}
$el.find('.addNewDynamicContentFilter').on('click',function(e){e.preventDefault();Le.createNewDynamicContentFilter(this);});if(typeof tokenName!='undefined'){$el.find('.dynamic-content-token-name').val(tokenName);}
if($el.find('.dynamic-content-token-name').val()==''){var dynamicContent=$el.attr('id').match(/\d+$/);if(dynamicContent){var dynamicContentIndex=dynamicContent[0];$el.find('.dynamic-content-token-name').val('Dynamic Content '+dynamicContentIndex);}}
$el.find('a.remove-selected').on('click',function(){mQuery(this).closest('.panel').animate({'opacity':0},'fast',function(){mQuery(this).remove();});});$el.find('select[data-le="available_filters"]').on('change',function(){var $this=mQuery(this);if($this.val()){Le.addDynamicContentFilter($this.val(),mQuery);$this.val('');$this.trigger('chosen:updated');}});Le.initRemoveEvents($el.find('.remove-item'),mQuery);};Le.updateDynamicContentDropdown=function(){var options=[];mQuery('#dynamicContentTabs').find('a[data-toggle="tab"]').each(function(){var prototype='<li><a class="fr-command" data-cmd="dynamicContent" data-param1="__tokenName__">__tokenName__</a></li>';var newOption=prototype.replace(/__tokenName__/g,mQuery(this).text());options.push(newOption);});mQuery('button[data-cmd="dynamicContent"]').next().find('ul').html(options.join(''));};Le.initRemoveEvents=function(elements,jQueryVariant){var mQuery=(typeof jQueryVariant!='undefined')?jQueryVariant:window.mQuery;if(elements.hasClass('remove-selected')){elements.on('click',function(){mQuery(this).closest('.panel').animate({'opacity':0},'fast',function(){mQuery(this).remove();});});}else{elements.on('click',function(e){e.preventDefault();var $this=mQuery(this);var parentElement=$this.parents('.tab-pane.dynamic-content');if($this.hasClass('remove-filter')){parentElement=$this.parents('.tab-pane.dynamic-content-filter');}
var tabLink=mQuery('a[href="#'+parentElement.attr('id')+'"]').parent();var tabContainer=tabLink.parent();parentElement.remove();tabLink.remove();if(tabContainer.hasClass('tabs-left')||$this.hasClass('remove-filter')){tabContainer.find('li').first().next().find('a').tab('show');}else{tabContainer.find('li').first().find('a').tab('show');}
Le.updateDynamicContentDropdown();});}};Le.addDynamicContentFilter=function(selectedFilter,jQueryVariant){var mQuery=(typeof jQueryVariant!='undefined')?jQueryVariant:window.mQuery;var dynamicContentItems=mQuery('.tab-pane.dynamic-content');var activeDynamicContent=dynamicContentItems.filter(':visible');var dynamicContentIndex=activeDynamicContent.attr('id').match(/\d+$/)[0];var dynamicContentFilterContainers=activeDynamicContent.find('div[data-filter-container]');var activeDynamicContentFilterContainer=dynamicContentFilterContainers.filter(':visible');var dynamicContentFilterIndex=dynamicContentFilterContainers.index(activeDynamicContentFilterContainer);var selectedOption=mQuery('option[data-le="available_'+selectedFilter+'"]').first();var label=selectedOption.text();var filterNum=activeDynamicContentFilterContainer.children('.panel').length;var prototype=mQuery('#filterSelectPrototype').data('prototype');var fieldObject=selectedOption.data('field-object');var fieldType=selectedOption.data('field-type');var isSpecial=(mQuery.inArray(fieldType,['leadlist','listoptin','lead_email_received','tags','multiselect','boolean','select','country','timezone','region','stage','locale'])!=-1);prototype=prototype.replace(/__name__/g,filterNum).replace(/__label__/g,label).replace(/dynamicContent_0_filters/g,'dynamicContent_'+dynamicContentIndex+'_filters').replace(/dynamicContent]\[0]\[filters/g,'dynamicContent]['+dynamicContentIndex+'][filters').replace(/filters_0_filters/g,'filters_'+dynamicContentFilterIndex+'_filters').replace(/filters]\[0]\[filters/g,'filters]['+dynamicContentFilterIndex+'][filters');if(filterNum===0){prototype=prototype.replace(/in-group/g,'');}
prototype=mQuery(prototype);if(fieldObject=='company'){prototype.find('.object-icon').removeClass('fa-user').addClass('fa-building');}else{prototype.find('.object-icon').removeClass('fa-building').addClass('fa-user');}
var filterBase="emailform[dynamicContent]["+dynamicContentIndex+"][filters]["+dynamicContentFilterIndex+"][filters]["+filterNum+"]";var filterIdBase="emailform_dynamicContent_"+dynamicContentIndex+"_filters_"+dynamicContentFilterIndex+"_filters_"+filterNum;if(isSpecial){var templateField=fieldType;if(fieldType=='boolean'||fieldType=='multiselect'){templateField='select';}
var template=mQuery('#templates .'+templateField+'-template').clone();var $template=mQuery(template);var templateNameAttr=$template.attr('name').replace(/__name__/g,filterNum).replace(/__dynamicContentIndex__/g,dynamicContentIndex).replace(/__dynamicContentFilterIndex__/g,dynamicContentFilterIndex);var templateIdAttr=$template.attr('id').replace(/__name__/g,filterNum).replace(/__dynamicContentIndex__/g,dynamicContentIndex).replace(/__dynamicContentFilterIndex__/g,dynamicContentFilterIndex);$template.attr('name',templateNameAttr);$template.attr('id',templateIdAttr);prototype.find('input[name="'+filterBase+'[filter]"]').replaceWith(template);}
if(activeDynamicContentFilterContainer.find('.panel').length==0){prototype.find(".panel-footer").addClass('hide');}
prototype.find("input[name='"+filterBase+"[field]']").val(selectedFilter);prototype.find("input[name='"+filterBase+"[type]']").val(fieldType);prototype.find("input[name='"+filterBase+"[object]']").val(fieldObject);var filterEl=(isSpecial)?"select[name='"+filterBase+"[filter]']":"input[name='"+filterBase+"[filter]']";activeDynamicContentFilterContainer.append(prototype);Le.initRemoveEvents(activeDynamicContentFilterContainer.find("a.remove-selected"),mQuery);var filter='#'+filterIdBase+'_filter';var fieldOptions=fieldCallback='';if(isSpecial){if(fieldType=='select'||fieldType=='boolean'||fieldType=='multiselect'){fieldOptions=selectedOption.data("field-list");mQuery.each(fieldOptions,function(index,val){mQuery('<option>').val(index).text(val).appendTo(filterEl);});}}else if(fieldType=='lookup'){fieldCallback=selectedOption.data("field-callback");if(fieldCallback&&typeof Le[fieldCallback]=='function'){fieldOptions=selectedOption.data("field-list");Le[fieldCallback](filterIdBase+'_filter',selectedFilter,fieldOptions);}}else if(fieldType=='datetime'){mQuery(filter).datetimepicker({format:'Y-m-d H:i',lazyInit:true,validateOnBlur:false,allowBlank:true,scrollMonth:false,scrollInput:false});}else if(fieldType=='date'){mQuery(filter).datetimepicker({timepicker:false,format:'Y-m-d',lazyInit:true,validateOnBlur:false,allowBlank:true,scrollMonth:false,scrollInput:false,closeOnDateSelect:true});}else if(fieldType=='time'){mQuery(el).timepicker({defaultTIme:false});}else if(fieldType=='lookup_id'){var oldFilter=mQuery(filterEl);var newDisplay=mQuery(oldFilter).clone();mQuery(newDisplay).attr('name',filterBase+'[display]').attr('id',filterIdBase+'_display');var oldDisplay=mQuery(prototype).find("input[name='"+filterBase+"[display]']");var newFilter=mQuery(oldDisplay).clone();mQuery(newFilter).attr('name',filterBase+'[filter]').attr('id',filterIdBase+'_filter');mQuery(oldFilter).replaceWith(newFilter);mQuery(oldDisplay).replaceWith(newDisplay);var fieldCallback=selectedOption.data("field-callback");if(fieldCallback&&typeof Le[fieldCallback]=='function'){fieldOptions=selectedOption.data("field-list");Le[fieldCallback](filterIdBase+'_display',selectedFilter,fieldOptions,mQuery);}}else{mQuery(filter).attr('type',fieldType);}
var operators=mQuery(selectedOption).data('field-operators');mQuery('#'+filterIdBase+'_operator').html('');mQuery.each(operators,function(value,label){var newOption=mQuery('<option/>').val(value).text(label);newOption.appendTo(mQuery('#'+filterIdBase+'_operator'));});Le.convertDynamicContentFilterInput('#'+filterIdBase+'_operator',mQuery);};Le.convertDynamicContentFilterInput=function(el,jQueryVariant){var mQuery=(typeof jQueryVariant!='undefined')?jQueryVariant:window.mQuery;var operator=mQuery(el).val();var regExp=/emailform_dynamicContent_(\d+)_filters_(\d+)_filters_(\d+)_operator/;var matches=regExp.exec(mQuery(el).attr('id'));var dynamicContentIndex=matches[1];var dynamicContentFilterIndex=matches[2];var filterNum=matches[3];var filterId='#emailform_dynamicContent_'+dynamicContentIndex+'_filters_'+dynamicContentFilterIndex+'_filters_'+filterNum+'_filter';var filterEl=mQuery(filterId);var filterElParent=filterEl.parent();if(filterElParent.hasClass('has-error')){filterElParent.find('div.help-block').hide();filterElParent.removeClass('has-error');}
var disabled=(operator=='empty'||operator=='!empty');filterEl.prop('disabled',disabled);if(disabled){filterEl.val('');}
var newName='';var lastPos;if(filterEl.is('select')){var isMultiple=filterEl.attr('multiple');var multiple=(operator=='in'||operator=='!in');var placeholder=filterEl.attr('data-placeholder');if(multiple&&!isMultiple){filterEl.attr('multiple','multiple');newName=filterEl.attr('name')+'[]';filterEl.attr('name',newName);placeholder=leLang['chosenChooseMore'];}else if(!multiple&&isMultiple){filterEl.removeAttr('multiple');newName=filterEl.attr('name');lastPos=newName.lastIndexOf('[]');newName=newName.substring(0,lastPos);filterEl.attr('name',newName);placeholder=leLang['chosenChooseOne'];}
if(multiple){filterEl.find('option[value=""]').remove();filterEl.find('option:selected').removeAttr('selected');}else{filterEl.prepend("<option value='' selected></option>");}
if(mQuery(filterId+'_chosen').length){filterEl.chosen('destroy');}
filterEl.attr('data-placeholder',placeholder);Le.activateChosenSelect(filterEl,false,mQuery);}};Le.checkemailstatus=function(){if(mQuery('.license-notifiation').hasClass('hide')){Le.ajaxActionRequest('email:emailstatus',{},function(response){if(response.success){if(response.info!=''&&response.isalertneeded!="true"){mQuery('.license-notifiation').removeClass('hide');mQuery('.license-notifiation').css('display','table');mQuery('.license-notifiation').css('table-layout','fixed');mQuery('.button-notification').addClass('hide');mQuery('.license-notifiation #license-alert-message').html(response.info);mQuery('#fixed-content').attr('style','margin-top:190px;');Le.registerDismissBtn();Le.adJustFixedHeader(true);Le.changeButtonPanelStyle(false);}else{Le.adJustFixedHeader(false);}}});}}
Le.registerDismissBtn=function(){mQuery('.emaildismissbtn').click(function(e){Le.closeLicenseButton();Le.adJustFixedHeader(false);Le.changeButtonPanelStyle(false);Le.ajaxActionRequest('subscription:notificationclosed',{'isalert_needed':"true"},function(response){});});};Le.changeButtonPanelStyle=function(change){if(change){mQuery('.ui-tabs-panel .fixed-header').removeClass('ui-panel-fixed-button-panel');}else{if(!mQuery('.ui-tabs-panel .fixed-header').hasClass('ui-panel-fixed-button-panel')){mQuery('.ui-tabs-panel .fixed-header').addClass('ui-panel-fixed-button-panel');}}
if(!mQuery('.drip-fixed-header').hasClass('drip-fixed-header-style')){mQuery('.drip-fixed-header').addClass('drip-fixed-header-style');}else{mQuery('.drip-fixed-header').removeClass('drip-fixed-header-style');}};Le.formOnLoad=function(container){if(mQuery(container+' #list-search').length){Le.activateSearchAutocomplete('list-search','form.form');}
var bodyOverflow={};mQuery('select.form-builder-new-component').change(function(e){mQuery(this).find('option:selected');Le.ajaxifyModal(mQuery(this).find('option:selected'));mQuery(this).val('');mQuery(this).trigger('chosen:updated');});if(mQuery('#leforms_fields')){mQuery('#leforms_fields').sortable({items:'.panel',cancel:'',helper:function(e,ui){ui.children().each(function(){mQuery(this).width(mQuery(this).width());});bodyOverflow.overflowX=mQuery('body').css('overflow-x');bodyOverflow.overflowY=mQuery('body').css('overflow-y');mQuery('body').css({overflowX:'visible',overflowY:'visible'});return ui;},scroll:true,axis:'y',containment:'#leforms_fields .drop-here',stop:function(e,ui){mQuery('body').css(bodyOverflow);mQuery(ui.item).attr('style','');mQuery.ajax({type:"POST",url:leAjaxUrl+"?action=form:reorderFields",data:mQuery('#leforms_fields').sortable("serialize",{attribute:'data-sortable-id'})+"&formId="+mQuery('#leform_sessionId').val()});}});Le.initFormFieldButtons();Le.removeActionButtons();}
mQuery("#ui-tab-header1").addClass('ui-tabs-selected ui-state-active');mQuery('.next-tab, .prev-tab, .ui-state-default').click(function(){mQuery('#Form_Name').removeClass('has-success has-error');mQuery('#Form_post_action').removeClass('has-success has-error');mQuery('#Form_Name .help-block').addClass('hide').html("");mQuery('#Form_post_action .help-block').addClass('hide').html("");mQuery('#form_url_div').removeClass('has-success has-error');mQuery('#form_url_div .help-block').addClass('hide').html("");if(mQuery('#leform_name').val()==""&&mQuery('#leform_postActionProperty').val()==""){if(mQuery('.check_required').hasClass('required'))
{mQuery('#Form_Name').removeClass('has-success has-error').addClass('has-error');mQuery('#Form_Name .custom-help').removeClass('hide').html("Name can't be empty.");mQuery('#Form_post_action').removeClass('has-success has-error').addClass('has-error');mQuery('#Form_post_action .custom-help').removeClass('hide').html("Redirect URL/Message can't be empty ");}else{mQuery('#Form_Name').removeClass('has-success has-error').addClass('has-error');mQuery('#Form_Name .custom-help').removeClass('hide').html("Name can't be empty.");}
return;}
else if(mQuery('#leform_name').val()==""){mQuery('#Form_Name').removeClass('has-success has-error').addClass('has-error');mQuery('#Form_Name .custom-help').removeClass('hide').html("Name can't be empty.");return;}else if(mQuery('#leform_postActionProperty').val()==""&&mQuery('.check_required').hasClass('required')){mQuery('#Form_post_action').removeClass('has-success has-error').addClass('has-error');mQuery('#Form_post_action .custom-help').removeClass('hide').html("Redirect URL/Message can't be empty");return;}
if(mQuery('#leform_formType').val()=='smart'&&mQuery('#leform_formurl').val()==""){mQuery('#form_url_div').removeClass('has-success has-error').addClass('has-error');mQuery('#form_url_div .custom-help').removeClass('hide').html("A value is required.");return;}
var selectrel=mQuery(this).attr("rel");mQuery(".ui-tabs-panel").addClass('ui-tabs-hide');mQuery("#fragment-"+selectrel).removeClass('ui-tabs-hide');mQuery(".ui-state-default").removeClass('ui-tabs-selected ui-state-active');mQuery("#ui-tab-header"+selectrel).addClass('ui-tabs-selected ui-state-active');});if(mQuery('#leforms_actions')){mQuery('#leforms_actions').sortable({items:'.panel',cancel:'',helper:function(e,ui){ui.children().each(function(){mQuery(this).width(mQuery(this).width());});bodyOverflow.overflowX=mQuery('body').css('overflow-x');bodyOverflow.overflowY=mQuery('body').css('overflow-y');mQuery('body').css({overflowX:'visible',overflowY:'visible'});return ui;},scroll:true,axis:'y',containment:'#leforms_actions .drop-here',stop:function(e,ui){mQuery('body').css(bodyOverflow);mQuery(ui.item).attr('style','');mQuery.ajax({type:"POST",url:leAjaxUrl+"?action=form:reorderActions",data:mQuery('#leforms_actions').sortable("serialize")+"&formId="+mQuery('#leform_sessionId').val()});}});mQuery('#leforms_actions .leform-row').on('dblclick.leformactions',function(event){event.preventDefault();mQuery(this).find('.btn-edit').first().click();});}
if(mQuery('leform_formType').length&&mQuery('#leform_formType').val()==''){}
Le.initHideItemButton('#leforms_fields');Le.initHideItemButton('#leforms_actions');Le.enableGDPRFormWidget();if(mQuery('#Form_post_action').hasClass('has-error')){mQuery('.check_required').addClass('required');}
mQuery('#smart-form-scan-url-btn').off().on('click',function(){var currentbtn=mQuery(this);var scanurl=mQuery('#leform_formurl').val();var pattern=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;if(!pattern.test(scanurl)){alert("Enter valid url to scan");return false;}
Le.activateButtonLoadingIndicator(currentbtn);Le.ajaxActionRequest('form:scanFormUrl',{scanurl:scanurl},function(response){if(response.success){mQuery("#fragment-1 #next-page-1").trigger("click");mQuery("#le_smart_form_list").html(response.newContent);var totalFormCount=response.totalCount;var msg="We have found "+totalFormCount+" forms in the given page. Please choose the one you want to integrate.";mQuery("#smart-action-form").removeClass('hide');mQuery("#smart-action-form").html(msg);Le.showSmartFormListPanel();}else{alert(response.message);}
Le.removeButtonLoadingIndicator(currentbtn);},false,true);});var formType=mQuery('#leform_formType').val();if(formType=='smart'){mQuery('#gdprpublished').addClass('hide');if(!mQuery('.smart-form-field-mapper-header-holder').hasClass('hide')){mQuery('.smart-action-panel').removeClass('hide');mQuery('.smart-form-field-mapper-formname-holder').css('marginLeft','-34px');}}
var url=window.location.href;if(url.indexOf('/embeded-forms/new')!=-1){Le.selectFormType('standalone');}else if(url.indexOf('/smart-forms/new')!=-1){Le.selectFormType('smart');}};Le.setBtnBackgroundColor=function(){var selectedbgcolor=mQuery('#formfield_btnbgcolor').val();var input=mQuery('#formfield_inputAttributes').val();if(input.indexOf('style=')==-1){var value=input+" style='background-color:#"+selectedbgcolor+";color:#ffffff;'";mQuery('#formfield_inputAttributes').val(value);}else{var fields=input.split('background-color');var sec=fields[1].substr(9);var value=fields[0]+'background-color:#'+selectedbgcolor+';'+sec;mQuery('#formfield_inputAttributes').val(value);}}
Le.setBtnTextColor=function(){var selectedtxtcolor=mQuery('#formfield_btntxtcolor').val();var input=mQuery('#formfield_inputAttributes').val();if(input.indexOf('style=')==-1){var value=input+" style='background-color:#ff9900;color:#"+selectedtxtcolor+";'";mQuery('#formfield_inputAttributes').val(value);}else{var fields=input.split(';color');var sec=fields[1].substr(9);var value=fields[0]+';color:#'+selectedtxtcolor+';'+sec;mQuery('#formfield_inputAttributes').val(value);}}
Le.updateFormFields=function(){Le.activateLabelLoadingIndicator('campaignevent_properties_field');var formId=mQuery('#campaignevent_properties_form').val();Le.ajaxActionRequest('form:updateFormFields',{'formId':formId},function(response){if(response.fields){var select=mQuery('#campaignevent_properties_field');select.find('option').remove();var fieldOptions={};mQuery.each(response.fields,function(key,field){var option=mQuery('<option></option>').attr('value',field.alias).text(field.label);select.append(option);fieldOptions[field.alias]=field.options;});select.attr('data-field-options',JSON.stringify(fieldOptions));select.trigger('chosen:updated');Le.updateFormFieldValues(select);}
Le.removeLabelLoadingIndicator();});};Le.updateFormFieldValues=function(field){field=mQuery(field);var fieldValue=field.val();var options=jQuery.parseJSON(field.attr('data-field-options'));var valueField=mQuery('#campaignevent_properties_value');var valueFieldAttrs={'class':valueField.attr('class'),'id':valueField.attr('id'),'name':valueField.attr('name'),'autocomplete':valueField.attr('autocomplete'),'value':valueField.attr('value')};if(typeof options[fieldValue]!=='undefined'&&!mQuery.isEmptyObject(options[fieldValue])){var newValueField=mQuery('<select/>').attr('class',valueFieldAttrs['class']).attr('id',valueFieldAttrs['id']).attr('name',valueFieldAttrs['name']).attr('autocomplete',valueFieldAttrs['autocomplete']).attr('value',valueFieldAttrs['value']);mQuery.each(options[fieldValue],function(key,optionVal){var option=mQuery("<option></option>").attr('value',optionVal).text(optionVal);newValueField.append(option);});valueField.replaceWith(newValueField);}else{var newValueField=mQuery('<input/>').attr('type','text').attr('class',valueFieldAttrs['class']).attr('id',valueFieldAttrs['id']).attr('name',valueFieldAttrs['name']).attr('autocomplete',valueFieldAttrs['autocomplete']).attr('value',valueFieldAttrs['value']);valueField.replaceWith(newValueField);}};Le.formFieldOnLoad=function(container,response){if(response.fieldHtml){var newHtml=response.fieldHtml;var fieldId='#leform_'+response.fieldId;var fieldContainer=mQuery(fieldId).closest('.form-field-wrapper');if(mQuery(fieldId).length){mQuery(fieldContainer).replaceWith(newHtml);var newField=false;}else{var panel=mQuery('#leforms_fields .leform-button-wrapper').closest('.form-field-wrapper');panel.before(newHtml);var newField=true;}
var fieldContainer=mQuery(fieldId).closest('.form-field-wrapper');mQuery(fieldContainer).find("[data-toggle='ajax']").click(function(event){event.preventDefault();return Le.ajaxifyLink(this,event);});mQuery(fieldContainer).find("*[data-toggle='tooltip']").tooltip({html:true});mQuery(fieldContainer).find("[data-toggle='ajaxmodal']").on('click.ajaxmodal',function(event){event.preventDefault();Le.ajaxifyModal(this,event);});Le.initFormFieldButtons(fieldContainer);Le.initHideItemButton(fieldContainer);if(!mQuery('#fields-panel').hasClass('in')){mQuery('a[href="#fields-panel"]').trigger('click');}
if(newField){mQuery('.bundle-main-inner-wrapper').scrollTop(mQuery('.bundle-main-inner-wrapper').height());}
if(mQuery('#form-field-placeholder').length){}}
var bgcolor=mQuery('#leform_input_submit').css('background-color');var txtcolor=mQuery('#leform_input_submit').css('color');var $iconbg=Le.getBgColorHex(bgcolor);var $icontxt=Le.getBgColorHex(txtcolor);mQuery('#formfield_btnbgcolor').minicolors('value',$iconbg);mQuery('#formfield_btntxtcolor').minicolors('value',$icontxt);Le.enableGDPRFormWidget();var formAlias=mQuery('#formfield_label').val();if(formAlias=='gdpr'||formAlias=='eu_gdpr_consent'||formAlias=='EU GDPR Consent'){if(!mQuery('#form_gdpr_content div').hasClass('has-error')){mQuery('#formfield_content').val(mQuery('.leform-checkboxgrp-label').text().trim());}
mQuery('#remove-GDPR-form').remove();}};Le.getBgColorHex=function(color){var hex;if(color.indexOf('#')>-1){hex=color;}else{var rgb=color.match(/\d+/g);hex=('0'+parseInt(rgb[0],10).toString(16)).slice(-2)+('0'+parseInt(rgb[1],10).toString(16)).slice(-2)+('0'+parseInt(rgb[2],10).toString(16)).slice(-2);}
return hex;}
Le.initFormFieldButtons=function(container){if(typeof container=='undefined'){mQuery('#leforms_fields .leform-row').off(".leformfields");var container='#leforms_fields';}
mQuery(container).find('.leform-row').on('dblclick.leformfields',function(event){event.preventDefault();mQuery(this).closest('.form-field-wrapper').find('.btn-edit').first().click();});};Le.formActionOnLoad=function(container,response){if(response.actionHtml){var newHtml=response.actionHtml;var actionId='#leform_action_'+response.actionId;if(mQuery(actionId).length){mQuery(actionId).replaceWith(newHtml);var newField=false;}else{mQuery(newHtml).appendTo('#leforms_actions');var newField=true;}
mQuery(actionId+" [data-toggle='ajax']").click(function(event){event.preventDefault();return Le.ajaxifyLink(this,event);});mQuery(actionId+" *[data-toggle='tooltip']").tooltip({html:true});mQuery(actionId+" [data-toggle='ajaxmodal']").on('click.ajaxmodal',function(event){event.preventDefault();Le.ajaxifyModal(this,event);});Le.initHideItemButton(actionId);mQuery('#leforms_actions .leform-row').off(".leform");mQuery('#leforms_actions .leform-row').on('dblclick.leformactions',function(event){event.preventDefault();mQuery(this).find('.btn-edit').first().click();});if(!mQuery('#actions-panel').hasClass('in')){mQuery('a[href="#actions-panel"]').trigger('click');}
if(newField){mQuery('.bundle-main-inner-wrapper').scrollTop(mQuery('.bundle-main-inner-wrapper').height());}
if(mQuery('#form-action-placeholder').length){}}};Le.initHideItemButton=function(container){mQuery(container).find('[data-hide-panel]').click(function(e){e.preventDefault();mQuery(this).closest('.panel').hide('fast');});}
Le.onPostSubmitActionChange=function(value){mQuery('#Form_post_action .custom-help').html("");if(value=='return'){mQuery('#leform_postActionProperty').attr('type','text');mQuery('#leform_postActionProperty').prev().removeClass('required');mQuery('#Form_post_action').addClass('hide');mQuery('#leform_postActionProperty').val('');}else{if(value=='redirect'){mQuery('#leform_postActionProperty').attr('type','url');mQuery('#Form_post_action').removeClass('hide');}else{mQuery('#leform_postActionProperty').attr('type','text');mQuery('#Form_post_action').removeClass('hide');}
mQuery('#leform_postActionProperty').prev().addClass('required');}
mQuery('#leform_postActionProperty').next().html('');mQuery('#leform_postActionProperty').parent().removeClass('has-error');};Le.selectFormType=function(formType){if(formType=='standalone'){mQuery('.fg1-standalone-form-specific').removeClass('hide');mQuery('.fg1-smart-form-specific').removeClass('hide').addClass('hide');mQuery('.page-header h3').text(leLang.newStandaloneForm);}else{mQuery('#gdprpublished').addClass('hide');mQuery('.fg1-smart-form-specific').removeClass('hide');mQuery('#leforms_fields').remove();mQuery('.fg1-standalone-form-specific').removeClass('hide').addClass('hide');mQuery('.fg2-standalone-form-specific').removeClass('hide').addClass('hide');mQuery('.page-header h3').text(leLang.newSmartForm);}
mQuery('.available-actions select').trigger('chosen:updated');mQuery('#leform_formType').val(formType);mQuery('body').removeClass('noscroll');mQuery('.form-type-modal').remove();mQuery('.form-type-modal-backdrop').remove();};Le.openNewFormAction=function(url){var formtype=mQuery('#leform_formType').val();url=url+"_"+formtype;window.location.href=url;};Le.updatePlaceholdervalue=function(ele){mQuery('#formfield_properties_placeholder').val(ele);};Le.toggleGDPRButtonClass=function(changedId){changedId='#'+changedId;if(mQuery(changedId).parent().attr('class').includes('btn-yes')){mQuery('.gdpr-content').removeClass('hide');}else{mQuery('.gdpr-content').addClass('hide');}};Le.enableGDPRFormWidget=function(){if(mQuery('#leform_isGDPRPublished_1').prop('checked')){mQuery('.gdpr-content').removeClass('hide');}};Le.showSmartFormListPanel=function(){mQuery('#smart-action-form').removeClass('hide');mQuery('#le_smart_form_list').removeClass('hide');mQuery('#le_smart_form_fields_mapping').removeClass('hide').addClass('hide');mQuery('.smart-form-field-mapper-header-holder').removeClass('hide').addClass('hide');mQuery('.smart-action-panel').addClass('hide');}
Le.showSmartFormFieldPanel=function(){mQuery('#le_smart_form_fields_mapping').removeClass('hide');mQuery('.smart-form-field-mapper-header-holder').removeClass('hide');mQuery('#le_smart_form_list').removeClass('hide').addClass('hide');mQuery('.smart-action-panel').removeClass('hide');}
Le.openSmartFormPanel=function(ele){var formname=mQuery(ele).attr('data-formname');var formid=mQuery(ele).attr('data-formid');var header=formname;if(formname==""){header=formid;}
var fieldjson=mQuery('#data_formfield_'+formid).text();mQuery('.smart-form-field-mapper-header').html(header);mQuery('#leform_smartformname').val(formname);mQuery('#leform_smartformid').val(formid);try{mQuery('#le_smart_form_fields_mapping').empty();var prototype=mQuery('#le_smart_form_fields_mapping').data('prototype');fieldjson=mQuery.parseJSON(fieldjson);mQuery.each(fieldjson,function(index,field){var smartfieldid="#leform_smartfields_"+index+"_smartfield";var leadfieldid="#leform_smartfields_"+index+"_leadfield";var dbfieldid="#leform_smartfields_"+index+"_dbfield";var fieldmapper=prototype.replace(/__name__/g,index);fieldmapper=mQuery(fieldmapper);var smartfield=fieldmapper.find(smartfieldid);smartfield.val(field.name);var leadfield=fieldmapper.find(leadfieldid);var dbfield=fieldmapper.find(dbfieldid);dbfield.val('f'+index);Le.activateChosenSelect(leadfield);fieldmapper.appendTo(mQuery('#le_smart_form_fields_mapping'));});mQuery('#smart-action-form').addClass('hide');Le.showSmartFormFieldPanel();}catch(err){alert(err);}};Le.leadOnLoad=function(container,response){Le.removeActionButtons();Le.addKeyboardShortcut('a','Quick add a New Lead',function(e){if(mQuery('a.quickadd').length){mQuery('a.quickadd').click();}else if(mQuery('a.btn-leadnote-add').length){mQuery('a.btn-leadnote-add').click();}},'contact pages');Le.addKeyboardShortcut('t','Activate Table View',function(e){mQuery('#table-view').click();},'contact pages');Le.addKeyboardShortcut('c','Activate Card View',function(e){mQuery('#card-view').click();},'contact pages');Mousetrap.stopCallback=function(e,element,combo){if(element.id=='leadnote_text'&&combo!='mod+enter'){return true;}
if((' '+element.className+' ').indexOf(' mousetrap ')>-1){return false;}
return element.tagName=='INPUT'||element.tagName=='SELECT'||element.tagName=='TEXTAREA'||(element.contentEditable&&element.contentEditable=='true');};var timelineForm=mQuery(container+' #timeline-filters');if(timelineForm.length){timelineForm.on('change',function(){timelineForm.submit();}).on('keyup',function(){timelineForm.delay(200).submit();}).on('submit',function(e){e.preventDefault();Le.refreshLeadTimeline(timelineForm);});var toggleTimelineDetails=function(el){var activateDetailsState=mQuery(el).hasClass('active');if(activateDetailsState){mQuery('#timeline-details-'+detailsId).addClass('hide');mQuery(el).removeClass('active');}else{mQuery('#timeline-details-'+detailsId).removeClass('hide');mQuery(el).addClass('active');}};Le.leadTimelineOnLoad(container,response);Le.leadAuditlogOnLoad(container,response);}
var auditlogForm=mQuery(container+' #auditlog-filters');if(auditlogForm.length){auditlogForm.on('change',function(){auditlogForm.submit();}).on('keyup',function(){auditlogForm.delay(200).submit();}).on('submit',function(e){e.preventDefault();Le.refreshLeadAuditLog(auditlogForm);});}
var noteForm=mQuery(container+' #note-filters');if(noteForm.length){noteForm.on('change',function(){noteForm.submit();}).on('keyup',function(){noteForm.delay(200).submit();}).on('submit',function(e){e.preventDefault();Le.refreshLeadNotes(noteForm);});}
if(mQuery(container+' #list-search').length){Le.activateSearchAutocomplete('list-search','lead.lead');}
if(mQuery(container+' #notes-container').length){Le.activateSearchAutocomplete('NoteFilter','lead.note');}
if(mQuery('#lead_preferred_profile_image').length){mQuery('#lead_preferred_profile_image').on('change',function(){if(mQuery(this).val()=='custom'){mQuery('#customAvatarContainer').slideDown('fast');}else{mQuery('#customAvatarContainer').slideUp('fast');}})}
if(mQuery('.lead-avatar-panel').length){mQuery('.lead-avatar-panel .avatar-collapser a.arrow').on('click',function(){setTimeout(function(){var status=(mQuery('#lead-avatar-block').hasClass('in')?'expanded':'collapsed');Cookies.set('mautic_lead_avatar_panel',status,{expires:30});},500);});}
if(mQuery('#anonymousLeadButton').length){var searchValue=mQuery('#list-search').typeahead('val').toLowerCase();var string=mQuery('#anonymousLeadButton').data('anonymous').toLowerCase();if(searchValue.indexOf(string)>=0&&searchValue.indexOf('!'+string)==-1){mQuery('#anonymousLeadButton').addClass('btn-primary');}else{mQuery('#anonymousLeadButton').removeClass('btn-primary');}}
var leadMap=[];mQuery(document).on('shown.bs.tab','a#load-lead-map',function(e){leadMap=Le.renderMap(mQuery('#place-container .vector-map'));});mQuery('a[data-toggle="tab"]').not('a#load-lead-map').on('shown.bs.tab',function(e){if(leadMap.length){Le.destroyMap(leadMap);leadMap=[];}});if(mQuery(container+' .panel-companies').length){mQuery(container+' .panel-companies .fa-check').tooltip({html:true});}
mQuery("#leadfield_eu_gdpr_consent .chosen-container").attr('tabindex','-1');mQuery("#leadfield_eu_gdpr_consent .chosen-container").attr('style','pointer-events: none;background-color: #ebedf0;opacity: 1;width:100%');mQuery("#leadfield_eu_gdpr_timezone .chosen-container").attr('tabindex','-1');mQuery("#leadfield_eu_gdpr_timezone .chosen-container").attr('style','pointer-events: none;background-color: #ebedf0;opacity: 1;width:100%');mQuery("#leadfield_status .chosen-container").attr('tabindex','-1');mQuery("#leadfield_status .chosen-container").attr('style','pointer-events: none;background-color: #ebedf0;opacity: 1;width:100%');mQuery("#leadfield_created_source .chosen-container").attr('tabindex','-1');mQuery("#leadfield_created_source .chosen-container").attr('style','pointer-events: none;background-color: #ebedf0;opacity: 1;width:100%');if(Le.isMobile()){mQuery("#leadfield_eu_gdpr_consent select").attr('tabindex','-1');mQuery("#leadfield_eu_gdpr_consent select").attr('style','pointer-events: none;background-color: #ebedf0;opacity: 1;width:100%');mQuery("#leadfield_eu_gdpr_timezone select").attr('tabindex','-1');mQuery("#leadfield_eu_gdpr_timezone select").attr('style','pointer-events: none;background-color: #ebedf0;opacity: 1;width:100%');mQuery("#leadfield_status select").attr('tabindex','-1');mQuery("#leadfield_status select").attr('style','pointer-events: none;background-color: #ebedf0;opacity: 1;width:100%');mQuery("#leadfield_created_source select").attr('tabindex','-1');mQuery("#leadfield_created_source select").attr('style','pointer-events: none;background-color: #ebedf0;opacity: 1;width:100%');}
Le.hideFlashMessage();};Le.segment_filter=function(id){if(mQuery('#segment-filter-block_'+id).css("display")!='none')
{mQuery('#segment-filter-block_'+id).css("display","none");mQuery('#'+id).setAttribute('aria-expanded','false');}
else
{mQuery('.filter_option').css("display","none");mQuery('#segment-filter-block_'+id).css("display","");mQuery('#'+id).setAttribute('aria-expanded','true');}}
Le.leadTimelineOnLoad=function(container,response){mQuery("#contact-timeline a[data-activate-details='all']").on('click',function(){if(mQuery(this).find('span').first().hasClass('fa-level-down')){mQuery("#contact-timeline a[data-activate-details!='all']").each(function(){var detailsId=mQuery(this).data('activate-details');if(detailsId&&mQuery('#timeline-details-'+detailsId).length){mQuery('#timeline-details-'+detailsId).removeClass('hide');mQuery(this).addClass('active');}});mQuery(this).find('span').first().removeClass('fa-level-down').addClass('fa-level-up');}else{mQuery("#contact-timeline a[data-activate-details!='all']").each(function(){var detailsId=mQuery(this).data('activate-details');if(detailsId&&mQuery('#timeline-details-'+detailsId).length){mQuery('#timeline-details-'+detailsId).addClass('hide');mQuery(this).removeClass('active');}});mQuery(this).find('span').first().removeClass('fa-level-up').addClass('fa-level-down');}});mQuery("#contact-timeline a[data-activate-details!='all']").on('click',function(){var detailsId=mQuery(this).data('activate-details');if(detailsId&&mQuery('#timeline-details-'+detailsId).length){var activateDetailsState=mQuery(this).hasClass('active');if(activateDetailsState){mQuery('#timeline-details-'+detailsId).addClass('hide');mQuery(this).removeClass('active');}else{mQuery('#timeline-details-'+detailsId).removeClass('hide');mQuery(this).addClass('active');}}});if(response&&typeof response.timelineCount!='undefined'){mQuery('#TimelineCount').html(response.timelineCount);}};Le.showAllEvents=function(){mQuery('.le-timeline-event').removeClass('hide');mQuery('.le-timeline-event-end').remove();}
Le.leadAuditlogOnLoad=function(container,response){mQuery("#contact-auditlog a[data-activate-details='all']").on('click',function(){if(mQuery(this).find('span').first().hasClass('fa-level-down')){mQuery("#contact-auditlog a[data-activate-details!='all']").each(function(){var detailsId=mQuery(this).data('activate-details');if(detailsId&&mQuery('#auditlog-details-'+detailsId).length){mQuery('#auditlog-details-'+detailsId).removeClass('hide');mQuery(this).addClass('active');}});mQuery(this).find('span').first().removeClass('fa-level-down').addClass('fa-level-up');}else{mQuery("#contact-auditlog a[data-activate-details!='all']").each(function(){var detailsId=mQuery(this).data('activate-details');if(detailsId&&mQuery('#auditlog-details-'+detailsId).length){mQuery('#auditlog-details-'+detailsId).addClass('hide');mQuery(this).removeClass('active');}});mQuery(this).find('span').first().removeClass('fa-level-up').addClass('fa-level-down');}});mQuery("#contact-auditlog a[data-activate-details!='all']").on('click',function(){var detailsId=mQuery(this).data('activate-details');if(detailsId&&mQuery('#auditlog-details-'+detailsId).length){var activateDetailsState=mQuery(this).hasClass('active');if(activateDetailsState){mQuery('#auditlog-details-'+detailsId).addClass('hide');mQuery(this).removeClass('active');}else{mQuery('#auditlog-details-'+detailsId).removeClass('hide');mQuery(this).addClass('active');}}});};Le.leadOnUnload=function(id){if(typeof leVars.moderatedIntervals['leadListLiveUpdate']!='undefined'){Le.clearModeratedInterval('leadListLiveUpdate');}
if(typeof Le.mapObjects!=='undefined'){delete Le.mapObjects;}};Le.getLeadId=function(){return mQuery('input#leadId').val();}
Le.leadEmailOnLoad=function(container,response){mQuery('[data-verified-emails]').click(function(e){e.preventDefault();var currentLink=mQuery(this);var email=currentLink.attr('data-verified-emails');var name=currentLink.attr('data-verified-fromname');mQuery("#lead_quickemail_from").val(email);mQuery("#lead_quickemail_fromname").val(name);});mQuery('[name="lead_quickemail"]').on('submit.ajaxform',function(){var emailHtml=mQuery('.fr-iframe').contents();var textarea=mQuery(this).find('#lead_quickemail_body');mQuery.each(emailHtml.find('td, th, table'),function(){var td=mQuery(this);if(td.attr('fr-original-class')){td.attr('class',td.attr('fr-original-class'));td.removeAttr('fr-original-class');}
if(td.attr('fr-original-style')){td.attr('style',td.attr('fr-original-style'));td.removeAttr('fr-original-style');}
if(td.css('border')==='1px solid rgb(221, 221, 221)'){td.css('border','');}});emailHtml.find('body').removeAttr('contenteditable');emailHtml.find('body').css('overflow','initial');var styleElement=emailHtml.find('style[data-fr-style]');var style=styleElement.text();style=style.replace(/overflow:\s*hidden\s*;\s*/,'');styleElement.get(0).innerHTML=style;textarea.val(emailHtml.find('html').get(0).outerHTML);});}
Le.addHide=function(){mQuery('#segment_filters').addClass('hide');}
Le.removeHide=function(){mQuery('#segment_filters').removeClass('hide');mQuery('#segment-filter-block_list_leadlist').css("display","");mQuery('#segment-filter-block_list_leadlist').css("height","auto");}
Le.closeOnOpen=function(headerid){if(headerid!=""){if(mQuery(headerid).hasClass('collapse in'))
{mQuery(headerid).addClass('collapse');}else{mQuery('.close_all').removeClass('collapse in ');mQuery('.close_all').addClass('collapse ');mQuery(headerid).removeClass('collapse');}}};Le.addSegementFilter=function(filterId){if(filterId.id!=""){Le.addLeadListFilter(filterId.id);mQuery(this).val('');mQuery(this).trigger('chosen:updated');mQuery('#filters').addClass('active in');mQuery('#details').removeClass('active in');mQuery('#filterstab').addClass('active');mQuery('#detailstab').removeClass('active');}};Le.leadlistOnLoad=function(container){if(mQuery(container+' #list-search').length){Le.activateSearchAutocomplete('list-search','lead.list');}
var prefix='leadlist';if(mQuery('#'+prefix+'_filters').length){mQuery('#available_filters').off().on('change',function(){if(mQuery(this).val()){Le.addLeadListFilter(mQuery(this).val());mQuery(this).val('');mQuery(this).trigger('chosen:updated');}});Le.registerEventsforFilterGroupButtons(prefix);Le.registerEventsForFilterLists();Le.registerEventsForFilterRemove(prefix);if(mQuery('#'+prefix+'_filters .filter-and-group-holder').length){var filterandgroupholder=mQuery('#'+prefix+'_filters .filter-and-group-holder');var filterandgroups=filterandgroupholder.children();if(filterandgroups.length==0){Le.addnewFilterAndGroup(prefix,'or');}}}
var segmentContactForm=mQuery('#segment-contact-filters');if(segmentContactForm.length){segmentContactForm.on('change',function(){segmentContactForm.submit();}).on('keyup',function(){segmentContactForm.delay(200).submit();}).on('submit',function(e){e.preventDefault();Le.refreshSegmentContacts(segmentContactForm);});}
Le.removeActionButtons();if(mQuery('.filter-field-segment').hasClass('has-error')){mQuery('#segment_filters_tab').click();}};Le.addnewFilterAndGroup=function(prefix,defaultglue){var filterandgroupholder=mQuery('#'+prefix+'_filters .filter-and-group-holder');var filtergrouptemplate=mQuery('#'+prefix+'_filters .filter-group-template').clone();filtergrouptemplate.removeClass('filter-group-template');filterandgroupholder.append(filtergrouptemplate);var filterpanelholder=mQuery(filtergrouptemplate).find('.filter-panel-holder');Le.addLeadListFilter('default',filterpanelholder,defaultglue);Le.registerEventsForFilterLists();Le.registerEventsforFilterGroupButtons(prefix);Le.registerEventsForFilterRemove(prefix);}
Le.registerEventsforFilterGroupButtons=function(prefix){mQuery('.selected-filters .leadlist-filter-group .btn-filter-group').off().on('click',function(){var type=mQuery(this).attr("data-filter-group");if(type=='and'){var filterpanelgroup=mQuery(this).parent();var filterpanelholder=filterpanelgroup.find('.filter-panel-holder');Le.addLeadListFilter('default',filterpanelholder,type);Le.registerEventsForFilterLists();Le.registerEventsforFilterGroupButtons(prefix);Le.registerEventsForFilterRemove(prefix);}else{Le.addnewFilterAndGroup(prefix,'or');}});}
Le.registerEventsForFilterLists=function(){mQuery('#leadlist_filters .list_filter_fields').off().on('change',function(){if(mQuery(this).val()){var filtercontainer=mQuery(this).parent();var filterprototype=filtercontainer.parent().parent();var filterindex=filtercontainer.attr('data-filter-index');Le.updateLeadListFilter(mQuery(this).val(),filterindex,filterprototype);}});}
Le.registerEventsForFilterRemove=function(prefix){mQuery('#'+prefix+'_filters .remove-selected').each(function(index,el){mQuery(el).off().on('click',function(){mQuery(this).closest('.panel').animate({'opacity':0},'fast',function(){mQuery(this).remove();});if(!mQuery('#'+prefix+'_filters li:not(.placeholder)').length){mQuery('#'+prefix+'_filters li.placeholder').removeClass('hide');}else{mQuery('#'+prefix+'_filters li.placeholder').addClass('hide');}
setTimeout(function(){if(mQuery('#CampaignEventModal').length){prefix='campaignevent_properties';}else if(mQuery('#emailform_plainText').length){prefix='emailform_recipients';}else if(mQuery('#dripemailform_name').length){prefix='dripemailform_recipients';}
Le.updateFilterGlueValue(prefix);},1000);});});}
Le.reorderSegmentFilters=function(){var counter=0;var prefix='leadlist';var parent=mQuery('.dynamic-content-filter, .dwc-filter');if(parent.length){prefix=parent.attr('id');}
mQuery('#'+prefix+'_filters .panel').each(function(){Le.updateFilterPositioning(mQuery(this).find('select.glue-select').first());mQuery(this).find('[id^="'+prefix+'_filters_"]').each(function(){var id=mQuery(this).attr('id');if(prefix+'_filters___name___filter'===id){return true;}
var suffix=id.split(/[_]+/).pop();mQuery(this).attr('id',prefix+'_filters_'+counter+'_'+suffix);mQuery(this).attr('name',prefix+'[filters]['+counter+']['+suffix+']');});++counter;});mQuery('#'+prefix+'_filters .panel-heading').removeClass('hide');mQuery('#'+prefix+'_filters .panel-heading').first().addClass('hide');mQuery('#'+prefix+'_filters .panel').first().removeClass('in-group');};Le.convertLeadFilterInput=function(el){var iscampaignmodel=false;var prefix='leadlist';if(mQuery('#CampaignEventModal').length){prefix='campaignevent_properties';}else if(mQuery('#emailform_plainText').length){prefix='emailform_recipients';}else if(mQuery('#dripemailform_name').length){prefix='dripemailform_recipients';}
var operator=mQuery(el).val();var regExp=/_filters_(\d+)_operator/;var matches=regExp.exec(mQuery(el).attr('id'));var filterNum=matches[1];var filterId='#'+prefix+'_filters_'+filterNum+'_filter';var operatorId='#'+prefix+'_filters_'+filterNum+'_operator';var typeId='#'+prefix+'_filters_'+filterNum+'_type';var fieldtype=mQuery(typeId).val();var isSpecial=(mQuery.inArray(fieldtype,['leadlist','listoptin','device_type','device_brand','device_os','owner_id','lead_email_received','lead_email_sent','lead_email_failed','tags','multiselect','boolean','select','country','timezone','region','stage','locale','globalcategory','landingpage_list','score_list','formsubmit_list','asset_downloads_list','drip_email_received','drip_email_list'])!=-1);if(mQuery(filterId).parent().hasClass('has-error')){mQuery(filterId).parent().find('div.help-block').hide();mQuery(filterId).parent().removeClass('has-error');}
var disabled=(operator=='empty'||operator=='!empty');mQuery(filterId+', #'+prefix+'_filters_'+filterNum+'_display').prop('disabled',disabled);if(disabled){mQuery(filterId).val('');}
var customFilter=(operator=='today'||operator=='tomorrow'||operator=='yesterday'||operator=='week_last'||operator=='week_next'||operator=='week_this'||operator=='last_03'||operator=='next_03'||operator=='last_07'||operator=='next_07'||operator=='last_15'||operator=='next_15'||operator=='last_30'||operator=='next_30'||operator=='last_60'||operator=='next_60'||operator=='last_90'||operator=='next_90'||operator=='month_last'||operator=='month_next'||operator=='month_this'||operator=='year_last'||operator=='year_next'||operator=='year_this'||operator=='year_till');if(customFilter){mQuery(filterId+', #'+prefix+'_filters_'+filterNum+'_display').attr('tabindex','-1');mQuery(filterId+', #'+prefix+'_filters_'+filterNum+'_display').attr('style','pointer-events: none;background-color: #ebedf0;opacity: 1;');mQuery(filterId).val(operator);}else{mQuery(filterId+', #'+prefix+'_filters_'+filterNum+'_display').removeAttr('tabindex','-1');mQuery(filterId+', #'+prefix+'_filters_'+filterNum+'_display').removeAttr('style','pointer-events: none;background-color: #ebedf0;opacity: 1;');mQuery(filterId).val("");}
Le.activateChosenSelect(mQuery(operatorId));var newName='';var lastPos;if(mQuery(filterId).is('select')){var isMultiple=mQuery(filterId).attr('multiple');var multiple=(operator=='in'||operator=='!in'||operator=='empty'||operator=='!empty');var placeholder=mQuery(filterId).attr('data-placeholder');if(multiple&&!isMultiple){mQuery(filterId).attr('multiple','multiple');newName=mQuery(filterId).attr('name')+'[]';mQuery(filterId).attr('name',newName);placeholder=leLang['chosenChooseMore'];}else if(!multiple&&isMultiple){mQuery(filterId).removeAttr('multiple');newName=mQuery(filterId).attr('name');lastPos=newName.lastIndexOf('[]');newName=newName.substring(0,lastPos);mQuery(filterId).attr('name',newName);placeholder=leLang['chosenChooseOne'];}
if(multiple){mQuery(filterId).find('option[value=""]').remove();mQuery(filterId+' option:selected').removeAttr('selected');}else{mQuery(filterId).prepend("<option value='' selected></option>");}
if(mQuery(filterId+'_chosen').length){mQuery(filterId).chosen('destroy');}
mQuery(filterId).attr('data-placeholder',placeholder);Le.activateChosenSelect(mQuery(filterId));}};Le.updateLookupListFilter=function(field,datum){if(datum&&datum.id){var filterField='#'+field.replace('_display','_filter');mQuery(filterField).val(datum.id);}};Le.activateSegmentFilterTypeahead=function(displayId,filterId,fieldOptions,mQueryObject){if(typeof mQueryObject=='function'){mQuery=mQueryObject;}
mQuery('#'+displayId).attr('data-lookup-callback','updateLookupListFilter');Le.activateFieldTypeahead(displayId,filterId,[],'lead:fieldList')};Le.addLeadListFilter=function(elId,filtergroup,glueval){var filterId='#available_'+elId;var label=mQuery(filterId).text();var filterNum=parseInt(mQuery('.available-filters').data('index'));mQuery('.available-filters').data('index',filterNum+1);var prototype=mQuery('.available-filters').data('prototype');prototype=prototype.replace(/__name__/g,filterNum);prototype=prototype.replace(/__label__/g,label);prototype=mQuery(prototype);var filterlist=mQuery(prototype).find('.list_filter_fields');if(filterNum==1){}
Le.activateChosenSelect(filterlist);var prefix='leadlist';var filterBase=prefix+"[filters]["+filterNum+"]";var filterIdBase=prefix+"_filters_"+filterNum+"_";var formBase=prefix+"_filters_";if(mQuery('#CampaignEventModal').length){filterBase="campaignevent[properties][filters]["+filterNum+"]";filterIdBase="campaignevent_properties_filters_"+filterNum+"_";formBase="campaignevent_properties_filters_";}else if(mQuery('#emailform_plainText').length){filterBase="emailform[recipients][filters]["+filterNum+"]";filterIdBase="emailform_recipients_filters_"+filterNum+"_";formBase="emailform_recipients_filters_";}else if(mQuery('#dripemailform_name').length){filterBase="dripemailform[recipients][filters]["+filterNum+"]";filterIdBase="dripemailform_recipients_filters_"+filterNum+"_";formBase="dripemailform_recipients_filters_";}
mQuery(prototype).appendTo(filtergroup);mQuery(prototype).find("input[name='"+filterBase+"[filter]']").remove();mQuery('#'+filterIdBase+'operator').remove();mQuery(prototype).find("input[name='"+filterBase+"[display]']").prop("disabled",true);mQuery(prototype).find("input[name='"+filterBase+"[field]']").prop("disabled",true);mQuery(prototype).find("input[name='"+filterBase+"[type]']").prop("disabled",true);mQuery(prototype).find("input[name='"+filterBase+"[object]']").prop("disabled",true);mQuery(prototype).find("input[name='"+filterBase+"[customObject]']").prop("disabled",true);mQuery(prototype).find("input[name='"+filterBase+"[fieldlabel]']").prop("disabled",true);mQuery(prototype).find("select[name='"+filterBase+"[glue]']").prop("disabled",true);mQuery(prototype).find("select[name='"+filterBase+"[glue]']").val(glueval);Le.updateFilterPositioning(formBase);};Le.updateLeadListFilter=function(elId,filterNum,prototype){var filterId='#available_'+elId;var label=mQuery(filterId).text();var fieldType=mQuery(filterId).data('field-type');var fieldObject=mQuery(filterId).data('field-object');var customObject=mQuery(filterId).data('field-customobject');var isSpecial=(mQuery.inArray(fieldType,['leadlist','listoptin','device_type','device_brand','device_os','owner_id','lead_email_received','lead_email_sent','lead_email_failed','tags','multiselect','boolean','select','country','timezone','region','stage','locale','globalcategory','landingpage_list','score_list','formsubmit_list','asset_downloads_list','drip_email_received','drip_email_list'])!=-1);var prefix='leadlist';var filterBase=prefix+"[filters]["+filterNum+"]";var filterIdBase=prefix+"_filters_"+filterNum+"_";if(mQuery('#CampaignEventModal').length){filterBase="campaignevent[properties][filters]["+filterNum+"]";filterIdBase="campaignevent_properties_filters_"+filterNum+"_";}else if(mQuery('#emailform_plainText').length){filterBase="emailform[recipients][filters]["+filterNum+"]";filterIdBase="emailform_recipients_filters_"+filterNum+"_";}else if(mQuery('#dripemailform_name').length){filterBase="dripemailform[recipients][filters]["+filterNum+"]";filterIdBase="dripemailform_recipients_filters_"+filterNum+"_";}
var operator=mQuery('#'+filterIdBase+'operator').val();try{var tempprototype=mQuery('.available-filters').data('prototype');tempprototype=tempprototype.replace(/__name__/g,filterNum);tempprototype=mQuery(tempprototype);mQuery(prototype).find('.filter-field-segment').replaceWith(mQuery(tempprototype).find('.filter-field-segment'));mQuery(prototype).find('.filter-operator-segment').replaceWith(mQuery(tempprototype).find('.filter-operator-segment'));}catch(err){alert(err);}
if(isSpecial){var templateField=fieldType;if(fieldType=='boolean'||fieldType=='multiselect'){templateField='select';}
var template=mQuery('#templates .'+templateField+'-template').clone();mQuery(template).attr('name',mQuery(template).attr('name').replace(/__name__/g,filterNum));mQuery(template).attr('id',mQuery(template).attr('id').replace(/__name__/g,filterNum));mQuery(template).prop("disabled",false);mQuery(prototype).find('input[name="'+filterBase+'[filter]"]').replaceWith(template);}
if(mQuery('#'+prefix+'_filters div.panel').length==0){mQuery(prototype).find(".panel-heading").addClass('hide');}
if(fieldObject=='company'){mQuery(prototype).find(".object-icon").removeClass('fa-user').addClass('fa-building');}else{mQuery(prototype).find(".object-icon").removeClass('fa-building').addClass('fa-user');}
mQuery(prototype).find(".inline-spacer").append(fieldObject);mQuery(prototype).find("a.remove-selected").on('click',function(){var panelholder=mQuery(this).closest('.panel').parent();mQuery(this).closest('.panel').animate({'opacity':0},'fast',function(){mQuery(this).remove();});if(panelholder.children()>0){var firstpanel=panelholder.first();mQuery(firstpanel).find("select[name='"+filterBase+"[glue]']").val('or');}});mQuery(prototype).find("input[name='"+filterBase+"[field]']").val(elId);mQuery(prototype).find("input[name='"+filterBase+"[type]']").val(fieldType);mQuery(prototype).find("input[name='"+filterBase+"[object]']").val(fieldObject);mQuery(prototype).find("input[name='"+filterBase+"[customObject]']").val(customObject);mQuery(prototype).find("input[name='"+filterBase+"[fieldlabel]']").val(label);mQuery(prototype).find("input[name='"+filterBase+"[display]']").prop("disabled",false);mQuery(prototype).find("input[name='"+filterBase+"[field]']").prop("disabled",false);mQuery(prototype).find("input[name='"+filterBase+"[type]']").prop("disabled",false);mQuery(prototype).find("input[name='"+filterBase+"[object]']").prop("disabled",false);mQuery(prototype).find("input[name='"+filterBase+"[customObject]']").prop("disabled",false);mQuery(prototype).find("input[name='"+filterBase+"[fieldlabel]']").prop("disabled",false);mQuery(prototype).find("select[name='"+filterBase+"[glue]']").prop("disabled",false);var filterEl=(isSpecial)?"select[name='"+filterBase+"[filter]']":"input[name='"+filterBase+"[filter]']";if(elId=="lead_email_activity"){mQuery(prototype).find('.email-activity-label').removeClass('hide');mQuery(prototype).find('.filter-field-segment').removeClass('col-sm-5').addClass('col-sm-2 lead_filter_padding_right');mQuery(prototype).find('.filter-operator-segment').removeClass('col-sm-2').addClass('col-sm-3');mQuery(prototype).find('.filter-operator-segment').removeClass('col-sm-2').addClass('col-sm-3');}else{mQuery(prototype).find('.email-activity-label').removeClass('hide lead_filter_padding_right').addClass('hide');}
var fields=['date_identified','last_active','date_modified','lead_email_read_date','lead_email_click_date','hit_url_date','lead_email_activity'];for(var i=0;i<fields.length;i++){if(fields[i]==elId){mQuery(prototype).find('.filter-operator-segment').removeClass('col-sm-2').addClass('col-sm-3');mQuery(prototype).find('.filter-field-segment').removeClass('col-sm-4').addClass('col-sm-3');}}
var filter='#'+filterIdBase+'filter';if(isSpecial){if(fieldType=='select'||fieldType=='multiselect'||fieldType=='boolean'){var fieldOptions=mQuery(filterId).data("field-list");mQuery.each(fieldOptions,function(index,val){if(mQuery.isPlainObject(val)){var optGroup=index;mQuery.each(val,function(index,value){mQuery('<option class="'+optGroup+'">').val(index).text(value).appendTo(filterEl);});mQuery('.'+index).wrapAll("<optgroup label='"+index+"' />");}else{mQuery('<option>').val(index).text(val).appendTo(filterEl);}});}}else if(fieldType=='lookup'){var fieldCallback=mQuery(filterId).data("field-callback");if(fieldCallback&&typeof Le[fieldCallback]=='function'){var fieldOptions=mQuery(filterId).data("field-list");Le[fieldCallback](filterIdBase+'filter',elId,fieldOptions);}}else if(fieldType=='datetime'){mQuery(filter).datetimepicker({format:'Y-m-d H:i',lazyInit:true,validateOnBlur:false,allowBlank:true,scrollMonth:false,scrollInput:false});}else if(fieldType=='date'){mQuery(filter).datetimepicker({timepicker:false,format:'Y-m-d',lazyInit:true,validateOnBlur:false,allowBlank:true,scrollMonth:false,scrollInput:false,closeOnDateSelect:true});}else if(fieldType=='time'){mQuery(filter).datetimepicker({datepicker:false,format:'H:i',lazyInit:true,validateOnBlur:false,allowBlank:true,scrollMonth:false,scrollInput:false});}else if(fieldType=='lookup_id'){var oldFilter=mQuery(filterEl);var newDisplay=mQuery(oldFilter).clone();mQuery(newDisplay).attr('name',filterBase+'[display]').attr('id',filterIdBase+'display');var oldDisplay=mQuery(prototype).find("input[name='"+filterBase+"[display]']");var newFilter=mQuery(oldDisplay).clone();mQuery(newFilter).attr('name',filterBase+'[filter]').attr('id',filterIdBase+'filter');mQuery(oldFilter).replaceWith(newFilter);mQuery(oldDisplay).replaceWith(newDisplay);var fieldCallback=mQuery(filterId).data("field-callback");if(fieldCallback&&typeof Le[fieldCallback]=='function'){var fieldOptions=mQuery(filterId).data("field-list");Le[fieldCallback](filterIdBase+'display',elId,fieldOptions);}}else{mQuery(filter).attr('type',fieldType);}
if(fieldObject=="pages"&&fieldType=="number"){mQuery(filter).attr('min',0);}
if(fieldObject=="emails"&&fieldType=="number"){mQuery(filter).attr('min',0);}
var operators=mQuery(filterId).data('field-operators');mQuery('#'+filterIdBase+'operator').html('');mQuery.each(operators,function(value,label){var newOption=mQuery('<option/>').val(value).text(label);newOption.appendTo(mQuery('#'+filterIdBase+'operator'));});Le.convertLeadFilterInput('#'+filterIdBase+'operator');};Le.leadfieldOnLoad=function(container){if(mQuery(container+' .leadfield-list').length){var bodyOverflow={};mQuery(container+' .leadfield-list tbody').sortable({handle:'.fa-ellipsis-v',helper:function(e,ui){ui.children().each(function(){mQuery(this).width(mQuery(this).width());});bodyOverflow.overflowX=mQuery('body').css('overflow-x');bodyOverflow.overflowY=mQuery('body').css('overflow-y');mQuery('body').css({overflowX:'visible',overflowY:'visible'});return ui;},scroll:false,axis:'y',containment:container+' .leadfield-list',stop:function(e,ui){mQuery('body').css(bodyOverflow);mQuery.ajax({type:"POST",url:leAjaxUrl+"?action=lead:reorder&limit="+mQuery('.pagination-limit').val()+'&page='+mQuery('.pagination li.active a span').first().text(),data:mQuery(container+' .leadfield-list tbody').sortable("serialize")});}});}
if(mQuery(container+' form[name="leadfield"]').length){Le.updateLeadFieldProperties(mQuery('#leadfield_type').val(),true);}};Le.updateSelectValueToLabel=function(valueele){var valueeleId=mQuery(valueele).attr('id');var labeleleId=valueeleId.replace("value","label");mQuery("#"+labeleleId).val(mQuery(valueele).val());};Le.updateLeadFieldProperties=function(selectedVal,onload){if(selectedVal=='multiselect'){selectedVal='select';}
if(mQuery('#field-templates .'+selectedVal).length){mQuery('#leadfield_properties').html(mQuery('#field-templates .'+selectedVal).html().replace(/leadfield_properties_template/g,'leadfield_properties'));mQuery("#leadfield_properties *[data-toggle='sortablelist']").each(function(index){var sortableList=mQuery(this);Le.activateSortable(this);var contactFieldListOptions=mQuery('#leadfield_properties').find('input').map(function(){return mQuery(this).val();}).get().join();var updateDefaultValuesetInterval=setInterval(function(){var evalListOptions=mQuery('#leadfield_properties').find('input').map(function(){return mQuery(this).val();}).get().join();if(mQuery('#leadfield_properties_itemcount').length){if(contactFieldListOptions!=evalListOptions){contactFieldListOptions=evalListOptions;var selected=mQuery('#leadfield_defaultValue').val();mQuery('#leadfield_defaultValue').html('<option value=""></option>');var labels=mQuery('#leadfield_properties').find('input.sortable-label');if(labels.length){labels.each(function(){var label=mQuery(this).val();var val=mQuery(this).closest('.row').find('input.sortable-value').first().val();mQuery('<option value="'+val+'">'+label+'</option>').appendTo(mQuery('#leadfield_defaultValue'));});}else{mQuery('#leadfield_properties .list-sortable').find('input').each(function(){var val=mQuery(this).val();mQuery('<option value="'+val+'">'+val+'</option>').appendTo(mQuery('#leadfield_defaultValue'));});}
mQuery('#leadfield_defaultValue').val(selected);mQuery('#leadfield_defaultValue').trigger('chosen:updated');}}else{clearInterval(updateDefaultValuesetInterval);delete contactFieldListOptions;}},500);});}else if(!mQuery('#leadfield_properties .'+selectedVal).length){mQuery('#leadfield_properties').html('');}
if(selectedVal=='time'){mQuery('#leadfield_isListable').closest('.row').addClass('hide');}else{mQuery('#leadfield_isListable').closest('.row').removeClass('hide');}
var defaultValueField=mQuery('#leadfield_defaultValue');if(defaultValueField.hasClass('calendar-activated')){defaultValueField.datetimepicker('destroy').removeClass('calendar-activated');}else if(mQuery('#leadfield_defaultValue_chosen').length){mQuery('#leadfield_defaultValue').chosen('destroy');}
var defaultFieldType=mQuery('input[name="leadfield[defaultValue]"]').attr('type');var tempType=selectedVal;var html='';var isSelect=false;var defaultVal=defaultValueField.val();switch(selectedVal){case'boolean':if(defaultFieldType!='radio'){html='<div id="leadfield_default_template_boolean">'+mQuery('#field-templates .default_template_boolean').html()+'</div>';}
break;case'country':case'region':case'locale':case'timezone':html=mQuery('#field-templates .default_template_'+selectedVal).html();isSelect=true;break;case'select':case'multiselect':case'lookup':html=mQuery('#field-templates .default_template_select').html();tempType='select';isSelect=true;break;case'textarea':html=mQuery('#field-templates .default_template_textarea').html();break;default:html=mQuery('#field-templates .default_template_text').html();tempType='text';if(selectedVal=='number'||selectedVal=='tel'||selectedVal=='url'||selectedVal=='email'){var replace='type="text"';var regex=new RegExp(replace,"g");html=html.replace(regex,'type="'+selectedVal+'"');}
break;}
if(html&&!onload){var replace='default_template_'+tempType;var regex=new RegExp(replace,"g");html=html.replace(regex,'defaultValue')
defaultValueField.replaceWith(mQuery(html));mQuery('#leadfield_defaultValue').val(defaultVal);}
mQuery('#leadfield_defaultValue').addClass('le-input');if(selectedVal==='datetime'||selectedVal==='date'||selectedVal==='time'){Le.activateDateTimeInputs('#leadfield_defaultValue',selectedVal);}else if(isSelect){Le.activateChosenSelect('#leadfield_defaultValue');}};Le.updateLeadFieldBooleanLabels=function(el,label){mQuery('#leadfield_defaultValue_'+label).parent().find('span').text(mQuery(el).val());};Le.refreshLeadSocialProfile=function(network,leadId,event){var query="action=lead:updateSocialProfile&network="+network+"&lead="+leadId;mQuery.ajax({showLoadingBar:true,url:leAjaxUrl,type:"POST",data:query,dataType:"json",success:function(response){if(response.success){if(response.completeProfile){mQuery('#social-container').html(response.completeProfile);mQuery('#SocialCount').html(response.socialCount);}else{mQuery.each(response.profiles,function(index,value){if(mQuery('#'+index+'CompleteProfile').length){mQuery('#'+index+'CompleteProfile').html(value.newContent);}});}}
Le.stopPageLoadingBar();Le.stopIconSpinPostEvent();},error:function(request,textStatus,errorThrown){Le.processAjaxError(request,textStatus,errorThrown);}});};Le.clearLeadSocialProfile=function(network,leadId,event){Le.startIconSpinOnEvent(event);var query="action=lead:clearSocialProfile&network="+network+"&lead="+leadId;mQuery.ajax({url:leAjaxUrl,type:"POST",data:query,dataType:"json",success:function(response){if(response.success){mQuery('.'+network+'-panelremove').click();if(response.completeProfile){mQuery('#social-container').html(response.completeProfile);}
mQuery('#SocialCount').html(response.socialCount);}
Le.stopIconSpinPostEvent();},error:function(request,textStatus,errorThrown){Le.processAjaxError(request,textStatus,errorThrown);Le.stopIconSpinPostEvent();}});};Le.refreshLeadAuditLog=function(form){Le.postForm(mQuery(form),function(response){response.target='#auditlog-table';mQuery('#AuditLogCount').html(response.auditLogCount);Le.processPageContent(response);});};Le.refreshLeadTimeline=function(form){Le.postForm(mQuery(form),function(response){response.target='#timeline-table';mQuery('#TimelineCount').html(response.timelineCount);Le.processPageContent(response);});};Le.refreshLeadNotes=function(form){Le.postForm(mQuery(form),function(response){response.target='#NoteList';mQuery('#NoteCount').html(response.noteCount);Le.processPageContent(response);});};Le.refreshSegmentContacts=function(form){Le.postForm(mQuery(form),function(response){response.target='#contacts-container';Le.processPageContent(response);});};Le.toggleLeadList=function(toggleId,leadId,listId){var action=mQuery('#'+toggleId).hasClass('fa-toggle-on')?'remove':'add';var query="action=lead:toggleLeadList&leadId="+leadId+"&listId="+listId+"&listAction="+action;Le.toggleLeadSwitch(toggleId,query,action);};Le.togglePreferredChannel=function(channel){if(channel=='all'){var status=mQuery('#lead_contact_frequency_rules_subscribed_channels_0')[0].checked;mQuery('#channels input:checkbox').each(function(){if(this.checked!=status){this.checked=status;Le.setPreferredChannel(this.value);}});}else{Le.setPreferredChannel(channel);}};Le.setPreferredChannel=function(channel){mQuery('#frequency_'+channel).slideToggle();mQuery('#frequency_'+channel).removeClass('hide');if(mQuery('#'+channel)[0].checked){mQuery('#is-contactable-'+channel).removeClass('text-muted');mQuery('#lead_contact_frequency_rules_frequency_number_'+channel).prop("disabled",false).trigger("chosen:updated");mQuery('#preferred_'+channel).prop("disabled",false);mQuery('#lead_contact_frequency_rules_frequency_time_'+channel).prop("disabled",false).trigger("chosen:updated");mQuery('#lead_contact_frequency_rules_contact_pause_start_date_'+channel).prop("disabled",false);mQuery('#lead_contact_frequency_rules_contact_pause_end_date_'+channel).prop("disabled",false);}else{mQuery('#is-contactable-'+channel).addClass('text-muted');mQuery('#lead_contact_frequency_rules_frequency_number_'+channel).prop("disabled",true).trigger("chosen:updated");mQuery('#preferred_'+channel).prop("disabled",true);mQuery('#lead_contact_frequency_rules_frequency_time_'+channel).prop("disabled",true).trigger("chosen:updated");mQuery('#lead_contact_frequency_rules_contact_pause_start_date_'+channel).prop("disabled",true);mQuery('#lead_contact_frequency_rules_contact_pause_end_date_'+channel).prop("disabled",true);}};Le.toggleCompanyLead=function(toggleId,leadId,companyId){var action=mQuery('#'+toggleId).hasClass('fa-toggle-on')?'remove':'add';var query="action=lead:toggleCompanyLead&leadId="+leadId+"&companyId="+companyId+"&companyAction="+action;Le.toggleLeadSwitch(toggleId,query,action);};Le.toggleLeadCampaign=function(toggleId,leadId,campaignId){var action=mQuery('#'+toggleId).hasClass('fa-toggle-on')?'remove':'add';var query="action=lead:toggleLeadCampaign&leadId="+leadId+"&campaignId="+campaignId+"&campaignAction="+action;Le.toggleLeadSwitch(toggleId,query,action);};Le.toggleLeadSwitch=function(toggleId,query,action){var toggleOn='fa-toggle-on text-success';var toggleOff='fa-toggle-off text-danger';var spinClass='fa-spin fa-spinner ';if(action=='remove'){mQuery('#'+toggleId).removeClass(toggleOn).addClass(spinClass+'text-danger');}else{mQuery('#'+toggleId).removeClass(toggleOff).addClass(spinClass+'text-success');}
mQuery.ajax({url:leAjaxUrl,type:"POST",data:query,dataType:"json",success:function(response){mQuery('#'+toggleId).removeClass(spinClass);if(!response.success){if(action=='remove'){mQuery('#'+toggleId).removeClass(toggleOff).addClass(toggleOn);}else{mQuery('#'+toggleId).removeClass(toggleOn).addClass(toggleOff);}}else{if(action=='remove'){mQuery('#'+toggleId).removeClass(toggleOn).addClass(toggleOff);}else{mQuery('#'+toggleId).removeClass(toggleOff).addClass(toggleOn);}}},error:function(request,textStatus,errorThrown){mQuery('#'+toggleId).removeClass(spinClass);if(action=='remove'){mQuery('#'+toggleId).removeClass(toggleOff).addClass(toggleOn);}else{mQuery('#'+toggleId).removeClass(toggleOn).addClass(toggleOff);}}});};Le.leadNoteOnLoad=function(container,response){if(response.noteHtml){var el='#LeadNote'+response.noteId;if(mQuery(el).length){mQuery(el).replaceWith(response.noteHtml);}else{mQuery('#LeadNotes').prepend(response.noteHtml);}
Le.makeModalsAlive(mQuery(el+" *[data-toggle='ajaxmodal']"));Le.makeConfirmationsAlive(mQuery(el+' a[data-toggle="confirmation"]'));Le.makeLinksAlive(mQuery(el+" a[data-toggle='ajax']"));}else if(response.deleteId&&mQuery('#LeadNote'+response.deleteId).length){mQuery('#LeadNote'+response.deleteId).remove();}
if(response.upNoteCount||response.noteCount||response.downNoteCount){var noteCountWrapper=mQuery('#NoteCount');var count=parseInt(noteCountWrapper.text().trim());if(response.upNoteCount){count++;}else if(response.downNoteCount){count--;}else{count=parseInt(response.noteCount);}
noteCountWrapper.text(count);}};Le.showSocialMediaImageModal=function(imgSrc){mQuery('#socialImageModal img').attr('src',imgSrc);mQuery('#socialImageModal').modal('show');};Le.leadImportOnLoad=function(container,response){if(!mQuery('#leadImportProgress').length){Le.clearModeratedInterval('leadImportProgress');}else{Le.setModeratedInterval('leadImportProgress','reloadLeadImportProgress',3000);}};Le.reloadLeadImportProgress=function(){if(!mQuery('#leadImportProgress').length){Le.clearModeratedInterval('leadImportProgress');}else{Le.ajaxActionRequest('lead:getImportProgress',{},function(response){if(response.progress){if(response.progress[0]>0){mQuery('.imported-count').html(response.progress[0]);mQuery('.progress-bar-import').attr('aria-valuenow',response.progress[0]).css('width',response.percent+'%');mQuery('.progress-bar-import span.sr-only').html(response.percent+'%');}}});mQuery.ajax({showLoadingBar:false,url:window.location+'?importbatch=1',success:function(response){Le.moderatedIntervalCallbackIsComplete('leadImportProgress');if(response.newContent){Le.processPageContent(response);}}});}};Le.removeBounceStatus=function(el,dncId){mQuery(el).removeClass('fa-times').addClass('fa-spinner fa-spin');Le.ajaxActionRequest('lead:removeBounceStatus','id='+dncId,function(){mQuery('#bounceLabel'+dncId).tooltip('destroy');mQuery('#bounceLabel'+dncId).fadeOut(300,function(){mQuery(this).remove();});});};Le.toggleLiveLeadListUpdate=function(){if(typeof leVars.moderatedIntervals['leadListLiveUpdate']=='undefined'){Le.setModeratedInterval('leadListLiveUpdate','updateLeadList',5000);mQuery('#liveModeButton').addClass('btn-primary');}else{Le.clearModeratedInterval('leadListLiveUpdate');mQuery('#liveModeButton').removeClass('btn-primary');}};Le.updateLeadList=function(){var maxLeadId=mQuery('#liveModeButton').data('max-id');mQuery.ajax({url:leAjaxUrl,type:"get",data:"action=lead:getNewLeads&maxId="+maxLeadId,dataType:"json",success:function(response){if(response.leads){if(response.indexMode=='list'){mQuery('#leadTable tbody').prepend(response.leads);}else{var items=mQuery(response.leads);mQuery('.shuffle-grid').prepend(items);mQuery('.shuffle-grid').shuffle('appended',items);mQuery('.shuffle-grid').shuffle('update');mQuery('#liveModeButton').data('max-id',response.maxId);}}
if(typeof IdleTimer!='undefined'&&!IdleTimer.isIdle()){if(response.indexMode=='list'){mQuery('#leadTable tr.warning').each(function(){var that=this;setTimeout(function(){mQuery(that).removeClass('warning',1000)},5000);});}else{mQuery('.shuffle-grid .highlight').each(function(){var that=this;setTimeout(function(){mQuery(that).removeClass('highlight',1000,function(){mQuery(that).css('border-top-color',mQuery(that).data('color'));})},5000);});}}
if(response.maxId){mQuery('#liveModeButton').data('max-id',response.maxId);}
Le.moderatedIntervalCallbackIsComplete('leadListLiveUpdate');},error:function(request,textStatus,errorThrown){Le.processAjaxError(request,textStatus,errorThrown);Le.moderatedIntervalCallbackIsComplete('leadListLiveUpdate');}});};Le.toggleAnonymousLeads=function(){var searchValue=mQuery('#list-search').typeahead('val');var string=mQuery('#anonymousLeadButton').data('anonymous').toLowerCase();if(searchValue.toLowerCase().indexOf('!'+string)==0){searchValue=searchValue.replace('!'+string,string);mQuery('#anonymousLeadButton').addClass('btn-primary');}else if(searchValue.toLowerCase().indexOf(string)==-1){if(searchValue){searchValue=searchValue+' '+string;}else{searchValue=string;}
searchValue=string;mQuery('#anonymousLeadButton').addClass('btn-primary');}else{searchValue=mQuery.trim(searchValue.replace(string,''));mQuery('#anonymousLeadButton').removeClass('btn-primary');}
searchValue=searchValue.replace("  "," ");Le.setSearchFilter(null,'list-search',searchValue);};Le.getLeadEmailContent=function(el){var id=(mQuery.type(el)==="string")?el:mQuery(el).attr('id');Le.activateLabelLoadingIndicator(id);var inModal=mQuery('#'+id).closest('modal').length;if(inModal){mQuery('#leSharedModal .btn-primary').prop('disabled',true);}
Le.ajaxActionRequest('lead:getEmailTemplate',{'template':mQuery(el).val()},function(response){if(inModal){mQuery('#leSharedModal .btn-primary').prop('disabled',false);}
var idPrefix=id.replace('templates','');var bodyEl=(mQuery('#'+idPrefix+'message').length)?'#'+idPrefix+'message':'#'+idPrefix+'body';mQuery(bodyEl).froalaEditor('html.set',response.body);mQuery(bodyEl).val(response.body);mQuery('#'+idPrefix+'subject').val(response.subject);Le.removeLabelLoadingIndicator();});};Le.updateLeadTags=function(){Le.activateLabelLoadingIndicator('lead_tags_tags');var formData=mQuery('form[name="lead_tags"]').serialize();Le.ajaxActionRequest('lead:updateLeadTags',formData,function(response){if(response.tags){mQuery('#lead_tags_tags').html(response.tags);mQuery('#lead_tags_tags').trigger('chosen:updated');}
Le.removeLabelLoadingIndicator();});};Le.createLeadTag=function(el){var newFound=false;mQuery('#'+mQuery(el).attr('id')+' :selected').each(function(i,selected){if(!mQuery.isNumeric(mQuery(selected).val())){newFound=true;}});var tags=JSON.stringify(mQuery(el).val());if(!newFound){Le.activateLabelLoadingIndicator(mQuery(el).attr('id'));Le.ajaxActionRequest('lead:addNumericLeadTags',{tags:tags},function(response){if(response.tags){mQuery('#'+mQuery(el).attr('id')).html(response.tags);mQuery('#'+mQuery(el).attr('id')).trigger('chosen:updated');}
Le.removeLabelLoadingIndicator();});return}
Le.activateLabelLoadingIndicator(mQuery(el).attr('id'));Le.ajaxActionRequest('lead:addLeadTags',{tags:tags},function(response){if(response.tags){mQuery('#'+mQuery(el).attr('id')).html(response.tags);mQuery('#'+mQuery(el).attr('id')).trigger('chosen:updated');}
Le.removeLabelLoadingIndicator();});};Le.createLeadUtmTag=function(el){var newFound=false;mQuery('#'+mQuery(el).attr('id')+' :selected').each(function(i,selected){if(!mQuery.isNumeric(mQuery(selected).val())){newFound=true;}});if(!newFound){return;}
Le.activateLabelLoadingIndicator(mQuery(el).attr('id'));var utmtags=JSON.stringify(mQuery(el).val());Le.ajaxActionRequest('lead:addLeadUtmTags',{utmtags:utmtags},function(response){if(response.tags){mQuery('#'+mQuery(el).attr('id')).html(response.utmtags);mQuery('#'+mQuery(el).attr('id')).trigger('chosen:updated');}
Le.removeLabelLoadingIndicator();});};Le.leadBatchSubmit=function(){if(Le.batchActionPrecheck()){var ids=Le.getCheckedListIds(false,true);if(mQuery('#lead_batch_ids').length){mQuery('#lead_batch_ids').val(ids);}else if(mQuery('#lead_batch_dnc_reason').length){mQuery('#lead_batch_dnc_ids').val(ids);}else if(mQuery('#lead_batch_stage_addstage').length){mQuery('#lead_batch_stage_ids').val(ids);}else if(mQuery('#lead_batch_owner_addowner').length){mQuery('#lead_batch_owner_ids').val(ids);}
return true;}
mQuery('#leSharedModal').modal('hide');return false;};Le.updateLeadFieldValues=function(field){mQuery('.condition-custom-date-row').hide();Le.updateFieldOperatorValue(field,'lead:updateLeadFieldValues',Le.updateLeadFieldValueOptions,[true]);};Le.updateLeadFieldValueOptions=function(field,updating){var fieldId=mQuery(field).attr('id');var fieldPrefix=fieldId.slice(0,-5);if('date'===mQuery('#'+fieldPrefix+'operator').val()){var customOption=mQuery(field).find('option[data-custom=1]');var value=mQuery(field).val();var customSelected=mQuery(customOption).prop('selected');if(customSelected){if(!updating){var regex=/(\+|-)(PT?)([0-9]*)([DMHY])$/g;var match=regex.exec(value);if(match){var interval=('-'===match[1])?match[1]+match[3]:match[3];var unit=('PT'===match[2]&&'M'===match[4])?'i':match[4];mQuery('#lead-field-custom-date-interval').val(interval);mQuery('#lead-field-custom-date-unit').val(unit.toLowerCase());}}else{var interval=mQuery('#lead-field-custom-date-interval').val();var unit=mQuery('#lead-field-custom-date-unit').val();var prefix=("i"==unit||"h"==unit)?"PT":"P";if("i"===unit){unit="m";}
unit=unit.toUpperCase();var operator="+";if(parseInt(interval)<0){operator="-";interval=-1*parseInt(interval);}
var newValue=operator+prefix+interval+unit;customOption.attr('value',newValue);}
mQuery('.condition-custom-date-row').show();}else{mQuery('.condition-custom-date-row').hide();}}else{mQuery('.condition-custom-date-row').hide();}};Le.toggleTimelineMoreVisiblity=function(el){if(mQuery(el).is(':visible')){mQuery(el).slideUp('fast');mQuery(el).next().text(leLang['showMore']);}else{mQuery(el).slideDown('fast');mQuery(el).next().text(leLang['hideMore']);}};Le.displayUniqueIdentifierWarning=function(el){if(mQuery(el).val()==="0"){mQuery('.unique-identifier-warning').fadeOut('fast');}else{mQuery('.unique-identifier-warning').fadeIn('fast');}};Le.initUniqueIdentifierFields=function(){var uniqueFields=mQuery('[data-unique-identifier]');if(uniqueFields.length){uniqueFields.on('change',function(){var input=mQuery(this);var request={field:input.data('unique-identifier'),value:input.val(),ignore:mQuery('#lead_unlockId').val()};Le.ajaxActionRequest('lead:getLeadIdsByFieldValue',request,function(response){if(response.items!=='undefined'&&response.items.length){var warning=mQuery('<div class="exists-warning" />').text(response.existsMessage);mQuery.each(response.items,function(i,item){if(i>0){warning.append(mQuery('<span>, </span>'));}
var link=mQuery('<a/>').attr('href',item.link).attr('target','_blank').text(item.name+' ('+item.id+')');warning.append(link);});warning.appendTo(input.parent());}else{input.parent().find('div.exists-warning').remove();}});});}};Le.updateFilterPositioning=function(filterBase){try{var newindex=0;mQuery('.selected-filters .filter-and-group').each(function(index,el){var filterholder=mQuery(el).find('.filter-panel-holder');var panels=filterholder.children();for(var cindex=0;cindex<panels.length;cindex++){var panel=panels[cindex];var oldindex=mQuery(panel).find('.field-name').attr("data-filter-index");mQuery(panel).find('.field-name').attr("data-filter-index",newindex);var operatorID='#'+filterBase+oldindex+'_operator';Le.replaceFilterElementsIndex(panel,operatorID,oldindex,newindex);var filterID='#'+filterBase+oldindex+'_filter';Le.replaceFilterElementsIndex(panel,filterID,oldindex,newindex);var filterchosenID='#'+filterBase+oldindex+'_filter_chosen';Le.replaceFilterElementsIndex(panel,filterchosenID,oldindex,newindex);var displayID='#'+filterBase+oldindex+'_display';Le.replaceFilterElementsIndex(panel,displayID,oldindex,newindex);var fieldID='#'+filterBase+oldindex+'_field';Le.replaceFilterElementsIndex(panel,fieldID,oldindex,newindex);var typeID='#'+filterBase+oldindex+'_type';Le.replaceFilterElementsIndex(panel,typeID,oldindex,newindex);var objectID='#'+filterBase+oldindex+'_object';Le.replaceFilterElementsIndex(panel,objectID,oldindex,newindex);var customobjectID='#'+filterBase+oldindex+'_customObject';Le.replaceFilterElementsIndex(panel,customobjectID,oldindex,newindex);var glueID='#'+filterBase+oldindex+'_glue';Le.replaceFilterElementsIndex(panel,glueID,oldindex,newindex);var fieldlabelID='#'+filterBase+oldindex+'_fieldlabel';Le.replaceFilterElementsIndex(panel,fieldlabelID,oldindex,newindex);newindex++;}});}catch(ex){alert(ex);}};Le.updateFilterGlueValue=function(filterBase){try{mQuery('.selected-filters .filter-and-group').not('.selected-filters .filter-group-template').each(function(index,el){var filterholder=mQuery(el).find('.filter-panel-holder');var panels=filterholder.children();if(panels.length>0){var panel=panels[0];var filterindex=mQuery(panel).find('.field-name').attr("data-filter-index");var glueID='#'+filterBase+'_filters_'+filterindex+'_glue';if(mQuery(panel).has(glueID).length){mQuery(panel).find(glueID).val('or');}}else{filterholder.parent().remove();}});}catch(ex){alert(ex);}};Le.replaceFilterElementsIndex=function(panel,id,oldindex,newindex)
{if(mQuery(panel).has(id).length){var el=mQuery(panel).find(id);if(typeof el.attr('name')!==typeof undefined&&el.attr('name')!==false){var nameattr=el.attr('name');nameattr=nameattr.replace('['+oldindex+']','['+newindex+']');el.attr('name',nameattr);}
if(typeof el.attr('id')!==typeof undefined&&el.attr('id')!==false){var idattr=el.attr('id');idattr=idattr.replace('_'+oldindex+'_','_'+newindex+'_');el.attr('id',idattr);}}}
Le.setAsPrimaryCompany=function(companyId,leadId){Le.ajaxActionRequest('lead:setAsPrimaryCompany',{'companyId':companyId,'leadId':leadId},function(response){if(response.success){if(response.oldPrimary==response.newPrimary&&mQuery('#company-'+response.oldPrimary).hasClass('primary')){mQuery('#company-'+response.oldPrimary).removeClass('primary');}else{mQuery('#company-'+response.oldPrimary).removeClass('primary');mQuery('#company-'+response.newPrimary).addClass('primary');}}});}
Le.showOthersField=function(selectedval){if(selectedval=="Other"){mQuery('#kycinfo_others_label').addClass('required');mQuery('#kycinfo_others_label').css("display","block");mQuery('#kycinfo_others').css("display","block");mQuery('#kycinfo_others').prop('required',true);}else{mQuery('#kycinfo_others_label').removeClass('required');mQuery('#kycinfo_others_label').css("display","none");mQuery('#kycinfo_others').css("display","none");mQuery('#kycinfo_others').prop('required',false);}}
Le.showMarketingOthersField=function(selectedval){if(selectedval=="Other"){mQuery('#marketing_others_label').addClass('required');mQuery('#marketing_others_label').css("display","block");mQuery('#kycinfo_emailcontent').css("display","block");mQuery('#kycinfo_emailcontent').prop('required',true);}else{mQuery('#marketing_others_label').removeClass('required');mQuery('#marketing_others_label').css("display","none");mQuery('#kycinfo_emailcontent').css("display","none");mQuery('#kycinfo_emailcontent').prop('required',false);}}
Le.checkImportHistory=function(){if(!mQuery('#importpanel').has('table').length>0){mQuery('#importpanel').css('border-color','#2a323c');}else{mQuery('#importpanel').css('border-color','#ffffff');}}
Le.showGSTNumber=function(selectedval){mQuery('#gstnumber_info').css("display","block");mQuery('#billinginfo_gstnumber').css("display","block");}
Le.exportLeads=function(){Le.ajaxActionRequest('lead:exportLead',{},function(response){});}
Le.leadExport=function(ele){var startIndex=mQuery('#export_startIndex').val();var endIndex=mQuery('#export_endIndex').val();var link=mQuery(ele).attr('link');if(Le.isProperExportCount(startIndex,endIndex)){mQuery('#export-field-error').addClass('hide');link=link+"&startIndex="+startIndex+"&endIndex="+endIndex;var iframe=mQuery("<iframe/>").attr({src:link,style:"visibility:hidden;display:none"}).appendTo(mQuery('body'));}else{if(startIndex==''){mQuery('#export-field-error').html("Start index can't be empty.");}else if(endIndex==''){mQuery('#export-field-error').html("Limit can't be empty.");}else{mQuery('#export-field-error').html("Limit should not be greater than 10000");}
mQuery('#export-field-error').removeClass('hide');}}
Le.isProperExportCount=function(startIndex,endIndex){if(startIndex==''||endIndex==''){return false;}
var diff=endIndex-startIndex;if(endIndex>10000){return false;}
return true;}
Le.hideActivity=function(){mQuery('#timeline-container').css('display','none');}
Le.removeHideActivity=function(){mQuery('#timeline-container').css('display','block');}
Le.isIOS=function(){return /(iPad|iPhone|iPod)/g.test(navigator.userAgent)&&!Le.isWindowsPhone();}
Le.isAndroid=function(){return /(Android)/g.test(navigator.userAgent)&&!Le.isWindowsPhone();}
Le.isBlackberry=function(){return /(Blackberry)/g.test(navigator.userAgent);}
Le.isWindowsPhone=function(){return /(Windows Phone)/gi.test(navigator.userAgent);}
Le.isMobile=function(){return Le.isAndroid()||Le.isIOS()||Le.isBlackberry();};Le.listoptinOnLoad=function(container){Le.changeListoptinTypeClass();};Le.showDoubleOptInList=function(widget){var ListType=mQuery(widget).val();if(ListType=='double'){mQuery('#doubleoptinemaillist').removeClass('hide');}else{mQuery('#doubleoptinemaillist').addClass('hide');}};Le.changeListoptinTypeClass=function(){if(mQuery('#leadlistoptin_listtype_0').prop('checked')){mQuery('.doubleoptinfields').addClass('hide');mQuery('#leadlistoptin_listtype_0').parent().removeClass('btn-danger').addClass('btn-success');}else if(mQuery('#leadlistoptin_listtype_1').prop('checked')){mQuery('.doubleoptinfields').removeClass('hide');}};Le.toggleDoubleOptinFieldVisibility=function(){setTimeout(function(){if(mQuery('#leadlistoptin_listtype_1').prop('checked')){mQuery('.doubleoptinfields').removeClass('hide');}else{mQuery('.doubleoptinfields').addClass('hide');}},10);};Le.toggleThankYouEmailListVisibility=function(){setTimeout(function(){if(mQuery('#leadlistoptin_thankyou_1').prop('checked')){mQuery('#thankyouemaillist').removeClass('hide');}else{mQuery('#thankyouemaillist').addClass('hide');}},10);};Le.toggleGoodbyeEmailListVisibility=function(){setTimeout(function(){if(mQuery('#leadlistoptin_goodbye_1').prop('checked')){mQuery('#goodbyeemaillist').removeClass('hide');}else{mQuery('#goodbyeemaillist').addClass('hide');}},10);};;Le.notificationOnLoad=function(container,response){if(mQuery(container+' #list-search').length){Le.activateSearchAutocomplete('list-search','notification');}
Le.activatePreviewPanelUpdate();};Le.selectNotificationType=function(notificationType){if(notificationType=='list'){mQuery('#leadList').removeClass('hide');mQuery('#publishStatus').addClass('hide');mQuery('.page-header h3').text(leLang.newListNotification);}else{mQuery('#publishStatus').removeClass('hide');mQuery('#leadList').addClass('hide');mQuery('.page-header h3').text(leLang.newTemplateNotification);}
mQuery('#notification_notificationType').val(notificationType);mQuery('body').removeClass('noscroll');mQuery('.notification-type-modal').remove();mQuery('.notification-type-modal-backdrop').remove();};Le.standardNotificationUrl=function(options){if(!options){return;}
var url=options.windowUrl;if(url){var editEmailKey='/notifications/edit/notificationId';var previewEmailKey='/notifications/preview/notificationId';if(url.indexOf(editEmailKey)>-1||url.indexOf(previewEmailKey)>-1){options.windowUrl=url.replace('notificationId',mQuery('#campaignevent_properties_notification').val());}}
return options;};Le.disabledNotificationAction=function(opener){if(typeof opener=='undefined'){opener=window;}
var notification=opener.mQuery('#campaignevent_properties_notification').val();var disabled=notification===''||notification===null;opener.mQuery('#campaignevent_properties_editNotificationButton').prop('disabled',disabled);};Le.activatePreviewPanelUpdate=function(){var notificationPreview=mQuery('#notification-preview');var notificationForm=mQuery('form[name="notification"]');if(notificationPreview.length&&notificationForm.length){var inputs=notificationForm.find('input,textarea');inputs.on('blur',function(){var $this=mQuery(this);var name=$this.attr('name');if(name==='notification[heading]'){notificationPreview.find('h4').text($this.val());}
if(name==='notification[message]'){notificationPreview.find('p').text($this.val());}
if(name==='notification[url]'){notificationPreview.find('span').not('.fa-bell').text($this.val());}});}};;Le.pageOnLoad=function(container,response){if(mQuery(container+' #list-search').length){Le.activateSearchAutocomplete('list-search','page.page');}
if(mQuery(container+' #page_template').length){Le.toggleBuilderButton(mQuery('#page_template').val()=='');if(mQuery(container+' select[name="page[redirectType]"]').length){Le.autoHideRedirectUrl(container);mQuery(container+' select[name="page[redirectType]"]').chosen().change(function(){Le.autoHideRedirectUrl(container);});}
Le.initSelectBeeTemplate(mQuery('#page_template'),'page');}
if(response&&response.inBuilder){Le.launchBuilder('page');Le.processBuilderErrors(response);}
Le.removeActionButtons();mQuery('.next-tab, .prevv-tab, .ui-state-default').click(function(){var selectrel=mQuery(this).attr("rel");mQuery('#page_Title').removeClass('has-success has-error');mQuery('#page_Title .help-block').addClass('hide').html("");mQuery('#redirectUrl').removeClass('has-success has-error');mQuery('#redirectUrl .help-block').html("");if(mQuery('#page_title').val()==""){mQuery('#page_Title').removeClass('has-success has-error').addClass('has-error');mQuery('#page_Title .custom-help').removeClass('hide').html("Landing Page Title name can't be empty");return;}
if(mQuery('#page_redirectUrl').is(':visible')){if(mQuery('#page_redirectUrl').val()==""){mQuery('#redirectUrl').addClass('has-error');mQuery('#redirectUrl .custom-help').html("Redirect URL can't be empty.");return;}}
if(mQuery('#page_variantSettings_weight').val()==""){mQuery('#Page_trafficweight').removeClass('has-success has-error').addClass('has-error');mQuery('#Page_trafficweight .help-block').html("Traffic Weight can't be empty");return;}else{mQuery('#Page_trafficweight').removeClass('has-success has-error');mQuery('#Page_trafficweight .help-block').html("");}
if(mQuery('#page_variantSettings_winnerCriteria').val()==""){mQuery('#Page_winnercriteria').removeClass('has-success has-error').addClass('has-error');mQuery('#Page_winnercriteria .help-block').html("Winner Criteria can't be empty");return;}else{mQuery('#Page_winnercriteria').removeClass('has-success has-error');mQuery('#Page_winnercriteria .help-block').html("");}
var selectrel=mQuery(this).attr("rel");mQuery(".ui-tabs-panel").addClass('hide');mQuery("#fragment-page-"+selectrel).removeClass('hide');mQuery(".ui-state-default").removeClass('ui-tabs-selected ui-state-active');mQuery("#ui-tab-page-header"+selectrel).addClass('ui-tabs-selected ui-state-active');if(mQuery('#ui-tab-page-header2').hasClass('ui-tabs-selected'))
{if(!mQuery('#email-content-preview').hasClass('hide')){mQuery('#builder_btn').removeClass('hide');}}else{mQuery('#builder_btn').addClass('hide');}
if(!mQuery('#email-advance-container').hasClass('hide')){var url=window.location.href;if(url.indexOf('pages/new')==-1){if(mQuery('textarea.builder-html').val()!='false'&&mQuery('textarea.builder-html').val().indexOf("false")<0&&mQuery('textarea.builder-html').val()!=''){mQuery('#builder_btn').removeClass('hide');Le.showpreviewoftemplate(mQuery('textarea.builder-html').val());}}}});Le.filterBeeTemplates=function(){d=document.getElementById("template_filters").value;if(d=="all"){mQuery('.bee-template').removeClass('hide');}else{mQuery('.bee-template').addClass('hide');mQuery('.'+d).removeClass('hide');}};};Le.getPageAbTestWinnerForm=function(abKey){if(abKey&&mQuery(abKey).val()&&mQuery(abKey).closest('.form-group').hasClass('has-error')){mQuery(abKey).closest('.form-group').removeClass('has-error');if(mQuery(abKey).next().hasClass('help-block')){mQuery(abKey).next().remove();}}
Le.activateLabelLoadingIndicator('page_variantSettings_winnerCriteria');var pageId=mQuery('#page_sessionId').val();var query="action=page:getAbTestForm&abKey="+mQuery(abKey).val()+"&pageId="+pageId;mQuery.ajax({url:leAjaxUrl,type:"POST",data:query,dataType:"json",success:function(response){if(typeof response.html!='undefined'){if(mQuery('#page_variantSettings_properties').length){mQuery('#page_variantSettings_properties').replaceWith(response.html);}else{mQuery('#page_variantSettings').append(response.html);}
if(response.html!=''){Le.onPageLoad('#page_variantSettings_properties',response);}}
Le.removeLabelLoadingIndicator();},error:function(request,textStatus,errorThrown){Le.processAjaxError(request,textStatus,errorThrown);spinner.remove();},complete:function(){Le.removeLabelLoadingIndicator();}});};Le.autoHideRedirectUrl=function(container){var select=mQuery(container+' select[name="page[redirectType]"]');var input=mQuery(container+' input[name="page[redirectUrl]"]');if(select.val()==''){input.closest('.form-group').hide();input.val('');}else{input.closest('.form-group').show();}};Le.openPluginModel=function(id){mQuery('#'+id).removeClass('hide').addClass('fade in');}
Le.closePluginModel=function(id){mQuery('#'+id).removeClass('fade in').addClass('hide');}
Le.openFormCreator=function(){Le.ajaxActionRequest('page:getFormsList',{},function(response){var formlist=response.forms;var tborder="<select border='1' id='page_formSelect' class='form-control category-select le-input' onclick='Le.onFormSelectinPage(this.options[this.selectedIndex].value);'>";var i=0;var firstValue="";for(var key in formlist){var val=key;var title=formlist[key];var value='<option class="active-result" value="'+key+'" > '+title+'</option>';tborder+=value;if(i==0){firstValue=key;}
i++;}
tborder+="</select>";mQuery('.insert-tokens').html(tborder);Le.onFormSelectinPage(firstValue);});mQuery('#bee-plugin-model').removeClass('fade in').addClass('hide');mQuery('#bee-plugin-form-creator').removeClass('hide').addClass('fade in');}
Le.onFormSelectinPage=function(ele){var base_url=window.location.origin+leBaseUrl;if(ele!=''){var iframeurl=base_url+"form/"+ele;var iframeinput='<iframe style="border: 0px solid;" src="'+iframeurl+'" width="350" height="350"><p>Your browser does not support iframes.</p></iframe>';}
mQuery('#iframe_textarea_page').val(iframeinput);}
Le.openVideoEmbedModel=function(){mQuery('#bee-plugin-model').removeClass('fade in').addClass('hide');mQuery('#bee-plugin-video-embed').removeClass('hide').addClass('fade in');}
Le.ConvertURLtoEmbed=function(){var url=mQuery('#youtube_url').val();if(mQuery('#youtube_url').val()==""){mQuery('#youtube_u').removeClass('has-success has-error').addClass('has-error');mQuery('#youtube_u .help-block').html("The Value Can't be Empty");}
else{mQuery('#youtube_u').removeClass('has-error');mQuery('#youtube_u .help-block').html("");var url=mQuery('#youtube_url').val();var videoId=this.getYoutubeVideoID(url);var iframeMarkup='<iframe width="560" height="315" src="//www.youtube.com/embed/'
+videoId+'?rel=0&amp;showinfo=0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>';mQuery('#iframe_textarea_videopage').val(iframeMarkup);}}
Le.getYoutubeVideoID=function(url){var regExp=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;var match=url.match(regExp);if(match&&match[2].length==11){return match[2];}else{return'error';}};if(typeof MauticPrefCenterLoaded==='undefined'){var MauticPrefCenterLoaded=true;function replaceSlotParams(slot){var i;var text=slot.dataset['paramLabelText'];if(text){setLabelText(slot,'label.control-label',text);var channels=slot.querySelectorAll('label[data-channel]');for(i=0;i<channels.length;i++){channels[i].innerHTML=text.replace('%channel%',channels[i].dataset['channel']);}}
var numOfLabelsInSlot=4;for(i=1;i<=numOfLabelsInSlot;i++){text=slot.dataset['paramLabelText'+i];if(typeof text!=="undefined"){setLabelText(slot,'label.label'+i,text);}}}
function setLabelText(slot,querySelector,text){var labels=slot.querySelectorAll(querySelector);for(var i=0;i<labels.length;i++){labels[i].innerHTML=text;}}
var callback=function(){var slots=document.querySelectorAll('div[data-slot="segmentlist"], div[data-slot="categorylist"], div[data-slot="preferredchannel"], div[data-slot="channelfrequency"]');for(var i=0;i<slots.length;i++){replaceSlotParams(slots[i]);}};if(document.readyState==="complete"||!(document.readyState==="loading"||document.documentElement.doScroll)){callback();}else{document.addEventListener("DOMContentLoaded",callback);}
function togglePreferredChannel(channel){var status=document.getElementById(channel).checked;if(status){document.getElementById('lead_contact_frequency_rules_frequency_number_'+channel).disabled=false;document.getElementById('lead_contact_frequency_rules_frequency_time_'+channel).disabled=false;document.getElementById('lead_contact_frequency_rules_contact_pause_start_date_'+channel).disabled=false;document.getElementById('lead_contact_frequency_rules_contact_pause_end_date_'+channel).disabled=false;}else{document.getElementById('lead_contact_frequency_rules_frequency_number_'+channel).disabled=true;document.getElementById('lead_contact_frequency_rules_frequency_time_'+channel).disabled=true;document.getElementById('lead_contact_frequency_rules_contact_pause_start_date_'+channel).disabled=true;document.getElementById('lead_contact_frequency_rules_contact_pause_end_date_'+channel).disabled=true;}}
function saveUnsubscribePreferences(formId){var forms=document.getElementsByName(formId);for(var i=0;i<forms.length;i++){if(forms[i].tagName==='FORM'){forms[i].submit();}}}};Le.matchedFields=function(index,object,integration){var compoundMauticFields=['mauticContactTimelineLink'];if(mQuery('#integration_details_featureSettings_updateDncByDate_0').is(':checked')){compoundMauticFields.push('mauticContactIsContactableByEmail');}
var integrationField=mQuery('#integration_details_featureSettings_'+object+'Fields_i_'+index).attr('data-value');var mauticField=mQuery('#integration_details_featureSettings_'+object+'Fields_m_'+index+' option:selected').val();if(mQuery.inArray(mauticField,compoundMauticFields)>=0){mQuery('.btn-arrow'+index).removeClass('active');mQuery('#integration_details_featureSettings_'+object+'Fields_update_mautic'+index+'_0').attr('checked','checked');mQuery('input[name="integration_details[featureSettings]['+object+'Fields][update_mautic'+index+']"]').prop('disabled',true).trigger("chosen:updated");mQuery('.btn-arrow'+index).addClass('disabled');}else{mQuery('input[name="integration_details[featureSettings]['+object+'Fields][update_mautic'+index+']"]').prop('disabled',false).trigger("chosen:updated");mQuery('.btn-arrow'+index).removeClass('disabled');}
if(object=='lead'){var updateMauticField=mQuery('input[name="integration_details[featureSettings]['+object+'Fields][update_mautic'+index+']"]:checked').val();}else{var updateMauticField=mQuery('input[name="integration_details[featureSettings]['+object+'Fields][update_mautic_company'+index+']"]:checked').val();}
Le.ajaxActionRequest('plugin:matchFields',{object:object,integration:integration,integrationField:integrationField,mauticField:mauticField,updateMautic:updateMauticField},function(response){var theMessage=(response.success)?'<i class="fa fa-check-circle text-success"></i>':'';mQuery('#matched-'+index+"-"+object).html(theMessage);});};Le.initiateIntegrationAuthorization=function(){mQuery('#integration_details_in_auth').val(1);Le.postForm(mQuery('form[name="integration_details"]'),'loadIntegrationAuthWindow');};Le.loadIntegrationAuthWindow=function(response){if(response.newContent){Le.processModalContent(response,'#IntegrationEditModal');}else{Le.stopPageLoadingBar();Le.stopIconSpinPostEvent();mQuery('#integration_details_in_auth').val(0);if(response.authUrl){var generator=window.open(response.authUrl,'integrationauth','height=500,width=500');if(!generator||generator.closed||typeof generator.closed=='undefined'){alert(leLang.popupBlockerMessage);}}}};Le.refreshIntegrationForm=function(){var opener=window.opener;if(opener){var form=opener.mQuery('form[name="integration_details"]');if(form.length){var action=form.attr('action');if(action){opener.Le.startModalLoadingBar('#IntegrationEditModal');opener.Le.loadAjaxModal('#IntegrationEditModal',action);}}}
window.close()};Le.integrationOnLoad=function(container,response){if(response&&response.name){var integration='.integration-'+response.name;if(response.enabled){mQuery(integration).removeClass('integration-disabled');}else{mQuery(integration).addClass('integration-disabled');}}else{Le.filterIntegrations();}
mQuery('[data-toggle="tooltip"]').tooltip();};Le.integrationConfigOnLoad=function(container){mQuery('html, body').animate({scrollTop:0},'100');if(mQuery('.fields-container select.integration-field').length){var selects=mQuery('.fields-container select.integration-field');selects.on('change',function(){var select=mQuery(this),newValue=select.val(),previousValue=select.attr('data-value');select.attr('data-value',newValue);var groupSelects=mQuery(this).closest('.fields-container').find('select.integration-field').not(select);if(previousValue){mQuery('option[value="'+previousValue+'"]',groupSelects).each(function(){if(!mQuery(this).closest('select').prop('disabled')){mQuery(this).prop('disabled',false);mQuery(this).removeAttr('disabled');}});}
if(newValue){mQuery('option[value="'+newValue+'"]',groupSelects).each(function(){if(!mQuery(this).closest('select').prop('disabled')){mQuery(this).prop('disabled',true);mQuery(this).attr('disabled','disabled');}});}
groupSelects.each(function(){mQuery(this).trigger('chosen:updated');});});selects.each(function(){if(!mQuery(this).closest('.field-container').hasClass('hide')){mQuery(this).trigger('change');}});}
mQuery('#mapping-container .btn-new-field-mapping').off().on('click',function(){var mappingIndex=parseInt(mQuery('.integration_field_mapping').attr("data-index"));mQuery('.integration_field_mapping').attr("data-index",mappingIndex+1);var prototype=mQuery('.integration_field_mapping').data('prototype');prototype=prototype.replace(/__name__/g,mappingIndex);prototype=mQuery(prototype);var localList=mQuery(prototype).find('#integration_field_mapping_field_mapping_'+mappingIndex+'_localfield');Le.activateChosenSelect(localList);var remoteList=mQuery(prototype).find('#integration_field_mapping_field_mapping_'+mappingIndex+'_remotefield');Le.activateChosenSelect(remoteList);mQuery(prototype).appendTo(mQuery('.integration_field_mapping'));Le.registerEventsForMappingRemove();Le.registerEventsForMappingLists();});mQuery('#mapping-container .btn-save-field-mapping').off().on('click',function(){mQuery('form[name="integration_field_mapping"]').submit();});Le.registerEventsForMappingRemove();Le.createDefaultFieldMapping();Le.registerEventsForMappingLists();};Le.filterIntegrations=function(update){var filter=mQuery('#integrationFilter').val();if(update){mQuery.ajax({url:leAjaxUrl,type:"POST",data:"action=plugin:setIntegrationFilter&plugin="+filter});}
if(mQuery('.shuffle-integrations').length){var grid=mQuery(".shuffle-integrations");setTimeout(function(){grid.shuffle('shuffle',function($el,shuffle){if(filter){return $el.hasClass('plugin'+filter);}else{return true;}});mQuery("html").on("fa.sidebar.minimize",function(){grid.shuffle("update");}).on("fa.sidebar.maximize",function(){grid.shuffle("update");});},500);}};Le.getIntegrationLeadFields=function(integration,el,settings){if(typeof settings=='undefined'){settings={};}
settings.integration=integration;settings.object='lead';Le.getIntegrationFields(settings,1,el);};Le.getIntegrationCompanyFields=function(integration,el,settings){if(typeof settings=='undefined'){settings={};}
settings.integration=integration;settings.object='company';Le.getIntegrationFields(settings,1,el);};Le.getIntegrationFields=function(settings,page,el){var object=settings.object?settings.object:'lead';var fieldsTab=('lead'===object)?'#fields-tab':'#'+object+'-fields-container';if(el&&mQuery(el).is('input')){Le.activateLabelLoadingIndicator(mQuery(el).attr('id'));var namePrefix=mQuery(el).attr('name').split('[')[0];if('integration_details'!==namePrefix){var nameParts=mQuery(el).attr('name').match(/\[.*?\]+/g);nameParts=nameParts.slice(0,-1);settings.prefix=namePrefix+nameParts.join('')+"["+object+"Fields]";}}
var fieldsContainer='#'+object+'FieldsContainer';var inModal=mQuery(fieldsContainer).closest('.modal');if(inModal){var modalId='#'+mQuery(fieldsContainer).closest('.modal').attr('id');Le.startModalLoadingBar(modalId);}
Le.ajaxActionRequest('plugin:getIntegrationFields',{page:page,integration:(settings.integration)?settings.integration:null,settings:settings},function(response){if(response.success){mQuery(fieldsContainer).replaceWith(response.html);Le.onPageLoad(fieldsContainer);Le.integrationConfigOnLoad(fieldsContainer);if(mQuery(fieldsTab).length){mQuery(fieldsTab).removeClass('hide');}}else{if(mQuery(fieldsTab).length){mQuery(fieldsTab).addClass('hide');}}
if(el){Le.removeLabelLoadingIndicator();}
if(inModal){Le.stopModalLoadingBar(modalId);}});};Le.getIntegrationConfig=function(el,settings){Le.activateLabelLoadingIndicator(mQuery(el).attr('id'));if(typeof settings=='undefined'){settings={};}
settings.name=mQuery(el).attr('name');var data={integration:mQuery(el).val(),settings:settings};mQuery('.integration-campaigns-status').html('');mQuery('.integration-config-container').html('');Le.ajaxActionRequest('plugin:getIntegrationConfig',data,function(response){if(response.success){mQuery('.integration-config-container').html(response.html);Le.onPageLoad('.integration-config-container',response);}
Le.integrationConfigOnLoad('.integration-config-container');Le.removeLabelLoadingIndicator();});};Le.getIntegrationCampaignStatus=function(el,settings){Le.activateLabelLoadingIndicator(mQuery(el).attr('id'));if(typeof settings=='undefined'){settings={};}
var prefix=mQuery(el).attr('name').split("[")[0];settings.name=mQuery('#'+prefix+'_properties_integration').attr('name');var data={integration:mQuery('#'+prefix+'_properties_integration').val(),campaign:mQuery(el).val(),settings:settings};mQuery('.integration-campaigns-status').html('');mQuery('.integration-campaigns-status').removeClass('hide');Le.ajaxActionRequest('plugin:getIntegrationCampaignStatus',data,function(response){if(response.success){mQuery('.integration-campaigns-status').append(response.html);Le.onPageLoad('.integration-campaigns-status',response);}
Le.integrationConfigOnLoad('.integration-campaigns-status');Le.removeLabelLoadingIndicator();});};Le.getIntegrationCampaigns=function(el,settings){Le.activateLabelLoadingIndicator(mQuery(el).attr('id'));var data={integration:mQuery(el).val()};mQuery('.integration-campaigns').html('');Le.ajaxActionRequest('plugin:getIntegrationCampaigns',data,function(response){if(response.success){mQuery('.integration-campaigns').html(response.html);Le.onPageLoad('.integration-campaigns',response);}
Le.integrationConfigOnLoad('.integration-campaigns');Le.removeLabelLoadingIndicator();});};Le.loadLeadAdsForm=function(pageId){var eventType='campaignevent_properties_leadgenform';var query="action=plugin:loadLeadAdsForm&pageId="+pageId;if(pageId=="-1"){mQuery("#fbldads-leadgenform").addClass('hide');}else{mQuery("#fbldads-leadgenform").removeClass('hide');}
Le.activateLabelLoadingIndicator(eventType);mQuery.ajax({url:leAjaxUrl,type:"POST",data:query,dataType:"json",success:function(response){if(response.success){var templateOptions=response.values;mQuery('#'+eventType).html('');if(mQuery('#'+eventType+'_chosen').length){mQuery('#'+eventType).chosen('destroy');}
mQuery.each(templateOptions,function(value,label){var newOption=mQuery('<option/>').val(value).text(label);newOption.appendTo(mQuery('#'+eventType));});Le.activateChosenSelect('#'+eventType);}},complete:function(){Le.removeLabelLoadingIndicator();}});}
Le.loadCustomAudiences=function(adAccount){var eventType='campaignevent_properties_customaudience';var query="action=plugin:loadCustomAudience&adAccount="+adAccount;Le.activateLabelLoadingIndicator(eventType);mQuery.ajax({url:leAjaxUrl,type:"POST",data:query,dataType:"json",success:function(response){if(response.success){var templateOptions=response.values;mQuery('#'+eventType).html('');if(mQuery('#'+eventType+'_chosen').length){mQuery('#'+eventType).chosen('destroy');}
mQuery.each(templateOptions,function(value,label){var newOption=mQuery('<option/>').val(value).text(label);newOption.appendTo(mQuery('#'+eventType));});Le.activateChosenSelect('#'+eventType);}},complete:function(){Le.removeLabelLoadingIndicator();}});};Le.saveTokenvalue=function(name){var tokenvalue=mQuery("#"+name+"-token-value").val();mQuery("."+name+"-container .help-block").addClass('hide');mQuery("."+name+"-container").removeClass('has-error');if(tokenvalue==""){mQuery("."+name+"-container").addClass('has-error');mQuery("."+name+"-container .help-block").removeClass('hide');return;}
var data={token:tokenvalue,integrationname:name,};Le.ajaxActionRequest('plugin:saveTokenvalue',data,function(response){if(response.success){Le.redirectWithBackdrop(response.redirect);}});};Le.removeTokenvalue=function(name){if(confirm(Le.translate('Are you sure want to remove token?'))){}else{return;}
var data={integrationname:name,};Le.ajaxActionRequest('plugin:removeTokenvalue',data,function(response){if(response.success){Le.redirectWithBackdrop(response.redirect);}});};Le.createDefaultFieldMapping=function(){try{var mappingindex=mQuery('.integration_field_mapping').attr("data-index");if(mappingindex==1){mQuery("#mapping-container .btn-new-field-mapping").trigger("click");}}catch(err){alert(err);}}
Le.registerEventsForMappingRemove=function(){mQuery('.integration_field_mapping .remove-selected').each(function(index,el){mQuery(el).off().on('click',function(){mQuery(this).closest('.panel').animate({'opacity':0},'fast',function(){mQuery(this).remove();Le.updateFieldMappingPositioning();});});});}
Le.replaceMappingElementsIndex=function(panel,id,oldindex,newindex)
{if(mQuery(panel).has(id).length){var el=mQuery(panel).find(id);if(typeof el.attr('name')!==typeof undefined&&el.attr('name')!==false){var nameattr=el.attr('name');nameattr=nameattr.replace('['+oldindex+']','['+newindex+']');el.attr('name',nameattr);}
if(typeof el.attr('id')!==typeof undefined&&el.attr('id')!==false){var idattr=el.attr('id');idattr=idattr.replace('_'+oldindex+'_','_'+newindex+'_');el.attr('id',idattr);}}}
Le.updateFieldMappingPositioning=function(){try{var newindex=0;var mappingBase='integration_field_mapping_field_mapping_';var mappingHolder=mQuery('.integration_field_mapping');var panels=mappingHolder.children();for(var cindex=0;cindex<panels.length;cindex++){var panel=panels[cindex];var oldindex=mQuery(panel).attr("data-mapping-index");mQuery(panel).attr("data-mapping-index",newindex);var localfield='#'+mappingBase+oldindex+'_localfield';Le.replaceMappingElementsIndex(panel,localfield,oldindex,newindex);var localfieldChosen='#'+mappingBase+oldindex+'_localfield_chosen';Le.replaceMappingElementsIndex(panel,localfieldChosen,oldindex,newindex);var remotefield='#'+mappingBase+oldindex+'_remotefield';Le.replaceMappingElementsIndex(panel,remotefield,oldindex,newindex);var remotefieldChosen='#'+mappingBase+oldindex+'_remotefield_chosen';Le.replaceMappingElementsIndex(panel,remotefieldChosen,oldindex,newindex);var defaultfield='#'+mappingBase+oldindex+'_defaultvalue';Le.replaceMappingElementsIndex(panel,defaultfield,oldindex,newindex);newindex++;}
mQuery('.integration_field_mapping').attr("data-index",newindex);}catch(ex){alert(ex);}};Le.registerEventsForMappingLists=function(){mQuery('.integration_field_mapping .local-mapping-fields').off().on('change',function(){if(mQuery(this).val()){var prototype=mQuery(this).closest('.panel');var mappingIndex=prototype.attr('data-mapping-index');var fieldname=mQuery(this).val();if(Le.integration_fieldmapping_details[fieldname]){var tmpprototype=mQuery('.integration_field_mapping').data('prototype');tmpprototype=tmpprototype.replace(/__name__/g,mappingIndex);tmpprototype=mQuery(tmpprototype);mQuery(prototype).find('.mapping-default-segment').replaceWith(mQuery(tmpprototype).find('.mapping-default-segment'));var fieldType=Le.integration_fieldmapping_details[fieldname]['type'];var fieldAlias=Le.integration_fieldmapping_details[fieldname]['alias'];var nameAttr='integration_field_mapping[field_mapping]['+mappingIndex+'][defaultvalue]';var mappingdefaultEl="input[name='"+nameAttr+"']";if(fieldType=='select'||fieldType=='multiselect'||fieldType=='boolean'){var fieldOptions=Le.integration_fieldmapping_details[fieldname]['properties'];var selectEl=mQuery('<select>');selectEl.attr('class','form-control not-chosen');selectEl.attr('name',nameAttr);selectEl.attr('id','integration_field_mapping_field_mapping_'+mappingIndex+'_defaultvalue');mQuery(prototype).find('input[name="'+nameAttr+'"]').replaceWith(selectEl);mappingdefaultEl="select[name='"+nameAttr+"']";if(fieldAlias!='eu_gdpr_consent'){mQuery('<option>').val('').text('choose one...').appendTo(mappingdefaultEl);}
mQuery.each(fieldOptions,function(index,val){if(mQuery.isPlainObject(val)){mQuery('<option>').val(val.value).text(val.label).appendTo(mappingdefaultEl);}else{mQuery('<option>').val(index).text(val).appendTo(mappingdefaultEl);}});Le.activateChosenSelect(mQuery(mappingdefaultEl));}else if(fieldType=='owner_id'||fieldType=='leadlist'||fieldType=='listoptin'||fieldType=='tags'||fieldType=='country'||fieldType=='timezone'){var selectEl=mQuery('<select>');selectEl.attr('class','form-control not-chosen');selectEl.attr('name',nameAttr);selectEl.attr('id','integration_field_mapping_field_mapping_'+mappingIndex+'_defaultvalue');mQuery(prototype).find('input[name="'+nameAttr+'"]').replaceWith(selectEl);mappingdefaultEl="select[name='"+nameAttr+"']";if(fieldType=='country'||fieldType=='timezone'){var fieldOptions=Le.integration_property_choices[fieldType];}else
{var fieldOptions=Le.integration_property_choices[fieldname];}
mQuery('<option>').val('').text('choose one...').appendTo(mappingdefaultEl);mQuery.each(fieldOptions,function(index,val){if(mQuery.isPlainObject(val)){mQuery('<option>').val(val.value).text(val.label).appendTo(mappingdefaultEl);}else{mQuery('<option>').val(index).text(val).appendTo(mappingdefaultEl);}});Le.activateChosenSelect(mQuery(mappingdefaultEl));}else if(fieldType=='region'){var selectEl=mQuery('<select>');selectEl.attr('class','form-control not-chosen');selectEl.attr('name',nameAttr);selectEl.attr('id','integration_field_mapping_field_mapping_'+mappingIndex+'_defaultvalue');mQuery(prototype).find('input[name="'+nameAttr+'"]').replaceWith(selectEl);mappingdefaultEl="select[name='"+nameAttr+"']";var fieldOptions=Le.integration_property_choices[fieldType];mQuery('<option>').val('').text('choose one...').appendTo(mappingdefaultEl);mQuery.each(fieldOptions,function(index,val){mQuery.each(val,function(index1,val1){if(mQuery.isPlainObject(val1)){mQuery('<option>').val(val1.value).text(val1.label).appendTo(mappingdefaultEl);}else{mQuery('<option>').val(index1).text(val1).appendTo(mappingdefaultEl);}});});Le.activateChosenSelect(mQuery(mappingdefaultEl));}else if(fieldType=='datetime'){mQuery(mappingdefaultEl).datetimepicker({format:'Y-m-d H:i',lazyInit:true,validateOnBlur:false,allowBlank:true,scrollInput:false});}else if(fieldType=='date'){mQuery(mappingdefaultEl).datetimepicker({timepicker:false,format:'Y-m-d',lazyInit:true,validateOnBlur:false,allowBlank:true,scrollInput:false,closeOnDateSelect:true});}else if(fieldType=='time'){mQuery(mappingdefaultEl).datetimepicker({datepicker:false,format:'H:i',lazyInit:true,validateOnBlur:false,allowBlank:true,scrollInput:false,defaultTime:false});}else{mQuery(mappingdefaultEl).attr('type',fieldType);}}}});}
Le.activateSpinner=function(el){var id='#'+el.id;mQuery(id+' i').removeClass('hide');}
Le.refreshPayloadHistory=function(integrationName){var data={integrationname:integrationName,};Le.ajaxActionRequest('plugin:refreshPayLoad',data,function(response){if(response.success){mQuery('#payload-container').html("");mQuery('#payload-container').html(response.html);}});};Le.slackOnLoad=function(){Le.getTokens('email:getBuilderTokens',function(tokens){mQuery.each(tokens,function(k,v){if(!k.match(/leadfield=/i)){delete tokens[k];}
if(k.match(/leadfield=created_source/i)||k.match(/leadfield=status/i)){delete tokens[k];}});var k,keys=[];for(k in tokens){if(tokens.hasOwnProperty(k)){keys.push(k);}}
var tborder="<div border='1' class='email-subject-table' ><tbody style='background-color:whitesmoke;'><tr>";for(var i=0;i<keys.length;i++){var val=keys[i];var title=tokens[val];if(i%3==0&&i!=0){tborder+="</tr><tr>";}
var value='<li class="email-subject-table-border"><a class="email-subject-token" id="insert-value" data-cmd="inserttoken" data-email-token="'+val+'" title="'+title+'">'+title+'</a></li>';tborder+=value;}
tborder+="</div>";mQuery('.insert-tokens').html(tborder);mQuery('[data-email-token]').click(function(e){e.preventDefault();var currentLink=mQuery(this);var value=currentLink.attr('data-email-token');var subValue=mQuery('#slack_message').val();if(subValue==''){mQuery("#slack_message").val(value);}else{if(subValue.includes(value)){}else{var cursorPos=mQuery('#slack_message').prop('selectionStart');var v=subValue;var textBefore=v.substring(0,cursorPos);var textAfter=v.substring(cursorPos,v.length);mQuery('#slack_message').val(textBefore+value+textAfter);}}});});};;Le.pointOnLoad=function(container){if(mQuery(container+' #list-search').length){Le.activateSearchAutocomplete('list-search','point');}
Le.removeActionButtons();var value=mQuery('#point_properties_campaigntype').val();Le.getSelectedCampaignValue(value);};Le.pointTriggerOnLoad=function(container){if(mQuery(container+' #list-search').length){Le.activateSearchAutocomplete('list-search','point.trigger');}
if(mQuery('#triggerEvents')){mQuery('#triggerEvents').sortable({items:'.trigger-event-row',handle:'.reorder-handle',stop:function(i){mQuery.ajax({type:"POST",url:leAjaxUrl+"?action=point:reorderTriggerEvents",data:mQuery('#triggerEvents').sortable("serialize")+"&triggerId="+mQuery('#pointtrigger_sessionId').val()});}});mQuery('#triggerEvents .trigger-event-row').on('mouseover.triggerevents',function(){mQuery(this).find('.form-buttons').removeClass('hide');}).on('mouseout.triggerevents',function(){mQuery(this).find('.form-buttons').addClass('hide');}).on('dblclick.triggerevents',function(event){event.preventDefault();mQuery(this).find('.btn-edit').first().click();});}};Le.pointTriggerEventOnLoad=function(container,response){if(response.eventHtml){var newHtml=response.eventHtml;var eventId='#triggerEvent_'+response.eventId;if(mQuery(eventId).length){mQuery(eventId).replaceWith(newHtml);var newField=false;}else{mQuery(newHtml).appendTo('#triggerEvents');var newField=true;}
mQuery(eventId+" *[data-toggle='tooltip']").tooltip({html:true});mQuery(eventId+" a[data-toggle='ajax']").click(function(event){event.preventDefault();return Le.ajaxifyLink(this,event);});mQuery(eventId+" a[data-toggle='ajaxmodal']").on('click.ajaxmodal',function(event){event.preventDefault();Le.ajaxifyModal(this,event);});mQuery('#triggerEvents .trigger-event-row').off(".triggerevents");mQuery('#triggerEvents .trigger-event-row').on('mouseover.triggerevents',function(){mQuery(this).find('.form-buttons').removeClass('hide');}).on('mouseout.triggerevents',function(){mQuery(this).find('.form-buttons').addClass('hide');}).on('dblclick.triggerevents',function(event){event.preventDefault();mQuery(this).find('.btn-edit').first().click();});if(!mQuery('#events-panel').hasClass('in')){mQuery('a[href="#events-panel"]').trigger('click');}
if(mQuery('#triggerEventPlaceholder').length){mQuery('#triggerEventPlaceholder').remove();}}};Le.getPointActionPropertiesForm=function(actionType){Le.activateLabelLoadingIndicator('point_type');var query="action=point:getActionForm&actionType="+actionType;mQuery.ajax({url:leAjaxUrl,type:"POST",data:query,dataType:"json",success:function(response){if(typeof response.html!='undefined'){mQuery('#pointActionProperties').html(response.html);Le.onPageLoad('#pointActionProperties',response);}},error:function(request,textStatus,errorThrown){Le.processAjaxError(request,textStatus,errorThrown);},complete:function(){Le.removeLabelLoadingIndicator();}});};Le.EnablesOption=function(urlActionProperty){if(urlActionProperty==='point_properties_returns_within'&&mQuery('#point_properties_returns_within').val()>0){mQuery('#point_properties_returns_after').val(0);}else{if(urlActionProperty==='point_properties_returns_after'&&mQuery('#point_properties_returns_after').val()>0){mQuery('#point_properties_returns_within').val(0);}}};Le.getSelectedCampaignValue=function(value){if(value=="broadcast"){var formType='point_properties_driplist';if(mQuery(location).attr('href').includes("workflows")){formType='campaignevent_properties_driplist';}
Le.resetDropDownValues(formType);mQuery('#pointemailaction').removeClass('hide');mQuery('#pointdripemailaction').addClass('hide');mQuery('#dripemaillist').addClass('hide');}else if(value=="drip"){var formType='point_properties_emails';if(mQuery(location).attr('href').includes("workflows")){formType='campaignevent_properties_emails';}
Le.resetDropDownValues(formType);mQuery('#pointdripemailaction').removeClass('hide');mQuery('#point_properties_dripemail').removeClass('hide');var dripList=mQuery('#point_properties_dripemail').val();if(dripList!=''){mQuery('#dripemaillist').removeClass('hide');}
mQuery('#pointemailaction').addClass('hide');}else{mQuery('#pointdripemailaction').addClass('hide');mQuery('#pointemailaction').addClass('hide');mQuery('#dripemaillist').addClass('hide');}};Le.convertDripFilterInput=function(templateId){var eventType='point_properties_driplist';if(mQuery(location).attr('href').includes("workflows")){eventType='campaignevent_properties_driplist';}
var query="action=point:getDripFilterInput&templateId="+templateId;Le.activateLabelLoadingIndicator(eventType);mQuery('#dripemaillist').removeClass('hide');mQuery.ajax({url:leAjaxUrl,type:"POST",data:query,dataType:"json",success:function(response){if(response.success){var templateOptions=response.values;mQuery('#'+eventType).html('');if(mQuery('#'+eventType+'_chosen').length){mQuery('#'+eventType).chosen('destroy');}
mQuery.each(templateOptions,function(value,label){var newOption=mQuery('<option/>').val(value).text(label);newOption.appendTo(mQuery('#'+eventType));});Le.activateChosenSelect('#'+eventType);}},complete:function(){Le.removeLabelLoadingIndicator();}});};Le.resetDropDownValues=function(type){mQuery('#'+type+' '+'option').removeAttr("selected");if(mQuery('#'+type+'_chosen').length){mQuery('#'+type).chosen('destroy');}
Le.activateChosenSelect(mQuery('#'+type));};;Le.reportOnLoad=function(container){if(mQuery(container+' #list-search').length){Le.activateSearchAutocomplete('list-search','report');}
if(mQuery('div[id=report_filters]').length){mQuery('div[id=report_filters]').attr('data-index',mQuery('#report_filters > div').length+1);mQuery('div[id=report_tableOrder]').attr('data-index',mQuery('#report_tableOrder > div').length+1);mQuery('div[id=report_aggregators]').attr('data-index',mQuery('#report_aggregators > div').length+1);if(mQuery('.filter-columns').length){mQuery('.filter-columns').each(function(){Le.updateReportFilterValueInput(this,true);mQuery(this).on('change',function(){Le.updateReportFilterValueInput(this);});});}}else{mQuery('#report-shelves .collapse').on('show.bs.collapse',function(e){var actives=mQuery('#report-shelves').find('.in, .collapsing');actives.each(function(index,element){mQuery(element).collapse('hide');var id=mQuery(element).attr('id');mQuery('a[aria-controls="'+id+'"]').addClass('collapsed');})})}
Le.updateReportGlueTriggers();Le.checkSelectedGroupBy();Le.initDateRangePicker();var $isScheduled=mQuery('[data-report-schedule="isScheduled"]');var $unitTypeId=mQuery('[data-report-schedule="scheduleUnit"]');var $scheduleDay=mQuery('[data-report-schedule="scheduleDay"]');var $scheduleMonthFrequency=mQuery('[data-report-schedule="scheduleMonthFrequency"]');var $scheduleDate=mQuery('[data-toggle="time"]');mQuery($isScheduled).change(function(){Le.scheduleDisplay($isScheduled,$unitTypeId,$scheduleDay,$scheduleMonthFrequency,$scheduleDate);});mQuery($unitTypeId).change(function(){Le.scheduleDisplay($isScheduled,$unitTypeId,$scheduleDay,$scheduleMonthFrequency,$scheduleDate);});mQuery($scheduleDay).change(function(){Le.schedulePreview($isScheduled,$unitTypeId,$scheduleDay,$scheduleMonthFrequency,$scheduleDate);});mQuery($scheduleMonthFrequency).change(function(){Le.schedulePreview($isScheduled,$unitTypeId,$scheduleDay,$scheduleMonthFrequency,$scheduleDate);});mQuery($scheduleDate).change(function(){Le.schedulePreview($isScheduled,$unitTypeId,$scheduleDay,$scheduleMonthFrequency,$scheduleDate);});Le.scheduleDisplay($isScheduled,$unitTypeId,$scheduleDay,$scheduleMonthFrequency,$scheduleDate);Le.removeActionButtons();};Le.scheduleDisplay=function($isScheduled,$unitTypeId,$scheduleDay,$scheduleMonthFrequency,$scheduleDate){Le.checkIsScheduled($isScheduled);var unitVal=mQuery($unitTypeId).val();mQuery('#scheduleDay, #scheduleDay label, #scheduleMonthFrequency').hide();if(unitVal==='WEEKLY'||unitVal==='MONTHLY'){mQuery('#scheduleDay').show();}
if(unitVal==='MONTHLY'){mQuery('#scheduleMonthFrequency').show();mQuery('#scheduleDay label').hide();}else{mQuery('#scheduleDay label').show();}
Le.schedulePreview($isScheduled,$unitTypeId,$scheduleDay,$scheduleMonthFrequency,$scheduleDate);};Le.schedulePreview=function($isScheduled,$unitTypeId,$scheduleDay,$scheduleMonthFrequency,$scheduleDate){var previewUrl=mQuery('#schedule_preview_url').data('url');var $schedulePreviewData=mQuery('#schedule_preview_data');var isScheduledVal=0;if(!mQuery($isScheduled).prop("checked")){isScheduledVal=1;}
if(!isScheduledVal){$schedulePreviewData.hide();return;}
var unitVal=mQuery($unitTypeId).val();var scheduleDayVal=mQuery($scheduleDay).val();var scheduleMonthFrequencyVal=mQuery($scheduleMonthFrequency).val();var scheduleDateVal=mQuery($scheduleDate).val();mQuery.get(previewUrl+'/'+isScheduledVal+'/'+unitVal+'/'+scheduleDayVal+'/'+scheduleMonthFrequencyVal+'/'+scheduleDateVal,function(data){if(!data.html){return;}
mQuery("#schedule_preview_data_content").html(data.html);$schedulePreviewData.show();});};Le.checkIsScheduled=function($isScheduled){var $scheduleForm=mQuery('#schedule-container .schedule_form');if(!mQuery($isScheduled).prop("checked")){$scheduleForm.show();return;}
$scheduleForm.hide();};Le.addReportRow=function(elId){var prototypeHolder=mQuery('div[id="'+elId+'"]');var index=parseInt(prototypeHolder.attr('data-index'));if(!index){index=0;}
index++;var prototype=prototypeHolder.data('prototype');var output=prototype.replace(/__name__/g,index);prototypeHolder.attr('data-index',index);prototypeHolder.append(output);var newColumnId='#'+elId+'_'+index+'_column';if(elId=='report_filters'){if(typeof Le.reportPrototypeFilterOptions!='undefined'){mQuery(newColumnId).html(Le.reportPrototypeFilterOptions);}
mQuery('#report_filters_'+index+'_container').addClass('in-group');mQuery(newColumnId).on('change',function(){Le.updateReportFilterValueInput(this);});Le.updateReportFilterValueInput(newColumnId);Le.updateReportGlueTriggers();}else if(typeof Le.reportPrototypeColumnOptions!='undefined'){mQuery(newColumnId).html(Le.reportPrototypeColumnOptions);}
Le.activateChosenSelect(mQuery('#'+elId+'_'+index+'_column'));mQuery("#"+elId+" *[data-toggle='tooltip']").tooltip({html:true,container:'body'});};Le.updateReportGlueTriggers=function(){var filterContainer=mQuery('#report_filters');var glueEl=filterContainer.find('.filter-glue');glueEl.off('change');glueEl.on('change',function(){var $this=mQuery(this);if($this.val()==='and'){$this.parents('.panel').addClass('in-group');}else{$this.parents('.panel').removeClass('in-group');}});};Le.updateReportFilterValueInput=function(filterColumn,setup){var definitions=(typeof Le.reportPrototypeFilterDefinitions!='undefined')?Le.reportPrototypeFilterDefinitions:mQuery('#report_filters').data('filter-definitions');var operators=(typeof Le.reportPrototypeFilterOperators!='undefined')?Le.reportPrototypeFilterOperators:mQuery('#report_filters').data('filter-operators');var newValue=mQuery(filterColumn).val();if(!newValue){return;}
var filterId=mQuery(filterColumn).attr('id');var filterType=definitions[newValue].type;var valueEl=mQuery(filterColumn).parent().parent().find('.filter-value');var valueVal=valueEl.val();var idParts=filterId.split("_");var valueId='report_filters_'+idParts[2]+'_value';var valueName='report[filters]['+idParts[2]+'][value]';var currentOperator=mQuery('#report_filters_'+idParts[2]+'_condition').val();mQuery('#report_filters_'+idParts[2]+'_condition').html(operators[newValue]);if(mQuery('#report_filters_'+idParts[2]+'_condition option[value="'+currentOperator+'"]').length>0){mQuery('#report_filters_'+idParts[2]+'_condition').val(currentOperator);}
if(mQuery('#'+valueId+'_chosen').length){mQuery('#'+valueId).chosen('destroy');}
if(filterType=='bool'||filterType=='boolean'){if(mQuery(valueEl).attr('type')!='radio'){var template=mQuery('#filterValueYesNoTemplate .btn-group').clone(true);mQuery(template).find('input[type="radio"]').each(function(){mQuery(this).attr('name',valueName);var radioVal=mQuery(this).val();mQuery(this).attr('id',valueId+'_'+radioVal);});mQuery(valueEl).replaceWith(template);}
if(setup){mQuery('#'+valueId+'_'+valueVal).click();}}else if(mQuery(valueEl).attr('type')!='text'){var newValueEl=mQuery('<input type="text" />').attr({id:valueId,name:valueName,'class':"form-control filter-value"});var replaceMe=(mQuery(valueEl).attr('type')=='radio')?mQuery(valueEl).parent().parent():mQuery(valueEl);replaceMe.replaceWith(newValueEl);}
if((filterType=='multiselect'||filterType=='select')&&typeof definitions[newValue].list!='undefined'){var currentValue=mQuery(valueEl).val();var attr={id:valueId,name:valueName,"class":'form-control filter-value',};if(filterType=='multiselect'){attr.multiple=true;}
var newSelect=mQuery('<select />',attr);mQuery.each(definitions[newValue].list,function(value,label){var newOption=mQuery('<option />').val(value).html(label);if(value==currentValue){newOption.prop('selected',true);}
newOption.appendTo(newSelect);});mQuery(valueEl).replaceWith(newSelect);Le.activateChosenSelect(newSelect);}
if(filterType=='datetime'||filterType=='date'||filterType=='time'){Le.activateDateTimeInputs('#'+valueId,filterType);}else if(mQuery('#'+valueId).hasClass('calendar-activated')){mQuery('#'+valueId).datetimepicker('destroy');}};Le.removeReportRow=function(container){mQuery("#"+container+" *[data-toggle='tooltip']").tooltip('destroy');mQuery('#'+container).remove();};Le.updateReportSourceData=function(context){Le.activateLabelLoadingIndicator('report_source');mQuery.ajax({url:leAjaxUrl,type:'post',data:"action=report:getSourceData&context="+context,success:function(response){mQuery('#report_columns').html(response.columns);mQuery('#report_columns').multiSelect('refresh');mQuery('#report_groupBy').html(response.columns);mQuery('#report_groupBy').multiSelect('refresh');mQuery('#report_filters').find('div').remove().end();mQuery('#report_filters').data('index',0);Le.reportPrototypeColumnOptions=mQuery(response.columns);mQuery('#report_tableOrder').find('div').remove().end();mQuery('#report_tableOrder').data('index',0);mQuery('#report_aggregators').find('div').remove().end();mQuery('#report_aggregators').data('index',0);Le.reportPrototypeFilterDefinitions=response.filterDefinitions;Le.reportPrototypeFilterOptions=response.filters;Le.reportPrototypeFilterOperators=response.filterOperators;mQuery('#report_graphs').html(response.graphs);mQuery('#report_graphs').multiSelect('refresh');if(!response.graphs){mQuery('#graphs-container').addClass('hide');mQuery('#graphs-tab').addClass('hide');}else{mQuery('#graphs-container').removeClass('hide');mQuery('#graphs-tab').removeClass('hide');}},error:function(request,textStatus,errorThrown){Le.processAjaxError(request,textStatus,errorThrown);},complete:function(){Le.removeLabelLoadingIndicator();}});};Le.checkReportCondition=function(selector){var option=mQuery('#'+selector+' option:selected').val();var valueInput=selector.replace('condition','value');if(option=='empty'||option=='notEmpty'){mQuery('#'+valueInput).prop('disabled',true);}else{mQuery('#'+valueInput).prop('disabled',false);}};Le.checkSelectedGroupBy=function(){var selectedOption=mQuery("select[name='report[groupBy][]'] option:selected").length;var existingAggregators=mQuery("select[name*='report[aggregators]']");if(selectedOption>0){mQuery('#aggregators-button').prop('disabled',false);}else{existingAggregators.each(function(){var containerId=mQuery(this).attr('id').replace('_column','');Le.removeReportRow(containerId+'_container');});mQuery('#aggregators-button').prop('disabled',true);}};;Le.smsconfigOnLoad=function(container){var status=mQuery('#config_smsconfig_sms_status').val();if(status=="InActive"){mQuery('#config_smsconfig_sms_status').removeClass('status_success');mQuery('#config_smsconfig_sms_status').addClass('status_fail');}
if(mQuery('#config_smsconfig_sms_transport').val()==""){mQuery('#smsStatus').addClass('hide');mQuery('#smsPublish').addClass('hide');mQuery('#smsActivatebtn').addClass('hide');}}
Le.testSmsServerConnection=function(sendSMS,mobile){var data={transport:mQuery('#config_smsconfig_sms_transport').val(),url:mQuery('#config_smsconfig_account_url').val(),senderid:mQuery('#config_smsconfig_account_sender_id').val(),apiKey:mQuery('#config_smsconfig_account_api_key').val(),username:mQuery('#config_smsconfig_account_auth_token').val(),password:mQuery('#config_smsconfig_account_sid').val(),fromnumber:mQuery('#config_smsconfig_sms_from_number').val(),mobile:mobile,};mQuery('#smsTestButtonContainer .fa-spinner').removeClass('hide');Le.ajaxActionRequest('sms:testSmsServerConnection',data,function(response){var theClass=(response.success)?'has-success':'has-error';var theMessage=response.message;if(!mQuery('#smsconfig #smsTestButtonContainer').is(':hidden')){mQuery('#smsconfig #smsTestButtonContainer').removeClass('has-success has-error').addClass(theClass);mQuery('#smsconfig #smsTestButtonContainer .help-block').html(theMessage);mQuery('#smsconfig #smsTestButtonContainer .fa-spinner').addClass('hide');}else{mQuery('#smsconfig #smsTestButtonContainer').removeClass('has-success has-error').addClass(theClass);mQuery('#smsconfig #smsTestButtonContainer .fa-spinner').addClass('hide');}
if(theClass=='has-success'){mQuery('#config_smsconfig_sms_status').val('Active');mQuery('#config_smsconfig_sms_status').removeClass('status_fail');mQuery('#config_smsconfig_sms_status').addClass('status_success');}else if(theClass=='has-error'){mQuery('#config_smsconfig_sms_status').val('InActive');mQuery('#config_smsconfig_sms_status').removeClass('status_success');mQuery('#config_smsconfig_sms_status').addClass('status_fail');}});};Le.updateTextMessageStatus=function(){mQuery('#config_smsconfig_sms_status').val('InActive');mQuery('#config_smsconfig_sms_status').removeClass('status_success');mQuery('#config_smsconfig_sms_status').addClass('status_fail')
mQuery('#config_smsconfig_sms_status').css('border-color','#ff0000');if(mQuery('#config_smsconfig_sms_transport').val()!=""){mQuery('#smsStatus').removeClass('hide');mQuery('#smsActivatebtn').removeClass('hide');}else{mQuery('#smsStatus').addClass('hide');mQuery('#smsPublish').addClass('hide');mQuery('#smsActivatebtn').addClass('hide');}}
Le.testSmsConnection=function(){var mobile=mQuery('#sms_config_mobile').val();mQuery('#sms_config_mobile').val("");if(mobile==""){mQuery('#sms_config_mobile_errors').removeClass('hide');mQuery('#sms_config_mobile_errors').html("Mobile Number cannot be empty!");return;}else{mQuery('#sms_config_mobile_errors').addClass('hide');}
mQuery('#activateSmsModel').modal('hide');Le.testSmsServerConnection(true,mobile)}
Le.validateSmsConfig=function(){if(mQuery('#config_smsconfig_sms_transport').val()=='le.sms.transport.twilio'){if(mQuery('#config_smsconfig_account_sid').val()==""&&mQuery('#config_smsconfig_sms_from_number').val()==""&&mQuery('#config_smsconfig_account_auth_token').val()==""){var theMessage="<strong>Sending Phone Number</strong> and <strong> Authentication Token </strong> and <strong> Account SID </strong> cannot be empty.";mQuery('#smsconfig #smsTestButtonContainer').removeClass('has-success has-error').addClass('has-error');mQuery('#smsconfig #smsTestButtonContainer .help-block').html(theMessage);mQuery('#activateSmsModel').modal('hide');}else if(mQuery('#config_smsconfig_account_sid').val()==""){var theMessage="<strong>Sending Phone Number</strong> or <strong>Authentication Token</strong> or <strong>Account SID </strong> cannot be empty.";mQuery('#smsconfig #smsTestButtonContainer').removeClass('has-success has-error').addClass('has-error');mQuery('#smsconfig #smsTestButtonContainer .help-block').html(theMessage);mQuery('#activateSmsModel').modal('hide');}else if(mQuery('#config_smsconfig_sms_from_number').val()==""){var theMessage="<strong>Sending Phone Number</strong> or <strong>Authentication Token</strong> or <strong>Account SID </strong> cannot be empty.";mQuery('#smsconfig #smsTestButtonContainer').removeClass('has-success has-error').addClass('has-error');mQuery('#smsconfig #smsTestButtonContainer .help-block').html(theMessage);mQuery('#activateSmsModel').modal('hide');}else if(mQuery('#config_smsconfig_account_auth_token').val()==""){var theMessage="<strong>Sending Phone Number</strong> or <strong>Authentication Token</strong> or <strong>Account SID </strong> cannot be empty.";mQuery('#smsconfig #smsTestButtonContainer').removeClass('has-success has-error').addClass('has-error');mQuery('#smsconfig #smsTestButtonContainer .help-block').html(theMessage);mQuery('#activateSmsModel').modal('hide');}else{mQuery('#smsconfig #smsTestButtonContainer .help-block').html("");mQuery('#activateSmsModel').modal('show');}}else{mQuery('#smsconfig #smsTestButtonContainer .help-block').html("");mQuery('#activateSmsModel').modal('show');}};Le.smsOnLoad=function(container,response){if(mQuery(container+' #list-search').length){Le.activateSearchAutocomplete('list-search','sms');}
Le.getTokens('email:getBuilderTokens',function(tokens){tokens=[];tokens['{leadfield=title}']='Title';tokens['{leadfield=firstname}']='First Name';tokens['{leadfield=lastname}']='Last Name';tokens['{leadfield=company_name}']='Company';tokens['{leadfield=mobile}']='Mobile';tokens['{leadfield=email}']='Email';tokens['{lead_owner_name}']='Lead Owner Name';tokens['{lead_owner_mobile}']='Lead Owner Mobile';tokens['{lead_owner_email}']='Lead Owner Email';var k,keys=[];for(k in tokens){if(tokens.hasOwnProperty(k)){keys.push(k);}}
var tborder="<div border='1' class='email-subject-table' ><tbody style='background-color:whitesmoke;'><tr>";for(var i=0;i<keys.length;i++){var val=keys[i];var title=tokens[val];if(i%3==0&&i!=0){tborder+="</tr><tr>";}
var value='<li class="email-subject-table-border"><a class="email-subject-token" id="insert-value" data-cmd="inserttoken" data-email-token="'+val+'" title="'+title+'">'+title+'</a></li>';tborder+=value;}
tborder+="</div>";mQuery('.insert-tokens').html(tborder);mQuery('[data-email-token]').click(function(e){e.preventDefault();var currentLink=mQuery(this);var value=currentLink.attr('data-email-token');var subValue=mQuery('#sms_message').val();if(subValue==''){mQuery("#sms_message").val(value);}else{var cursorPos=mQuery('#sms_message').prop('selectionStart');var v=subValue;var textBefore=v.substring(0,cursorPos);var textAfter=v.substring(cursorPos,v.length);mQuery('#sms_message').val(textBefore+value+textAfter);}});});Le.removeActionButtons();};Le.CheckSMSStatus=function(){if(mQuery('.license-notifiation').hasClass('hide')){Le.ajaxActionRequest('sms:smsstatus',{},function(response){if(response.success){if(response.info!=''&&response.isalertneeded!="true"){mQuery('.license-notifiation').removeClass('hide');mQuery('.license-notifiation').css('display','table');mQuery('.license-notifiation').css('table-layout','fixed');mQuery('.license-notifiation #license-alert-message').html('');mQuery('.license-notifiation #license-alert-message').html(response.info);mQuery('.button-notification').addClass('hide');mQuery('#fixed-content').attr('style','margin-top:195px;');Le.registerSmsDismissBtn();Le.changeButtonPanelStyle(false);Le.adJustFixedHeader(true);}else{Le.adJustFixedHeader(false);}}});}}
Le.registerSmsDismissBtn=function(){mQuery('.smsdismissbtn').click(function(e){Le.closeLicenseButton();Le.adJustFixedHeader(true);Le.changeButtonPanelStyle(false);Le.ajaxActionRequest('subscription:notificationclosed',{'isalert_needed':"true"},function(response){});});};Le.selectSmsType=function(smsType){if(smsType=='list'){mQuery('#leadList').removeClass('hide');mQuery('#publishStatus').addClass('hide');mQuery('.page-header h3').text(leLang.newListSms);}else{mQuery('#publishStatus').removeClass('hide');mQuery('#leadList').addClass('hide');mQuery('.page-header h3').text(leLang.newTemplateSms);}
mQuery('#sms_smsType').val(smsType);mQuery('body').removeClass('noscroll');mQuery('.sms-type-modal').remove();mQuery('.sms-type-modal-backdrop').remove();};Le.standardSmsUrl=function(options){if(!options){return;}
var url=options.windowUrl;if(url){var editEmailKey='/sms/edit/smsId';if(url.indexOf(editEmailKey)>-1){options.windowUrl=url.replace('smsId',mQuery('#campaignevent_properties_sms').val());}}
return options;};Le.disabledSmsAction=function(opener){if(typeof opener=='undefined'){opener=window;}
var sms=opener.mQuery('#campaignevent_properties_sms').val();var disabled=sms===''||sms===null;opener.mQuery('#campaignevent_properties_editSmsButton').prop('disabled',disabled);};;Le.getStageActionPropertiesForm=function(actionType){Le.activateLabelLoadingIndicator('stage_type');var query="action=stage:getActionForm&actionType="+actionType;mQuery.ajax({url:leAjaxUrl,type:"POST",data:query,dataType:"json",success:function(response){if(typeof response.html!='undefined'){mQuery('#stageActionProperties').html(response.html);Le.onPageLoad('#stageActionProperties',response);}},error:function(request,textStatus,errorThrown){Le.processAjaxError(request,textStatus,errorThrown);},complete:function(){Le.removeLabelLoadingIndicator();}});};;Le.userOnLoad=function(container){if(mQuery(container+' form[name="user"]').length){if(mQuery('#user_position').length){Le.activateTypeahead('#user_position',{displayKey:'position'});}}else{if(mQuery(container+' #list-search').length){Le.activateSearchAutocomplete('list-search','user.user');}}
mQuery('.user_img').removeClass('required');if(mQuery('#user_preferred_profile_image').length){mQuery('#user_preferred_profile_image').on('change',function(){if(mQuery(this).val()=='custom'){mQuery('#customAvatarContainer').slideDown('fast');}else{mQuery('#customAvatarContainer').slideUp('fast');}})}};Le.roleOnLoad=function(container,response){if(mQuery(container+' #list-search').length){Le.activateSearchAutocomplete('list-search','user.role');}
if(response&&response.permissionList){leVars.permissionList=response.permissionList;}};Le.togglePermissionVisibility=function(){setTimeout(function(){if(mQuery('#role_isAdmin_0').prop('checked')){mQuery('#rolePermissions').removeClass('hide');mQuery('#isAdminMessage').addClass('hide');}else{mQuery('#rolePermissions').addClass('hide');mQuery('#isAdminMessage').removeClass('hide');}},10);};Le.onPermissionChange=function(changedPermission,bundle){var granted=0;if(mQuery(changedPermission).prop('checked')){if(mQuery(changedPermission).val()=='full'){mQuery(changedPermission).closest('.choice-wrapper').find("label input:checkbox:checked").map(function(){if(mQuery(this).val()!='full'){mQuery(this).prop('checked',false);mQuery(this).parent().toggleClass('active');}})}else{mQuery(changedPermission).closest('.choice-wrapper').find("label input:checkbox:checked").map(function(){if(mQuery(this).val()=='full'){granted=granted-1;mQuery(this).prop('checked',false);mQuery(this).parent().toggleClass('active');}})}}
if(mQuery('.'+bundle+'_granted').length){var granted=0;var levelPerms=leVars.permissionList[bundle];mQuery.each(levelPerms,function(level,perms){mQuery.each(perms,function(index,perm){var isChecked=mQuery('input[data-permission="'+bundle+':'+level+':'+perm+'"]').prop('checked');if(perm=='full'){if(isChecked){if(perms.length===1){granted++;}else{granted+=perms.length-1;}}}else if(isChecked){granted++;}});});mQuery('.'+bundle+'_granted').html(granted);}};;Le.sendHookTest=function(){var url=mQuery('#webhook_webhookUrl').val();var eventTypes=mQuery("#event-types input[type='checkbox']");var selectedTypes=[];eventTypes.each(function(){var item=mQuery(this);if(item.is(':checked')){selectedTypes.push(item.val());}});var data={action:'webhook:sendHookTest',url:url,types:selectedTypes};var spinner=mQuery('#spinner');spinner.removeClass('hide');mQuery.ajax({url:leAjaxUrl,data:data,type:'POST',dataType:"json",success:function(response){if(response.success){mQuery('#tester').html(response.html);}},error:function(request,textStatus,errorThrown){var errorMsg=errorThrown;if(typeof request.responseJSON!=='undefined'){errorMsg=request.responseJSON;if(errorMsg.errors&&errorMsg.errors[0]&&errorMsg.errors[0].message){errorMsg=errorMsg.errors[0].message;if(errorMsg.indexOf('Operation timed out')!=-1){errorMsg="Connection timeout";}}}
var spandiv='<div class="has-error"><span class="help-block">'+errorMsg+'</span></div>';mQuery('#tester').html(spandiv);},complete:function(response){spinner.addClass('hide');}})};;Le.prepaidplansOnLoad=function(container){mQuery('#prepaidplan-panel').on('show.bs.collapse',function(e){var actives=mQuery('#prepaidplan-panel').find('.in, .collapsing');actives.each(function(index,element){mQuery(element).collapse('hide');var id=mQuery(element).attr('id');mQuery('a[aria-controls="'+id+'"]').addClass('collapsed');mQuery('#'+id).removeClass('show');})});mQuery('[data-plankey]').click(function(e){e.preventDefault();var currentLink=mQuery(this);var plankey=currentLink.attr('data-plankey');var planname=currentLink.attr('data-planname');var planamount=currentLink.attr('data-planamount');var plancurrency=currentLink.attr('data-plancurrency');var plancredits=currentLink.attr('data-plancredits');Le.ajaxActionRequest('subscription:getAvailableCount',{},function(response){Le.deactivateBackgroup();if(response.success){var availablecredits=response.availablecount;var totalcredits=(+plancredits+ +availablecredits);mQuery('#sectionTwo #selected-plan').html(planname);mQuery('#sectionTwo #available-credits').html(Le.getFormattedNumber(availablecredits));mQuery('#sectionTwo #additional-credits').html(Le.getFormattedNumber(plancredits));mQuery('#sectionTwo #total-credits').html(Le.getFormattedNumber(totalcredits));var paymentcontinue=mQuery('#sectionTwo #paymentcontinue-btn');paymentcontinue.attr("plankey",plankey);paymentcontinue.attr("planname",planname);paymentcontinue.attr("planamount",planamount);paymentcontinue.attr("plancurrency",plancurrency);paymentcontinue.attr("plancredits",plancredits);paymentcontinue.attr("beforecredits",availablecredits);paymentcontinue.attr("aftercredits",totalcredits);mQuery('a[aria-controls="sectionTwo"]').trigger('click');}});});mQuery('#paymentcontinue-btn').click(function(e){e.preventDefault();var paymentcontinue=mQuery('#sectionTwo #paymentcontinue-btn');var plankey=paymentcontinue.attr("plankey");var planname=paymentcontinue.attr("planname");var planamount=paymentcontinue.attr("planamount");var plancurrency=paymentcontinue.attr("plancurrency");var plancredits=paymentcontinue.attr("plancredits");var beforecredits=paymentcontinue.attr("beforecredits");var aftercredits=paymentcontinue.attr("aftercredits");var planpricing=mQuery('#sectionThree #plan-pricing');var taxheaderlabel=mQuery('#sectionThree #tax-label');var taxamountlabel=mQuery('#sectionThree #tax-amount');var totalamountlabel=mQuery('#sectionThree #total-amount');var pricingcurrency=mQuery('#sectionThree .pricing-currency');var taxcurrency=mQuery('#sectionThree .tax-currency');var totalcurrency=mQuery('#sectionThree .total-currency');var taxamount=0;var totalamount=0;if(plancurrency==""){taxamount=(planamount*18)/100;taxamount=Math.round(taxamount);totalamount=(+planamount+ +taxamount);taxheaderlabel.html("Tax (18%)");taxamountlabel.html(Le.getFormattedNumber(taxamount));}else{taxcurrency.hide();totalamount=planamount;taxamountlabel.html("NA");taxheaderlabel.html("Tax");}
planpricing.html(Le.getFormattedNumber(planamount));totalamountlabel.html(Le.getFormattedNumber(totalamount));taxcurrency.html(plancurrency);pricingcurrency.html(plancurrency);totalcurrency.html(plancurrency);var makepayment=mQuery('#sectionThree #makepayment-btn');makepayment.attr("plankey",plankey);makepayment.attr("planname",planname);makepayment.attr("plancurrency",plancurrency);makepayment.attr("plancredits",plancredits);makepayment.attr("aftercredits",aftercredits);makepayment.attr("beforecredits",beforecredits);makepayment.attr("totalamt",totalamount);makepayment.attr("netamount",planamount);makepayment.attr("taxamount",taxamount);mQuery('a[aria-controls="sectionThree"]').trigger('click');});mQuery('#makepayment-btn').click(function(e){e.preventDefault();var makepayment=mQuery('#sectionThree #makepayment-btn');var plankey=makepayment.attr("plankey");var planname=makepayment.attr("planname");var plancurrency=makepayment.attr("plancurrency");var plancredits=makepayment.attr("plancredits");var beforecredits=makepayment.attr("beforecredits");var aftercredits=makepayment.attr("aftercredits");var totalamount=makepayment.attr("totalamt");var netamount=makepayment.attr("netamount");var taxamount=makepayment.attr("taxamount");Le.activateBackdrop();Le.ajaxActionRequest('subscription:purchaseplan',{plancurrency:plancurrency,planamount:totalamount,planname:planname,plankey:plankey,plancredits:plancredits,beforecredits:beforecredits,aftercredits:aftercredits,taxamount:taxamount,netamount:netamount},function(response){Le.deactivateBackgroup();if(response.success){if(response.provider=="razorpay"){Le.invokeRazorPay_Prepaid(response,plankey,planname,totalamount);}else{Le.invokePaypalPay_Prepaid(response);}}else{alert(response.errormsg);}});});}
Le.invokeRazorPay_Prepaid=function(response,plankey,planname,totalamount){var apikey=response.apikey;var username=response.username;var useremail=response.useremail;var usermobile=response.usermobile;var captureamount=(totalamount*100);var orderid=response.orderid;var options={"key":apikey,"amount":captureamount,"name":planname,"description":"Order ID:"+orderid,"image":"https://s3.amazonaws.com/leadsroll.com/Razer-Pay-Icon.png","handler":function(response){Le.activateBackdrop();var paymentid=response.razorpay_payment_id;Le.ajaxActionRequest('subscription:capturepayment',{paymentid:paymentid,captureamount:captureamount},function(response){if(response.success){Le.redirectWithBackdrop(response.redirect);}else{Le.deactivateBackgroup();alert(response.errormsg);}});},"prefill":{"name":username,"email":useremail,"contact":usermobile,},"notes":{"merchant_order_id":response.orderid,"plankey":plankey},"theme":{"color":"#0066cc"},"modal":{"ondismiss":function(response){Le.ajaxActionRequest('subscription:cancelpayment',{orderid:orderid},function(response){});}}};var rzp1=new Razorpay(options);rzp1.open();};Le.invokePaypalPay_Prepaid=function(response){Le.redirectWithBackdrop(response.approvalurl);};Le.getFormattedNumber=function(number){return number.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")};Le.loadLicenseUsageInfo=function(){Le.ajaxActionRequest('subscription:licenseusageinfo',{},function(response){if(response.success){if((response.info.trim()!='')&&response.isalertneeded!="true"){mQuery('.license-notifiation').removeClass('hide');mQuery('.license-notifiation').css('display','table');mQuery('.license-notifiation').css('table-layout','fixed');mQuery('.license-notifiation').css('text-align','center');mQuery('.license-notifiation #license-alert-message').html('');mQuery('.license-notifiation #license-alert-message').html(response.info);if(!response.needClosebutton){}
Le.changeButtonPanelStyle(false);Le.registerLicenseCloseBtnListener();Le.adJustFixedHeader(true);}else{Le.adJustFixedHeader(false);}}});Le.ajaxActionRequest('subscription:TrialUpgrade',{},function(response){if(response.success&&!location.href.match(/(pricing)/i)){mQuery('#upgrade-now').removeClass('hide');mQuery('#upgrade-info-trial-info').removeClass('hide');mQuery('#upgrade-now').html(response.upgradeinfo);mQuery('#upgrade-info-trial-info').html(response.trailinfo);}else{mQuery('#upgrade-now').addClass('hide');mQuery('#upgrade-info-trial-info').addClass('hide');}});};Le.registerLicenseCloseBtnListener=function(){mQuery('.licenseclosebtn').click(function(e){Le.closeLicenseButton();Le.adJustFixedHeader(false);Le.changeButtonPanelStyle(true);Le.ajaxActionRequest('subscription:notificationclosed',{'isalert_needed':"true"},function(response){});});};Le.adJustFixedHeader=function(isadd){setTimeout(function(){var pagemode=mQuery('.content-body').attr('data-pagemode');var url=window.location.href;if(pagemode==''){if(isadd){mQuery('#fixed-header').css('top','90px');if(url.indexOf('forms/view')==-1&&url.indexOf('reports/view')==-1){mQuery('.content-body').css('margin-top','170px');}}else{if(mQuery('#licenseclosediv').hasClass('hide')){mQuery('#fixed-header').css('top','45px');if(url.indexOf('forms/view')==-1&&url.indexOf('reports/view')==-1){mQuery('.content-body').css('margin-top','110px');}}}}else if(pagemode=='config'){if(isadd){mQuery('#fixed-header').css('top','90px');mQuery('.content-body').css('margin-top','170px');}else{if(mQuery('#licenseclosediv').hasClass('hide')){mQuery('#fixed-header').css('top','45px');mQuery('.content-body').css('margin-top','110px');}}}else{if(isadd){mQuery('.content-body').attr('style','padding-top:3.3%;');}}},1000);};;Le.accountinfoOnLoad=function(container){if(mQuery('.cardholder-panel').is(':visible')){var stripe=getStripeClient();var card=getStripeCard(stripe);mountStripeCard(stripe,card,'#card-holder-widget');mQuery('.cardholder-panel .card-update-btn').click(function(e){e.preventDefault();Le.activateBackdrop();stripe.createToken(card).then(function(result){if(result.error){Le.deactivateBackgroup();var errorElement=document.getElementById('card-holder-errors');var message=Le.showerror(result.error.message);errorElement.textContent=message;}else{stripeTokenHandler(card,result.token,".cardholder-panel",null);}});});}
if(mQuery('.cancelsubscription').is(':visible')){mQuery('.cancelsubscription .cancel-subscription').click(function(e){e.preventDefault();Le.activateBackdrop();Le.ajaxActionRequest('subscription:cancelsubscription',{},function(response){e.preventDefault();Le.activateBackdrop();Le.deactivateBackgroup();if(response.success){mQuery('.cancelsubscription').addClass('hide');mQuery('.deactivatedaccount').addClass('show');}});});}}
Le.billingOnLoad=function(container){var stripe=getStripeClient();var card=getStripeCard(stripe);if(mQuery('#card-holder-widget').is(':visible')){mountStripeCard(stripe,card,'#card-holder-widget');}
mQuery('.pay-now-btn').click(function(e){e.preventDefault();var currentLink=mQuery(this);var planamount=currentLink.attr('planamount');var plancurrency=currentLink.attr('plancurrency');var planname=currentLink.attr('planname');var plancredits=currentLink.attr('plancredits');var planvalidity=currentLink.attr('planvalidity');var contactcredits=currentLink.attr('contactcredits');Le.activateButtonLoadingIndicator(currentLink);stripe.createToken(card).then(function(result){if(result.error){Le.removeButtonLoadingIndicator(currentLink);var errorElement=document.getElementById('card-holder-errors');var message=Le.showerror(result.error.message);errorElement.textContent=message;}else{stripeTokenHandler(card,result.token,'.pricing-type-modal',currentLink);}});});}
Le.pricingplansOnLoad=function(container){}
function getStripeClient(){var stripe=Stripe('pk_live_SaCvf4xx8HojET3eQfTBhiY2');return stripe;}
function getStripeCard(stripe){var elements=stripe.elements();var style={base:{color:'#32325d',lineHeight:'18px',fontFamily:'"Helvetica Neue", Helvetica, sans-serif',fontSmoothing:'antialiased',fontSize:'16px','::placeholder':{color:'#aab7c4'}},invalid:{color:'#fa755a',iconColor:'#fa755a'}};var card=elements.create('card',{style:style});return card;}
function mountStripeCard(stripe,card,elementid){card.mount(elementid);card.addEventListener('change',function(event){var displayError=document.getElementById('card-holder-errors');if(event.error){displayError.textContent=event.error.message;}else{displayError.textContent='';}});}
function stripeTokenHandler(card,token,rootclass,btnelement){try{clearInfoText();var chwidget=mQuery(rootclass+' #card-holder-widget');var letoken=chwidget.attr("data-le-token");var stripetoken=token.id;var planamount=1;var plancurrency="$";var plancredits=0;var planname="";var planvalidity="";var contactcredits=0;var isCardUpdateAlone=true;if(btnelement!=null){planamount=btnelement.attr('planamount');plancurrency=btnelement.attr('plancurrency');planname=btnelement.attr('planname');plancredits=btnelement.attr('plancredits');planvalidity=btnelement.attr('planvalidity');contactcredits=btnelement.attr('contactcredits');isCardUpdateAlone=false;}
var accountdata={};if(!isCardUpdateAlone){var businessname=mQuery('#welcome_business').val();var currentlist=mQuery('#select_listsize').val();var currentprovider=mQuery('#welcome_currentesp').val();var email=mQuery('#welcome_accountemail').val();var address=mQuery('#welcome_address').val();var city=mQuery('#welcome_city').val();var zipcode=mQuery('#welcome_zip').val();var state=mQuery('#selectstate').val();var country=mQuery('#selectcountry').val();var website=mQuery('#welcome_website').val();var isvalidrequest=true;if(businessname==''){isvalidrequest=false;mQuery('.business_error').removeClass('hide');}
if(email==''){isvalidrequest=false;mQuery('.email_error').removeClass('hide');}
if(address==''){isvalidrequest=false;mQuery('.address_error').removeClass('hide');}
if(city==''){isvalidrequest=false;mQuery('.city_error').removeClass('hide');}
if(zipcode==''){isvalidrequest=false;mQuery('.zip_error').removeClass('hide');}
if(state==''||state=='blank'){isvalidrequest=false;mQuery('.state_error').removeClass('hide');}
if(country==''||country=='blank'){isvalidrequest=false;mQuery('.country_error').removeClass('hide');}
if(!isvalidrequest){Le.removeButtonLoadingIndicator(mQuery('.pay-now-btn'));return;}
accountdata={business:businessname,currentlist:currentlist,currentprovider:currentprovider,email:email,address:address,city:city,zipcode:zipcode,state:state,country:country,website:website,};}
var data={letoken:letoken,stripetoken:stripetoken,planamount:planamount,plancurrency:plancurrency,plancredits:plancredits,planname:planname,planvalidity:planvalidity,isCardUpdateAlone:isCardUpdateAlone,contactcredits:contactcredits,accountdata:accountdata};Le.ajaxActionRequest('subscription:updatestripecard',data,function(response){if(isCardUpdateAlone){Le.deactivateBackgroup();}else{Le.removeButtonLoadingIndicator(mQuery('.pay-now-btn'));}
if(response.success){card.clear();if(isCardUpdateAlone){setInfoText("Card updated successfully");location.reload();}else{Le.redirectWithBackdrop(response.statusurl);}}
else{var errors=response.errormsg;var error=Le.showerror(errors);setInfoText(error);mQuery('html, body').animate({scrollTop:0},'100');}});}catch(err){}}
function clearInfoText(){var infoElement=mQuery("#card-holder-info");infoElement.html("");infoElement.addClass('hide');}
function setInfoText(info){var infoElement=mQuery("#card-holder-info");infoElement.html(info);infoElement.removeClass('hide');}
Le.showerror=function(error){var keys=["Your card was declined","insufficient funds"," security code is incorrect"];var errors=["Your card was declined. Please use a vaild credit card.","Your card has insufficient funds."," Incorrect CVV or expiry date of the card. Please retry with correct details."];for(var i=0;i<keys.length;i++){if(error.includes(keys[i])==true){var message=errors[i];mQuery("#card-holder-widget").addClass("StripeElement--invalid");}}
if(message!==undefined&&message!==null){message=message;}else{message=error;}
return message;};Le.openCancelSubscriptionModel=function(){mQuery('.cancel-subscription-modal-backdrop').removeClass('hide');mQuery('.cancel-subscription-modal').removeClass('hide');};Le.cancelSubscription=function(){try{Le.activateBackdrop();var cancelreason=mQuery('#cancel_reason option:selected').text();var cancelfeedback=mQuery('#reason_feedback').val();Le.ajaxActionRequest('subscription:cancelsubscription',{cancelreason:cancelreason,cancelfeedback:cancelfeedback},function(response){Le.deactivateBackgroup();if(response.success){Le.loadContent(response.redirecturl);mQuery('body').removeClass('noscroll');}});}catch(err){}};;Le.subscriptionOnLoad=function(container){mQuery('#subscription-panel').on('show.bs.collapse',function(e){var actives=mQuery('#subscription-panel').find('.in, .collapsing');actives.each(function(index,element){mQuery(element).collapse('hide');var id=mQuery(element).attr('id');mQuery('a[aria-controls="'+id+'"]').addClass('collapsed');mQuery('#'+id).removeClass('show');})});mQuery('[data-plankey]').click(function(e){e.preventDefault();var currentLink=mQuery(this);var plankey=currentLink.attr('data-plankey');var planname=currentLink.attr('data-planname');var planamount=currentLink.attr('data-planamount');var plancurrency=currentLink.attr('data-plancurrency');mQuery('#selected-plan').html(planname);mQuery('#planamount-desc').attr("plancurrency",plancurrency);mQuery('#planamount-desc').attr("planamount",planamount);mQuery('#planamount-desc').attr("plankey",plankey);mQuery('#planamount-desc').attr("planname",planname);mQuery('#payment-monthly').trigger('click');mQuery('a[aria-controls="sectionTwo"]').trigger('click');});mQuery('[data-frequencybtn]').click(function(e){var currentLink=mQuery(this);var frequency=currentLink.attr('data-frequencybtn');var pldesc=mQuery('#planamount-desc');var planamount=pldesc.attr('planamount');var plancurrency=pldesc.attr('plancurrency');if(frequency=="year"){planamount=planamount*12;mQuery('#paymentduration-desc').html("Amount to be paid per year");}else{mQuery('#paymentduration-desc').html("Amount to be paid per month");}
mQuery('#planamount-desc').attr("totalamount",planamount);mQuery('#planamount-desc').attr("plancycle",frequency);mQuery('#planamount-desc').html(plancurrency+planamount);});mQuery('#paymentcontinue-btn').click(function(e){e.preventDefault();var pldesc=mQuery('#planamount-desc');var plankey=pldesc.attr('plankey');var planname=pldesc.attr('planname');var plancurrency=pldesc.attr('plancurrency');var actualamount=pldesc.attr('totalamount');var plancycle=pldesc.attr('plancycle');var taxamount=0;var totalamount=0;if(plancurrency==""){taxamount=(actualamount*18)/100;totalamount=(+actualamount+ +taxamount);}else{totalamount=actualamount;}
totalamount=Math.round(totalamount);taxamount=Math.round(taxamount);mQuery('#sectionThree .cplantitle').html(planname);mQuery('#sectionThree .cplantitle').attr("planname",plankey);mQuery('#sectionThree .cplantitle').attr("plancycle",plancycle);mQuery('#sectionThree .cplantitle').attr("plancurrency",plancurrency);mQuery('#sectionThree .cplanamount').html(actualamount);mQuery('#sectionThree .cplantax').html(taxamount);mQuery('#sectionThree .cplantotal').html(totalamount);mQuery('#sectionThree .cplanamtcurrency').html(plancurrency);mQuery('#sectionThree .cplantaxcurrency').html(plancurrency);mQuery('#sectionThree .cplantotalcurrency').html(plancurrency);mQuery('a[aria-controls="sectionThree"]').trigger('click');});mQuery('#paymentconfirm-btn').click(function(e){e.preventDefault();mQuery('a[aria-controls="sectionFour"]').trigger('click');});mQuery('#makepayment-btn').click(function(e){e.preventDefault();var usernameel=mQuery('#sectionFour #payment-username');var useremailel=mQuery('#sectionFour #payment-useremail');var useraddressel=mQuery('#sectionFour #payment-useraddress');var username=usernameel.val();var useremail=useremailel.val();var useraddress=useraddressel.val();var divwrapper=mQuery(usernameel).closest('div');if(username==""){divwrapper.addClass('has-error');return;}else{divwrapper.removeClass('has-error');}
divwrapper=mQuery(useremailel).closest('div');if(useremail==""){divwrapper.addClass('has-error');return;}else{divwrapper.removeClass('has-error');}
divwrapper=mQuery(useraddressel).closest('div');if(useraddress==""){divwrapper.addClass('has-error');return;}else{divwrapper.removeClass('has-error');}
var planname=mQuery('#sectionThree .cplantitle').attr("planname");var plancycle=mQuery('#sectionThree .cplantitle').attr("plancycle");var plancurrency=mQuery('#sectionThree .cplantitle').attr("plancurrency");Le.activateBackdrop();Le.ajaxActionRequest('subscription:makepayment',{username:username,useremail:useremail,useraddress:useraddress,planname:planname,plancycle:plancycle,plancurrency:plancurrency},function(response){Le.deactivateBackgroup();if(response.success){if(response.provider=="razorpay"){Le.invokeRazorPay(response,username,useremail,useraddress,planname);}else{Le.invokePaypalPay(response);}}else{alert(response.errormsg);}});});}
Le.validatePersonalInfo=function(){var theClass="has-error";var isvalid=true;var firstName=mQuery('#user_firstName').val();var lastName=mQuery('#user_lastName').val();var phonenumber=mQuery('#accountinfo_phonenumber').val();var email=mQuery('#user_email').val();mQuery('#user_Firstname').removeClass('has-success has-error');mQuery('#user_Firstname .help-block').html("");mQuery('#user_Lastname').removeClass('has-success has-error');mQuery('#user_Lastname .help-block').html("");mQuery('#account_Mobile').removeClass('has-success has-error');mQuery('#account_Mobile .help-block').html("");mQuery('#user_Email').removeClass('has-success has-error');mQuery('#user_Email .help-block').html("");if(firstName==""){mQuery('#user_Firstname').removeClass('has-success has-error').addClass(theClass);mQuery('#user_Firstname .help-block').html("Firstname can't be empty");isvalid=false;}
if(lastName==""){}
if(phonenumber==""){}else if(phonenumber!=""){if(phonenumber.length<10||isNaN(phonenumber)){mQuery('#account_Mobile').removeClass('has-success has-error').addClass(theClass);mQuery('#account_Mobile .help-block').html("Mobile doesn't look right. Use the Valid one");isvalid=false;}}
if(email==""){mQuery('#user_Email').removeClass('has-success has-error').addClass(theClass);mQuery('#user_Email .help-block').html("Email can't be empty");isvalid=false;}
return isvalid;}
Le.validateKYCForm=function(){var companyname=mQuery('#billinginfo_companyname').val();var domain=mQuery('#accountinfo_domainname').val();var website=mQuery('#accountinfo_website').val();var companyaddress=mQuery('#billinginfo_companyaddress').val();var postalcode=mQuery('#billinginfo_postalcode').val();var state=mQuery('#billinginfo_state').val();var city=mQuery('#billinginfo_city').val();var country=mQuery('#billinginfo_country').val();var timezone=mQuery('#accountinfo_timezone').val();var gstnumber=mQuery('#billinginfo_gstnumber').val();var isvalid=true;mQuery('#billing_Company').removeClass('has-success has-error');mQuery('#billing_Company .help-block').html("");mQuery('#account_Website').removeClass('has-success has-error');mQuery('#account_Website .help-block').html("");mQuery('#billing_Address').removeClass('has-success has-error');mQuery('#billing_Address .help-block').html("");mQuery('#billing_City').removeClass('has-success has-error');mQuery('#billing_City .help-block').html("");mQuery('#billing_Postal').removeClass('has-success has-error');mQuery('#billing_Postal .help-block').html("");mQuery('#billing_state').removeClass('has-success has-error');mQuery('#billing_state .help-block').html("");mQuery('#billing_country').removeClass('has-success has-error');mQuery('#billing_country .help-block').html("");mQuery('#account_timezone').removeClass('has-success has-error');mQuery('#account_timezone .help-block').html("");mQuery('#billing_GST').removeClass('has-success has-error');mQuery('#billing_GST .help-block').html("");mQuery('#condition_Agree').removeClass('has-success has-error label_control_error');mQuery('#condition_Agree .help-block').html("");mQuery('#spam_Agree').removeClass('has-success has-error label_control_error');mQuery('#spam_Agree .help-block').html("");var theClass="has-error";if(companyname==""){mQuery('#billing_Company').removeClass('has-success has-error').addClass(theClass);mQuery('#billing_Company .help-block').html("Company Name can't be empty");isvalid=false;}
if(website==""){mQuery('#account_Website').removeClass('has-success has-error').addClass(theClass);mQuery('#account_Website .help-block').html("Website can't be empty");isvalid=false;}else if(website!=""){var re=/^(http[s]?:\/\/){0,1}(www\.){0,1}[a-zA-Z0-9\.\-]+\.[a-zA-Z]{2,5}[\.]{0,1}/;if(!re.test(website)){mQuery('#account_Website').removeClass('has-success has-error').addClass(theClass);mQuery('#account_Website .help-block').html("Website doesn't look right. Use the Valid one");isvalid=false;}}
if(companyaddress==""){mQuery('#billing_Address').removeClass('has-success has-error').addClass(theClass);mQuery('#billing_Address .help-block').html("Company Address can't be empty");isvalid=false;}
if(city==""){mQuery('#billing_City').removeClass('has-success has-error').addClass(theClass);mQuery('#billing_City .help-block').html("City can't be empty");isvalid=false;}
if(state==""){mQuery('#billing_state').removeClass('has-success has-error').addClass(theClass);mQuery('#billing_state .help-block').html("State can't be empty");isvalid=false;}
if(country==""){mQuery('#billing_country').removeClass('has-success has-error').addClass(theClass);mQuery('#billing_country .help-block').html("Country can't be empty");isvalid=false;}
if(postalcode==""){mQuery('#billing_Postal').removeClass('has-success has-error').addClass(theClass);mQuery('#billing_Postal .help-block').html("Zip/Postal code can't be empty");isvalid=false;}
if(timezone==""){mQuery('#account_timezone').removeClass('has-success has-error').addClass(theClass);mQuery('#account_timezone .help-block').html("Timezone can't be empty");isvalid=false;}
if(!mQuery('#spamAgree').prop('checked')){mQuery('#spam_Agree').removeClass('label_control_error').addClass("label_control_error");isvalid=false;}
return isvalid;};var timeInterval=0;Le.savePersonalInfo=function(){var firstName=mQuery('#user_firstName').val();var lastName=mQuery('#user_lastName').val();var phonenumber=mQuery('#accountinfo_phonenumber').val();var email=mQuery('#user_email').val();var isvalid=Le.validatePersonalInfo();if(!isvalid){return isvalid;}
mQuery('#step2_firstname').val(firstName);mQuery('#step2_lastname').val(lastName);mQuery('#step2_mobile').val(phonenumber);mQuery('#step2_email').val(email);mQuery(".kyc_step2").css("display","block");mQuery(".kyc").css("display","none");}
Le.SendOTPConnection=function(){var firstName=mQuery('#step2_firstname').val();var lastName=mQuery('#step2_lastname').val();var phonenumber=mQuery('#step2_mobile').val();var email=mQuery('#step2_email').val();var company=mQuery('#billinginfo_companyname').val();var domain=mQuery('#accountinfo_domainname').val();var website=mQuery('#accountinfo_website').val();var address=mQuery('#billinginfo_companyaddress').val();var postalcode=mQuery('#billinginfo_postalcode').val();var state=mQuery('#billinginfo_state').val();var city=mQuery('#billinginfo_city').val();var country=mQuery('#billinginfo_country').val();var timezone=mQuery('#accountinfo_timezone').val();var gstnumber=mQuery('#billinginfo_gstnumber').val();mQuery('#billinginfo_state').prop('required',false);mQuery('#billinginfo_country').prop('required',false);mQuery('#billinginfo_gstnumber').prop('required',false);var theClass="has-error";var isvalid=true;isvalid=Le.validateKYCForm();if(!isvalid){return isvalid;}
var otp=Le.getCookie('MobileVerificationOTP');if(isvalid){var data={firstName:firstName,lastName:lastName,phonenumber:phonenumber,email:email,companyname:company,domain:domain,website:website,companyaddress:address,postalcode:postalcode,state:state,city:city,country:country,timezone:timezone,gstnumber:gstnumber,};if(otp!=""){data['otp']=otp;}
mQuery('#kycSubmit .fa-spinner').removeClass('hide');Le.ajaxActionRequest('subscription:updateKYC',data,function(response){if(response.success){mQuery('#kycSubmit .fa-spinner').addClass('hide');var otp=response.otp;var otpsend=response.otpsend;if(otpsend){mQuery(".alertmsg").css("display","none");mQuery('.sms_code_div').removeClass('has-success has-error');mQuery('#sms_code').val('');mQuery(".otp_verifications").fadeIn("slow");mQuery(".steps").css("display","none");maxLimit=61;timeInterval=setInterval(function(){maxLimit=parseInt(maxLimit)-1;mQuery('#send_sms').html('<i class="fa fa-repeat"></i> Resend Code('+maxLimit+')s');if(maxLimit==0){mQuery('#send_sms').removeClass('disabled').attr('disabled',false);mQuery('#send_sms').html('<i class="fa fa-repeat"></i> Resend Code');mQuery('#send_sms').removeClass('disabled');clearInterval(timeInterval);}},1000);var mobile=response.mobile;mQuery('#sms_number').val(mobile);document.cookie="MobileVerificationOTP="+otp+"; path=/";mQuery('#kyc_otpverification').html('A code was just sent to your mobile phone : <b>'+mobile+'</b>')}else{Le.RedirectToGivenURL(response.redirecturl);}}});}};Le.LoadKYCDetails=function(){clearInterval(timeInterval);mQuery(".otp_verifications").css("display","none");mQuery(".steps").fadeIn("slow");mQuery('#send_sms').attr('disabled','true');mQuery('#send_sms').addClass('disabled');};Le.reSendOTP=function(){mQuery('#send_sms').attr('disabled');mQuery('#send_sms').addClass('disabled');var phonenumber=mQuery('#sms_number').val();var otp=Le.getCookie('MobileVerificationOTP');mQuery(".alertmsg").css("display","none");mQuery('.sms_code_div').removeClass('has-success has-error');mQuery('#sms_code').val('');var data={phonenumber:phonenumber,otp:otp,};Le.ajaxActionRequest('subscription:resendOTP',data,function(response){if(response.success){mQuery('#send_sms .fa').removeClass('fa-spinner fa-spin').addClass('fa-repeat');maxLimit=61;timeInterval=setInterval(function(){maxLimit=parseInt(maxLimit)-1;mQuery('#send_sms').html('<i class="fa fa-repeat"></i> Resend Code('+maxLimit+')s');if(maxLimit==0){mQuery('#send_sms').removeClass('disabled').attr('disabled',false);mQuery('#send_sms').html('<i class="fa fa-repeat"></i> Resend Code');mQuery('#send_sms').removeClass('disabled');clearInterval(timeInterval);}},1000);var otp=response.otp;var mobile=response.mobile;document.cookie="MobileVerificationOTP="+otp+"; path=/";mQuery('#kyc_otpverification').html('A code was just sent to your mobile phone : <b>'+mobile+'</b>')}});};Le.verifyOTP=function(){mQuery(".alertmsg").css("display","none");document.cookie.indexOf("MobileVerificationOTP");var otp=Le.getCookie('MobileVerificationOTP');var otpcode=mQuery('#sms_code').val();if(otpcode==""){mQuery('.sms_code_div').removeClass('has-success has-error').addClass('has-error');return;}
var data={};if(otp!=""&&otp==otpcode){Le.ajaxActionRequest('subscription:OTPVerified',data,function(response){if(response.success){Le.RedirectToGivenURL(response.redirecturl);}});}else{mQuery(".alertmsg").css("display","block");}};Le.closeAlertMSG=function(){mQuery(".alertmsg").css("display","none");};Le.getCookie=function(cname){var name=cname+"=";var ca=document.cookie.split(';');for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==' '){c=c.substring(1);}
if(c.indexOf(name)==0){return c.substring(name.length,c.length);}}
return"";};Le.invokeRazorPay=function(response,username,useremail,useraddress,planname){var apikey=response.apikey;var subscriptionid=response.subscriptionid
var options={"key":apikey,"subscription_id":subscriptionid,"name":"LeadsEngage","description":planname+" plan upgradtion","image":"https://s3.amazonaws.com/leadsroll.com/Razer-Pay-Icon.png","handler":function(response){var paymentid=response.razorpay_payment_id;var subscriptionid=response.razorpay_subscription_id;var signature=response.razorpay_signature;Le.ajaxActionRequest('subscription:validatepayment',{paymentid:paymentid,subscriptionid:subscriptionid,signature:signature},function(response){if(response.success){Le.redirectWithBackdrop(response.redirect);}else{alert(response.errormsg);}});},"prefill":{"name":username,"email":useremail,"contact":"","method":"card"},"notes":{"address":useraddress},"theme":{"color":"#0066cc"}};var rzp1=new Razorpay(options);rzp1.open();};Le.invokePaypalPay=function(response){Le.redirectWithBackdrop(response.approvalurl);};;Le.welcomeOnLoad=function(){mQuery("#continue-btn").on('click',function(){mQuery(this).val('Please wait...');});};Le.IsProperURL=function(url){regexp=/^(?:(?:https?|ftp):\/\/)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:\/\S*)?$/;if(regexp.test(url)){return true;}else{return false;}};Le.validateFirstTimeSetup=function(){var businessname=mQuery('#welcome_business').val();var currentlist=mQuery('#select_listsize').val();var currentprovider=mQuery('#welcome_currentesp').val();var websiteurl=mQuery('#welcome_websiteurl').val();var address=mQuery('#welcome_address').val();var city=mQuery('#welcome_city').val();var zipcode=mQuery('#welcome_zip').val();var state=mQuery('#selectstate').val();var country=mQuery('#selectcountry').val();var isvalidrequest=true;if(businessname==''){isvalidrequest=false;mQuery('.business_error').removeClass('hide');}
if(websiteurl==''){isvalidrequest=false;mQuery('.website_error').removeClass('hide');}
if(currentlist==''||currentlist=='blank'){isvalidrequest=false;mQuery('.listsize_error').removeClass('hide');}
if(currentprovider==''){isvalidrequest=false;mQuery('.currentesp_error').removeClass('hide');}
if(address==''){isvalidrequest=false;mQuery('.address_error').removeClass('hide');}
if(city==''){isvalidrequest=false;mQuery('.city_error').removeClass('hide');}
if(zipcode==''){isvalidrequest=false;mQuery('.zip_error').removeClass('hide');}
if(state==null||state==''||state=='blank'){isvalidrequest=false;mQuery('.state_error').removeClass('hide');}
if(country==null||country==''||country=='blank'){isvalidrequest=false;mQuery('.country_error').removeClass('hide');}
if(!mQuery('#terms_conditions').prop('checked')){isvalidrequest=false;mQuery('#termsConditions').removeClass('label_control_error').addClass('label_control_error');}
if(!mQuery('#spam_conditions').prop('checked')){isvalidrequest=false;mQuery('#spamConditions').removeClass('label_control_error').addClass('label_control_error');}
if(isvalidrequest){mQuery('#firstTimeSetup_Form').submit();}};